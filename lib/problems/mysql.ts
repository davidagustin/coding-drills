import type { Problem } from '../types';

/**
 * MySQL problems for coding drills
 * Covers MySQL-specific functions and syntax including:
 * - String Functions (CONCAT_WS, SUBSTRING_INDEX, FIELD, FIND_IN_SET)
 * - Date Functions (DATE_FORMAT, STR_TO_DATE, TIMESTAMPDIFF)
 * - Control Flow (IF, CASE, IFNULL, NULLIF, COALESCE)
 * - JSON Functions (JSON_EXTRACT, JSON_ARRAY, JSON_OBJECT, JSON_CONTAINS)
 * - Window Functions (MySQL 8.0+)
 * - Full-Text Search (MATCH AGAINST, BOOLEAN MODE)
 * - User Variables (@variable syntax)
 * - GROUP_CONCAT
 * - INSERT ON DUPLICATE KEY UPDATE
 * - Index Hints
 */

export const mysqlProblems: Problem[] = [
  // ============================================================
  // STRING FUNCTIONS (10 problems)
  // ============================================================
  {
    id: 'mysql-string-001',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'Concatenate with Separator',
    text: 'Use CONCAT_WS to join first_name, middle_name, and last_name with a space separator. The table has columns: id, first_name, middle_name, last_name.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, first_name VARCHAR(50), middle_name VARCHAR(50), last_name VARCHAR(50));\nINSERT INTO employees VALUES (1, 'John', 'Michael', 'Doe');",
    expected: 'John Michael Doe',
    sample: "SELECT CONCAT_WS(' ', first_name, middle_name, last_name) FROM employees;",
    hints: [
      'CONCAT_WS stands for Concatenate With Separator',
      'The first argument is the separator',
      'CONCAT_WS automatically skips NULL values',
    ],
    validPatterns: [
      /CONCAT_WS\s*\(\s*['"]\s+['"]\s*,\s*first_name\s*,\s*middle_name\s*,\s*last_name\s*\)/i,
    ],
    tags: ['string', 'concat', 'mysql-specific'],
  },
  {
    id: 'mysql-string-002',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'Extract Domain from Email',
    text: "Use SUBSTRING_INDEX to extract the domain from an email address. The email column contains 'user@example.com'.",
    setup: 'SELECT from users table with email column',
    setupCode:
      "CREATE TABLE users (id INT, email VARCHAR(100));\nINSERT INTO users VALUES (1, 'user@example.com');",
    expected: 'example.com',
    sample: "SELECT SUBSTRING_INDEX(email, '@', -1) FROM users;",
    hints: [
      'SUBSTRING_INDEX returns substring before/after nth occurrence of delimiter',
      'Negative count means from the right side',
      'Count of -1 returns everything after the last @',
    ],
    validPatterns: [/SUBSTRING_INDEX\s*\(\s*email\s*,\s*['"]@['"]\s*,\s*-1\s*\)/i],
    tags: ['string', 'substring', 'mysql-specific'],
  },
  {
    id: 'mysql-string-003',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'Extract Username from Email',
    text: "Use SUBSTRING_INDEX to extract just the username part from an email address 'john.doe@company.org'.",
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, email VARCHAR(100));\nINSERT INTO users VALUES (1, 'john.doe@company.org');",
    expected: 'john.doe',
    sample: "SELECT SUBSTRING_INDEX(email, '@', 1) FROM users;",
    hints: [
      'Use positive count to get substring before the delimiter',
      'Count of 1 returns everything before the first @',
    ],
    validPatterns: [/SUBSTRING_INDEX\s*\(\s*email\s*,\s*['"]@['"]\s*,\s*1\s*\)/i],
    tags: ['string', 'substring', 'mysql-specific'],
  },
  {
    id: 'mysql-string-004',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'Find Position in Set',
    text: "Use FIELD to find the position of a status value in the order: 'pending', 'processing', 'shipped', 'delivered'. The status column contains 'shipped'.",
    setup: 'SELECT from orders table',
    setupCode:
      "CREATE TABLE orders (id INT, status VARCHAR(20));\nINSERT INTO orders VALUES (1, 'shipped');",
    expected: 3,
    sample: "SELECT FIELD(status, 'pending', 'processing', 'shipped', 'delivered') FROM orders;",
    hints: [
      'FIELD returns the index position of the first argument in the list',
      'Returns 0 if not found',
      'Position is 1-based, not 0-based',
    ],
    validPatterns: [
      /FIELD\s*\(\s*status\s*,\s*['"]pending['"]\s*,\s*['"]processing['"]\s*,\s*['"]shipped['"]\s*,\s*['"]delivered['"]\s*\)/i,
    ],
    tags: ['string', 'field', 'mysql-specific'],
  },
  {
    id: 'mysql-string-005',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'Search in Comma-Separated List',
    text: "Use FIND_IN_SET to check if 'admin' exists in a comma-separated roles column containing 'user,editor,admin'.",
    setup: 'SELECT from users table with roles column',
    setupCode:
      "CREATE TABLE users (id INT, roles VARCHAR(100));\nINSERT INTO users VALUES (1, 'user,editor,admin');",
    expected: 3,
    sample: "SELECT FIND_IN_SET('admin', roles) FROM users;",
    hints: [
      'FIND_IN_SET searches for a string in a comma-separated list',
      'Returns the position (1-based) if found, 0 if not found',
      'Useful for denormalized data with CSV values',
    ],
    validPatterns: [/FIND_IN_SET\s*\(\s*['"]admin['"]\s*,\s*roles\s*\)/i],
    tags: ['string', 'find-in-set', 'mysql-specific'],
  },
  {
    id: 'mysql-string-006',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'Extract Middle Part of Path',
    text: "Use SUBSTRING_INDEX twice to extract 'products' from the path '/api/v1/products/123'. Extract the 3rd segment.",
    setup: 'SELECT from requests table with path column',
    setupCode:
      "CREATE TABLE requests (id INT, path VARCHAR(200));\nINSERT INTO requests VALUES (1, '/api/v1/products/123');",
    expected: 'products',
    sample: "SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(path, '/', 4), '/', -1) FROM requests;",
    hints: [
      'Nest SUBSTRING_INDEX calls to extract middle segments',
      'First call gets up to the 4th slash',
      'Second call gets the last segment of that result',
    ],
    validPatterns: [
      /SUBSTRING_INDEX\s*\(\s*SUBSTRING_INDEX\s*\(\s*path\s*,\s*['"]\/['"]\s*,\s*4\s*\)\s*,\s*['"]\/['"]\s*,\s*-1\s*\)/i,
    ],
    tags: ['string', 'substring', 'nested', 'mysql-specific'],
  },
  {
    id: 'mysql-string-007',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'Sort by Custom Order',
    text: "Use FIELD in ORDER BY to sort statuses in custom order: 'critical', 'high', 'medium', 'low'.",
    setup: 'SELECT from tickets table',
    setupCode:
      "CREATE TABLE tickets (id INT, priority VARCHAR(20));\nINSERT INTO tickets VALUES (1, 'low'), (2, 'critical'), (3, 'medium');",
    expected: 'critical, medium, low',
    sample:
      "SELECT priority FROM tickets ORDER BY FIELD(priority, 'critical', 'high', 'medium', 'low');",
    hints: [
      'FIELD can be used in ORDER BY for custom sorting',
      'Items not in the list get position 0 (sort first)',
    ],
    validPatterns: [
      /ORDER\s+BY\s+FIELD\s*\(\s*priority\s*,\s*['"]critical['"]\s*,\s*['"]high['"]\s*,\s*['"]medium['"]\s*,\s*['"]low['"]\s*\)/i,
    ],
    tags: ['string', 'field', 'order-by', 'mysql-specific'],
  },
  {
    id: 'mysql-string-008',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'Filter by Comma-Separated Values',
    text: "Use FIND_IN_SET in WHERE clause to find all users who have the 'moderator' role in their comma-separated roles column.",
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, name VARCHAR(50), roles VARCHAR(100));\nINSERT INTO users VALUES (1, 'Alice', 'user,moderator'), (2, 'Bob', 'user'), (3, 'Carol', 'admin,moderator');",
    expected: 'Alice, Carol',
    sample: "SELECT name FROM users WHERE FIND_IN_SET('moderator', roles) > 0;",
    hints: [
      'FIND_IN_SET returns 0 when not found',
      'Use > 0 to filter for existence',
      'Can also use != 0 or just the truthy value',
    ],
    validPatterns: [
      /WHERE\s+FIND_IN_SET\s*\(\s*['"]moderator['"]\s*,\s*roles\s*\)\s*>\s*0/i,
      /WHERE\s+FIND_IN_SET\s*\(\s*['"]moderator['"]\s*,\s*roles\s*\)\s*!=\s*0/i,
      /WHERE\s+FIND_IN_SET\s*\(\s*['"]moderator['"]\s*,\s*roles\s*\)\s*<>\s*0/i,
    ],
    tags: ['string', 'find-in-set', 'where', 'mysql-specific'],
  },
  {
    id: 'mysql-string-009',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'Count Items in CSV Column',
    text: "Count the number of tags in a comma-separated tags column. For 'php,mysql,javascript', return 3.",
    setup: 'SELECT from articles table',
    setupCode:
      "CREATE TABLE articles (id INT, tags VARCHAR(200));\nINSERT INTO articles VALUES (1, 'php,mysql,javascript');",
    expected: 3,
    sample: "SELECT LENGTH(tags) - LENGTH(REPLACE(tags, ',', '')) + 1 AS tag_count FROM articles;",
    hints: [
      'Count commas and add 1 to get the number of items',
      'Use LENGTH and REPLACE to count occurrences',
      'Handle empty strings separately if needed',
    ],
    validPatterns: [
      /LENGTH\s*\(\s*tags\s*\)\s*-\s*LENGTH\s*\(\s*REPLACE\s*\(\s*tags\s*,\s*['"],?['"]\s*,\s*['"]{2}\s*\)\s*\)\s*\+\s*1/i,
    ],
    tags: ['string', 'length', 'replace', 'counting', 'mysql-specific'],
  },
  {
    id: 'mysql-string-010',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'Build Full Address with CONCAT_WS',
    text: 'Use CONCAT_WS to build a full address from street, city, state, zip columns, using ", " as separator. Handle NULL values gracefully.',
    setup: 'SELECT from addresses table',
    setupCode:
      "CREATE TABLE addresses (id INT, street VARCHAR(100), city VARCHAR(50), state VARCHAR(2), zip VARCHAR(10));\nINSERT INTO addresses VALUES (1, '123 Main St', 'Boston', 'MA', '02101');",
    expected: '123 Main St, Boston, MA, 02101',
    sample: "SELECT CONCAT_WS(', ', street, city, state, zip) FROM addresses;",
    hints: [
      'CONCAT_WS automatically handles NULL values by skipping them',
      'This is more robust than regular CONCAT which returns NULL if any value is NULL',
    ],
    validPatterns: [
      /CONCAT_WS\s*\(\s*['"],\s*['"]\s*,\s*street\s*,\s*city\s*,\s*state\s*,\s*zip\s*\)/i,
    ],
    tags: ['string', 'concat', 'null-handling', 'mysql-specific'],
  },

  // ============================================================
  // DATE FUNCTIONS (10 problems)
  // ============================================================
  {
    id: 'mysql-date-001',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Format Date as Month Day, Year',
    text: "Use DATE_FORMAT to format a date as 'January 15, 2024' format.",
    setup: 'SELECT from events table with event_date column',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-01-15');",
    expected: 'January 15, 2024',
    sample: "SELECT DATE_FORMAT(event_date, '%M %d, %Y') FROM events;",
    hints: ['%M = full month name', '%d = day with leading zero', '%Y = 4-digit year'],
    validPatterns: [/DATE_FORMAT\s*\(\s*event_date\s*,\s*['"]%M\s+%d,\s+%Y['"]\s*\)/i],
    tags: ['date', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-date-002',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Format Date as DD/MM/YYYY',
    text: 'Use DATE_FORMAT to display a date in European format (DD/MM/YYYY).',
    setup: 'SELECT from orders table with order_date column',
    setupCode:
      "CREATE TABLE orders (id INT, order_date DATE);\nINSERT INTO orders VALUES (1, '2024-03-25');",
    expected: '25/03/2024',
    sample: "SELECT DATE_FORMAT(order_date, '%d/%m/%Y') FROM orders;",
    hints: ['%d = day (01-31)', '%m = month (01-12)', '%Y = 4-digit year'],
    validPatterns: [/DATE_FORMAT\s*\(\s*order_date\s*,\s*['"]%d\/%m\/%Y['"]\s*\)/i],
    tags: ['date', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-date-003',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'Parse String to Date',
    text: "Use STR_TO_DATE to convert '15-Jan-2024' to a proper DATE.",
    setup: 'SELECT statement with string date',
    setupCode: "-- Input string: '15-Jan-2024'",
    expected: '2024-01-15',
    sample: "SELECT STR_TO_DATE('15-Jan-2024', '%d-%b-%Y');",
    hints: [
      '%b = abbreviated month name (Jan, Feb, etc.)',
      'STR_TO_DATE is the reverse of DATE_FORMAT',
    ],
    validPatterns: [/STR_TO_DATE\s*\(\s*['"]15-Jan-2024['"]\s*,\s*['"]%d-%b-%Y['"]\s*\)/i],
    tags: ['date', 'parse', 'conversion', 'mysql-specific'],
  },
  {
    id: 'mysql-date-004',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'Calculate Age in Years',
    text: 'Use TIMESTAMPDIFF to calculate the age in years from a birth_date column to current date.',
    setup: 'SELECT from users table with birth_date column',
    setupCode:
      "CREATE TABLE users (id INT, birth_date DATE);\nINSERT INTO users VALUES (1, '1990-06-15');",
    expected: '33 (or current age)',
    sample: 'SELECT TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) AS age FROM users;',
    hints: [
      'TIMESTAMPDIFF takes unit, start_date, end_date',
      'Unit can be YEAR, MONTH, DAY, HOUR, MINUTE, SECOND',
      'Use CURDATE() for current date',
    ],
    validPatterns: [
      /TIMESTAMPDIFF\s*\(\s*YEAR\s*,\s*birth_date\s*,\s*CURDATE\s*\(\s*\)\s*\)/i,
      /TIMESTAMPDIFF\s*\(\s*YEAR\s*,\s*birth_date\s*,\s*NOW\s*\(\s*\)\s*\)/i,
    ],
    tags: ['date', 'timestampdiff', 'age', 'mysql-specific'],
  },
  {
    id: 'mysql-date-005',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'Days Between Orders',
    text: 'Use TIMESTAMPDIFF to calculate the number of days between order_date and ship_date.',
    setup: 'SELECT from orders table',
    setupCode:
      "CREATE TABLE orders (id INT, order_date DATE, ship_date DATE);\nINSERT INTO orders VALUES (1, '2024-01-10', '2024-01-15');",
    expected: 5,
    sample: 'SELECT TIMESTAMPDIFF(DAY, order_date, ship_date) AS days_to_ship FROM orders;',
    hints: [
      'Use DAY as the unit for day differences',
      'Start date comes before end date in parameters',
    ],
    validPatterns: [/TIMESTAMPDIFF\s*\(\s*DAY\s*,\s*order_date\s*,\s*ship_date\s*\)/i],
    tags: ['date', 'timestampdiff', 'mysql-specific'],
  },
  {
    id: 'mysql-date-006',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Format Time as 12-Hour Clock',
    text: "Use DATE_FORMAT to display a datetime as '03:45 PM' format.",
    setup: 'SELECT from events table with event_time column',
    setupCode:
      "CREATE TABLE events (id INT, event_time DATETIME);\nINSERT INTO events VALUES (1, '2024-01-15 15:45:00');",
    expected: '03:45 PM',
    sample: "SELECT DATE_FORMAT(event_time, '%h:%i %p') FROM events;",
    hints: ['%h = 12-hour format (01-12)', '%i = minutes (00-59)', '%p = AM or PM'],
    validPatterns: [/DATE_FORMAT\s*\(\s*event_time\s*,\s*['"]%h:%i\s*%p['"]\s*\)/i],
    tags: ['date', 'time', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-date-007',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Extract Day of Week Name',
    text: 'Use DATE_FORMAT to get the full weekday name from a date.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-01-15');",
    expected: 'Monday',
    sample: "SELECT DATE_FORMAT(event_date, '%W') FROM events;",
    hints: ['%W = full weekday name', '%w = day of week (0=Sunday, 6=Saturday)'],
    validPatterns: [
      /DATE_FORMAT\s*\(\s*event_date\s*,\s*['"]%W['"]\s*\)/i,
      /DAYNAME\s*\(\s*event_date\s*\)/i,
    ],
    tags: ['date', 'weekday', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-date-008',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'Parse US Date Format',
    text: "Use STR_TO_DATE to convert '03/25/2024' (MM/DD/YYYY) to a DATE.",
    setup: 'SELECT statement',
    setupCode: "-- Input: '03/25/2024'",
    expected: '2024-03-25',
    sample: "SELECT STR_TO_DATE('03/25/2024', '%m/%d/%Y');",
    hints: ['Order of format specifiers must match the input string', '%m = month, %d = day'],
    validPatterns: [/STR_TO_DATE\s*\(\s*['"]03\/25\/2024['"]\s*,\s*['"]%m\/%d\/%Y['"]\s*\)/i],
    tags: ['date', 'parse', 'mysql-specific'],
  },
  {
    id: 'mysql-date-009',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Calculate Months of Tenure',
    text: 'Use TIMESTAMPDIFF to calculate how many complete months an employee has worked from hire_date to today.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, hire_date DATE);\nINSERT INTO employees VALUES (1, '2022-06-15');",
    expected: '19 (varies by current date)',
    sample: 'SELECT TIMESTAMPDIFF(MONTH, hire_date, CURDATE()) AS months_worked FROM employees;',
    hints: ['MONTH unit counts complete months', 'Partial months are not counted'],
    validPatterns: [/TIMESTAMPDIFF\s*\(\s*MONTH\s*,\s*hire_date\s*,\s*CURDATE\s*\(\s*\)\s*\)/i],
    tags: ['date', 'timestampdiff', 'tenure', 'mysql-specific'],
  },
  {
    id: 'mysql-date-010',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'Format ISO Week Number',
    text: "Use DATE_FORMAT to display the ISO week number and year like 'Week 03 of 2024'.",
    setup: 'SELECT from logs table',
    setupCode:
      "CREATE TABLE logs (id INT, log_date DATE);\nINSERT INTO logs VALUES (1, '2024-01-15');",
    expected: 'Week 03 of 2024',
    sample: "SELECT DATE_FORMAT(log_date, 'Week %v of %x') FROM logs;",
    hints: [
      '%v = ISO week number (01-53)',
      '%x = ISO year for the week',
      'ISO weeks start on Monday',
    ],
    validPatterns: [/DATE_FORMAT\s*\(\s*log_date\s*,\s*['"]Week\s+%v\s+of\s+%x['"]\s*\)/i],
    tags: ['date', 'iso-week', 'format', 'mysql-specific'],
  },

  // ============================================================
  // CONTROL FLOW FUNCTIONS (8 problems)
  // ============================================================
  {
    id: 'mysql-control-001',
    category: 'Control Flow',
    difficulty: 'easy',
    title: 'Simple IF Expression',
    text: "Use IF() to return 'Active' if status = 1, otherwise 'Inactive'.",
    setup: 'SELECT from users table with status column',
    setupCode:
      "CREATE TABLE users (id INT, name VARCHAR(50), status INT);\nINSERT INTO users VALUES (1, 'John', 1);",
    expected: 'Active',
    sample: "SELECT IF(status = 1, 'Active', 'Inactive') FROM users;",
    hints: ['IF(condition, true_value, false_value)', 'Similar to ternary operator in programming'],
    validPatterns: [/IF\s*\(\s*status\s*=\s*1\s*,\s*['"]Active['"]\s*,\s*['"]Inactive['"]\s*\)/i],
    tags: ['control-flow', 'if', 'mysql-specific'],
  },
  {
    id: 'mysql-control-002',
    category: 'Control Flow',
    difficulty: 'easy',
    title: 'Handle NULL with IFNULL',
    text: "Use IFNULL to return 'N/A' when the phone column is NULL.",
    setup: 'SELECT from contacts table',
    setupCode:
      "CREATE TABLE contacts (id INT, name VARCHAR(50), phone VARCHAR(20));\nINSERT INTO contacts VALUES (1, 'John', NULL);",
    expected: 'N/A',
    sample: "SELECT IFNULL(phone, 'N/A') FROM contacts;",
    hints: [
      'IFNULL(expr1, expr2) returns expr2 if expr1 is NULL',
      'Simpler than COALESCE for two values',
    ],
    validPatterns: [/IFNULL\s*\(\s*phone\s*,\s*['"]N\/A['"]\s*\)/i],
    tags: ['control-flow', 'null', 'ifnull', 'mysql-specific'],
  },
  {
    id: 'mysql-control-003',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'NULLIF for Division Safety',
    text: 'Use NULLIF to safely divide total_sales by num_orders, avoiding division by zero.',
    setup: 'SELECT from metrics table',
    setupCode:
      'CREATE TABLE metrics (id INT, total_sales DECIMAL(10,2), num_orders INT);\nINSERT INTO metrics VALUES (1, 1000.00, 0);',
    expected: 'NULL (safe)',
    sample: 'SELECT total_sales / NULLIF(num_orders, 0) AS avg_order FROM metrics;',
    hints: [
      'NULLIF(expr1, expr2) returns NULL if expr1 = expr2',
      'Dividing by NULL returns NULL instead of error',
    ],
    validPatterns: [/NULLIF\s*\(\s*num_orders\s*,\s*0\s*\)/i],
    tags: ['control-flow', 'nullif', 'division', 'mysql-specific'],
  },
  {
    id: 'mysql-control-004',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'COALESCE Chain',
    text: 'Use COALESCE to return the first non-NULL value from mobile_phone, home_phone, work_phone, or "No phone".',
    setup: 'SELECT from contacts table',
    setupCode:
      "CREATE TABLE contacts (id INT, mobile_phone VARCHAR(20), home_phone VARCHAR(20), work_phone VARCHAR(20));\nINSERT INTO contacts VALUES (1, NULL, NULL, '555-0100');",
    expected: '555-0100',
    sample: "SELECT COALESCE(mobile_phone, home_phone, work_phone, 'No phone') FROM contacts;",
    hints: [
      'COALESCE returns the first non-NULL argument',
      'Can have any number of arguments',
      'Last argument can be a default value',
    ],
    validPatterns: [
      /COALESCE\s*\(\s*mobile_phone\s*,\s*home_phone\s*,\s*work_phone\s*,\s*['"]No phone['"]\s*\)/i,
    ],
    tags: ['control-flow', 'coalesce', 'null', 'mysql-specific'],
  },
  {
    id: 'mysql-control-005',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'CASE Expression for Grade',
    text: "Use CASE to convert numeric score to letter grade: >= 90 = 'A', >= 80 = 'B', >= 70 = 'C', >= 60 = 'D', else 'F'.",
    setup: 'SELECT from students table',
    setupCode:
      "CREATE TABLE students (id INT, name VARCHAR(50), score INT);\nINSERT INTO students VALUES (1, 'Alice', 85);",
    expected: 'B',
    sample:
      "SELECT CASE WHEN score >= 90 THEN 'A' WHEN score >= 80 THEN 'B' WHEN score >= 70 THEN 'C' WHEN score >= 60 THEN 'D' ELSE 'F' END FROM students;",
    hints: [
      'CASE WHEN condition THEN result ... ELSE default END',
      'Conditions are evaluated in order',
    ],
    validPatterns: [
      /CASE\s+WHEN\s+score\s*>=\s*90\s+THEN\s+['"]A['"]\s+WHEN\s+score\s*>=\s*80\s+THEN\s+['"]B['"]/i,
    ],
    tags: ['control-flow', 'case', 'mysql-specific'],
  },
  {
    id: 'mysql-control-006',
    category: 'Control Flow',
    difficulty: 'easy',
    title: 'Simple CASE Switch',
    text: "Use simple CASE syntax to convert status codes: 1 = 'Pending', 2 = 'Approved', 3 = 'Rejected'.",
    setup: 'SELECT from applications table',
    setupCode:
      'CREATE TABLE applications (id INT, status_code INT);\nINSERT INTO applications VALUES (1, 2);',
    expected: 'Approved',
    sample:
      "SELECT CASE status_code WHEN 1 THEN 'Pending' WHEN 2 THEN 'Approved' WHEN 3 THEN 'Rejected' END FROM applications;",
    hints: [
      'Simple CASE: CASE expression WHEN value THEN result',
      'Compares expression to each value',
    ],
    validPatterns: [
      /CASE\s+status_code\s+WHEN\s+1\s+THEN\s+['"]Pending['"]\s+WHEN\s+2\s+THEN\s+['"]Approved['"]\s+WHEN\s+3\s+THEN\s+['"]Rejected['"]/i,
    ],
    tags: ['control-flow', 'case', 'mysql-specific'],
  },
  {
    id: 'mysql-control-007',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'Nested IF for Category',
    text: "Use nested IF to categorize price: < 10 = 'Budget', < 50 = 'Standard', < 100 = 'Premium', else 'Luxury'.",
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50), price DECIMAL(10,2));\nINSERT INTO products VALUES (1, 'Widget', 75.00);",
    expected: 'Premium',
    sample:
      "SELECT IF(price < 10, 'Budget', IF(price < 50, 'Standard', IF(price < 100, 'Premium', 'Luxury'))) FROM products;",
    hints: ['Nest IF() calls for multiple conditions', 'CASE is often cleaner for many conditions'],
    validPatterns: [/IF\s*\(\s*price\s*<\s*10\s*,\s*['"]Budget['"]\s*,\s*IF\s*\(/i],
    tags: ['control-flow', 'if', 'nested', 'mysql-specific'],
  },
  {
    id: 'mysql-control-008',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'COALESCE with Calculation',
    text: 'Use COALESCE to calculate total price as (quantity * COALESCE(discount_price, regular_price)).',
    setup: 'SELECT from order_items table',
    setupCode:
      'CREATE TABLE order_items (id INT, quantity INT, regular_price DECIMAL(10,2), discount_price DECIMAL(10,2));\nINSERT INTO order_items VALUES (1, 3, 100.00, 80.00);',
    expected: 240.0,
    sample: 'SELECT quantity * COALESCE(discount_price, regular_price) AS total FROM order_items;',
    hints: [
      'COALESCE picks the first non-NULL value',
      'Use discount_price if available, otherwise regular_price',
    ],
    validPatterns: [/quantity\s*\*\s*COALESCE\s*\(\s*discount_price\s*,\s*regular_price\s*\)/i],
    tags: ['control-flow', 'coalesce', 'calculation', 'mysql-specific'],
  },

  // ============================================================
  // JSON FUNCTIONS (10 problems)
  // ============================================================
  {
    id: 'mysql-json-001',
    category: 'JSON Functions',
    difficulty: 'easy',
    title: 'Extract JSON Value',
    text: 'Use JSON_EXTRACT to get the \'name\' field from a JSON column data = \'{"name": "John", "age": 30}\'.',
    setup: 'SELECT from profiles table with data JSON column',
    setupCode:
      'CREATE TABLE profiles (id INT, data JSON);\nINSERT INTO profiles VALUES (1, \'{"name": "John", "age": 30}\');',
    expected: '"John"',
    sample: "SELECT JSON_EXTRACT(data, '$.name') FROM profiles;",
    hints: [
      '$ represents the root of the JSON document',
      '$.key accesses a key at the root level',
      'Returns JSON-formatted result (with quotes for strings)',
    ],
    validPatterns: [
      /JSON_EXTRACT\s*\(\s*data\s*,\s*['"]?\$\.name['"]?\s*\)/i,
      /data\s*->\s*['"]?\$\.name['"]?/i,
    ],
    tags: ['json', 'extract', 'mysql-specific'],
  },
  {
    id: 'mysql-json-002',
    category: 'JSON Functions',
    difficulty: 'easy',
    title: 'JSON Arrow Operator',
    text: "Use the -> operator shorthand to extract 'email' from JSON column.",
    setup: 'SELECT from users table with info JSON column',
    setupCode:
      'CREATE TABLE users (id INT, info JSON);\nINSERT INTO users VALUES (1, \'{"email": "john@example.com"}\');',
    expected: '"john@example.com"',
    sample: "SELECT info->'$.email' FROM users;",
    hints: ['-> is shorthand for JSON_EXTRACT', 'MySQL 5.7+ supports this syntax'],
    validPatterns: [
      /info\s*->\s*['"]?\$\.email['"]?/i,
      /JSON_EXTRACT\s*\(\s*info\s*,\s*['"]?\$\.email['"]?\s*\)/i,
    ],
    tags: ['json', 'operator', 'mysql-specific'],
  },
  {
    id: 'mysql-json-003',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON Unquote Extraction',
    text: "Use ->> operator to extract 'city' as unquoted text from JSON column.",
    setup: 'SELECT from customers table',
    setupCode:
      'CREATE TABLE customers (id INT, address JSON);\nINSERT INTO customers VALUES (1, \'{"city": "Boston", "zip": "02101"}\');',
    expected: 'Boston',
    sample: "SELECT address->>'$.city' FROM customers;",
    hints: ['->> extracts and unquotes the value', 'Equivalent to JSON_UNQUOTE(JSON_EXTRACT(...))'],
    validPatterns: [
      /address\s*->>\s*['"]?\$\.city['"]?/i,
      /JSON_UNQUOTE\s*\(\s*JSON_EXTRACT\s*\(\s*address\s*,\s*['"]?\$\.city['"]?\s*\)\s*\)/i,
    ],
    tags: ['json', 'unquote', 'mysql-specific'],
  },
  {
    id: 'mysql-json-004',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'Create JSON Object',
    text: "Use JSON_OBJECT to create a JSON object with keys 'id', 'name', 'active' from table columns.",
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, name VARCHAR(50), active BOOLEAN);\nINSERT INTO users VALUES (1, 'John', TRUE);",
    expected: '{"id": 1, "name": "John", "active": true}',
    sample: "SELECT JSON_OBJECT('id', id, 'name', name, 'active', active) FROM users;",
    hints: [
      "JSON_OBJECT('key1', value1, 'key2', value2, ...)",
      'Keys and values alternate in the argument list',
    ],
    validPatterns: [
      /JSON_OBJECT\s*\(\s*['"]id['"]\s*,\s*id\s*,\s*['"]name['"]\s*,\s*name\s*,\s*['"]active['"]\s*,\s*active\s*\)/i,
    ],
    tags: ['json', 'create', 'mysql-specific'],
  },
  {
    id: 'mysql-json-005',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'Create JSON Array',
    text: 'Use JSON_ARRAY to create a JSON array from multiple column values.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50), price DECIMAL(10,2), category VARCHAR(50));\nINSERT INTO products VALUES (1, 'Widget', 19.99, 'Electronics');",
    expected: '[1, "Widget", 19.99, "Electronics"]',
    sample: 'SELECT JSON_ARRAY(id, name, price, category) FROM products;',
    hints: [
      'JSON_ARRAY(val1, val2, ...) creates an array',
      'Values are converted to JSON types automatically',
    ],
    validPatterns: [/JSON_ARRAY\s*\(\s*id\s*,\s*name\s*,\s*price\s*,\s*category\s*\)/i],
    tags: ['json', 'array', 'mysql-specific'],
  },
  {
    id: 'mysql-json-006',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'Check JSON Contains Value',
    text: "Use JSON_CONTAINS to check if a JSON array column 'tags' contains the value 'urgent'.",
    setup: 'SELECT from tickets table',
    setupCode:
      'CREATE TABLE tickets (id INT, tags JSON);\nINSERT INTO tickets VALUES (1, \'["support", "urgent", "billing"]\');',
    expected: 1,
    sample: 'SELECT JSON_CONTAINS(tags, \'"urgent"\') FROM tickets;',
    hints: [
      'Second argument must be valid JSON (quoted for strings)',
      'Returns 1 if contained, 0 if not',
    ],
    validPatterns: [/JSON_CONTAINS\s*\(\s*tags\s*,\s*['"]['"]?urgent['"]?['"]\s*\)/i],
    tags: ['json', 'contains', 'mysql-specific'],
  },
  {
    id: 'mysql-json-007',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'Extract Nested JSON',
    text: 'Use JSON_EXTRACT to get the city from nested JSON: \'{"address": {"city": "Boston", "state": "MA"}}\'.',
    setup: 'SELECT from customers table',
    setupCode:
      'CREATE TABLE customers (id INT, data JSON);\nINSERT INTO customers VALUES (1, \'{"address": {"city": "Boston", "state": "MA"}}\');',
    expected: '"Boston"',
    sample: "SELECT JSON_EXTRACT(data, '$.address.city') FROM customers;",
    hints: [
      'Use dot notation for nested paths',
      '$.address.city navigates to address object then city key',
    ],
    validPatterns: [
      /JSON_EXTRACT\s*\(\s*data\s*,\s*['"]?\$\.address\.city['"]?\s*\)/i,
      /data\s*->\s*['"]?\$\.address\.city['"]?/i,
    ],
    tags: ['json', 'nested', 'mysql-specific'],
  },
  {
    id: 'mysql-json-008',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'Extract Array Element',
    text: 'Use JSON_EXTRACT to get the second item (index 1) from JSON array \'["apple", "banana", "cherry"]\'.',
    setup: 'SELECT from baskets table',
    setupCode:
      'CREATE TABLE baskets (id INT, fruits JSON);\nINSERT INTO baskets VALUES (1, \'["apple", "banana", "cherry"]\');',
    expected: '"banana"',
    sample: "SELECT JSON_EXTRACT(fruits, '$[1]') FROM baskets;",
    hints: ['Use $[index] for array elements', 'Arrays are 0-indexed'],
    validPatterns: [
      /JSON_EXTRACT\s*\(\s*fruits\s*,\s*['"]?\$\[1\]['"]?\s*\)/i,
      /fruits\s*->\s*['"]?\$\[1\]['"]?/i,
    ],
    tags: ['json', 'array', 'index', 'mysql-specific'],
  },
  {
    id: 'mysql-json-009',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Search for Key',
    text: "Use JSON_SEARCH to find the path to value 'premium' in JSON object.",
    setup: 'SELECT from subscriptions table',
    setupCode:
      'CREATE TABLE subscriptions (id INT, details JSON);\nINSERT INTO subscriptions VALUES (1, \'{"plan": "premium", "status": "active"}\');',
    expected: '"$.plan"',
    sample: "SELECT JSON_SEARCH(details, 'one', 'premium') FROM subscriptions;",
    hints: [
      'JSON_SEARCH returns the path to the value',
      "'one' returns first match, 'all' returns all matches",
    ],
    validPatterns: [/JSON_SEARCH\s*\(\s*details\s*,\s*['"]one['"]\s*,\s*['"]premium['"]\s*\)/i],
    tags: ['json', 'search', 'mysql-specific'],
  },
  {
    id: 'mysql-json-010',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON Array Length',
    text: "Use JSON_LENGTH to count the number of items in a JSON array column 'items'.",
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT, items JSON);\nINSERT INTO orders VALUES (1, \'[{"sku": "A1"}, {"sku": "B2"}, {"sku": "C3"}]\');',
    expected: 3,
    sample: 'SELECT JSON_LENGTH(items) FROM orders;',
    hints: [
      'JSON_LENGTH returns number of elements in array',
      'For objects, returns number of keys',
    ],
    validPatterns: [/JSON_LENGTH\s*\(\s*items\s*\)/i],
    tags: ['json', 'length', 'mysql-specific'],
  },

  // ============================================================
  // WINDOW FUNCTIONS (8 problems)
  // ============================================================
  {
    id: 'mysql-window-001',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Row Number by Department',
    text: 'Use ROW_NUMBER() to assign sequential numbers to employees within each department, ordered by salary descending.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50), salary DECIMAL(10,2));\nINSERT INTO employees VALUES (1, 'Alice', 'Engineering', 90000);",
    expected: 'row_num = 1 for highest salary in each dept',
    sample:
      'SELECT name, department, salary, ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) AS row_num FROM employees;',
    hints: [
      'PARTITION BY divides rows into groups',
      'ORDER BY determines the numbering order',
      'ROW_NUMBER() assigns unique sequential integers',
    ],
    validPatterns: [
      /ROW_NUMBER\s*\(\s*\)\s+OVER\s*\(\s*PARTITION\s+BY\s+department\s+ORDER\s+BY\s+salary\s+DESC\s*\)/i,
    ],
    tags: ['window', 'row-number', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-002',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Rank with Ties',
    text: 'Use RANK() to rank products by sales, allowing for ties (same rank for equal values).',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50), sales INT);\nINSERT INTO products VALUES (1, 'A', 100), (2, 'B', 100), (3, 'C', 80);",
    expected: 'A=1, B=1, C=3',
    sample: 'SELECT name, sales, RANK() OVER (ORDER BY sales DESC) AS sales_rank FROM products;',
    hints: [
      'RANK() assigns same rank for equal values',
      'Leaves gaps after ties (1, 1, 3 not 1, 1, 2)',
    ],
    validPatterns: [/RANK\s*\(\s*\)\s+OVER\s*\(\s*ORDER\s+BY\s+sales\s+DESC\s*\)/i],
    tags: ['window', 'rank', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-003',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Dense Rank',
    text: 'Use DENSE_RANK() to rank products without gaps after ties.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50), sales INT);\nINSERT INTO products VALUES (1, 'A', 100), (2, 'B', 100), (3, 'C', 80);",
    expected: 'A=1, B=1, C=2',
    sample:
      'SELECT name, sales, DENSE_RANK() OVER (ORDER BY sales DESC) AS sales_rank FROM products;',
    hints: ['DENSE_RANK() does not leave gaps after ties', 'Results: 1, 1, 2 instead of 1, 1, 3'],
    validPatterns: [/DENSE_RANK\s*\(\s*\)\s+OVER\s*\(\s*ORDER\s+BY\s+sales\s+DESC\s*\)/i],
    tags: ['window', 'dense-rank', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-004',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Running Total',
    text: 'Use SUM() as window function to calculate running total of order_amount ordered by order_date.',
    setup: 'SELECT from orders table',
    setupCode:
      "CREATE TABLE orders (id INT, order_date DATE, order_amount DECIMAL(10,2));\nINSERT INTO orders VALUES (1, '2024-01-01', 100.00), (2, '2024-01-02', 150.00);",
    expected: '100.00, 250.00',
    sample:
      'SELECT order_date, order_amount, SUM(order_amount) OVER (ORDER BY order_date) AS running_total FROM orders;',
    hints: [
      'Aggregate functions can be used as window functions',
      'ORDER BY without PARTITION BY creates running aggregates',
    ],
    validPatterns: [/SUM\s*\(\s*order_amount\s*\)\s+OVER\s*\(\s*ORDER\s+BY\s+order_date\s*\)/i],
    tags: ['window', 'sum', 'running-total', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-005',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'LAG - Previous Row Value',
    text: "Use LAG() to get the previous day's closing price for stock comparison.",
    setup: 'SELECT from stock_prices table',
    setupCode:
      "CREATE TABLE stock_prices (id INT, trade_date DATE, close_price DECIMAL(10,2));\nINSERT INTO stock_prices VALUES (1, '2024-01-01', 100.00), (2, '2024-01-02', 105.00);",
    expected: 'prev_close = NULL, 100.00',
    sample:
      'SELECT trade_date, close_price, LAG(close_price, 1) OVER (ORDER BY trade_date) AS prev_close FROM stock_prices;',
    hints: [
      'LAG(column, offset) gets value from previous rows',
      'Default offset is 1',
      'Returns NULL for first row',
    ],
    validPatterns: [
      /LAG\s*\(\s*close_price\s*(,\s*1)?\s*\)\s+OVER\s*\(\s*ORDER\s+BY\s+trade_date\s*\)/i,
    ],
    tags: ['window', 'lag', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-006',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'LEAD - Next Row Value',
    text: 'Use LEAD() to get the next scheduled appointment for each patient.',
    setup: 'SELECT from appointments table',
    setupCode:
      "CREATE TABLE appointments (id INT, patient_id INT, appt_date DATE);\nINSERT INTO appointments VALUES (1, 1, '2024-01-15'), (2, 1, '2024-02-15');",
    expected: 'next_appt = 2024-02-15, NULL',
    sample:
      'SELECT patient_id, appt_date, LEAD(appt_date, 1) OVER (PARTITION BY patient_id ORDER BY appt_date) AS next_appt FROM appointments;',
    hints: [
      'LEAD(column, offset) gets value from following rows',
      'PARTITION BY groups by patient for individual sequences',
    ],
    validPatterns: [
      /LEAD\s*\(\s*appt_date\s*(,\s*1)?\s*\)\s+OVER\s*\(\s*PARTITION\s+BY\s+patient_id\s+ORDER\s+BY\s+appt_date\s*\)/i,
    ],
    tags: ['window', 'lead', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-007',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'NTILE Distribution',
    text: 'Use NTILE(4) to divide products into 4 quartiles based on price.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, name VARCHAR(50), price DECIMAL(10,2));',
    expected: 'Each product assigned to quartile 1-4',
    sample: 'SELECT name, price, NTILE(4) OVER (ORDER BY price) AS price_quartile FROM products;',
    hints: [
      'NTILE(n) divides rows into n roughly equal groups',
      'Useful for percentile/quartile analysis',
    ],
    validPatterns: [/NTILE\s*\(\s*4\s*\)\s+OVER\s*\(\s*ORDER\s+BY\s+price\s*\)/i],
    tags: ['window', 'ntile', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-window-008',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Moving Average',
    text: 'Calculate a 3-day moving average of sales using window frame specification.',
    setup: 'SELECT from daily_sales table',
    setupCode: 'CREATE TABLE daily_sales (id INT, sale_date DATE, amount DECIMAL(10,2));',
    expected: 'Rolling 3-day average for each row',
    sample:
      'SELECT sale_date, amount, AVG(amount) OVER (ORDER BY sale_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg FROM daily_sales;',
    hints: ['ROWS BETWEEN defines the window frame', '2 PRECEDING AND CURRENT ROW = last 3 rows'],
    validPatterns: [
      /AVG\s*\(\s*amount\s*\)\s+OVER\s*\(\s*ORDER\s+BY\s+sale_date\s+ROWS\s+BETWEEN\s+2\s+PRECEDING\s+AND\s+CURRENT\s+ROW\s*\)/i,
    ],
    tags: ['window', 'moving-average', 'frame', 'mysql-8', 'mysql-specific'],
  },

  // ============================================================
  // FULL-TEXT SEARCH (5 problems)
  // ============================================================
  {
    id: 'mysql-fts-001',
    category: 'Full-Text Search',
    difficulty: 'medium',
    title: 'Basic Full-Text Search',
    text: "Use MATCH AGAINST to search for articles containing 'database optimization'.",
    setup: 'SELECT from articles table with FULLTEXT index on content',
    setupCode:
      "CREATE TABLE articles (id INT, title VARCHAR(200), content TEXT, FULLTEXT(content));\nINSERT INTO articles VALUES (1, 'DB Tips', 'database optimization techniques');",
    expected: 'Matching articles returned',
    sample: "SELECT * FROM articles WHERE MATCH(content) AGAINST('database optimization');",
    hints: [
      'MATCH AGAINST performs full-text search',
      'Requires FULLTEXT index on the column',
      'Natural language mode is default',
    ],
    validPatterns: [
      /MATCH\s*\(\s*content\s*\)\s+AGAINST\s*\(\s*['"]database\s+optimization['"]\s*\)/i,
    ],
    tags: ['fulltext', 'search', 'mysql-specific'],
  },
  {
    id: 'mysql-fts-002',
    category: 'Full-Text Search',
    difficulty: 'medium',
    title: 'Boolean Mode Search',
    text: "Use BOOLEAN MODE to find articles that must contain 'mysql' but not 'oracle'.",
    setup: 'SELECT from articles table with FULLTEXT index',
    setupCode: 'CREATE TABLE articles (id INT, content TEXT, FULLTEXT(content));',
    expected: 'Articles with mysql but not oracle',
    sample:
      "SELECT * FROM articles WHERE MATCH(content) AGAINST('+mysql -oracle' IN BOOLEAN MODE);",
    hints: [
      '+ means word must be present',
      '- means word must be absent',
      'IN BOOLEAN MODE enables operators',
    ],
    validPatterns: [
      /MATCH\s*\(\s*content\s*\)\s+AGAINST\s*\(\s*['"]\+mysql\s+-oracle['"]\s+IN\s+BOOLEAN\s+MODE\s*\)/i,
    ],
    tags: ['fulltext', 'boolean', 'mysql-specific'],
  },
  {
    id: 'mysql-fts-003',
    category: 'Full-Text Search',
    difficulty: 'hard',
    title: 'Relevance Score',
    text: 'Select articles and their relevance score for the search term, ordered by relevance.',
    setup: 'SELECT from articles table',
    setupCode:
      'CREATE TABLE articles (id INT, title VARCHAR(200), content TEXT, FULLTEXT(content));',
    expected: 'Articles with relevance score, highest first',
    sample:
      "SELECT title, MATCH(content) AGAINST('performance tuning') AS relevance FROM articles WHERE MATCH(content) AGAINST('performance tuning') ORDER BY relevance DESC;",
    hints: [
      'MATCH AGAINST returns a relevance score when used in SELECT',
      'Higher score = more relevant',
      'Need to repeat MATCH AGAINST in WHERE and SELECT',
    ],
    validPatterns: [/SELECT\s+.*MATCH\s*\(\s*content\s*\)\s+AGAINST\s*\(.*\)\s+AS\s+relevance/i],
    tags: ['fulltext', 'relevance', 'mysql-specific'],
  },
  {
    id: 'mysql-fts-004',
    category: 'Full-Text Search',
    difficulty: 'hard',
    title: 'Phrase Search',
    text: "Use Boolean mode to search for the exact phrase 'query optimization' using double quotes.",
    setup: 'SELECT from tutorials table',
    setupCode: 'CREATE TABLE tutorials (id INT, content TEXT, FULLTEXT(content));',
    expected: 'Only articles with exact phrase',
    sample:
      'SELECT * FROM tutorials WHERE MATCH(content) AGAINST(\'"query optimization"\' IN BOOLEAN MODE);',
    hints: [
      'Wrap phrase in double quotes for exact matching',
      'Outer quotes are SQL string delimiters',
      'Inner double quotes are for phrase matching',
    ],
    validPatterns: [
      /MATCH\s*\(\s*content\s*\)\s+AGAINST\s*\(\s*['"]['"]query\s+optimization['"]['"].*IN\s+BOOLEAN\s+MODE\s*\)/i,
    ],
    tags: ['fulltext', 'phrase', 'boolean', 'mysql-specific'],
  },
  {
    id: 'mysql-fts-005',
    category: 'Full-Text Search',
    difficulty: 'medium',
    title: 'Wildcard Search',
    text: "Use Boolean mode with * wildcard to find words starting with 'optim' (optimization, optimize, etc.).",
    setup: 'SELECT from articles table',
    setupCode: 'CREATE TABLE articles (id INT, content TEXT, FULLTEXT(content));',
    expected: 'Articles containing words starting with optim',
    sample: "SELECT * FROM articles WHERE MATCH(content) AGAINST('optim*' IN BOOLEAN MODE);",
    hints: [
      '* is a wildcard for any characters',
      'Only works as suffix (word*), not prefix (*word)',
      'Must use BOOLEAN MODE for wildcards',
    ],
    validPatterns: [
      /MATCH\s*\(\s*content\s*\)\s+AGAINST\s*\(\s*['"]optim\*['"]\s+IN\s+BOOLEAN\s+MODE\s*\)/i,
    ],
    tags: ['fulltext', 'wildcard', 'boolean', 'mysql-specific'],
  },

  // ============================================================
  // USER VARIABLES (4 problems)
  // ============================================================
  {
    id: 'mysql-var-001',
    category: 'User Variables',
    difficulty: 'easy',
    title: 'Set and Use Variable',
    text: 'Set a user variable @tax_rate to 0.08 and use it to calculate tax on price.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50), price DECIMAL(10,2));\nINSERT INTO products VALUES (1, 'Widget', 100.00);",
    expected: 'tax = 8.00',
    sample: 'SET @tax_rate = 0.08;\nSELECT name, price, price * @tax_rate AS tax FROM products;',
    hints: [
      'User variables start with @',
      'SET @var = value assigns the value',
      'Variables persist for the session',
    ],
    validPatterns: [/SET\s+@tax_rate\s*=\s*0\.08/i, /@tax_rate/i],
    tags: ['variables', 'session', 'mysql-specific'],
  },
  {
    id: 'mysql-var-002',
    category: 'User Variables',
    difficulty: 'medium',
    title: 'Row Counter Variable',
    text: 'Use a user variable to create a row counter without ROW_NUMBER() (pre-MySQL 8.0 technique).',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, name VARCHAR(50));\nINSERT INTO employees VALUES (1, 'Alice'), (2, 'Bob');",
    expected: 'row_num: 1, 2',
    sample: 'SET @row_num = 0;\nSELECT @row_num := @row_num + 1 AS row_num, name FROM employees;',
    hints: [
      ':= is the assignment operator in SELECT',
      'Variable is incremented for each row',
      'Pre-MySQL 8.0 technique for row numbering',
    ],
    validPatterns: [/@row_num\s*:=\s*@row_num\s*\+\s*1/i],
    tags: ['variables', 'row-number', 'legacy', 'mysql-specific'],
  },
  {
    id: 'mysql-var-003',
    category: 'User Variables',
    difficulty: 'hard',
    title: 'Capture Value in Variable',
    text: 'Capture the maximum salary into a variable and use it to find all employees with that salary.',
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, name VARCHAR(50), salary DECIMAL(10,2));',
    expected: 'Employees with max salary',
    sample:
      'SELECT @max_salary := MAX(salary) FROM employees;\nSELECT name, salary FROM employees WHERE salary = @max_salary;',
    hints: [
      'First query captures the value',
      'Second query uses the variable',
      'Alternative to subquery approach',
    ],
    validPatterns: [/@max_salary\s*:=\s*MAX\s*\(\s*salary\s*\)/i],
    tags: ['variables', 'capture', 'mysql-specific'],
  },
  {
    id: 'mysql-var-004',
    category: 'User Variables',
    difficulty: 'medium',
    title: 'Variable in LIMIT',
    text: 'Set page size and page number variables for pagination.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, name VARCHAR(50));',
    expected: 'Paginated results using variables',
    sample:
      "SET @page_size = 10;\nSET @page_num = 2;\nSET @offset = (@page_num - 1) * @page_size;\nPREPARE stmt FROM 'SELECT * FROM products LIMIT ?, ?';\nEXECUTE stmt USING @offset, @page_size;",
    hints: [
      'LIMIT does not accept variables directly',
      'Use PREPARE/EXECUTE for dynamic LIMIT',
      'Calculate offset from page number',
    ],
    validPatterns: [/PREPARE\s+\w+\s+FROM[\s\S]*LIMIT\s*\?[\s\S]*EXECUTE[\s\S]*USING/i],
    tags: ['variables', 'pagination', 'prepared', 'mysql-specific'],
  },

  // ============================================================
  // GROUP_CONCAT (5 problems)
  // ============================================================
  {
    id: 'mysql-groupconcat-001',
    category: 'GROUP_CONCAT',
    difficulty: 'easy',
    title: 'Basic GROUP_CONCAT',
    text: 'Use GROUP_CONCAT to list all product names for each category.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50), category VARCHAR(50));\nINSERT INTO products VALUES (1, 'Apple', 'Fruit'), (2, 'Banana', 'Fruit'), (3, 'Carrot', 'Vegetable');",
    expected: "Fruit: 'Apple,Banana', Vegetable: 'Carrot'",
    sample: 'SELECT category, GROUP_CONCAT(name) AS products FROM products GROUP BY category;',
    hints: [
      'GROUP_CONCAT aggregates string values',
      'Default separator is comma',
      'Must use with GROUP BY',
    ],
    validPatterns: [/GROUP_CONCAT\s*\(\s*name\s*\)/i],
    tags: ['group-concat', 'aggregate', 'mysql-specific'],
  },
  {
    id: 'mysql-groupconcat-002',
    category: 'GROUP_CONCAT',
    difficulty: 'medium',
    title: 'GROUP_CONCAT with Custom Separator',
    text: "Use GROUP_CONCAT with ' | ' as separator to list employee names by department.",
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50));',
    expected: "Engineering: 'Alice | Bob | Carol'",
    sample:
      "SELECT department, GROUP_CONCAT(name SEPARATOR ' | ') AS team FROM employees GROUP BY department;",
    hints: [
      "SEPARATOR 'custom' changes the delimiter",
      'Place SEPARATOR clause inside GROUP_CONCAT',
    ],
    validPatterns: [/GROUP_CONCAT\s*\(\s*name\s+SEPARATOR\s+['"] \| ['"]\s*\)/i],
    tags: ['group-concat', 'separator', 'mysql-specific'],
  },
  {
    id: 'mysql-groupconcat-003',
    category: 'GROUP_CONCAT',
    difficulty: 'medium',
    title: 'GROUP_CONCAT with ORDER BY',
    text: 'Use GROUP_CONCAT to list product names alphabetically within each category.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, name VARCHAR(50), category VARCHAR(50));',
    expected: 'Names sorted alphabetically per category',
    sample:
      'SELECT category, GROUP_CONCAT(name ORDER BY name ASC) AS products FROM products GROUP BY category;',
    hints: ['ORDER BY goes inside GROUP_CONCAT', 'Controls order of concatenated values'],
    validPatterns: [/GROUP_CONCAT\s*\(\s*name\s+ORDER\s+BY\s+name(\s+ASC)?\s*\)/i],
    tags: ['group-concat', 'order', 'mysql-specific'],
  },
  {
    id: 'mysql-groupconcat-004',
    category: 'GROUP_CONCAT',
    difficulty: 'hard',
    title: 'GROUP_CONCAT with DISTINCT',
    text: 'Use GROUP_CONCAT with DISTINCT to list unique tags per article.',
    setup: 'SELECT from article_tags table',
    setupCode: 'CREATE TABLE article_tags (article_id INT, tag VARCHAR(50));',
    expected: 'Unique tags only, no duplicates',
    sample:
      'SELECT article_id, GROUP_CONCAT(DISTINCT tag ORDER BY tag) AS tags FROM article_tags GROUP BY article_id;',
    hints: ['DISTINCT removes duplicate values', 'Place DISTINCT after opening parenthesis'],
    validPatterns: [/GROUP_CONCAT\s*\(\s*DISTINCT\s+tag/i],
    tags: ['group-concat', 'distinct', 'mysql-specific'],
  },
  {
    id: 'mysql-groupconcat-005',
    category: 'GROUP_CONCAT',
    difficulty: 'hard',
    title: 'GROUP_CONCAT Complete Example',
    text: "Combine DISTINCT, ORDER BY, and custom SEPARATOR in GROUP_CONCAT to list unique product names by category, sorted, separated by ' - '.",
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, name VARCHAR(50), category VARCHAR(50));',
    expected: 'Sorted unique names with custom separator',
    sample:
      "SELECT category, GROUP_CONCAT(DISTINCT name ORDER BY name SEPARATOR ' - ') AS products FROM products GROUP BY category;",
    hints: [
      'Order: DISTINCT, expression, ORDER BY, SEPARATOR',
      'All clauses go inside GROUP_CONCAT parentheses',
    ],
    validPatterns: [
      /GROUP_CONCAT\s*\(\s*DISTINCT\s+name\s+ORDER\s+BY\s+name(\s+ASC)?\s+SEPARATOR\s+['"]\s*-\s*['"]\s*\)/i,
    ],
    tags: ['group-concat', 'complete', 'mysql-specific'],
  },

  // ============================================================
  // INSERT ON DUPLICATE KEY UPDATE (4 problems)
  // ============================================================
  {
    id: 'mysql-upsert-001',
    category: 'INSERT ON DUPLICATE KEY',
    difficulty: 'medium',
    title: 'Basic Upsert',
    text: 'Use INSERT ON DUPLICATE KEY UPDATE to insert or update a user record. If email exists, update the name.',
    setup: 'INSERT into users table with unique email',
    setupCode:
      "CREATE TABLE users (id INT AUTO_INCREMENT PRIMARY KEY, email VARCHAR(100) UNIQUE, name VARCHAR(50));\nINSERT INTO users VALUES (1, 'john@example.com', 'John');",
    expected: 'Insert new or update existing',
    sample:
      "INSERT INTO users (email, name) VALUES ('john@example.com', 'John Doe') ON DUPLICATE KEY UPDATE name = VALUES(name);",
    hints: [
      'ON DUPLICATE KEY UPDATE runs on unique/primary key conflict',
      'VALUES(column) references the value from INSERT',
    ],
    validPatterns: [
      /INSERT\s+INTO\s+users.*ON\s+DUPLICATE\s+KEY\s+UPDATE\s+name\s*=\s*VALUES\s*\(\s*name\s*\)/i,
    ],
    tags: ['upsert', 'duplicate-key', 'mysql-specific'],
  },
  {
    id: 'mysql-upsert-002',
    category: 'INSERT ON DUPLICATE KEY',
    difficulty: 'medium',
    title: 'Increment Counter on Duplicate',
    text: 'Use INSERT ON DUPLICATE KEY UPDATE to increment a view_count when a page is visited again.',
    setup: 'INSERT into page_views table',
    setupCode:
      'CREATE TABLE page_views (page_url VARCHAR(200) PRIMARY KEY, view_count INT DEFAULT 1);',
    expected: 'Insert with count 1, or increment existing',
    sample:
      "INSERT INTO page_views (page_url, view_count) VALUES ('/home', 1) ON DUPLICATE KEY UPDATE view_count = view_count + 1;",
    hints: [
      'Reference the existing column value in UPDATE',
      'view_count + 1 adds to existing value',
    ],
    validPatterns: [/ON\s+DUPLICATE\s+KEY\s+UPDATE\s+view_count\s*=\s*view_count\s*\+\s*1/i],
    tags: ['upsert', 'counter', 'mysql-specific'],
  },
  {
    id: 'mysql-upsert-003',
    category: 'INSERT ON DUPLICATE KEY',
    difficulty: 'hard',
    title: 'Multiple Column Update',
    text: 'Use INSERT ON DUPLICATE KEY UPDATE to update multiple columns: last_login and login_count.',
    setup: 'INSERT into user_stats table',
    setupCode:
      'CREATE TABLE user_stats (user_id INT PRIMARY KEY, last_login DATETIME, login_count INT);',
    expected: 'Update both columns on conflict',
    sample:
      'INSERT INTO user_stats (user_id, last_login, login_count) VALUES (1, NOW(), 1) ON DUPLICATE KEY UPDATE last_login = NOW(), login_count = login_count + 1;',
    hints: ['Separate multiple column updates with commas', 'Can use NOW() for current timestamp'],
    validPatterns: [/ON\s+DUPLICATE\s+KEY\s+UPDATE\s+last_login\s*=.*,\s*login_count\s*=/i],
    tags: ['upsert', 'multiple-columns', 'mysql-specific'],
  },
  {
    id: 'mysql-upsert-004',
    category: 'INSERT ON DUPLICATE KEY',
    difficulty: 'hard',
    title: 'Conditional Update',
    text: 'Use INSERT ON DUPLICATE KEY UPDATE with IF to only update price if new price is lower.',
    setup: 'INSERT into products table',
    setupCode:
      'CREATE TABLE products (sku VARCHAR(20) PRIMARY KEY, name VARCHAR(100), price DECIMAL(10,2));',
    expected: 'Only update if new price is lower',
    sample:
      "INSERT INTO products (sku, name, price) VALUES ('ABC123', 'Widget', 19.99) ON DUPLICATE KEY UPDATE price = IF(VALUES(price) < price, VALUES(price), price);",
    hints: ['Use IF() to conditionally set the value', 'Compare VALUES(price) with existing price'],
    validPatterns: [
      /ON\s+DUPLICATE\s+KEY\s+UPDATE\s+price\s*=\s*IF\s*\(\s*VALUES\s*\(\s*price\s*\)\s*<\s*price/i,
    ],
    tags: ['upsert', 'conditional', 'mysql-specific'],
  },

  // ============================================================
  // INDEX HINTS (6 problems)
  // ============================================================
  {
    id: 'mysql-index-001',
    category: 'Index Hints',
    difficulty: 'medium',
    title: 'USE INDEX Hint',
    text: 'Use USE INDEX hint to suggest MySQL use the idx_status index for the query.',
    setup: 'SELECT from orders table with multiple indexes',
    setupCode:
      'CREATE TABLE orders (id INT PRIMARY KEY, status VARCHAR(20), order_date DATE, INDEX idx_status(status), INDEX idx_date(order_date));',
    expected: 'Query using idx_status index',
    sample: "SELECT * FROM orders USE INDEX (idx_status) WHERE status = 'pending';",
    hints: [
      'USE INDEX suggests which index to consider',
      'Goes after table name in FROM clause',
      'Optimizer may still choose differently',
    ],
    validPatterns: [/FROM\s+orders\s+USE\s+INDEX\s*\(\s*idx_status\s*\)/i],
    tags: ['index', 'hint', 'use-index', 'mysql-specific'],
  },
  {
    id: 'mysql-index-002',
    category: 'Index Hints',
    difficulty: 'medium',
    title: 'FORCE INDEX Hint',
    text: 'Use FORCE INDEX to force MySQL to use idx_customer_date index.',
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT PRIMARY KEY, customer_id INT, order_date DATE, INDEX idx_customer_date(customer_id, order_date));',
    expected: 'Query forced to use specific index',
    sample: 'SELECT * FROM orders FORCE INDEX (idx_customer_date) WHERE customer_id = 100;',
    hints: [
      'FORCE INDEX is stronger than USE INDEX',
      'Forces optimizer to use index or do table scan',
      'Use when optimizer consistently picks wrong index',
    ],
    validPatterns: [/FROM\s+orders\s+FORCE\s+INDEX\s*\(\s*idx_customer_date\s*\)/i],
    tags: ['index', 'hint', 'force-index', 'mysql-specific'],
  },
  {
    id: 'mysql-index-003',
    category: 'Index Hints',
    difficulty: 'medium',
    title: 'IGNORE INDEX Hint',
    text: 'Use IGNORE INDEX to prevent MySQL from using the idx_status index.',
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT PRIMARY KEY, status VARCHAR(20), amount DECIMAL(10,2), INDEX idx_status(status));',
    expected: 'Query avoiding idx_status index',
    sample:
      "SELECT * FROM orders IGNORE INDEX (idx_status) WHERE status = 'shipped' AND amount > 1000;",
    hints: [
      'IGNORE INDEX excludes index from consideration',
      'Useful when index hurts performance',
      'Can force table scan or other index use',
    ],
    validPatterns: [/FROM\s+orders\s+IGNORE\s+INDEX\s*\(\s*idx_status\s*\)/i],
    tags: ['index', 'hint', 'ignore-index', 'mysql-specific'],
  },
  {
    id: 'mysql-index-004',
    category: 'Index Hints',
    difficulty: 'hard',
    title: 'Multiple Index Hints',
    text: 'Use multiple indexes in a USE INDEX hint for a query with multiple conditions.',
    setup: 'SELECT from products table with multiple indexes',
    setupCode:
      'CREATE TABLE products (id INT PRIMARY KEY, category_id INT, price DECIMAL(10,2), INDEX idx_category(category_id), INDEX idx_price(price));',
    expected: 'Query suggesting multiple indexes',
    sample:
      'SELECT * FROM products USE INDEX (idx_category, idx_price) WHERE category_id = 5 AND price < 100;',
    hints: [
      'Separate multiple index names with commas',
      'Optimizer chooses among the listed indexes',
    ],
    validPatterns: [/USE\s+INDEX\s*\(\s*idx_category\s*,\s*idx_price\s*\)/i],
    tags: ['index', 'hint', 'multiple', 'mysql-specific'],
  },
  {
    id: 'mysql-index-005',
    category: 'Index Hints',
    difficulty: 'hard',
    title: 'Index Hint for JOIN',
    text: 'Use FORCE INDEX on a table in a JOIN to ensure the correct index is used.',
    setup: 'SELECT with JOIN between orders and customers',
    setupCode:
      'CREATE TABLE customers (id INT PRIMARY KEY, name VARCHAR(100));\nCREATE TABLE orders (id INT PRIMARY KEY, customer_id INT, INDEX idx_customer(customer_id));',
    expected: 'Join using forced index',
    sample:
      'SELECT c.name, o.id FROM customers c JOIN orders o FORCE INDEX (idx_customer) ON c.id = o.customer_id;',
    hints: ['Place FORCE INDEX after table name/alias', 'Affects how JOIN is executed'],
    validPatterns: [/orders\s+\w*\s*FORCE\s+INDEX\s*\(\s*idx_customer\s*\)/i],
    tags: ['index', 'hint', 'join', 'mysql-specific'],
  },
  {
    id: 'mysql-index-006',
    category: 'Index Hints',
    difficulty: 'hard',
    title: 'Index Hint for ORDER BY',
    text: 'Use USE INDEX FOR ORDER BY to suggest an index for sorting.',
    setup: 'SELECT from products with ORDER BY',
    setupCode:
      'CREATE TABLE products (id INT PRIMARY KEY, name VARCHAR(100), created_at DATETIME, INDEX idx_created(created_at));',
    expected: 'Index used specifically for ORDER BY',
    sample:
      'SELECT * FROM products USE INDEX FOR ORDER BY (idx_created) WHERE name LIKE "A%" ORDER BY created_at;',
    hints: [
      'USE INDEX FOR ORDER BY specifies index for sorting',
      'Also available: FOR JOIN, FOR GROUP BY',
    ],
    validPatterns: [/USE\s+INDEX\s+FOR\s+ORDER\s+BY\s*\(\s*idx_created\s*\)/i],
    tags: ['index', 'hint', 'order-by', 'mysql-specific'],
  },

  // ============================================================
  // NEW PROBLEMS - STRING FUNCTIONS (50 problems)
  // ============================================================
  {
    id: 'mysql-str-100',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'Basic CONCAT',
    text: 'Use CONCAT to combine first_name and last_name with a space between them.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, first_name VARCHAR(50), last_name VARCHAR(50));\nINSERT INTO employees VALUES (1, 'John', 'Smith');",
    expected: 'John Smith',
    sample: "SELECT CONCAT(first_name, ' ', last_name) AS full_name FROM employees;",
    hints: ['CONCAT joins strings together', 'Include a space string between the names'],
    tags: ['string', 'concat', 'mysql-specific'],
  },
  {
    id: 'mysql-str-101',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'UPPER Case Conversion',
    text: 'Convert the product_name column to uppercase.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, product_name VARCHAR(100));\nINSERT INTO products VALUES (1, 'wireless mouse');",
    expected: 'WIRELESS MOUSE',
    sample: 'SELECT UPPER(product_name) FROM products;',
    hints: ['UPPER converts all characters to uppercase', 'Also known as UCASE in MySQL'],
    tags: ['string', 'upper', 'mysql-specific'],
  },
  {
    id: 'mysql-str-102',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'LOWER Case Conversion',
    text: 'Convert the email column to lowercase for consistent storage.',
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, email VARCHAR(100));\nINSERT INTO users VALUES (1, 'John.Doe@Example.COM');",
    expected: 'john.doe@example.com',
    sample: 'SELECT LOWER(email) FROM users;',
    hints: ['LOWER converts all characters to lowercase', 'Also known as LCASE in MySQL'],
    tags: ['string', 'lower', 'mysql-specific'],
  },
  {
    id: 'mysql-str-103',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'String LENGTH',
    text: 'Find the length of the description column.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, description VARCHAR(200));\nINSERT INTO products VALUES (1, 'High quality product');",
    expected: '20',
    sample: 'SELECT LENGTH(description) FROM products;',
    hints: ['LENGTH returns the number of bytes', 'For multi-byte chars use CHAR_LENGTH'],
    tags: ['string', 'length', 'mysql-specific'],
  },
  {
    id: 'mysql-str-104',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'TRIM Whitespace',
    text: 'Remove leading and trailing whitespace from the name column.',
    setup: 'SELECT from customers table',
    setupCode:
      "CREATE TABLE customers (id INT, name VARCHAR(100));\nINSERT INTO customers VALUES (1, '  John Doe  ');",
    expected: 'John Doe',
    sample: 'SELECT TRIM(name) FROM customers;',
    hints: ['TRIM removes leading and trailing spaces', 'Use LTRIM or RTRIM for one side only'],
    tags: ['string', 'trim', 'mysql-specific'],
  },
  {
    id: 'mysql-str-105',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'LEFT Substring',
    text: 'Extract the first 3 characters from the product_code column.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, product_code VARCHAR(20));\nINSERT INTO products VALUES (1, 'ABC12345');",
    expected: 'ABC',
    sample: 'SELECT LEFT(product_code, 3) FROM products;',
    hints: ['LEFT(str, n) returns first n characters', 'Useful for extracting prefixes'],
    tags: ['string', 'left', 'mysql-specific'],
  },
  {
    id: 'mysql-str-106',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'RIGHT Substring',
    text: 'Extract the last 4 characters from the phone column to get extension.',
    setup: 'SELECT from contacts table',
    setupCode:
      "CREATE TABLE contacts (id INT, phone VARCHAR(20));\nINSERT INTO contacts VALUES (1, '555-123-4567');",
    expected: '4567',
    sample: 'SELECT RIGHT(phone, 4) FROM contacts;',
    hints: ['RIGHT(str, n) returns last n characters', 'Useful for extracting suffixes'],
    tags: ['string', 'right', 'mysql-specific'],
  },
  {
    id: 'mysql-str-107',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'SUBSTRING Extraction',
    text: 'Extract characters 5-8 from a string using SUBSTRING.',
    setup: 'SELECT from codes table',
    setupCode:
      "CREATE TABLE codes (id INT, code VARCHAR(20));\nINSERT INTO codes VALUES (1, 'ABCD1234XYZ');",
    expected: '1234',
    sample: 'SELECT SUBSTRING(code, 5, 4) FROM codes;',
    hints: ['SUBSTRING(str, start, length)', 'Position is 1-based in MySQL'],
    tags: ['string', 'substring', 'mysql-specific'],
  },
  {
    id: 'mysql-str-108',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'REPLACE Text',
    text: "Replace all occurrences of 'old' with 'new' in the content column.",
    setup: 'SELECT from articles table',
    setupCode:
      "CREATE TABLE articles (id INT, content TEXT);\nINSERT INTO articles VALUES (1, 'The old way is the old method');",
    expected: 'The new way is the new method',
    sample: "SELECT REPLACE(content, 'old', 'new') FROM articles;",
    hints: ['REPLACE(str, from_str, to_str)', 'Replaces all occurrences, not just first'],
    tags: ['string', 'replace', 'mysql-specific'],
  },
  {
    id: 'mysql-str-109',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'LOCATE Position',
    text: "Find the position of '@' in an email address.",
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, email VARCHAR(100));\nINSERT INTO users VALUES (1, 'user@example.com');",
    expected: '5',
    sample: "SELECT LOCATE('@', email) FROM users;",
    hints: ['LOCATE returns position of first occurrence', 'Returns 0 if not found'],
    tags: ['string', 'locate', 'mysql-specific'],
  },
  {
    id: 'mysql-str-110',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'LPAD Formatting',
    text: 'Left-pad an order number with zeros to make it 8 characters.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, order_num INT);\nINSERT INTO orders VALUES (1, 1234);',
    expected: '00001234',
    sample: "SELECT LPAD(order_num, 8, '0') FROM orders;",
    hints: ['LPAD(str, len, pad_str)', 'Pads on the left side'],
    tags: ['string', 'lpad', 'mysql-specific'],
  },
  {
    id: 'mysql-str-111',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'RPAD Formatting',
    text: 'Right-pad a name with dots to make it exactly 20 characters.',
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, name VARCHAR(50));\nINSERT INTO users VALUES (1, 'Alice');",
    expected: 'Alice...............',
    sample: "SELECT RPAD(name, 20, '.') FROM users;",
    hints: ['RPAD(str, len, pad_str)', 'Pads on the right side'],
    tags: ['string', 'rpad', 'mysql-specific'],
  },
  {
    id: 'mysql-str-112',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'REVERSE String',
    text: 'Reverse the characters in a string.',
    setup: 'SELECT from words table',
    setupCode:
      "CREATE TABLE words (id INT, word VARCHAR(50));\nINSERT INTO words VALUES (1, 'hello');",
    expected: 'olleh',
    sample: 'SELECT REVERSE(word) FROM words;',
    hints: ['REVERSE flips the string', 'Useful for palindrome checks'],
    tags: ['string', 'reverse', 'mysql-specific'],
  },
  {
    id: 'mysql-str-113',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'REPEAT String',
    text: 'Repeat a star character 5 times to create a rating display.',
    setup: 'SELECT statement',
    setupCode: '-- Create star rating',
    expected: '*****',
    sample: "SELECT REPEAT('*', 5) AS rating;",
    hints: ['REPEAT(str, count)', 'Returns string repeated count times'],
    tags: ['string', 'repeat', 'mysql-specific'],
  },
  {
    id: 'mysql-str-114',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'INSTR Position',
    text: "Find the position of 'world' in a greeting string.",
    setup: 'SELECT from messages table',
    setupCode:
      "CREATE TABLE messages (id INT, msg VARCHAR(100));\nINSERT INTO messages VALUES (1, 'Hello world!');",
    expected: '7',
    sample: "SELECT INSTR(msg, 'world') FROM messages;",
    hints: [
      'INSTR is similar to LOCATE but with reversed arguments',
      'INSTR(str, substr) vs LOCATE(substr, str)',
    ],
    tags: ['string', 'instr', 'mysql-specific'],
  },
  {
    id: 'mysql-str-115',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'INSERT String',
    text: "Insert '---' into a string at position 4, replacing 3 characters.",
    setup: 'SELECT statement',
    setupCode: "-- Original: 'ABCDEFGH'",
    expected: 'ABC---GH',
    sample: "SELECT INSERT('ABCDEFGH', 4, 3, '---');",
    hints: ['INSERT(str, pos, len, new_str)', 'Replaces len characters at pos with new_str'],
    tags: ['string', 'insert', 'mysql-specific'],
  },
  {
    id: 'mysql-str-116',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'REGEXP Pattern Match',
    text: 'Find all products where name matches pattern starting with letter and ending with number.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(100));\nINSERT INTO products VALUES (1, 'Model5'), (2, 'Test'), (3, 'Version2');",
    expected: 'Model5, Version2',
    sample: "SELECT name FROM products WHERE name REGEXP '^[A-Za-z].*[0-9]$';",
    hints: ['^[A-Za-z] matches letter at start', '[0-9]$ matches digit at end'],
    tags: ['string', 'regexp', 'mysql-specific'],
  },
  {
    id: 'mysql-str-117',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'REGEXP_REPLACE',
    text: 'Replace all digits in a string with X using REGEXP_REPLACE.',
    setup: 'SELECT from data table',
    setupCode:
      "CREATE TABLE data (id INT, value VARCHAR(100));\nINSERT INTO data VALUES (1, 'Phone: 123-456-7890');",
    expected: 'Phone: XXX-XXX-XXXX',
    sample: "SELECT REGEXP_REPLACE(value, '[0-9]', 'X') FROM data;",
    hints: ['REGEXP_REPLACE(str, pattern, replacement)', 'Replaces all matches by default'],
    tags: ['string', 'regexp', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-str-118',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'REGEXP_SUBSTR Extract',
    text: 'Extract the first number from a mixed string.',
    setup: 'SELECT from items table',
    setupCode:
      "CREATE TABLE items (id INT, description VARCHAR(100));\nINSERT INTO items VALUES (1, 'Item costs $25.99 each');",
    expected: '25',
    sample: "SELECT REGEXP_SUBSTR(description, '[0-9]+') FROM items;",
    hints: ['REGEXP_SUBSTR extracts matching portion', '[0-9]+ matches one or more digits'],
    tags: ['string', 'regexp', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-str-119',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'CHAR_LENGTH for Unicode',
    text: 'Get the character count of a string with unicode characters.',
    setup: 'SELECT from messages table',
    setupCode:
      "CREATE TABLE messages (id INT, content VARCHAR(100));\nINSERT INTO messages VALUES (1, 'Hello World');",
    expected: '11',
    sample: 'SELECT CHAR_LENGTH(content) FROM messages;',
    hints: ['CHAR_LENGTH counts characters, not bytes', 'Use for accurate unicode string length'],
    tags: ['string', 'length', 'unicode', 'mysql-specific'],
  },
  {
    id: 'mysql-str-120',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'SPACE Generator',
    text: 'Generate 10 space characters to use as padding.',
    setup: 'SELECT statement',
    setupCode: '-- Generate spaces',
    expected: '          (10 spaces)',
    sample: "SELECT CONCAT('Start', SPACE(10), 'End');",
    hints: ['SPACE(n) returns n space characters', 'Useful for formatting output'],
    tags: ['string', 'space', 'mysql-specific'],
  },
  {
    id: 'mysql-str-121',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'ASCII Value',
    text: 'Get the ASCII code of the first character in a string.',
    setup: 'SELECT statement',
    setupCode: "-- Get ASCII of 'A'",
    expected: '65',
    sample: "SELECT ASCII('ABC');",
    hints: ['ASCII returns code of first character', 'A = 65, a = 97, 0 = 48'],
    tags: ['string', 'ascii', 'mysql-specific'],
  },
  {
    id: 'mysql-str-122',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'CHAR from ASCII',
    text: 'Convert ASCII code 65 back to character.',
    setup: 'SELECT statement',
    setupCode: '-- Convert 65 to char',
    expected: 'A',
    sample: 'SELECT CHAR(65);',
    hints: ['CHAR converts ASCII code to character', 'Reverse of ASCII function'],
    tags: ['string', 'char', 'mysql-specific'],
  },
  {
    id: 'mysql-str-123',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'FORMAT Number as String',
    text: 'Format a number with thousands separator and 2 decimal places.',
    setup: 'SELECT from sales table',
    setupCode:
      'CREATE TABLE sales (id INT, amount DECIMAL(15,2));\nINSERT INTO sales VALUES (1, 1234567.891);',
    expected: '1,234,567.89',
    sample: 'SELECT FORMAT(amount, 2) FROM sales;',
    hints: ['FORMAT(number, decimals)', 'Adds comma as thousands separator'],
    tags: ['string', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-str-124',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'HEX Encoding',
    text: 'Convert a string to its hexadecimal representation.',
    setup: 'SELECT statement',
    setupCode: "-- Encode 'ABC'",
    expected: '414243',
    sample: "SELECT HEX('ABC');",
    hints: ['HEX returns hexadecimal string', 'Each character becomes 2 hex digits'],
    tags: ['string', 'hex', 'mysql-specific'],
  },
  {
    id: 'mysql-str-125',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'UNHEX Decoding',
    text: 'Convert hexadecimal 414243 back to string.',
    setup: 'SELECT statement',
    setupCode: '-- Decode hex',
    expected: 'ABC',
    sample: "SELECT UNHEX('414243');",
    hints: ['UNHEX reverses HEX encoding', 'Returns binary string'],
    tags: ['string', 'unhex', 'mysql-specific'],
  },
  {
    id: 'mysql-str-126',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'STRCMP Comparison',
    text: 'Compare two strings and return -1, 0, or 1.',
    setup: 'SELECT statement',
    setupCode: "-- Compare 'apple' and 'banana'",
    expected: '-1',
    sample: "SELECT STRCMP('apple', 'banana');",
    hints: ['STRCMP returns -1 if first < second', '0 if equal, 1 if first > second'],
    tags: ['string', 'strcmp', 'mysql-specific'],
  },
  {
    id: 'mysql-str-127',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'ELT Selection',
    text: 'Use ELT to select the 3rd item from a list of strings.',
    setup: 'SELECT statement',
    setupCode: '-- Select 3rd item',
    expected: 'three',
    sample: "SELECT ELT(3, 'one', 'two', 'three', 'four');",
    hints: ['ELT(n, str1, str2, ...) returns nth string', 'Returns NULL if n is out of range'],
    tags: ['string', 'elt', 'mysql-specific'],
  },
  {
    id: 'mysql-str-128',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'MAKE_SET from Bitmask',
    text: 'Use MAKE_SET with bitmask 5 (binary 101) to select items 1 and 3.',
    setup: 'SELECT statement',
    setupCode: '-- Bitmask 5 = 101 binary',
    expected: 'a,c',
    sample: "SELECT MAKE_SET(5, 'a', 'b', 'c', 'd');",
    hints: [
      'MAKE_SET uses bits to select strings',
      'Bit 1 selects first, bit 2 selects second, etc.',
    ],
    tags: ['string', 'make-set', 'mysql-specific'],
  },
  {
    id: 'mysql-str-129',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'QUOTE String',
    text: 'Properly quote a string for use in SQL, escaping special characters.',
    setup: 'SELECT statement',
    setupCode: '-- Quote string with apostrophe',
    expected: "'It\\'s quoted'",
    sample: 'SELECT QUOTE("It\'s quoted");',
    hints: ['QUOTE adds quotes and escapes special chars', 'Useful for dynamic SQL'],
    tags: ['string', 'quote', 'mysql-specific'],
  },
  {
    id: 'mysql-str-130',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'SOUNDEX Matching',
    text: "Find names that sound like 'Smith' using SOUNDEX.",
    setup: 'SELECT from customers table',
    setupCode:
      "CREATE TABLE customers (id INT, name VARCHAR(50));\nINSERT INTO customers VALUES (1, 'Smith'), (2, 'Smyth'), (3, 'Jones');",
    expected: 'Smith, Smyth',
    sample: "SELECT name FROM customers WHERE SOUNDEX(name) = SOUNDEX('Smith');",
    hints: ['SOUNDEX generates phonetic code', 'Similar sounding words have same code'],
    tags: ['string', 'soundex', 'mysql-specific'],
  },
  {
    id: 'mysql-str-131',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'BIN Conversion',
    text: 'Convert a number to its binary string representation.',
    setup: 'SELECT statement',
    setupCode: '-- Convert 10 to binary',
    expected: '1010',
    sample: 'SELECT BIN(10);',
    hints: ['BIN returns binary string', '10 decimal = 1010 binary'],
    tags: ['string', 'bin', 'mysql-specific'],
  },
  {
    id: 'mysql-str-132',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'OCT Conversion',
    text: 'Convert a number to its octal string representation.',
    setup: 'SELECT statement',
    setupCode: '-- Convert 64 to octal',
    expected: '100',
    sample: 'SELECT OCT(64);',
    hints: ['OCT returns octal string', '64 decimal = 100 octal'],
    tags: ['string', 'oct', 'mysql-specific'],
  },
  {
    id: 'mysql-str-133',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'EXPORT_SET from Bitmask',
    text: 'Use EXPORT_SET to show binary representation with custom on/off chars.',
    setup: 'SELECT statement',
    setupCode: '-- Show bits 5 = 101',
    expected: 'Y,N,Y',
    sample: "SELECT EXPORT_SET(5, 'Y', 'N', ',', 3);",
    hints: ['EXPORT_SET(bits, on, off, separator, num_bits)', 'Creates string showing bit pattern'],
    tags: ['string', 'export-set', 'mysql-specific'],
  },
  {
    id: 'mysql-str-134',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'ORD Function',
    text: 'Get the code value for the leftmost character of a multi-byte string.',
    setup: 'SELECT statement',
    setupCode: '-- Get ORD value',
    expected: '65',
    sample: "SELECT ORD('ABC');",
    hints: ['ORD returns code for leftmost character', 'For single-byte chars, same as ASCII'],
    tags: ['string', 'ord', 'mysql-specific'],
  },
  {
    id: 'mysql-str-135',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'REGEXP_INSTR Position',
    text: 'Find the position of first digit sequence in a string.',
    setup: 'SELECT from data table',
    setupCode:
      "CREATE TABLE data (id INT, value VARCHAR(100));\nINSERT INTO data VALUES (1, 'Order ABC123 shipped');",
    expected: '10',
    sample: "SELECT REGEXP_INSTR(value, '[0-9]+') FROM data;",
    hints: ['REGEXP_INSTR returns position of match', 'Returns 0 if no match found'],
    tags: ['string', 'regexp', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-str-136',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'REGEXP_LIKE Boolean',
    text: 'Check if email matches valid email pattern using REGEXP_LIKE.',
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, email VARCHAR(100));\nINSERT INTO users VALUES (1, 'test@example.com');",
    expected: '1 (true)',
    sample:
      "SELECT REGEXP_LIKE(email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$') FROM users;",
    hints: [
      'REGEXP_LIKE returns 1 for match, 0 for no match',
      'More readable than REGEXP operator',
    ],
    tags: ['string', 'regexp', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-str-137',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'MID Alias',
    text: 'Use MID as an alias for SUBSTRING to extract characters.',
    setup: 'SELECT from codes table',
    setupCode:
      "CREATE TABLE codes (id INT, code VARCHAR(20));\nINSERT INTO codes VALUES (1, 'ABC-123-XYZ');",
    expected: '123',
    sample: 'SELECT MID(code, 5, 3) FROM codes;',
    hints: ['MID is alias for SUBSTRING', 'MID(str, pos, len)'],
    tags: ['string', 'mid', 'mysql-specific'],
  },
  {
    id: 'mysql-str-138',
    category: 'String Functions',
    difficulty: 'easy',
    title: 'SUBSTR Alias',
    text: 'Use SUBSTR as an alias for SUBSTRING.',
    setup: 'SELECT from data table',
    setupCode:
      "CREATE TABLE data (id INT, value VARCHAR(50));\nINSERT INTO data VALUES (1, 'ABCDEFGH');",
    expected: 'CDE',
    sample: 'SELECT SUBSTR(value, 3, 3) FROM data;',
    hints: ['SUBSTR is alias for SUBSTRING', 'Same syntax and behavior'],
    tags: ['string', 'substr', 'mysql-specific'],
  },
  {
    id: 'mysql-str-139',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'Nested String Functions',
    text: 'Extract and format phone: remove non-digits, then format as (XXX) XXX-XXXX.',
    setup: 'SELECT from contacts table',
    setupCode:
      "CREATE TABLE contacts (id INT, phone VARCHAR(30));\nINSERT INTO contacts VALUES (1, '1-555-123-4567');",
    expected: '(555) 123-4567',
    sample:
      "SELECT CONCAT('(', SUBSTRING(REGEXP_REPLACE(phone, '[^0-9]', ''), 2, 3), ') ', SUBSTRING(REGEXP_REPLACE(phone, '[^0-9]', ''), 5, 3), '-', SUBSTRING(REGEXP_REPLACE(phone, '[^0-9]', ''), 8, 4)) FROM contacts;",
    hints: ['First remove non-digits with REGEXP_REPLACE', 'Then use SUBSTRING to extract parts'],
    tags: ['string', 'nested', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-str-140',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'TRIM with Characters',
    text: 'Remove leading and trailing dashes from a string.',
    setup: 'SELECT from codes table',
    setupCode:
      "CREATE TABLE codes (id INT, code VARCHAR(30));\nINSERT INTO codes VALUES (1, '---ABC123---');",
    expected: 'ABC123',
    sample: "SELECT TRIM(BOTH '-' FROM code) FROM codes;",
    hints: ['TRIM(BOTH char FROM str)', 'Can specify character to trim'],
    tags: ['string', 'trim', 'mysql-specific'],
  },
  {
    id: 'mysql-str-141',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'LTRIM Leading',
    text: 'Remove only leading zeros from a string.',
    setup: 'SELECT from numbers table',
    setupCode:
      "CREATE TABLE numbers (id INT, num_str VARCHAR(20));\nINSERT INTO numbers VALUES (1, '000123');",
    expected: '123',
    sample: "SELECT TRIM(LEADING '0' FROM num_str) FROM numbers;",
    hints: ['TRIM(LEADING char FROM str)', 'Removes only from the start'],
    tags: ['string', 'trim', 'leading', 'mysql-specific'],
  },
  {
    id: 'mysql-str-142',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'RTRIM Trailing',
    text: 'Remove only trailing underscores from a string.',
    setup: 'SELECT from data table',
    setupCode:
      "CREATE TABLE data (id INT, value VARCHAR(30));\nINSERT INTO data VALUES (1, 'field___');",
    expected: 'field',
    sample: "SELECT TRIM(TRAILING '_' FROM value) FROM data;",
    hints: ['TRIM(TRAILING char FROM str)', 'Removes only from the end'],
    tags: ['string', 'trim', 'trailing', 'mysql-specific'],
  },
  {
    id: 'mysql-str-143',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'SUBSTRING_INDEX Nested Path',
    text: "Extract the filename from a full file path '/home/user/documents/report.pdf'.",
    setup: 'SELECT from files table',
    setupCode:
      "CREATE TABLE files (id INT, path VARCHAR(200));\nINSERT INTO files VALUES (1, '/home/user/documents/report.pdf');",
    expected: 'report.pdf',
    sample: "SELECT SUBSTRING_INDEX(path, '/', -1) FROM files;",
    hints: ['-1 gets everything after the last delimiter', 'Works regardless of path depth'],
    tags: ['string', 'substring-index', 'mysql-specific'],
  },
  {
    id: 'mysql-str-144',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'Extract Directory from Path',
    text: "Extract the directory path without filename from '/home/user/docs/file.txt'.",
    setup: 'SELECT from files table',
    setupCode:
      "CREATE TABLE files (id INT, path VARCHAR(200));\nINSERT INTO files VALUES (1, '/home/user/docs/file.txt');",
    expected: '/home/user/docs',
    sample:
      "SELECT SUBSTRING_INDEX(path, '/', LENGTH(path) - LENGTH(REPLACE(path, '/', ''))) FROM files;",
    hints: [
      'Count slashes to find how many to include',
      'Use LENGTH difference to count occurrences',
    ],
    tags: ['string', 'substring-index', 'path', 'mysql-specific'],
  },
  {
    id: 'mysql-str-145',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'WEIGHT_STRING for Sorting',
    text: 'Get the sort key for a string to understand collation sorting.',
    setup: 'SELECT statement',
    setupCode: '-- Get weight string',
    expected: 'Binary sort key',
    sample: "SELECT HEX(WEIGHT_STRING('abc'));",
    hints: ['WEIGHT_STRING returns binary sort key', 'Useful for understanding collation'],
    tags: ['string', 'weight-string', 'mysql-specific'],
  },
  {
    id: 'mysql-str-146',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'Split and Count Words',
    text: 'Count the number of words in a sentence by counting spaces + 1.',
    setup: 'SELECT from articles table',
    setupCode:
      "CREATE TABLE articles (id INT, title VARCHAR(200));\nINSERT INTO articles VALUES (1, 'The quick brown fox jumps');",
    expected: '5',
    sample:
      "SELECT LENGTH(title) - LENGTH(REPLACE(title, ' ', '')) + 1 AS word_count FROM articles;",
    hints: ['Count spaces and add 1 for word count', 'Assumes single spaces between words'],
    tags: ['string', 'word-count', 'mysql-specific'],
  },
  {
    id: 'mysql-str-147',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'CONVERT Character Set',
    text: 'Convert a string from utf8 to latin1 character set.',
    setup: 'SELECT statement',
    setupCode: '-- Convert charset',
    expected: 'Converted string',
    sample: "SELECT CONVERT('Hello' USING latin1);",
    hints: ['CONVERT(str USING charset)', 'Changes character encoding'],
    tags: ['string', 'convert', 'charset', 'mysql-specific'],
  },
  {
    id: 'mysql-str-148',
    category: 'String Functions',
    difficulty: 'medium',
    title: 'BINARY Comparison',
    text: 'Perform case-sensitive comparison using BINARY.',
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, username VARCHAR(50));\nINSERT INTO users VALUES (1, 'Admin'), (2, 'admin');",
    expected: 'Only exact match',
    sample: "SELECT username FROM users WHERE BINARY username = 'Admin';",
    hints: [
      'BINARY forces case-sensitive comparison',
      'Without BINARY, comparison is case-insensitive',
    ],
    tags: ['string', 'binary', 'case-sensitive', 'mysql-specific'],
  },
  {
    id: 'mysql-str-149',
    category: 'String Functions',
    difficulty: 'hard',
    title: 'REGEXP Word Boundary',
    text: "Find rows where column contains the whole word 'the' not as part of another word.",
    setup: 'SELECT from texts table',
    setupCode:
      "CREATE TABLE texts (id INT, content VARCHAR(200));\nINSERT INTO texts VALUES (1, 'the cat'), (2, 'other'), (3, 'see the dog');",
    expected: 'the cat, see the dog',
    sample: "SELECT content FROM texts WHERE content REGEXP '[[:<:]]the[[:>:]]';",
    hints: ['[[:<:]] is word start boundary', '[[:>:]] is word end boundary'],
    tags: ['string', 'regexp', 'word-boundary', 'mysql-specific'],
  },

  // ============================================================
  // DATE FUNCTIONS (50 problems)
  // ============================================================
  {
    id: 'mysql-date-100',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Current Date',
    text: 'Get the current date without time component.',
    setup: 'SELECT statement',
    setupCode: '-- Get current date',
    expected: '2024-01-15 (current date)',
    sample: 'SELECT CURDATE();',
    hints: ['CURDATE() returns date only', 'Also known as CURRENT_DATE()'],
    tags: ['date', 'curdate', 'mysql-specific'],
  },
  {
    id: 'mysql-date-101',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Current DateTime',
    text: 'Get the current date and time.',
    setup: 'SELECT statement',
    setupCode: '-- Get current datetime',
    expected: '2024-01-15 10:30:45',
    sample: 'SELECT NOW();',
    hints: ['NOW() returns date and time', 'Also known as CURRENT_TIMESTAMP()'],
    tags: ['date', 'now', 'mysql-specific'],
  },
  {
    id: 'mysql-date-102',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Current Time',
    text: 'Get the current time without date.',
    setup: 'SELECT statement',
    setupCode: '-- Get current time',
    expected: '10:30:45',
    sample: 'SELECT CURTIME();',
    hints: ['CURTIME() returns time only', 'Also known as CURRENT_TIME()'],
    tags: ['date', 'curtime', 'mysql-specific'],
  },
  {
    id: 'mysql-date-103',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Extract YEAR',
    text: 'Extract the year from a date column.',
    setup: 'SELECT from orders table',
    setupCode:
      "CREATE TABLE orders (id INT, order_date DATE);\nINSERT INTO orders VALUES (1, '2024-06-15');",
    expected: '2024',
    sample: 'SELECT YEAR(order_date) FROM orders;',
    hints: ['YEAR extracts 4-digit year', 'Returns integer value'],
    tags: ['date', 'year', 'mysql-specific'],
  },
  {
    id: 'mysql-date-104',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Extract MONTH',
    text: 'Extract the month number from a date column.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-08-20');",
    expected: '8',
    sample: 'SELECT MONTH(event_date) FROM events;',
    hints: ['MONTH returns 1-12', 'For month name use MONTHNAME'],
    tags: ['date', 'month', 'mysql-specific'],
  },
  {
    id: 'mysql-date-105',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'Extract DAY',
    text: 'Extract the day of month from a date column.',
    setup: 'SELECT from birthdays table',
    setupCode:
      "CREATE TABLE birthdays (id INT, birth_date DATE);\nINSERT INTO birthdays VALUES (1, '1990-03-25');",
    expected: '25',
    sample: 'SELECT DAY(birth_date) FROM birthdays;',
    hints: ['DAY returns 1-31', 'Also known as DAYOFMONTH'],
    tags: ['date', 'day', 'mysql-specific'],
  },
  {
    id: 'mysql-date-106',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'DAYOFWEEK Number',
    text: 'Get the day of week as a number (1=Sunday, 7=Saturday).',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-01-15');",
    expected: '2 (Monday)',
    sample: 'SELECT DAYOFWEEK(event_date) FROM events;',
    hints: ['DAYOFWEEK: 1=Sunday to 7=Saturday', 'WEEKDAY: 0=Monday to 6=Sunday'],
    tags: ['date', 'dayofweek', 'mysql-specific'],
  },
  {
    id: 'mysql-date-107',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'DAYOFYEAR',
    text: 'Get the day of year (1-366) for a date.',
    setup: 'SELECT from logs table',
    setupCode:
      "CREATE TABLE logs (id INT, log_date DATE);\nINSERT INTO logs VALUES (1, '2024-02-15');",
    expected: '46',
    sample: 'SELECT DAYOFYEAR(log_date) FROM logs;',
    hints: ['DAYOFYEAR returns 1-366', 'Useful for Julian date calculations'],
    tags: ['date', 'dayofyear', 'mysql-specific'],
  },
  {
    id: 'mysql-date-108',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'WEEKDAY Number',
    text: 'Get the weekday number where Monday=0 and Sunday=6.',
    setup: 'SELECT from schedule table',
    setupCode:
      "CREATE TABLE schedule (id INT, sched_date DATE);\nINSERT INTO schedule VALUES (1, '2024-01-15');",
    expected: '0 (Monday)',
    sample: 'SELECT WEEKDAY(sched_date) FROM schedule;',
    hints: ['WEEKDAY: 0=Monday to 6=Sunday', 'Different from DAYOFWEEK'],
    tags: ['date', 'weekday', 'mysql-specific'],
  },
  {
    id: 'mysql-date-109',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'WEEK Number',
    text: 'Get the week number of the year.',
    setup: 'SELECT from reports table',
    setupCode:
      "CREATE TABLE reports (id INT, report_date DATE);\nINSERT INTO reports VALUES (1, '2024-01-15');",
    expected: '3',
    sample: 'SELECT WEEK(report_date) FROM reports;',
    hints: ['WEEK returns 0-53', 'Second arg controls mode (0-7)'],
    tags: ['date', 'week', 'mysql-specific'],
  },
  {
    id: 'mysql-date-110',
    category: 'Date Functions',
    difficulty: 'easy',
    title: 'QUARTER',
    text: 'Get the quarter (1-4) of a date.',
    setup: 'SELECT from sales table',
    setupCode:
      "CREATE TABLE sales (id INT, sale_date DATE);\nINSERT INTO sales VALUES (1, '2024-08-15');",
    expected: '3',
    sample: 'SELECT QUARTER(sale_date) FROM sales;',
    hints: ['QUARTER returns 1-4', 'Q1: Jan-Mar, Q2: Apr-Jun, etc.'],
    tags: ['date', 'quarter', 'mysql-specific'],
  },
  {
    id: 'mysql-date-111',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'DATE_ADD Days',
    text: 'Add 30 days to a date.',
    setup: 'SELECT from subscriptions table',
    setupCode:
      "CREATE TABLE subscriptions (id INT, start_date DATE);\nINSERT INTO subscriptions VALUES (1, '2024-01-15');",
    expected: '2024-02-14',
    sample: 'SELECT DATE_ADD(start_date, INTERVAL 30 DAY) FROM subscriptions;',
    hints: ['DATE_ADD(date, INTERVAL expr unit)', 'DAY, WEEK, MONTH, YEAR units'],
    tags: ['date', 'date-add', 'mysql-specific'],
  },
  {
    id: 'mysql-date-112',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'DATE_SUB Months',
    text: 'Subtract 3 months from a date.',
    setup: 'SELECT from invoices table',
    setupCode:
      "CREATE TABLE invoices (id INT, due_date DATE);\nINSERT INTO invoices VALUES (1, '2024-06-15');",
    expected: '2024-03-15',
    sample: 'SELECT DATE_SUB(due_date, INTERVAL 3 MONTH) FROM invoices;',
    hints: ['DATE_SUB subtracts interval', 'Same as DATE_ADD with negative'],
    tags: ['date', 'date-sub', 'mysql-specific'],
  },
  {
    id: 'mysql-date-113',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'ADDDATE Alternative',
    text: 'Use ADDDATE to add 1 week to a date.',
    setup: 'SELECT from appointments table',
    setupCode:
      "CREATE TABLE appointments (id INT, appt_date DATE);\nINSERT INTO appointments VALUES (1, '2024-01-15');",
    expected: '2024-01-22',
    sample: 'SELECT ADDDATE(appt_date, INTERVAL 1 WEEK) FROM appointments;',
    hints: ['ADDDATE is alias for DATE_ADD', 'Can also use ADDDATE(date, days)'],
    tags: ['date', 'adddate', 'mysql-specific'],
  },
  {
    id: 'mysql-date-114',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'DATEDIFF Between Dates',
    text: 'Calculate days between two dates.',
    setup: 'SELECT from projects table',
    setupCode:
      "CREATE TABLE projects (id INT, start_date DATE, end_date DATE);\nINSERT INTO projects VALUES (1, '2024-01-01', '2024-03-15');",
    expected: '74',
    sample: 'SELECT DATEDIFF(end_date, start_date) FROM projects;',
    hints: ['DATEDIFF(end, start) returns days', 'Result can be negative if reversed'],
    tags: ['date', 'datediff', 'mysql-specific'],
  },
  {
    id: 'mysql-date-115',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'TIMEDIFF Between Times',
    text: 'Calculate time difference between two datetime values.',
    setup: 'SELECT from shifts table',
    setupCode:
      "CREATE TABLE shifts (id INT, start_time DATETIME, end_time DATETIME);\nINSERT INTO shifts VALUES (1, '2024-01-15 09:00:00', '2024-01-15 17:30:00');",
    expected: '08:30:00',
    sample: 'SELECT TIMEDIFF(end_time, start_time) FROM shifts;',
    hints: ['TIMEDIFF returns TIME value', 'Shows hours:minutes:seconds'],
    tags: ['date', 'timediff', 'mysql-specific'],
  },
  {
    id: 'mysql-date-116',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'HOUR Extraction',
    text: 'Extract the hour from a datetime column.',
    setup: 'SELECT from logs table',
    setupCode:
      "CREATE TABLE logs (id INT, created_at DATETIME);\nINSERT INTO logs VALUES (1, '2024-01-15 14:30:45');",
    expected: '14',
    sample: 'SELECT HOUR(created_at) FROM logs;',
    hints: ['HOUR returns 0-23', 'Works with TIME and DATETIME'],
    tags: ['date', 'hour', 'mysql-specific'],
  },
  {
    id: 'mysql-date-117',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'MINUTE Extraction',
    text: 'Extract minutes from a time column.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_time TIME);\nINSERT INTO events VALUES (1, '14:45:30');",
    expected: '45',
    sample: 'SELECT MINUTE(event_time) FROM events;',
    hints: ['MINUTE returns 0-59', 'Works with TIME and DATETIME'],
    tags: ['date', 'minute', 'mysql-specific'],
  },
  {
    id: 'mysql-date-118',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'SECOND Extraction',
    text: 'Extract seconds from a datetime column.',
    setup: 'SELECT from timestamps table',
    setupCode:
      "CREATE TABLE timestamps (id INT, ts DATETIME);\nINSERT INTO timestamps VALUES (1, '2024-01-15 10:30:45');",
    expected: '45',
    sample: 'SELECT SECOND(ts) FROM timestamps;',
    hints: ['SECOND returns 0-59', 'Works with TIME and DATETIME'],
    tags: ['date', 'second', 'mysql-specific'],
  },
  {
    id: 'mysql-date-119',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'EXTRACT Function',
    text: 'Use EXTRACT to get the year and month from a date.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-08-15');",
    expected: '202408',
    sample: 'SELECT EXTRACT(YEAR_MONTH FROM event_date) FROM events;',
    hints: ['EXTRACT(unit FROM date)', 'YEAR_MONTH returns YYYYMM'],
    tags: ['date', 'extract', 'mysql-specific'],
  },
  {
    id: 'mysql-date-120',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'MAKEDATE from Year and Day',
    text: 'Create a date from year and day of year.',
    setup: 'SELECT statement',
    setupCode: '-- Create date for day 100 of 2024',
    expected: '2024-04-09',
    sample: 'SELECT MAKEDATE(2024, 100);',
    hints: ['MAKEDATE(year, dayofyear)', 'Creates date from year and day number'],
    tags: ['date', 'makedate', 'mysql-specific'],
  },
  {
    id: 'mysql-date-121',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'MAKETIME',
    text: 'Create a time value from hours, minutes, seconds.',
    setup: 'SELECT statement',
    setupCode: '-- Create time 14:30:45',
    expected: '14:30:45',
    sample: 'SELECT MAKETIME(14, 30, 45);',
    hints: ['MAKETIME(hour, minute, second)', 'Returns TIME value'],
    tags: ['date', 'maketime', 'mysql-specific'],
  },
  {
    id: 'mysql-date-122',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'MONTHNAME',
    text: 'Get the full month name from a date.',
    setup: 'SELECT from reports table',
    setupCode:
      "CREATE TABLE reports (id INT, report_date DATE);\nINSERT INTO reports VALUES (1, '2024-03-15');",
    expected: 'March',
    sample: 'SELECT MONTHNAME(report_date) FROM reports;',
    hints: ['MONTHNAME returns full name', 'Language depends on lc_time_names'],
    tags: ['date', 'monthname', 'mysql-specific'],
  },
  {
    id: 'mysql-date-123',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'DAYNAME',
    text: 'Get the full day name from a date.',
    setup: 'SELECT from calendar table',
    setupCode:
      "CREATE TABLE calendar (id INT, cal_date DATE);\nINSERT INTO calendar VALUES (1, '2024-01-15');",
    expected: 'Monday',
    sample: 'SELECT DAYNAME(cal_date) FROM calendar;',
    hints: ['DAYNAME returns full weekday name', 'Monday, Tuesday, etc.'],
    tags: ['date', 'dayname', 'mysql-specific'],
  },
  {
    id: 'mysql-date-124',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'LAST_DAY of Month',
    text: 'Get the last day of the month for a given date.',
    setup: 'SELECT from billing table',
    setupCode:
      "CREATE TABLE billing (id INT, bill_date DATE);\nINSERT INTO billing VALUES (1, '2024-02-15');",
    expected: '2024-02-29',
    sample: 'SELECT LAST_DAY(bill_date) FROM billing;',
    hints: ['LAST_DAY returns last day of month', 'Handles leap years correctly'],
    tags: ['date', 'last-day', 'mysql-specific'],
  },
  {
    id: 'mysql-date-125',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'First Day of Month',
    text: 'Calculate the first day of the month for a given date.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-03-15');",
    expected: '2024-03-01',
    sample: "SELECT DATE_FORMAT(event_date, '%Y-%m-01') FROM events;",
    hints: ['No built-in function for first day', 'Use DATE_FORMAT or DATE_SUB with DAY-1'],
    tags: ['date', 'first-day', 'mysql-specific'],
  },
  {
    id: 'mysql-date-126',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Add Business Days',
    text: 'Add 5 business days (excluding weekends) to a date using a calculation.',
    setup: 'SELECT from tasks table',
    setupCode:
      "CREATE TABLE tasks (id INT, start_date DATE);\nINSERT INTO tasks VALUES (1, '2024-01-15');",
    expected: '2024-01-22',
    sample:
      'SELECT DATE_ADD(start_date, INTERVAL (5 + FLOOR((WEEKDAY(start_date) + 5) / 5) * 2) DAY) FROM tasks;',
    hints: ['Need to account for weekends', 'Complex calculation required'],
    tags: ['date', 'business-days', 'mysql-specific'],
  },
  {
    id: 'mysql-date-127',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'TIME_TO_SEC Conversion',
    text: 'Convert a time value to total seconds.',
    setup: 'SELECT from durations table',
    setupCode:
      "CREATE TABLE durations (id INT, duration TIME);\nINSERT INTO durations VALUES (1, '02:30:45');",
    expected: '9045',
    sample: 'SELECT TIME_TO_SEC(duration) FROM durations;',
    hints: ['TIME_TO_SEC converts to seconds', '2*3600 + 30*60 + 45 = 9045'],
    tags: ['date', 'time-to-sec', 'mysql-specific'],
  },
  {
    id: 'mysql-date-128',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'SEC_TO_TIME Conversion',
    text: 'Convert 3665 seconds to a TIME value.',
    setup: 'SELECT statement',
    setupCode: '-- Convert seconds to time',
    expected: '01:01:05',
    sample: 'SELECT SEC_TO_TIME(3665);',
    hints: ['SEC_TO_TIME converts seconds to TIME', 'Inverse of TIME_TO_SEC'],
    tags: ['date', 'sec-to-time', 'mysql-specific'],
  },
  {
    id: 'mysql-date-129',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'TO_DAYS Conversion',
    text: 'Convert a date to day number since year 0.',
    setup: 'SELECT from dates table',
    setupCode:
      "CREATE TABLE dates (id INT, the_date DATE);\nINSERT INTO dates VALUES (1, '2024-01-15');",
    expected: '739260 (approximately)',
    sample: 'SELECT TO_DAYS(the_date) FROM dates;',
    hints: ['TO_DAYS counts days from year 0', 'Useful for date arithmetic'],
    tags: ['date', 'to-days', 'mysql-specific'],
  },
  {
    id: 'mysql-date-130',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'FROM_DAYS Conversion',
    text: 'Convert a day number back to a date.',
    setup: 'SELECT statement',
    setupCode: '-- Convert day number to date',
    expected: '2024-01-15',
    sample: 'SELECT FROM_DAYS(739260);',
    hints: ['FROM_DAYS is inverse of TO_DAYS', 'Returns DATE value'],
    tags: ['date', 'from-days', 'mysql-specific'],
  },
  {
    id: 'mysql-date-131',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'UNIX_TIMESTAMP',
    text: 'Convert a datetime to Unix timestamp (seconds since epoch).',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_time DATETIME);\nINSERT INTO events VALUES (1, '2024-01-15 12:00:00');",
    expected: '1705320000 (approximately)',
    sample: 'SELECT UNIX_TIMESTAMP(event_time) FROM events;',
    hints: ['UNIX_TIMESTAMP returns seconds since 1970-01-01', 'Useful for external systems'],
    tags: ['date', 'unix-timestamp', 'mysql-specific'],
  },
  {
    id: 'mysql-date-132',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'FROM_UNIXTIME',
    text: 'Convert Unix timestamp to datetime.',
    setup: 'SELECT statement',
    setupCode: '-- Convert Unix timestamp',
    expected: '2024-01-15 12:00:00',
    sample: 'SELECT FROM_UNIXTIME(1705320000);',
    hints: [
      'FROM_UNIXTIME converts timestamp to datetime',
      'Can add format string as second argument',
    ],
    tags: ['date', 'from-unixtime', 'mysql-specific'],
  },
  {
    id: 'mysql-date-133',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'PERIOD_ADD',
    text: 'Add 3 months to a period value YYYYMM.',
    setup: 'SELECT statement',
    setupCode: '-- Add months to period',
    expected: '202406',
    sample: 'SELECT PERIOD_ADD(202403, 3);',
    hints: ['PERIOD_ADD(YYMM or YYYYMM, months)', 'Works with period format, not DATE'],
    tags: ['date', 'period-add', 'mysql-specific'],
  },
  {
    id: 'mysql-date-134',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'PERIOD_DIFF',
    text: 'Calculate months between two period values.',
    setup: 'SELECT statement',
    setupCode: '-- Diff between periods',
    expected: '14',
    sample: 'SELECT PERIOD_DIFF(202503, 202401);',
    hints: ['PERIOD_DIFF returns months between periods', 'First arg minus second arg'],
    tags: ['date', 'period-diff', 'mysql-specific'],
  },
  {
    id: 'mysql-date-135',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'GET_FORMAT for Locale',
    text: 'Get the date format string for USA locale.',
    setup: 'SELECT statement',
    setupCode: '-- Get USA date format',
    expected: '%m.%d.%Y',
    sample: "SELECT GET_FORMAT(DATE, 'USA');",
    hints: ['GET_FORMAT returns format string', 'Options: EUR, USA, JIS, ISO, INTERNAL'],
    tags: ['date', 'get-format', 'mysql-specific'],
  },
  {
    id: 'mysql-date-136',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'CONVERT_TZ',
    text: 'Convert a datetime from UTC to US Eastern time.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_time DATETIME);\nINSERT INTO events VALUES (1, '2024-01-15 12:00:00');",
    expected: '2024-01-15 07:00:00',
    sample: "SELECT CONVERT_TZ(event_time, '+00:00', '-05:00') FROM events;",
    hints: ['CONVERT_TZ(dt, from_tz, to_tz)', 'Use offset format or timezone names'],
    tags: ['date', 'convert-tz', 'timezone', 'mysql-specific'],
  },
  {
    id: 'mysql-date-137',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'DATE from DATETIME',
    text: 'Extract just the date part from a datetime column.',
    setup: 'SELECT from logs table',
    setupCode:
      "CREATE TABLE logs (id INT, created_at DATETIME);\nINSERT INTO logs VALUES (1, '2024-01-15 14:30:45');",
    expected: '2024-01-15',
    sample: 'SELECT DATE(created_at) FROM logs;',
    hints: ['DATE() extracts date portion', 'Removes time component'],
    tags: ['date', 'date-extract', 'mysql-specific'],
  },
  {
    id: 'mysql-date-138',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'TIME from DATETIME',
    text: 'Extract just the time part from a datetime column.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_time DATETIME);\nINSERT INTO events VALUES (1, '2024-01-15 09:30:00');",
    expected: '09:30:00',
    sample: 'SELECT TIME(event_time) FROM events;',
    hints: ['TIME() extracts time portion', 'Removes date component'],
    tags: ['date', 'time-extract', 'mysql-specific'],
  },
  {
    id: 'mysql-date-139',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'TIMESTAMP Constructor',
    text: 'Combine a date and time into a timestamp.',
    setup: 'SELECT statement',
    setupCode: '-- Combine date and time',
    expected: '2024-01-15 14:30:00',
    sample: "SELECT TIMESTAMP('2024-01-15', '14:30:00');",
    hints: ['TIMESTAMP(date, time) combines them', 'With one arg, converts to timestamp'],
    tags: ['date', 'timestamp', 'mysql-specific'],
  },
  {
    id: 'mysql-date-140',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'ADDTIME',
    text: 'Add time to a datetime value.',
    setup: 'SELECT from schedules table',
    setupCode:
      "CREATE TABLE schedules (id INT, start_time DATETIME);\nINSERT INTO schedules VALUES (1, '2024-01-15 09:00:00');",
    expected: '2024-01-15 11:30:45',
    sample: "SELECT ADDTIME(start_time, '02:30:45') FROM schedules;",
    hints: ['ADDTIME adds time expression', 'Works with DATETIME or TIME'],
    tags: ['date', 'addtime', 'mysql-specific'],
  },
  {
    id: 'mysql-date-141',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'SUBTIME',
    text: 'Subtract time from a datetime value.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, end_time DATETIME);\nINSERT INTO events VALUES (1, '2024-01-15 17:00:00');",
    expected: '2024-01-15 15:30:00',
    sample: "SELECT SUBTIME(end_time, '01:30:00') FROM events;",
    hints: ['SUBTIME subtracts time', 'Opposite of ADDTIME'],
    tags: ['date', 'subtime', 'mysql-specific'],
  },
  {
    id: 'mysql-date-142',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'TIMESTAMPADD',
    text: 'Add 2 hours to a timestamp using TIMESTAMPADD.',
    setup: 'SELECT from logs table',
    setupCode:
      "CREATE TABLE logs (id INT, log_time TIMESTAMP);\nINSERT INTO logs VALUES (1, '2024-01-15 10:00:00');",
    expected: '2024-01-15 12:00:00',
    sample: 'SELECT TIMESTAMPADD(HOUR, 2, log_time) FROM logs;',
    hints: [
      'TIMESTAMPADD(unit, interval, timestamp)',
      'Unit can be SECOND, MINUTE, HOUR, DAY, etc.',
    ],
    tags: ['date', 'timestampadd', 'mysql-specific'],
  },
  {
    id: 'mysql-date-143',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'YEARWEEK',
    text: 'Get the year and week number combined as YYYYWW.',
    setup: 'SELECT from orders table',
    setupCode:
      "CREATE TABLE orders (id INT, order_date DATE);\nINSERT INTO orders VALUES (1, '2024-01-15');",
    expected: '202403',
    sample: 'SELECT YEARWEEK(order_date) FROM orders;',
    hints: ['YEARWEEK returns YYYYWW format', 'Second arg controls week mode'],
    tags: ['date', 'yearweek', 'mysql-specific'],
  },
  {
    id: 'mysql-date-144',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Age in Years Months Days',
    text: 'Calculate detailed age showing years, months, and days.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, birth_date DATE);\nINSERT INTO employees VALUES (1, '1990-06-15');",
    expected: 'X years, Y months, Z days',
    sample:
      "SELECT CONCAT(TIMESTAMPDIFF(YEAR, birth_date, CURDATE()), ' years, ', TIMESTAMPDIFF(MONTH, birth_date, CURDATE()) % 12, ' months, ', DATEDIFF(CURDATE(), DATE_ADD(birth_date, INTERVAL TIMESTAMPDIFF(MONTH, birth_date, CURDATE()) MONTH)), ' days') FROM employees;",
    hints: ['Use TIMESTAMPDIFF for years and months', 'Calculate remaining days separately'],
    tags: ['date', 'age', 'complex', 'mysql-specific'],
  },
  {
    id: 'mysql-date-145',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Next Weekday',
    text: 'Find the next Monday after a given date.',
    setup: 'SELECT from events table',
    setupCode:
      "CREATE TABLE events (id INT, event_date DATE);\nINSERT INTO events VALUES (1, '2024-01-15');",
    expected: '2024-01-22',
    sample:
      'SELECT DATE_ADD(event_date, INTERVAL (7 - WEEKDAY(event_date)) % 7 + 7 DAY) FROM events;',
    hints: ['WEEKDAY returns 0-6 for Mon-Sun', 'Calculate days until next occurrence'],
    tags: ['date', 'next-weekday', 'mysql-specific'],
  },
  {
    id: 'mysql-date-146',
    category: 'Date Functions',
    difficulty: 'medium',
    title: 'End of Previous Month',
    text: 'Get the last day of the previous month.',
    setup: 'SELECT from billing table',
    setupCode:
      "CREATE TABLE billing (id INT, bill_date DATE);\nINSERT INTO billing VALUES (1, '2024-03-15');",
    expected: '2024-02-29',
    sample: 'SELECT LAST_DAY(DATE_SUB(bill_date, INTERVAL 1 MONTH)) FROM billing;',
    hints: ['Subtract a month first', 'Then get LAST_DAY'],
    tags: ['date', 'last-day', 'previous-month', 'mysql-specific'],
  },
  {
    id: 'mysql-date-147',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Days in Current Month',
    text: 'Calculate the number of days in the current month for a given date.',
    setup: 'SELECT from dates table',
    setupCode:
      "CREATE TABLE dates (id INT, the_date DATE);\nINSERT INTO dates VALUES (1, '2024-02-15');",
    expected: '29',
    sample: 'SELECT DAY(LAST_DAY(the_date)) FROM dates;',
    hints: ['LAST_DAY gives last day of month', 'DAY extracts the day number'],
    tags: ['date', 'days-in-month', 'mysql-specific'],
  },
  {
    id: 'mysql-date-148',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'Start of Week',
    text: 'Find the start of the week (Monday) for a given date.',
    setup: 'SELECT from reports table',
    setupCode:
      "CREATE TABLE reports (id INT, report_date DATE);\nINSERT INTO reports VALUES (1, '2024-01-17');",
    expected: '2024-01-15',
    sample: 'SELECT DATE_SUB(report_date, INTERVAL WEEKDAY(report_date) DAY) FROM reports;',
    hints: ['WEEKDAY returns days since Monday', 'Subtract that many days'],
    tags: ['date', 'start-of-week', 'mysql-specific'],
  },
  {
    id: 'mysql-date-149',
    category: 'Date Functions',
    difficulty: 'hard',
    title: 'End of Week',
    text: 'Find the end of the week (Sunday) for a given date.',
    setup: 'SELECT from schedules table',
    setupCode:
      "CREATE TABLE schedules (id INT, sched_date DATE);\nINSERT INTO schedules VALUES (1, '2024-01-17');",
    expected: '2024-01-21',
    sample: 'SELECT DATE_ADD(sched_date, INTERVAL (6 - WEEKDAY(sched_date)) DAY) FROM schedules;',
    hints: ['Sunday is 6 days after Monday', 'Calculate days remaining to Sunday'],
    tags: ['date', 'end-of-week', 'mysql-specific'],
  },

  // ============================================================
  // AGGREGATE FUNCTIONS (50 problems)
  // ============================================================
  {
    id: 'mysql-agg-100',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'COUNT All Rows',
    text: 'Count the total number of rows in the orders table.',
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));\nINSERT INTO orders VALUES (1, 1, 100), (2, 1, 150), (3, 2, 200);',
    expected: '3',
    sample: 'SELECT COUNT(*) FROM orders;',
    hints: ['COUNT(*) counts all rows', 'Includes rows with NULL values'],
    tags: ['aggregate', 'count', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-101',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'COUNT Column',
    text: 'Count the number of non-NULL email addresses.',
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, email VARCHAR(100));\nINSERT INTO users VALUES (1, 'a@test.com'), (2, NULL), (3, 'b@test.com');",
    expected: '2',
    sample: 'SELECT COUNT(email) FROM users;',
    hints: ['COUNT(column) skips NULL values', 'Different from COUNT(*)'],
    tags: ['aggregate', 'count', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-102',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'COUNT DISTINCT',
    text: 'Count the number of unique categories.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, category VARCHAR(50));\nINSERT INTO products VALUES (1, 'Electronics'), (2, 'Electronics'), (3, 'Clothing');",
    expected: '2',
    sample: 'SELECT COUNT(DISTINCT category) FROM products;',
    hints: ['COUNT(DISTINCT col) counts unique values', 'Excludes duplicate values'],
    tags: ['aggregate', 'count', 'distinct', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-103',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'SUM Total',
    text: 'Calculate the total sales amount.',
    setup: 'SELECT from sales table',
    setupCode:
      'CREATE TABLE sales (id INT, amount DECIMAL(10,2));\nINSERT INTO sales VALUES (1, 100.50), (2, 200.75), (3, 150.25);',
    expected: '451.50',
    sample: 'SELECT SUM(amount) FROM sales;',
    hints: ['SUM adds all values', 'NULL values are ignored'],
    tags: ['aggregate', 'sum', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-104',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'AVG Average',
    text: 'Calculate the average order amount.',
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT, amount DECIMAL(10,2));\nINSERT INTO orders VALUES (1, 100), (2, 200), (3, 300);',
    expected: '200.00',
    sample: 'SELECT AVG(amount) FROM orders;',
    hints: ['AVG calculates arithmetic mean', 'NULL values are excluded from calculation'],
    tags: ['aggregate', 'avg', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-105',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'MIN Value',
    text: 'Find the minimum price in the products table.',
    setup: 'SELECT from products table',
    setupCode:
      'CREATE TABLE products (id INT, price DECIMAL(10,2));\nINSERT INTO products VALUES (1, 29.99), (2, 49.99), (3, 19.99);',
    expected: '19.99',
    sample: 'SELECT MIN(price) FROM products;',
    hints: ['MIN returns smallest value', 'Works with numbers, strings, dates'],
    tags: ['aggregate', 'min', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-106',
    category: 'Aggregate Functions',
    difficulty: 'easy',
    title: 'MAX Value',
    text: 'Find the maximum salary in the employees table.',
    setup: 'SELECT from employees table',
    setupCode:
      'CREATE TABLE employees (id INT, salary DECIMAL(10,2));\nINSERT INTO employees VALUES (1, 50000), (2, 75000), (3, 60000);',
    expected: '75000.00',
    sample: 'SELECT MAX(salary) FROM employees;',
    hints: ['MAX returns largest value', 'Works with numbers, strings, dates'],
    tags: ['aggregate', 'max', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-107',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP BY with COUNT',
    text: 'Count orders per customer.',
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));\nINSERT INTO orders VALUES (1, 1, 100), (2, 1, 150), (3, 2, 200);',
    expected: 'customer_id 1: 2, customer_id 2: 1',
    sample: 'SELECT customer_id, COUNT(*) AS order_count FROM orders GROUP BY customer_id;',
    hints: ['GROUP BY groups rows by column value', 'Aggregate functions apply per group'],
    tags: ['aggregate', 'group-by', 'count', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-108',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP BY with SUM',
    text: 'Calculate total sales per category.',
    setup: 'SELECT from sales table',
    setupCode:
      "CREATE TABLE sales (id INT, category VARCHAR(50), amount DECIMAL(10,2));\nINSERT INTO sales VALUES (1, 'A', 100), (2, 'A', 150), (3, 'B', 200);",
    expected: 'A: 250, B: 200',
    sample: 'SELECT category, SUM(amount) AS total FROM sales GROUP BY category;',
    hints: ['SUM within GROUP BY gives totals per group', 'Each category gets its own sum'],
    tags: ['aggregate', 'group-by', 'sum', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-109',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'HAVING Clause',
    text: 'Find customers with more than 2 orders.',
    setup: 'SELECT from orders table',
    setupCode:
      'CREATE TABLE orders (id INT, customer_id INT);\nINSERT INTO orders VALUES (1, 1), (2, 1), (3, 1), (4, 2);',
    expected: 'customer_id 1 with 3 orders',
    sample: 'SELECT customer_id, COUNT(*) AS cnt FROM orders GROUP BY customer_id HAVING cnt > 2;',
    hints: ['HAVING filters groups after aggregation', 'WHERE filters rows before aggregation'],
    tags: ['aggregate', 'having', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-110',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP BY Multiple Columns',
    text: 'Count orders by customer and status.',
    setup: 'SELECT from orders table',
    setupCode:
      "CREATE TABLE orders (id INT, customer_id INT, status VARCHAR(20));\nINSERT INTO orders VALUES (1, 1, 'pending'), (2, 1, 'pending'), (3, 1, 'shipped');",
    expected: 'Counts per customer-status combination',
    sample: 'SELECT customer_id, status, COUNT(*) FROM orders GROUP BY customer_id, status;',
    hints: [
      'GROUP BY multiple columns creates unique combinations',
      'Each combination is a separate group',
    ],
    tags: ['aggregate', 'group-by', 'multiple', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-111',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP_CONCAT Basic',
    text: 'Concatenate all product names into a comma-separated list.',
    setup: 'SELECT from products table',
    setupCode:
      "CREATE TABLE products (id INT, name VARCHAR(50));\nINSERT INTO products VALUES (1, 'Apple'), (2, 'Banana'), (3, 'Cherry');",
    expected: 'Apple,Banana,Cherry',
    sample: 'SELECT GROUP_CONCAT(name) FROM products;',
    hints: ['GROUP_CONCAT concatenates values', 'Default separator is comma'],
    tags: ['aggregate', 'group-concat', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-112',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP_CONCAT with Separator',
    text: "Concatenate names with ' | ' separator.",
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, name VARCHAR(50));\nINSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');",
    expected: 'Alice | Bob',
    sample: "SELECT GROUP_CONCAT(name SEPARATOR ' | ') FROM users;",
    hints: ['SEPARATOR keyword changes delimiter', 'Default is comma'],
    tags: ['aggregate', 'group-concat', 'separator', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-113',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP_CONCAT with ORDER BY',
    text: 'Concatenate names in alphabetical order.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, name VARCHAR(50));\nINSERT INTO employees VALUES (1, 'Charlie'), (2, 'Alice'), (3, 'Bob');",
    expected: 'Alice,Bob,Charlie',
    sample: 'SELECT GROUP_CONCAT(name ORDER BY name ASC) FROM employees;',
    hints: ['ORDER BY inside GROUP_CONCAT', 'Controls concatenation order'],
    tags: ['aggregate', 'group-concat', 'order', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-114',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'GROUP_CONCAT DISTINCT',
    text: 'Concatenate unique values only.',
    setup: 'SELECT from tags table',
    setupCode:
      "CREATE TABLE tags (id INT, tag VARCHAR(30));\nINSERT INTO tags VALUES (1, 'news'), (2, 'sports'), (3, 'news');",
    expected: 'news,sports',
    sample: 'SELECT GROUP_CONCAT(DISTINCT tag) FROM tags;',
    hints: ['DISTINCT removes duplicates', 'Place before column name'],
    tags: ['aggregate', 'group-concat', 'distinct', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-115',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'WITH ROLLUP',
    text: 'Get subtotals and grand total using WITH ROLLUP.',
    setup: 'SELECT from sales table',
    setupCode:
      "CREATE TABLE sales (id INT, region VARCHAR(20), amount DECIMAL(10,2));\nINSERT INTO sales VALUES (1, 'East', 100), (2, 'East', 150), (3, 'West', 200);",
    expected: 'East: 250, West: 200, Total: 450',
    sample: 'SELECT region, SUM(amount) FROM sales GROUP BY region WITH ROLLUP;',
    hints: ['WITH ROLLUP adds subtotals and grand total', 'NULL in region column indicates total'],
    tags: ['aggregate', 'rollup', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-116',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'GROUPING Function',
    text: 'Use GROUPING to identify rollup rows.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, category VARCHAR(20), amount DECIMAL(10,2));',
    expected: 'Identify which rows are rollup totals',
    sample:
      'SELECT category, SUM(amount), GROUPING(category) AS is_total FROM sales GROUP BY category WITH ROLLUP;',
    hints: ['GROUPING returns 1 for rollup rows', 'Returns 0 for regular group rows'],
    tags: ['aggregate', 'grouping', 'rollup', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-117',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'STD Standard Deviation',
    text: 'Calculate the standard deviation of prices.',
    setup: 'SELECT from products table',
    setupCode:
      'CREATE TABLE products (id INT, price DECIMAL(10,2));\nINSERT INTO products VALUES (1, 10), (2, 20), (3, 30);',
    expected: '8.16... (population std dev)',
    sample: 'SELECT STD(price) FROM products;',
    hints: [
      'STD calculates population standard deviation',
      'STDDEV_SAMP for sample standard deviation',
    ],
    tags: ['aggregate', 'std', 'statistics', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-118',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'VARIANCE',
    text: 'Calculate the variance of test scores.',
    setup: 'SELECT from scores table',
    setupCode:
      'CREATE TABLE scores (id INT, score INT);\nINSERT INTO scores VALUES (1, 80), (2, 90), (3, 100);',
    expected: '66.67 (population variance)',
    sample: 'SELECT VARIANCE(score) FROM scores;',
    hints: ['VARIANCE calculates population variance', 'VAR_SAMP for sample variance'],
    tags: ['aggregate', 'variance', 'statistics', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-119',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'BIT_AND Aggregate',
    text: 'Perform bitwise AND across all values.',
    setup: 'SELECT from flags table',
    setupCode:
      'CREATE TABLE flags (id INT, bits INT);\nINSERT INTO flags VALUES (1, 7), (2, 5), (3, 3);',
    expected: '1 (binary 001)',
    sample: 'SELECT BIT_AND(bits) FROM flags;',
    hints: ['BIT_AND performs bitwise AND', '7=111, 5=101, 3=011, result=001=1'],
    tags: ['aggregate', 'bit-and', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-120',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'BIT_OR Aggregate',
    text: 'Perform bitwise OR across all permission values.',
    setup: 'SELECT from permissions table',
    setupCode:
      'CREATE TABLE permissions (id INT, perm INT);\nINSERT INTO permissions VALUES (1, 1), (2, 2), (3, 4);',
    expected: '7 (binary 111)',
    sample: 'SELECT BIT_OR(perm) FROM permissions;',
    hints: ['BIT_OR performs bitwise OR', '1=001, 2=010, 4=100, result=111=7'],
    tags: ['aggregate', 'bit-or', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-121',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'BIT_XOR Aggregate',
    text: 'Perform bitwise XOR across values.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, val INT);\nINSERT INTO data VALUES (1, 5), (2, 3);',
    expected: '6 (5 XOR 3 = 101 XOR 011 = 110)',
    sample: 'SELECT BIT_XOR(val) FROM data;',
    hints: ['BIT_XOR performs bitwise exclusive OR', 'Useful for checksums and toggles'],
    tags: ['aggregate', 'bit-xor', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-122',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Conditional COUNT',
    text: 'Count only active users using conditional aggregation.',
    setup: 'SELECT from users table',
    setupCode:
      "CREATE TABLE users (id INT, status VARCHAR(20));\nINSERT INTO users VALUES (1, 'active'), (2, 'inactive'), (3, 'active');",
    expected: '2',
    sample: "SELECT COUNT(CASE WHEN status = 'active' THEN 1 END) FROM users;",
    hints: ['CASE inside COUNT for conditional counting', 'NULL values are not counted'],
    tags: ['aggregate', 'conditional', 'count', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-123',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Conditional SUM',
    text: 'Sum only positive amounts.',
    setup: 'SELECT from transactions table',
    setupCode:
      'CREATE TABLE transactions (id INT, amount DECIMAL(10,2));\nINSERT INTO transactions VALUES (1, 100), (2, -50), (3, 75);',
    expected: '175',
    sample: 'SELECT SUM(CASE WHEN amount > 0 THEN amount ELSE 0 END) FROM transactions;',
    hints: ['CASE inside SUM for conditional summing', 'Return 0 for unwanted values'],
    tags: ['aggregate', 'conditional', 'sum', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-124',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Pivot with Aggregation',
    text: 'Create a pivot table showing counts by status and month.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, status VARCHAR(20), order_date DATE);',
    expected: 'Pivot table with months as columns',
    sample:
      "SELECT MONTH(order_date) AS month, SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) AS completed, SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) AS pending FROM orders GROUP BY MONTH(order_date);",
    hints: ['Use CASE inside SUM for each column', 'GROUP BY the row dimension'],
    tags: ['aggregate', 'pivot', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-125',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'AVG with DISTINCT',
    text: 'Calculate average of distinct values only.',
    setup: 'SELECT from ratings table',
    setupCode:
      'CREATE TABLE ratings (id INT, score INT);\nINSERT INTO ratings VALUES (1, 5), (2, 5), (3, 3), (4, 3), (5, 4);',
    expected: '4 (average of 3, 4, 5)',
    sample: 'SELECT AVG(DISTINCT score) FROM ratings;',
    hints: ['AVG(DISTINCT col) averages unique values', 'Duplicates only counted once'],
    tags: ['aggregate', 'avg', 'distinct', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-126',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Nested Aggregation with Subquery',
    text: 'Find the average of per-customer order totals.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: 'Average of customer totals',
    sample:
      'SELECT AVG(customer_total) FROM (SELECT customer_id, SUM(amount) AS customer_total FROM orders GROUP BY customer_id) AS totals;',
    hints: ['First aggregate by customer in subquery', 'Then average the results in outer query'],
    tags: ['aggregate', 'nested', 'subquery', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-127',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'COALESCE with Aggregates',
    text: 'Return 0 instead of NULL when SUM has no rows.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: '0 instead of NULL',
    sample: 'SELECT COALESCE(SUM(amount), 0) FROM orders WHERE customer_id = 999;',
    hints: ['SUM returns NULL for empty set', 'COALESCE provides default value'],
    tags: ['aggregate', 'coalesce', 'null', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-128',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Running Total with Variables',
    text: 'Calculate running total using user variables (pre-MySQL 8).',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, sale_date DATE, amount DECIMAL(10,2));',
    expected: 'Running total for each row',
    sample:
      'SET @running = 0; SELECT sale_date, amount, (@running := @running + amount) AS running_total FROM sales ORDER BY sale_date;',
    hints: ['@variable := value assigns in SELECT', 'ORDER BY ensures correct sequence'],
    tags: ['aggregate', 'running-total', 'variables', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-129',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Percentage of Total',
    text: 'Calculate each category as percentage of total sales.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, category VARCHAR(50), amount DECIMAL(10,2));',
    expected: 'Each category with percentage',
    sample:
      'SELECT category, SUM(amount) AS cat_total, SUM(amount) * 100.0 / (SELECT SUM(amount) FROM sales) AS percentage FROM sales GROUP BY category;',
    hints: ['Subquery gets overall total', 'Divide group total by overall total'],
    tags: ['aggregate', 'percentage', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-130',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Top N per Group',
    text: 'Get top 2 products by sales in each category.',
    setup: 'SELECT from products table',
    setupCode:
      'CREATE TABLE products (id INT, category VARCHAR(50), name VARCHAR(100), sales INT);',
    expected: 'Top 2 products per category',
    sample:
      'SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales DESC) AS rn FROM products) ranked WHERE rn <= 2;',
    hints: ['ROW_NUMBER with PARTITION BY for ranking within groups', 'Filter in outer query'],
    tags: ['aggregate', 'top-n', 'window', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-131',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'MIN and MAX Together',
    text: 'Find the price range (min and max) for each category.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(50), price DECIMAL(10,2));',
    expected: 'Category with min_price and max_price',
    sample:
      'SELECT category, MIN(price) AS min_price, MAX(price) AS max_price, MAX(price) - MIN(price) AS price_range FROM products GROUP BY category;',
    hints: ['Multiple aggregates in one query', 'Can calculate derived values'],
    tags: ['aggregate', 'min', 'max', 'range', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-132',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'COUNT with NULL',
    text: 'Count total rows vs rows with non-null email.',
    setup: 'SELECT from users table',
    setupCode: 'CREATE TABLE users (id INT, email VARCHAR(100));',
    expected: 'Total vs non-null count',
    sample:
      'SELECT COUNT(*) AS total, COUNT(email) AS with_email, COUNT(*) - COUNT(email) AS without_email FROM users;',
    hints: ['COUNT(*) includes NULL rows', 'COUNT(column) excludes NULL'],
    tags: ['aggregate', 'count', 'null', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-133',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Median Calculation',
    text: 'Calculate the median value using aggregates and variables.',
    setup: 'SELECT from scores table',
    setupCode: 'CREATE TABLE scores (id INT, score INT);',
    expected: 'Median score',
    sample:
      'SELECT AVG(score) AS median FROM (SELECT score, @rownum:=@rownum+1 AS row_num, @total_rows:=@rownum FROM (SELECT @rownum:=0) r, (SELECT score FROM scores ORDER BY score) s) ranked WHERE row_num IN (FLOOR((@total_rows+1)/2), FLOOR((@total_rows+2)/2));',
    hints: ['Median is middle value when sorted', 'For even count, average two middle values'],
    tags: ['aggregate', 'median', 'complex', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-134',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'HAVING with Multiple Conditions',
    text: 'Find categories with more than 5 products AND average price over 50.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(50), price DECIMAL(10,2));',
    expected: 'Categories meeting both conditions',
    sample:
      'SELECT category, COUNT(*) AS cnt, AVG(price) AS avg_price FROM products GROUP BY category HAVING COUNT(*) > 5 AND AVG(price) > 50;',
    hints: ['HAVING can have multiple conditions', 'Use AND/OR to combine'],
    tags: ['aggregate', 'having', 'multiple', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-135',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Cumulative Distribution',
    text: 'Calculate cumulative percentage of sales.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, product_id INT, amount DECIMAL(10,2));',
    expected: 'Cumulative percentage per product',
    sample:
      'SELECT product_id, amount, SUM(amount) OVER (ORDER BY amount DESC) / SUM(amount) OVER () * 100 AS cumulative_pct FROM sales;',
    hints: ['Window function for running sum', 'Divide by total sum'],
    tags: ['aggregate', 'cumulative', 'window', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-136',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'First Value in Group',
    text: 'Get the first order date for each customer.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, order_date DATE);',
    expected: 'Earliest order per customer',
    sample: 'SELECT customer_id, MIN(order_date) AS first_order FROM orders GROUP BY customer_id;',
    hints: ['MIN on date gives earliest', 'GROUP BY to get per customer'],
    tags: ['aggregate', 'min', 'first', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-137',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Mode Calculation',
    text: 'Find the most frequent value (mode) in a column.',
    setup: 'SELECT from responses table',
    setupCode: 'CREATE TABLE responses (id INT, answer VARCHAR(50));',
    expected: 'Most common answer',
    sample:
      'SELECT answer, COUNT(*) AS cnt FROM responses GROUP BY answer ORDER BY cnt DESC LIMIT 1;',
    hints: ['Count occurrences of each value', 'Order by count and take first'],
    tags: ['aggregate', 'mode', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-138',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Weighted Average',
    text: 'Calculate weighted average grade based on credit hours.',
    setup: 'SELECT from grades table',
    setupCode: 'CREATE TABLE grades (id INT, grade DECIMAL(3,2), credits INT);',
    expected: 'Weighted GPA',
    sample: 'SELECT SUM(grade * credits) / SUM(credits) AS weighted_avg FROM grades;',
    hints: ['Multiply each value by its weight', 'Divide sum of products by sum of weights'],
    tags: ['aggregate', 'weighted', 'avg', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-139',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Consecutive Days Count',
    text: 'Find the maximum consecutive days with orders.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, order_date DATE);',
    expected: 'Max consecutive days',
    sample:
      'SELECT MAX(consecutive) FROM (SELECT COUNT(*) AS consecutive FROM (SELECT order_date, DATE_SUB(order_date, INTERVAL ROW_NUMBER() OVER (ORDER BY order_date) DAY) AS grp FROM (SELECT DISTINCT order_date FROM orders) d) t GROUP BY grp) x;',
    hints: ['Group consecutive dates using row number trick', 'Subtract row number from date'],
    tags: ['aggregate', 'consecutive', 'window', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-140',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'JSON_ARRAYAGG',
    text: 'Aggregate values into a JSON array.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(50), name VARCHAR(100));',
    expected: 'JSON array of product names per category',
    sample: 'SELECT category, JSON_ARRAYAGG(name) AS products FROM products GROUP BY category;',
    hints: ['JSON_ARRAYAGG creates JSON array', 'MySQL 5.7.22+ feature'],
    tags: ['aggregate', 'json', 'arrayagg', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-141',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'JSON_OBJECTAGG',
    text: 'Aggregate key-value pairs into a JSON object.',
    setup: 'SELECT from settings table',
    setupCode:
      'CREATE TABLE settings (id INT, setting_key VARCHAR(50), setting_value VARCHAR(100));',
    expected: 'JSON object of settings',
    sample: 'SELECT JSON_OBJECTAGG(setting_key, setting_value) AS settings FROM settings;',
    hints: ['JSON_OBJECTAGG creates JSON object', 'First arg is key, second is value'],
    tags: ['aggregate', 'json', 'objectagg', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-142',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Year over Year Comparison',
    text: 'Compare monthly sales to same month previous year.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, sale_date DATE, amount DECIMAL(10,2));',
    expected: 'This year vs last year per month',
    sample:
      'SELECT YEAR(sale_date) AS yr, MONTH(sale_date) AS mo, SUM(amount) AS total FROM sales GROUP BY yr, mo ORDER BY yr, mo;',
    hints: ['Group by year and month', 'Join or use window functions to compare'],
    tags: ['aggregate', 'yoy', 'comparison', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-143',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Count Distinct Multiple',
    text: 'Count distinct combinations of two columns.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, product_id INT);',
    expected: 'Unique customer-product pairs',
    sample: 'SELECT COUNT(DISTINCT customer_id, product_id) FROM orders;',
    hints: ['COUNT(DISTINCT col1, col2) counts unique pairs', 'MySQL-specific syntax'],
    tags: ['aggregate', 'count', 'distinct', 'multiple', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-144',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Gap Analysis',
    text: 'Find gaps in sequential order numbers.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (order_number INT PRIMARY KEY);',
    expected: 'Missing order numbers',
    sample:
      'SELECT t1.order_number + 1 AS gap_start, MIN(t2.order_number) - 1 AS gap_end FROM orders t1 INNER JOIN orders t2 ON t2.order_number > t1.order_number + 1 GROUP BY t1.order_number HAVING gap_start <= gap_end;',
    hints: ['Self-join to find gaps', 'Compare consecutive values'],
    tags: ['aggregate', 'gap', 'analysis', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-145',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Ratio Calculation',
    text: 'Calculate the ratio of completed orders to total orders.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, status VARCHAR(20));',
    expected: 'Completion ratio',
    sample:
      "SELECT SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) / COUNT(*) AS completion_ratio FROM orders;",
    hints: ['Conditional sum divided by count', 'Multiply by 100 for percentage'],
    tags: ['aggregate', 'ratio', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-146',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Histogram Buckets',
    text: 'Create histogram buckets for price distribution.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, price DECIMAL(10,2));',
    expected: 'Count per price range',
    sample:
      'SELECT FLOOR(price / 10) * 10 AS bucket_start, FLOOR(price / 10) * 10 + 9 AS bucket_end, COUNT(*) AS cnt FROM products GROUP BY FLOOR(price / 10);',
    hints: ['FLOOR(price/bucket_size) creates buckets', 'Multiply back for range start'],
    tags: ['aggregate', 'histogram', 'buckets', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-147',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'Any Value',
    text: 'Use ANY_VALUE to get a non-grouped column in MySQL.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, customer_name VARCHAR(100));',
    expected: 'Customer with order count',
    sample:
      'SELECT customer_id, ANY_VALUE(customer_name) AS name, COUNT(*) AS orders FROM orders GROUP BY customer_id;',
    hints: ['ANY_VALUE returns any value from group', 'Avoids ONLY_FULL_GROUP_BY error'],
    tags: ['aggregate', 'any-value', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-148',
    category: 'Aggregate Functions',
    difficulty: 'hard',
    title: 'Correlation Coefficient',
    text: 'Calculate correlation between two numeric columns.',
    setup: 'SELECT from stats table',
    setupCode: 'CREATE TABLE stats (id INT, x DECIMAL(10,2), y DECIMAL(10,2));',
    expected: 'Correlation coefficient between -1 and 1',
    sample:
      'SELECT (COUNT(*) * SUM(x*y) - SUM(x)*SUM(y)) / SQRT((COUNT(*)*SUM(x*x) - SUM(x)*SUM(x)) * (COUNT(*)*SUM(y*y) - SUM(y)*SUM(y))) AS correlation FROM stats;',
    hints: ['Pearson correlation formula', 'Uses multiple aggregates'],
    tags: ['aggregate', 'correlation', 'statistics', 'mysql-specific'],
  },
  {
    id: 'mysql-agg-149',
    category: 'Aggregate Functions',
    difficulty: 'medium',
    title: 'NULL Safe Comparison in Aggregate',
    text: 'Count rows where two columns are equal, including NULL = NULL.',
    setup: 'SELECT from comparisons table',
    setupCode: 'CREATE TABLE comparisons (id INT, a INT, b INT);',
    expected: 'Count including NULL matches',
    sample: 'SELECT SUM(CASE WHEN a <=> b THEN 1 ELSE 0 END) AS equal_count FROM comparisons;',
    hints: ['<=> is NULL-safe equality', 'NULL <=> NULL returns true'],
    tags: ['aggregate', 'null-safe', 'mysql-specific'],
  },

  // ============================================================
  // WINDOW FUNCTIONS (50 problems)
  // ============================================================
  {
    id: 'mysql-win-100',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'ROW_NUMBER Basic',
    text: 'Assign sequential row numbers to all employees ordered by hire date.',
    setup: 'SELECT from employees table',
    setupCode:
      "CREATE TABLE employees (id INT, name VARCHAR(50), hire_date DATE);\nINSERT INTO employees VALUES (1, 'Alice', '2020-01-15'), (2, 'Bob', '2019-06-01');",
    expected: 'Bob=1, Alice=2',
    sample:
      'SELECT name, hire_date, ROW_NUMBER() OVER (ORDER BY hire_date) AS row_num FROM employees;',
    hints: ['ROW_NUMBER assigns sequential integers', 'ORDER BY in OVER determines sequence'],
    tags: ['window', 'row-number', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-101',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'ROW_NUMBER with PARTITION',
    text: 'Number employees within each department starting from 1.',
    setup: 'SELECT from employees table',
    setupCode:
      'CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50), salary DECIMAL(10,2));',
    expected: 'Row numbers reset per department',
    sample:
      'SELECT name, department, ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) AS dept_rank FROM employees;',
    hints: ['PARTITION BY resets numbering for each group', 'ORDER BY sets the ranking criteria'],
    tags: ['window', 'row-number', 'partition', 'mysql-specific'],
  },
  {
    id: 'mysql-win-102',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'RANK Basic',
    text: 'Rank students by score, allowing ties.',
    setup: 'SELECT from students table',
    setupCode:
      "CREATE TABLE students (id INT, name VARCHAR(50), score INT);\nINSERT INTO students VALUES (1, 'Alice', 95), (2, 'Bob', 95), (3, 'Carol', 90);",
    expected: 'Alice=1, Bob=1, Carol=3',
    sample: 'SELECT name, score, RANK() OVER (ORDER BY score DESC) AS rank FROM students;',
    hints: ['RANK allows ties with gaps', 'Same values get same rank'],
    tags: ['window', 'rank', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-103',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'DENSE_RANK',
    text: 'Rank products without gaps after ties.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, name VARCHAR(50), sales INT);',
    expected: 'Dense ranking 1,1,2 not 1,1,3',
    sample:
      'SELECT name, sales, DENSE_RANK() OVER (ORDER BY sales DESC) AS dense_rank FROM products;',
    hints: ['DENSE_RANK has no gaps after ties', '1,1,2,3 instead of 1,1,3,4'],
    tags: ['window', 'dense-rank', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-104',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'NTILE Quartiles',
    text: 'Divide employees into 4 salary quartiles.',
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, name VARCHAR(50), salary DECIMAL(10,2));',
    expected: 'Each employee assigned to quartile 1-4',
    sample: 'SELECT name, salary, NTILE(4) OVER (ORDER BY salary) AS quartile FROM employees;',
    hints: ['NTILE(n) divides into n groups', 'Tries to make groups equal size'],
    tags: ['window', 'ntile', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-105',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'LEAD Next Value',
    text: 'Get the next order date for comparison.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, order_date DATE);',
    expected: 'Each order with next order date',
    sample:
      'SELECT order_date, LEAD(order_date) OVER (ORDER BY order_date) AS next_order FROM orders;',
    hints: ['LEAD gets value from following row', 'Returns NULL for last row'],
    tags: ['window', 'lead', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-106',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'LAG Previous Value',
    text: 'Get the previous months sales for comparison.',
    setup: 'SELECT from monthly_sales table',
    setupCode: 'CREATE TABLE monthly_sales (month DATE, sales DECIMAL(10,2));',
    expected: 'Each month with previous month sales',
    sample:
      'SELECT month, sales, LAG(sales) OVER (ORDER BY month) AS prev_month_sales FROM monthly_sales;',
    hints: ['LAG gets value from preceding row', 'Returns NULL for first row'],
    tags: ['window', 'lag', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-107',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'LEAD with Offset',
    text: 'Get the value from 2 rows ahead.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, value INT);',
    expected: 'Value from 2 rows later',
    sample: 'SELECT id, value, LEAD(value, 2) OVER (ORDER BY id) AS value_plus_2 FROM data;',
    hints: ['LEAD(col, n) looks n rows ahead', 'Default n is 1'],
    tags: ['window', 'lead', 'offset', 'mysql-specific'],
  },
  {
    id: 'mysql-win-108',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'LAG with Default',
    text: 'Get previous value with 0 as default for first row.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, amount DECIMAL(10,2));',
    expected: 'Previous value or 0',
    sample: 'SELECT id, amount, LAG(amount, 1, 0) OVER (ORDER BY id) AS prev_amount FROM sales;',
    hints: ['LAG(col, offset, default)', 'Third arg is default value'],
    tags: ['window', 'lag', 'default', 'mysql-specific'],
  },
  {
    id: 'mysql-win-109',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'FIRST_VALUE',
    text: 'Get the first order date within each customer partition.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, order_date DATE);',
    expected: 'First order date for each customer',
    sample:
      'SELECT customer_id, order_date, FIRST_VALUE(order_date) OVER (PARTITION BY customer_id ORDER BY order_date) AS first_order FROM orders;',
    hints: ['FIRST_VALUE returns first value in partition', 'Based on ORDER BY clause'],
    tags: ['window', 'first-value', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-110',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'LAST_VALUE',
    text: 'Get the last (most recent) price in the window.',
    setup: 'SELECT from prices table',
    setupCode: 'CREATE TABLE prices (product_id INT, price_date DATE, price DECIMAL(10,2));',
    expected: 'Most recent price',
    sample:
      'SELECT product_id, price_date, price, LAST_VALUE(price) OVER (PARTITION BY product_id ORDER BY price_date ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_price FROM prices;',
    hints: ['LAST_VALUE needs frame specification', 'Default frame might not include all rows'],
    tags: ['window', 'last-value', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-111',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'NTH_VALUE',
    text: 'Get the 3rd highest salary in each department.',
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, department VARCHAR(50), salary DECIMAL(10,2));',
    expected: '3rd highest salary per dept',
    sample:
      'SELECT department, salary, NTH_VALUE(salary, 3) OVER (PARTITION BY department ORDER BY salary DESC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS third_highest FROM employees;',
    hints: ['NTH_VALUE(col, n) returns nth value', 'Needs proper frame clause'],
    tags: ['window', 'nth-value', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-112',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Running SUM',
    text: 'Calculate running total of sales ordered by date.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (sale_date DATE, amount DECIMAL(10,2));',
    expected: 'Cumulative sum',
    sample:
      'SELECT sale_date, amount, SUM(amount) OVER (ORDER BY sale_date) AS running_total FROM sales;',
    hints: ['SUM as window function', 'ORDER BY creates running calculation'],
    tags: ['window', 'sum', 'running', 'mysql-specific'],
  },
  {
    id: 'mysql-win-113',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Running AVG',
    text: 'Calculate running average of scores.',
    setup: 'SELECT from test_scores table',
    setupCode: 'CREATE TABLE test_scores (test_date DATE, score INT);',
    expected: 'Cumulative average',
    sample:
      'SELECT test_date, score, AVG(score) OVER (ORDER BY test_date) AS running_avg FROM test_scores;',
    hints: ['AVG as window function', 'Calculates average of all preceding rows'],
    tags: ['window', 'avg', 'running', 'mysql-specific'],
  },
  {
    id: 'mysql-win-114',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Moving Average 3-day',
    text: 'Calculate 3-day moving average of stock prices.',
    setup: 'SELECT from stock_prices table',
    setupCode: 'CREATE TABLE stock_prices (trade_date DATE, price DECIMAL(10,2));',
    expected: 'Average of current and 2 preceding days',
    sample:
      'SELECT trade_date, price, AVG(price) OVER (ORDER BY trade_date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg_3 FROM stock_prices;',
    hints: ['ROWS BETWEEN defines frame', '2 PRECEDING = current + 2 prior rows'],
    tags: ['window', 'moving-average', 'frame', 'mysql-specific'],
  },
  {
    id: 'mysql-win-115',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Moving SUM 7-day',
    text: 'Calculate 7-day rolling sum of orders.',
    setup: 'SELECT from daily_orders table',
    setupCode: 'CREATE TABLE daily_orders (order_date DATE, order_count INT);',
    expected: 'Sum of last 7 days',
    sample:
      'SELECT order_date, order_count, SUM(order_count) OVER (ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_7_sum FROM daily_orders;',
    hints: ['6 PRECEDING + CURRENT = 7 rows', 'Careful with row count vs days'],
    tags: ['window', 'moving-sum', 'rolling', 'mysql-specific'],
  },
  {
    id: 'mysql-win-116',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'RANGE Frame',
    text: 'Calculate sum of sales within 30-day range.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (sale_date DATE, amount DECIMAL(10,2));',
    expected: 'Sum of sales in 30-day window',
    sample:
      'SELECT sale_date, amount, SUM(amount) OVER (ORDER BY sale_date RANGE BETWEEN INTERVAL 30 DAY PRECEDING AND CURRENT ROW) AS sum_30_days FROM sales;',
    hints: ['RANGE uses actual values not row count', 'Works with date intervals'],
    tags: ['window', 'range', 'frame', 'mysql-specific'],
  },
  {
    id: 'mysql-win-117',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'PERCENT_RANK',
    text: 'Calculate percentile rank of each score.',
    setup: 'SELECT from scores table',
    setupCode: 'CREATE TABLE scores (student_id INT, score INT);',
    expected: 'Percentile rank 0 to 1',
    sample:
      'SELECT student_id, score, PERCENT_RANK() OVER (ORDER BY score) AS percentile FROM scores;',
    hints: ['PERCENT_RANK returns 0 to 1', 'Formula: (rank-1)/(rows-1)'],
    tags: ['window', 'percent-rank', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-118',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'CUME_DIST',
    text: 'Calculate cumulative distribution of values.',
    setup: 'SELECT from measurements table',
    setupCode: 'CREATE TABLE measurements (id INT, value DECIMAL(10,2));',
    expected: 'Cumulative distribution 0 to 1',
    sample: 'SELECT id, value, CUME_DIST() OVER (ORDER BY value) AS cume_dist FROM measurements;',
    hints: ['CUME_DIST = rows with value <= current / total rows', 'Always > 0, max is 1'],
    tags: ['window', 'cume-dist', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-win-119',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Difference from Previous',
    text: 'Calculate the change from previous row value.',
    setup: 'SELECT from metrics table',
    setupCode: 'CREATE TABLE metrics (metric_date DATE, value DECIMAL(10,2));',
    expected: 'Difference from prior row',
    sample:
      'SELECT metric_date, value, value - LAG(value) OVER (ORDER BY metric_date) AS change FROM metrics;',
    hints: ['Subtract LAG from current value', 'First row will be NULL'],
    tags: ['window', 'lag', 'difference', 'mysql-specific'],
  },
  {
    id: 'mysql-win-120',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Percent Change',
    text: 'Calculate percentage change from previous period.',
    setup: 'SELECT from revenue table',
    setupCode: 'CREATE TABLE revenue (period_date DATE, amount DECIMAL(10,2));',
    expected: 'Percentage change',
    sample:
      'SELECT period_date, amount, (amount - LAG(amount) OVER (ORDER BY period_date)) / LAG(amount) OVER (ORDER BY period_date) * 100 AS pct_change FROM revenue;',
    hints: ['(current - previous) / previous * 100', 'Handle NULL for first row'],
    tags: ['window', 'percent-change', 'mysql-specific'],
  },
  {
    id: 'mysql-win-121',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Partition Running Total',
    text: 'Calculate running total within each category.',
    setup: 'SELECT from transactions table',
    setupCode:
      'CREATE TABLE transactions (category VARCHAR(50), trans_date DATE, amount DECIMAL(10,2));',
    expected: 'Running total per category',
    sample:
      'SELECT category, trans_date, amount, SUM(amount) OVER (PARTITION BY category ORDER BY trans_date) AS cat_running_total FROM transactions;',
    hints: ['PARTITION BY resets for each category', 'ORDER BY creates running sum'],
    tags: ['window', 'partition', 'running', 'mysql-specific'],
  },
  {
    id: 'mysql-win-122',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Count in Window',
    text: 'Count orders in a sliding 30-day window.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (order_date DATE, amount DECIMAL(10,2));',
    expected: 'Order count in window',
    sample:
      'SELECT order_date, COUNT(*) OVER (ORDER BY order_date RANGE BETWEEN INTERVAL 30 DAY PRECEDING AND CURRENT ROW) AS orders_30_days FROM orders;',
    hints: ['COUNT as window function', 'RANGE INTERVAL for date-based windows'],
    tags: ['window', 'count', 'range', 'mysql-specific'],
  },
  {
    id: 'mysql-win-123',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'MIN in Partition',
    text: 'Show the minimum salary in each department alongside each employee.',
    setup: 'SELECT from employees table',
    setupCode:
      'CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50), salary DECIMAL(10,2));',
    expected: 'Each row with dept min salary',
    sample:
      'SELECT name, department, salary, MIN(salary) OVER (PARTITION BY department) AS dept_min FROM employees;',
    hints: ['MIN as window function', 'No ORDER BY needed for full partition'],
    tags: ['window', 'min', 'partition', 'mysql-specific'],
  },
  {
    id: 'mysql-win-124',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'MAX in Partition',
    text: 'Show the maximum score alongside each student in the same class.',
    setup: 'SELECT from students table',
    setupCode: 'CREATE TABLE students (id INT, name VARCHAR(50), class VARCHAR(10), score INT);',
    expected: 'Each row with class max score',
    sample:
      'SELECT name, class, score, MAX(score) OVER (PARTITION BY class) AS class_max FROM students;',
    hints: ['MAX as window function', 'Compare individual to group max'],
    tags: ['window', 'max', 'partition', 'mysql-specific'],
  },
  {
    id: 'mysql-win-125',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Ratio to Total',
    text: 'Calculate each sales ratio to total using window functions.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, category VARCHAR(50), amount DECIMAL(10,2));',
    expected: 'Percentage of total',
    sample:
      'SELECT id, category, amount, amount / SUM(amount) OVER () * 100 AS pct_of_total FROM sales;',
    hints: ['Empty OVER() means entire result set', 'No partition = one group'],
    tags: ['window', 'ratio', 'percentage', 'mysql-specific'],
  },
  {
    id: 'mysql-win-126',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Ratio to Partition',
    text: 'Calculate each sales ratio within its category.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (id INT, category VARCHAR(50), amount DECIMAL(10,2));',
    expected: 'Percentage within category',
    sample:
      'SELECT id, category, amount, amount / SUM(amount) OVER (PARTITION BY category) * 100 AS pct_of_category FROM sales;',
    hints: ['SUM within partition gives category total', 'Divide individual by partition total'],
    tags: ['window', 'ratio', 'partition', 'mysql-specific'],
  },
  {
    id: 'mysql-win-127',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Named Window',
    text: 'Use a named window clause for multiple window functions.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (sale_date DATE, category VARCHAR(50), amount DECIMAL(10,2));',
    expected: 'Multiple calcs with same window',
    sample:
      'SELECT sale_date, category, amount, SUM(amount) OVER w AS running_sum, AVG(amount) OVER w AS running_avg FROM sales WINDOW w AS (PARTITION BY category ORDER BY sale_date);',
    hints: ['WINDOW clause defines named window', 'Reuse with OVER window_name'],
    tags: ['window', 'named', 'clause', 'mysql-specific'],
  },
  {
    id: 'mysql-win-128',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Top N per Group Filter',
    text: 'Get top 3 products by sales in each category using CTE.',
    setup: 'SELECT from products table',
    setupCode:
      'CREATE TABLE products (id INT, category VARCHAR(50), name VARCHAR(100), sales DECIMAL(10,2));',
    expected: 'Top 3 per category',
    sample:
      'WITH ranked AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales DESC) AS rn FROM products) SELECT * FROM ranked WHERE rn <= 3;',
    hints: ['ROW_NUMBER assigns rank within category', 'Filter in outer query or CTE'],
    tags: ['window', 'top-n', 'cte', 'mysql-specific'],
  },
  {
    id: 'mysql-win-129',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Row Count in Partition',
    text: 'Show total count of employees in each department alongside each row.',
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50));',
    expected: 'Each row with dept count',
    sample:
      'SELECT name, department, COUNT(*) OVER (PARTITION BY department) AS dept_size FROM employees;',
    hints: ['COUNT(*) as window function', 'Each row shows its partition count'],
    tags: ['window', 'count', 'partition', 'mysql-specific'],
  },
  {
    id: 'mysql-win-130',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Gap Detection',
    text: 'Detect gaps in sequential order numbers using window functions.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (order_num INT);',
    expected: 'Rows with gaps identified',
    sample:
      'SELECT order_num, order_num - LAG(order_num) OVER (ORDER BY order_num) AS gap FROM orders HAVING gap > 1;',
    hints: ['Compare current to previous', 'Gap > 1 indicates missing numbers'],
    tags: ['window', 'gap', 'detection', 'mysql-specific'],
  },
  {
    id: 'mysql-win-131',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Island Detection',
    text: 'Identify consecutive date groups (islands).',
    setup: 'SELECT from events table',
    setupCode: 'CREATE TABLE events (event_date DATE);',
    expected: 'Group consecutive dates',
    sample:
      'SELECT event_date, DATE_SUB(event_date, INTERVAL ROW_NUMBER() OVER (ORDER BY event_date) DAY) AS grp FROM events;',
    hints: ['Subtract row number from date', 'Consecutive dates get same group value'],
    tags: ['window', 'islands', 'gaps', 'mysql-specific'],
  },
  {
    id: 'mysql-win-132',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Dense Rank for Ties',
    text: 'Rank with no gaps when there are ties.',
    setup: 'SELECT from competitors table',
    setupCode: 'CREATE TABLE competitors (id INT, name VARCHAR(50), score INT);',
    expected: 'Dense ranking without gaps',
    sample:
      'SELECT name, score, DENSE_RANK() OVER (ORDER BY score DESC) AS position FROM competitors;',
    hints: ['DENSE_RANK: 1,1,2 not 1,1,3', 'Use when gaps are unwanted'],
    tags: ['window', 'dense-rank', 'ties', 'mysql-specific'],
  },
  {
    id: 'mysql-win-133',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Exponential Moving Average',
    text: 'Approximate exponential moving average using window functions.',
    setup: 'SELECT from prices table',
    setupCode: 'CREATE TABLE prices (price_date DATE, price DECIMAL(10,2));',
    expected: 'EMA approximation',
    sample:
      'SELECT price_date, price, AVG(price) OVER (ORDER BY price_date ROWS BETWEEN 4 PRECEDING AND CURRENT ROW) * 2 / (5 + 1) + LAG(price, 5, price) OVER (ORDER BY price_date) * (1 - 2 / (5 + 1)) AS ema_approx FROM prices;',
    hints: ['True EMA requires recursion', 'This is an approximation'],
    tags: ['window', 'ema', 'complex', 'mysql-specific'],
  },
  {
    id: 'mysql-win-134',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Count Distinct in Window',
    text: 'Workaround for COUNT DISTINCT in window (not directly supported).',
    setup: 'SELECT from visits table',
    setupCode: 'CREATE TABLE visits (visit_date DATE, user_id INT);',
    expected: 'Distinct count approximation',
    sample:
      'SELECT visit_date, SUM(is_first) OVER (ORDER BY visit_date) AS cumulative_users FROM (SELECT visit_date, user_id, CASE WHEN ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY visit_date) = 1 THEN 1 ELSE 0 END AS is_first FROM visits) t;',
    hints: ['Mark first occurrence of each user', 'Sum the marks for running distinct count'],
    tags: ['window', 'count-distinct', 'workaround', 'mysql-specific'],
  },
  {
    id: 'mysql-win-135',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Rows vs Range Frame',
    text: 'Understand difference between ROWS and RANGE frames.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (val INT);',
    expected: 'Different results for ROWS vs RANGE',
    sample:
      'SELECT val, SUM(val) OVER (ORDER BY val ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS rows_sum, SUM(val) OVER (ORDER BY val RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS range_sum FROM data;',
    hints: ['ROWS counts physical rows', 'RANGE uses value ranges'],
    tags: ['window', 'rows', 'range', 'frame', 'mysql-specific'],
  },
  {
    id: 'mysql-win-136',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'UNBOUNDED PRECEDING',
    text: 'Sum from partition start to current row.',
    setup: 'SELECT from transactions table',
    setupCode: 'CREATE TABLE transactions (id INT, amount DECIMAL(10,2));',
    expected: 'Running total from start',
    sample:
      'SELECT id, amount, SUM(amount) OVER (ORDER BY id ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cumulative FROM transactions;',
    hints: ['UNBOUNDED PRECEDING = from start', 'This is default for ORDER BY without frame'],
    tags: ['window', 'unbounded', 'frame', 'mysql-specific'],
  },
  {
    id: 'mysql-win-137',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'UNBOUNDED FOLLOWING',
    text: 'Sum from current row to partition end.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, val INT);',
    expected: 'Sum to end',
    sample:
      'SELECT id, val, SUM(val) OVER (ORDER BY id ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS remaining_sum FROM data;',
    hints: ['UNBOUNDED FOLLOWING = to end', 'Useful for remaining totals'],
    tags: ['window', 'unbounded', 'following', 'mysql-specific'],
  },
  {
    id: 'mysql-win-138',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Centered Moving Average',
    text: 'Calculate centered 5-period moving average.',
    setup: 'SELECT from prices table',
    setupCode: 'CREATE TABLE prices (period INT, price DECIMAL(10,2));',
    expected: 'Average of 2 before, current, 2 after',
    sample:
      'SELECT period, price, AVG(price) OVER (ORDER BY period ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS centered_avg FROM prices;',
    hints: ['2 PRECEDING AND 2 FOLLOWING = 5 rows', 'Centers the window on current row'],
    tags: ['window', 'moving-average', 'centered', 'mysql-specific'],
  },
  {
    id: 'mysql-win-139',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Session Assignment',
    text: 'Assign session IDs based on 30-minute gaps in activity.',
    setup: 'SELECT from activity table',
    setupCode: 'CREATE TABLE activity (user_id INT, event_time DATETIME);',
    expected: 'Session ID for each event',
    sample:
      'SELECT user_id, event_time, SUM(new_session) OVER (PARTITION BY user_id ORDER BY event_time) AS session_id FROM (SELECT *, CASE WHEN TIMESTAMPDIFF(MINUTE, LAG(event_time) OVER (PARTITION BY user_id ORDER BY event_time), event_time) > 30 OR LAG(event_time) OVER (PARTITION BY user_id ORDER BY event_time) IS NULL THEN 1 ELSE 0 END AS new_session FROM activity) t;',
    hints: ['Mark new session when gap > 30 min', 'Running sum of marks = session ID'],
    tags: ['window', 'session', 'gap', 'mysql-specific'],
  },
  {
    id: 'mysql-win-140',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Deduplication with ROW_NUMBER',
    text: 'Keep only the latest record per user.',
    setup: 'SELECT from user_data table',
    setupCode: 'CREATE TABLE user_data (user_id INT, data VARCHAR(100), created_at DATETIME);',
    expected: 'One row per user (latest)',
    sample:
      'SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY created_at DESC) AS rn FROM user_data) t WHERE rn = 1;',
    hints: ['ROW_NUMBER partitioned by user', 'Order by created_at DESC, take rn=1'],
    tags: ['window', 'dedupe', 'row-number', 'mysql-specific'],
  },
  {
    id: 'mysql-win-141',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Funnel Analysis',
    text: 'Calculate conversion funnel percentages.',
    setup: 'SELECT from events table',
    setupCode: 'CREATE TABLE events (user_id INT, event_type VARCHAR(50), event_time DATETIME);',
    expected: 'Conversion rates between steps',
    sample:
      "SELECT event_type, user_count, user_count * 100.0 / FIRST_VALUE(user_count) OVER (ORDER BY step_num) AS conversion_pct FROM (SELECT event_type, COUNT(DISTINCT user_id) AS user_count, CASE event_type WHEN 'view' THEN 1 WHEN 'cart' THEN 2 WHEN 'purchase' THEN 3 END AS step_num FROM events GROUP BY event_type) t;",
    hints: ['FIRST_VALUE gets top of funnel count', 'Divide each step by first step'],
    tags: ['window', 'funnel', 'analysis', 'mysql-specific'],
  },
  {
    id: 'mysql-win-142',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Difference from Average',
    text: 'Calculate how much each salary differs from department average.',
    setup: 'SELECT from employees table',
    setupCode:
      'CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50), salary DECIMAL(10,2));',
    expected: 'Salary vs dept average',
    sample:
      'SELECT name, department, salary, salary - AVG(salary) OVER (PARTITION BY department) AS diff_from_avg FROM employees;',
    hints: ['AVG in partition = dept average', 'Subtract from individual salary'],
    tags: ['window', 'avg', 'difference', 'mysql-specific'],
  },
  {
    id: 'mysql-win-143',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Z-Score Calculation',
    text: 'Calculate z-score (standard score) for each value.',
    setup: 'SELECT from measurements table',
    setupCode: 'CREATE TABLE measurements (id INT, value DECIMAL(10,4));',
    expected: 'Z-score for each measurement',
    sample:
      'SELECT id, value, (value - AVG(value) OVER ()) / STDDEV(value) OVER () AS z_score FROM measurements;',
    hints: ['Z-score = (value - mean) / stddev', 'Empty OVER() for overall stats'],
    tags: ['window', 'z-score', 'statistics', 'mysql-specific'],
  },
  {
    id: 'mysql-win-144',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Year over Year Growth',
    text: 'Calculate YoY growth using window functions.',
    setup: 'SELECT from annual_sales table',
    setupCode: 'CREATE TABLE annual_sales (year INT, sales DECIMAL(12,2));',
    expected: 'YoY percentage growth',
    sample:
      'SELECT year, sales, (sales - LAG(sales) OVER (ORDER BY year)) / LAG(sales) OVER (ORDER BY year) * 100 AS yoy_growth FROM annual_sales;',
    hints: ['LAG gets previous year sales', 'Calculate percentage difference'],
    tags: ['window', 'yoy', 'growth', 'mysql-specific'],
  },
  {
    id: 'mysql-win-145',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Multiple Rankings',
    text: 'Show ROW_NUMBER, RANK, and DENSE_RANK side by side.',
    setup: 'SELECT from scores table',
    setupCode: 'CREATE TABLE scores (id INT, score INT);',
    expected: 'All three ranking types',
    sample:
      'SELECT id, score, ROW_NUMBER() OVER w AS row_num, RANK() OVER w AS rank, DENSE_RANK() OVER w AS dense_rank FROM scores WINDOW w AS (ORDER BY score DESC);',
    hints: ['Named window for reuse', 'Compare different ranking behaviors'],
    tags: ['window', 'ranking', 'comparison', 'mysql-specific'],
  },
  {
    id: 'mysql-win-146',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Running Count',
    text: 'Calculate running count of events.',
    setup: 'SELECT from events table',
    setupCode: 'CREATE TABLE events (event_time DATETIME, event_type VARCHAR(50));',
    expected: 'Cumulative event count',
    sample:
      'SELECT event_time, event_type, COUNT(*) OVER (ORDER BY event_time) AS cumulative_count FROM events;',
    hints: ['COUNT(*) as window function', 'ORDER BY makes it cumulative'],
    tags: ['window', 'count', 'running', 'mysql-specific'],
  },
  {
    id: 'mysql-win-147',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Week over Week Comparison',
    text: 'Compare current week to previous week same day.',
    setup: 'SELECT from daily_metrics table',
    setupCode: 'CREATE TABLE daily_metrics (metric_date DATE, value DECIMAL(10,2));',
    expected: 'WoW comparison',
    sample:
      'SELECT metric_date, value, LAG(value, 7) OVER (ORDER BY metric_date) AS prev_week_value, value - LAG(value, 7) OVER (ORDER BY metric_date) AS wow_change FROM daily_metrics;',
    hints: ['LAG with offset 7 for same day last week', 'Assumes consecutive dates'],
    tags: ['window', 'wow', 'comparison', 'mysql-specific'],
  },
  {
    id: 'mysql-win-148',
    category: 'Window Functions',
    difficulty: 'medium',
    title: 'Partition Boundary Values',
    text: 'Show first and last value in each partition.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (region VARCHAR(50), sale_date DATE, amount DECIMAL(10,2));',
    expected: 'Each row with partition first/last',
    sample:
      'SELECT region, sale_date, amount, FIRST_VALUE(sale_date) OVER (PARTITION BY region ORDER BY sale_date) AS first_date, FIRST_VALUE(sale_date) OVER (PARTITION BY region ORDER BY sale_date DESC) AS last_date FROM sales;',
    hints: ['FIRST_VALUE with ASC for first', 'FIRST_VALUE with DESC for last'],
    tags: ['window', 'first-value', 'boundary', 'mysql-specific'],
  },
  {
    id: 'mysql-win-149',
    category: 'Window Functions',
    difficulty: 'hard',
    title: 'Conditional Running Sum',
    text: 'Running sum of only positive values.',
    setup: 'SELECT from transactions table',
    setupCode: 'CREATE TABLE transactions (id INT, amount DECIMAL(10,2));',
    expected: 'Running sum of positives only',
    sample:
      'SELECT id, amount, SUM(CASE WHEN amount > 0 THEN amount ELSE 0 END) OVER (ORDER BY id) AS running_positive_sum FROM transactions;',
    hints: ['CASE inside SUM window function', 'Filters values within the sum'],
    tags: ['window', 'conditional', 'sum', 'mysql-specific'],
  },

  // ============================================================
  // JSON FUNCTIONS (40 problems)
  // ============================================================
  {
    id: 'mysql-json-100',
    category: 'JSON Functions',
    difficulty: 'easy',
    title: 'JSON_VALID Check',
    text: 'Check if a string is valid JSON.',
    setup: 'SELECT statement',
    setupCode: '-- Check JSON validity',
    expected: '1 for valid, 0 for invalid',
    sample: 'SELECT JSON_VALID(\'{"name": "John"}\');',
    hints: ['JSON_VALID returns 1 or 0', 'Useful for validation before processing'],
    tags: ['json', 'valid', 'mysql-specific'],
  },
  {
    id: 'mysql-json-101',
    category: 'JSON Functions',
    difficulty: 'easy',
    title: 'JSON_TYPE',
    text: 'Determine the type of a JSON value.',
    setup: 'SELECT statement',
    setupCode: '-- Get JSON type',
    expected: 'OBJECT, ARRAY, STRING, etc.',
    sample: "SELECT JSON_TYPE('[1, 2, 3]');",
    hints: ['JSON_TYPE returns type name as string', 'Types: OBJECT, ARRAY, STRING, INTEGER, etc.'],
    tags: ['json', 'type', 'mysql-specific'],
  },
  {
    id: 'mysql-json-102',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_KEYS',
    text: 'Get all keys from a JSON object.',
    setup: 'SELECT from config table',
    setupCode:
      'CREATE TABLE config (id INT, settings JSON);\nINSERT INTO config VALUES (1, \'{"theme": "dark", "lang": "en", "notifications": true}\');',
    expected: '["theme", "lang", "notifications"]',
    sample: 'SELECT JSON_KEYS(settings) FROM config;',
    hints: ['JSON_KEYS returns array of keys', 'Only works on objects, not arrays'],
    tags: ['json', 'keys', 'mysql-specific'],
  },
  {
    id: 'mysql-json-103',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_SET',
    text: 'Add or update a value in JSON object.',
    setup: 'UPDATE config table',
    setupCode: 'CREATE TABLE config (id INT, settings JSON);',
    expected: 'Updated JSON with new/modified key',
    sample: "UPDATE config SET settings = JSON_SET(settings, '$.theme', 'light') WHERE id = 1;",
    hints: ['JSON_SET adds or replaces values', 'Creates path if it does not exist'],
    tags: ['json', 'set', 'update', 'mysql-specific'],
  },
  {
    id: 'mysql-json-104',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_INSERT',
    text: 'Insert a new key only if it does not exist.',
    setup: 'UPDATE users table',
    setupCode: 'CREATE TABLE users (id INT, profile JSON);',
    expected: 'Value inserted only if key missing',
    sample:
      "UPDATE users SET profile = JSON_INSERT(profile, '$.nickname', 'Anonymous') WHERE id = 1;",
    hints: ['JSON_INSERT only adds new keys', 'Does not replace existing values'],
    tags: ['json', 'insert', 'mysql-specific'],
  },
  {
    id: 'mysql-json-105',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_REPLACE',
    text: 'Replace a value only if the key exists.',
    setup: 'UPDATE settings table',
    setupCode: 'CREATE TABLE settings (id INT, data JSON);',
    expected: 'Value replaced only if key exists',
    sample:
      "UPDATE settings SET data = JSON_REPLACE(data, '$.email', 'new@example.com') WHERE id = 1;",
    hints: ['JSON_REPLACE only updates existing keys', 'Does not create new keys'],
    tags: ['json', 'replace', 'mysql-specific'],
  },
  {
    id: 'mysql-json-106',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_REMOVE',
    text: 'Remove a key from JSON object.',
    setup: 'UPDATE profiles table',
    setupCode: 'CREATE TABLE profiles (id INT, data JSON);',
    expected: 'JSON with key removed',
    sample: "UPDATE profiles SET data = JSON_REMOVE(data, '$.password') WHERE id = 1;",
    hints: ['JSON_REMOVE deletes specified path', 'Can remove multiple paths at once'],
    tags: ['json', 'remove', 'mysql-specific'],
  },
  {
    id: 'mysql-json-107',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_ARRAY_APPEND',
    text: 'Append a value to a JSON array.',
    setup: 'UPDATE items table',
    setupCode: 'CREATE TABLE items (id INT, tags JSON);',
    expected: 'Array with new element added',
    sample: "UPDATE items SET tags = JSON_ARRAY_APPEND(tags, '$', 'new-tag') WHERE id = 1;",
    hints: ['JSON_ARRAY_APPEND adds to end of array', 'Path $ refers to root array'],
    tags: ['json', 'array', 'append', 'mysql-specific'],
  },
  {
    id: 'mysql-json-108',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_ARRAY_INSERT',
    text: 'Insert a value at specific position in JSON array.',
    setup: 'UPDATE lists table',
    setupCode: 'CREATE TABLE lists (id INT, items JSON);',
    expected: 'Array with element at position',
    sample: "UPDATE lists SET items = JSON_ARRAY_INSERT(items, '$[1]', 'inserted') WHERE id = 1;",
    hints: ['JSON_ARRAY_INSERT adds at index', 'Existing elements shift right'],
    tags: ['json', 'array', 'insert', 'mysql-specific'],
  },
  {
    id: 'mysql-json-109',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_MERGE_PRESERVE',
    text: 'Merge two JSON objects preserving duplicates as arrays.',
    setup: 'SELECT statement',
    setupCode: '-- Merge two JSON objects',
    expected: 'Merged JSON',
    sample: 'SELECT JSON_MERGE_PRESERVE(\'{"a": 1}\', \'{"a": 2, "b": 3}\');',
    hints: ['JSON_MERGE_PRESERVE keeps all values', 'Duplicates become arrays'],
    tags: ['json', 'merge', 'preserve', 'mysql-specific'],
  },
  {
    id: 'mysql-json-110',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_MERGE_PATCH',
    text: 'Merge JSON with later values overwriting earlier.',
    setup: 'SELECT statement',
    setupCode: '-- Merge with overwrite',
    expected: 'Merged JSON with overwrites',
    sample: 'SELECT JSON_MERGE_PATCH(\'{"a": 1, "b": 2}\', \'{"a": 10, "c": 3}\');',
    hints: ['JSON_MERGE_PATCH overwrites duplicates', 'Second argument wins on conflicts'],
    tags: ['json', 'merge', 'patch', 'mysql-specific'],
  },
  {
    id: 'mysql-json-111',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_DEPTH',
    text: 'Find the maximum depth of a JSON document.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, doc JSON);',
    expected: 'Nesting depth as integer',
    sample: 'SELECT JSON_DEPTH(doc) FROM data;',
    hints: ['JSON_DEPTH returns nesting level', 'Empty doc = 1, scalar = 1'],
    tags: ['json', 'depth', 'mysql-specific'],
  },
  {
    id: 'mysql-json-112',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_TABLE',
    text: 'Convert JSON array to relational rows.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, items JSON);',
    expected: 'Rows from JSON array',
    sample:
      "SELECT o.id, jt.item_name, jt.quantity FROM orders o, JSON_TABLE(o.items, '$[*]' COLUMNS(item_name VARCHAR(100) PATH '$.name', quantity INT PATH '$.qty')) AS jt;",
    hints: ['JSON_TABLE converts JSON to rows', 'COLUMNS defines output structure'],
    tags: ['json', 'table', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-json-113',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_QUOTE',
    text: 'Quote a string as JSON string value.',
    setup: 'SELECT statement',
    setupCode: '-- Quote as JSON',
    expected: 'Quoted JSON string',
    sample: 'SELECT JSON_QUOTE(\'Hello "World"\');',
    hints: ['JSON_QUOTE adds quotes and escapes', 'Makes string valid JSON string'],
    tags: ['json', 'quote', 'mysql-specific'],
  },
  {
    id: 'mysql-json-114',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_UNQUOTE',
    text: 'Remove quotes from a JSON string value.',
    setup: 'SELECT statement',
    setupCode: '-- Unquote JSON string',
    expected: 'Plain string value',
    sample: 'SELECT JSON_UNQUOTE(\'"Hello World"\');',
    hints: ['JSON_UNQUOTE removes outer quotes', 'Same as ->> operator'],
    tags: ['json', 'unquote', 'mysql-specific'],
  },
  {
    id: 'mysql-json-115',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_CONTAINS_PATH',
    text: 'Check if a path exists in JSON document.',
    setup: 'SELECT from config table',
    setupCode: 'CREATE TABLE config (id INT, settings JSON);',
    expected: '1 if path exists, 0 otherwise',
    sample: "SELECT JSON_CONTAINS_PATH(settings, 'one', '$.theme', '$.lang') FROM config;",
    hints: ['one = any path exists', 'all = all paths must exist'],
    tags: ['json', 'contains-path', 'mysql-specific'],
  },
  {
    id: 'mysql-json-116',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_OVERLAPS',
    text: 'Check if two JSON documents have common elements.',
    setup: 'SELECT statement',
    setupCode: '-- Check for overlap',
    expected: '1 if overlap exists',
    sample: "SELECT JSON_OVERLAPS('[1, 2, 3]', '[3, 4, 5]');",
    hints: ['JSON_OVERLAPS checks for common values', 'MySQL 8.0.17+ feature'],
    tags: ['json', 'overlaps', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-json-117',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Member Of',
    text: 'Check if value is member of JSON array.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, categories JSON);',
    expected: '1 if member, 0 otherwise',
    sample: "SELECT id FROM products WHERE 'electronics' MEMBER OF(categories);",
    hints: ['MEMBER OF checks array membership', 'MySQL 8.0.17+ feature'],
    tags: ['json', 'member-of', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-json-118',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON_STORAGE_SIZE',
    text: 'Get the storage size of a JSON document in bytes.',
    setup: 'SELECT from documents table',
    setupCode: 'CREATE TABLE documents (id INT, content JSON);',
    expected: 'Size in bytes',
    sample: 'SELECT JSON_STORAGE_SIZE(content) FROM documents;',
    hints: ['Returns bytes used for storage', 'Includes internal overhead'],
    tags: ['json', 'storage', 'size', 'mysql-specific'],
  },
  {
    id: 'mysql-json-119',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON_PRETTY',
    text: 'Format JSON with indentation for readability.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, doc JSON);',
    expected: 'Formatted JSON with newlines and indentation',
    sample: 'SELECT JSON_PRETTY(doc) FROM data;',
    hints: ['JSON_PRETTY adds formatting', 'Good for debugging and display'],
    tags: ['json', 'pretty', 'format', 'mysql-specific'],
  },
  {
    id: 'mysql-json-120',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'Nested JSON Navigation',
    text: 'Extract deeply nested value from JSON.',
    setup: 'SELECT from users table',
    setupCode: 'CREATE TABLE users (id INT, data JSON);',
    expected: 'Deeply nested value',
    sample: "SELECT data->>'$.profile.address.city' FROM users;",
    hints: ['Chain path segments with dots', '->> extracts and unquotes'],
    tags: ['json', 'nested', 'path', 'mysql-specific'],
  },
  {
    id: 'mysql-json-121',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Wildcard Path',
    text: 'Extract all prices from nested items using wildcard.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, items JSON);',
    expected: 'Array of all prices',
    sample: "SELECT JSON_EXTRACT(items, '$[*].price') FROM orders;",
    hints: ['$[*] matches all array elements', 'Returns array of matched values'],
    tags: ['json', 'wildcard', 'path', 'mysql-specific'],
  },
  {
    id: 'mysql-json-122',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Double Wildcard',
    text: 'Extract all values matching a key anywhere in document.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, doc JSON);',
    expected: 'All matching values',
    sample: "SELECT JSON_EXTRACT(doc, '$**.name') FROM data;",
    hints: ['$** matches any path', 'Recursive wildcard search'],
    tags: ['json', 'wildcard', 'recursive', 'mysql-specific'],
  },
  {
    id: 'mysql-json-123',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'Create JSON from NULL',
    text: 'Handle NULL values when creating JSON objects.',
    setup: 'SELECT from users table',
    setupCode: 'CREATE TABLE users (id INT, name VARCHAR(50), email VARCHAR(100));',
    expected: 'JSON object handling NULLs',
    sample: "SELECT JSON_OBJECT('name', COALESCE(name, 'Unknown'), 'email', email) FROM users;",
    hints: ['NULL in JSON_OBJECT creates null value', 'Use COALESCE for defaults'],
    tags: ['json', 'null', 'object', 'mysql-specific'],
  },
  {
    id: 'mysql-json-124',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Index Usage',
    text: 'Create and use a generated column index for JSON.',
    setup: 'CREATE TABLE with JSON index',
    setupCode: '-- Create indexed JSON column',
    expected: 'Efficient JSON queries',
    sample:
      "CREATE TABLE products (id INT, data JSON, category VARCHAR(50) GENERATED ALWAYS AS (data->>'$.category') STORED, INDEX idx_category (category));",
    hints: ['Generated column extracts JSON value', 'STORED allows indexing'],
    tags: ['json', 'index', 'generated', 'mysql-specific'],
  },
  {
    id: 'mysql-json-125',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Schema Validation',
    text: 'Validate JSON against a schema using JSON_SCHEMA_VALID.',
    setup: 'SELECT statement',
    setupCode: '-- Validate JSON schema',
    expected: '1 if valid, 0 if not',
    sample:
      'SELECT JSON_SCHEMA_VALID(\'{"type": "object", "properties": {"name": {"type": "string"}}}\', \'{"name": "John"}\');',
    hints: ['JSON_SCHEMA_VALID validates against JSON Schema', 'MySQL 8.0.17+ feature'],
    tags: ['json', 'schema', 'validation', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-json-126',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON Compare',
    text: 'Compare two JSON values for equality.',
    setup: 'SELECT statement',
    setupCode: '-- Compare JSON',
    expected: '1 if equal, 0 if not',
    sample: "SELECT JSON_EXTRACT('{\"a\": 1}', '$') = JSON_EXTRACT('{\"a\": 1}', '$');",
    hints: ['JSON comparison uses = operator', 'Keys order does not matter in objects'],
    tags: ['json', 'compare', 'mysql-specific'],
  },
  {
    id: 'mysql-json-127',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON to Rows with Ordinality',
    text: 'Convert JSON array to rows with index using JSON_TABLE.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, arr JSON);',
    expected: 'Rows with index and value',
    sample:
      "SELECT d.id, jt.idx, jt.val FROM data d, JSON_TABLE(d.arr, '$[*]' COLUMNS(idx FOR ORDINALITY, val INT PATH '$')) AS jt;",
    hints: ['FOR ORDINALITY adds row number', 'Starts from 1'],
    tags: ['json', 'table', 'ordinality', 'mysql-specific'],
  },
  {
    id: 'mysql-json-128',
    category: 'JSON Functions',
    difficulty: 'hard',
    title: 'JSON Nested Path in TABLE',
    text: 'Handle nested arrays with JSON_TABLE.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, data JSON);',
    expected: 'Flattened nested data',
    sample:
      "SELECT o.id, items.name, items.qty FROM orders o, JSON_TABLE(o.data, '$.items[*]' COLUMNS(name VARCHAR(100) PATH '$.name', qty INT PATH '$.quantity')) AS items;",
    hints: ['Path can target nested arrays', 'COLUMNS extracts nested fields'],
    tags: ['json', 'table', 'nested', 'mysql-specific'],
  },
  {
    id: 'mysql-json-129',
    category: 'JSON Functions',
    difficulty: 'medium',
    title: 'JSON CAST',
    text: 'Cast a value to JSON type.',
    setup: 'SELECT statement',
    setupCode: '-- Cast to JSON',
    expected: 'JSON value',
    sample: "SELECT CAST('[1, 2, 3]' AS JSON);",
    hints: ['CAST converts string to JSON', 'Validates JSON syntax'],
    tags: ['json', 'cast', 'mysql-specific'],
  },

  // ============================================================
  // CONTROL FLOW (40 problems)
  // ============================================================
  {
    id: 'mysql-ctrl-100',
    category: 'Control Flow',
    difficulty: 'easy',
    title: 'Basic IF Function',
    text: "Return 'Yes' if value > 0, otherwise 'No'.",
    setup: 'SELECT from values table',
    setupCode:
      'CREATE TABLE values_tbl (id INT, value INT);\nINSERT INTO values_tbl VALUES (1, 5), (2, -3);',
    expected: 'Yes, No',
    sample: "SELECT IF(value > 0, 'Yes', 'No') FROM values_tbl;",
    hints: ['IF(condition, true_val, false_val)', 'Three-argument function'],
    tags: ['control-flow', 'if', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-101',
    category: 'Control Flow',
    difficulty: 'easy',
    title: 'IFNULL Default',
    text: 'Replace NULL with 0 for calculations.',
    setup: 'SELECT from scores table',
    setupCode:
      'CREATE TABLE scores (id INT, score INT);\nINSERT INTO scores VALUES (1, 85), (2, NULL);',
    expected: '85, 0',
    sample: 'SELECT IFNULL(score, 0) FROM scores;',
    hints: ['IFNULL(expr, default)', 'Returns default if expr is NULL'],
    tags: ['control-flow', 'ifnull', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-102',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'NULLIF Comparison',
    text: 'Return NULL if two values are equal.',
    setup: 'SELECT statement',
    setupCode: '-- Compare values',
    expected: 'NULL if equal, first value otherwise',
    sample: 'SELECT NULLIF(5, 5), NULLIF(5, 3);',
    hints: ['NULLIF(expr1, expr2)', 'Returns NULL if expr1 = expr2'],
    tags: ['control-flow', 'nullif', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-103',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'COALESCE Multiple',
    text: 'Get the first non-NULL value from multiple columns.',
    setup: 'SELECT from contacts table',
    setupCode:
      'CREATE TABLE contacts (id INT, phone1 VARCHAR(20), phone2 VARCHAR(20), phone3 VARCHAR(20));',
    expected: 'First available phone',
    sample: "SELECT COALESCE(phone1, phone2, phone3, 'No phone') AS phone FROM contacts;",
    hints: ['COALESCE returns first non-NULL', 'Can have any number of arguments'],
    tags: ['control-flow', 'coalesce', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-104',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'Simple CASE',
    text: 'Convert status code to status name using simple CASE.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, status INT);',
    expected: 'Status name',
    sample:
      "SELECT CASE status WHEN 1 THEN 'Pending' WHEN 2 THEN 'Processing' WHEN 3 THEN 'Shipped' ELSE 'Unknown' END FROM orders;",
    hints: ['CASE expr WHEN value THEN result', 'Compares expression to values'],
    tags: ['control-flow', 'case', 'simple', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-105',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'Searched CASE',
    text: 'Categorize prices into ranges using searched CASE.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, price DECIMAL(10,2));',
    expected: 'Price category',
    sample:
      "SELECT CASE WHEN price < 10 THEN 'Budget' WHEN price < 50 THEN 'Mid-range' WHEN price < 100 THEN 'Premium' ELSE 'Luxury' END AS category FROM products;",
    hints: ['CASE WHEN condition THEN result', 'Each WHEN has its own condition'],
    tags: ['control-flow', 'case', 'searched', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-106',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'Nested IF',
    text: 'Use nested IF for multiple conditions.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, value INT);',
    expected: 'Three-way classification',
    sample: "SELECT IF(value > 0, 'Positive', IF(value < 0, 'Negative', 'Zero')) FROM data;",
    hints: ['IF can be nested', 'CASE is often cleaner for multiple conditions'],
    tags: ['control-flow', 'if', 'nested', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-107',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'CASE in ORDER BY',
    text: 'Custom sort order using CASE in ORDER BY.',
    setup: 'SELECT from tasks table',
    setupCode: 'CREATE TABLE tasks (id INT, priority VARCHAR(20));',
    expected: 'Custom sorted results',
    sample:
      "SELECT * FROM tasks ORDER BY CASE priority WHEN 'Critical' THEN 1 WHEN 'High' THEN 2 WHEN 'Medium' THEN 3 WHEN 'Low' THEN 4 ELSE 5 END;",
    hints: ['CASE in ORDER BY for custom order', 'Assign numeric values for sorting'],
    tags: ['control-flow', 'case', 'order-by', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-108',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'CASE in UPDATE',
    text: 'Update multiple values conditionally using CASE.',
    setup: 'UPDATE products table',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(50), price DECIMAL(10,2));',
    expected: 'Conditional price updates',
    sample:
      "UPDATE products SET price = price * CASE category WHEN 'Electronics' THEN 1.10 WHEN 'Clothing' THEN 1.05 ELSE 1.02 END;",
    hints: ['CASE in SET clause', 'Apply different logic per category'],
    tags: ['control-flow', 'case', 'update', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-109',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'IF with Aggregate',
    text: 'Count only specific conditions using IF with SUM.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, status VARCHAR(20), amount DECIMAL(10,2));',
    expected: 'Conditional counts',
    sample:
      "SELECT SUM(IF(status = 'completed', 1, 0)) AS completed, SUM(IF(status = 'pending', 1, 0)) AS pending FROM orders;",
    hints: ['IF inside aggregate function', 'Creates conditional aggregates'],
    tags: ['control-flow', 'if', 'aggregate', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-110',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'CASE for Pivot',
    text: 'Create a pivot table using CASE expressions.',
    setup: 'SELECT from sales table',
    setupCode: 'CREATE TABLE sales (product VARCHAR(50), month INT, amount DECIMAL(10,2));',
    expected: 'Months as columns',
    sample:
      'SELECT product, SUM(CASE WHEN month = 1 THEN amount ELSE 0 END) AS jan, SUM(CASE WHEN month = 2 THEN amount ELSE 0 END) AS feb, SUM(CASE WHEN month = 3 THEN amount ELSE 0 END) AS mar FROM sales GROUP BY product;',
    hints: ['CASE inside SUM for each column', 'GROUP BY the row dimension'],
    tags: ['control-flow', 'case', 'pivot', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-111',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'GREATEST Function',
    text: 'Find the largest value among multiple columns.',
    setup: 'SELECT from scores table',
    setupCode: 'CREATE TABLE scores (id INT, score1 INT, score2 INT, score3 INT);',
    expected: 'Maximum of the three scores',
    sample: 'SELECT GREATEST(score1, score2, score3) AS best_score FROM scores;',
    hints: ['GREATEST returns max value', 'Works with any number of arguments'],
    tags: ['control-flow', 'greatest', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-112',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'LEAST Function',
    text: 'Find the smallest value among multiple columns.',
    setup: 'SELECT from prices table',
    setupCode:
      'CREATE TABLE prices (id INT, price1 DECIMAL(10,2), price2 DECIMAL(10,2), price3 DECIMAL(10,2));',
    expected: 'Minimum of the three prices',
    sample: 'SELECT LEAST(price1, price2, price3) AS lowest_price FROM prices;',
    hints: ['LEAST returns min value', 'Works with any number of arguments'],
    tags: ['control-flow', 'least', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-113',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'Safe Division with NULLIF',
    text: 'Divide without error when divisor is zero.',
    setup: 'SELECT from metrics table',
    setupCode: 'CREATE TABLE metrics (id INT, total DECIMAL(10,2), count INT);',
    expected: 'NULL instead of division error',
    sample: 'SELECT total / NULLIF(count, 0) AS average FROM metrics;',
    hints: ['NULLIF(count, 0) returns NULL if zero', 'Division by NULL returns NULL'],
    tags: ['control-flow', 'nullif', 'division', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-114',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'Boolean Expression',
    text: 'Convert boolean condition to 1 or 0.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, price DECIMAL(10,2), sale_price DECIMAL(10,2));',
    expected: '1 if on sale, 0 otherwise',
    sample: 'SELECT id, (sale_price < price) AS is_on_sale FROM products;',
    hints: ['Boolean expressions return 0 or 1', 'Direct comparison without IF'],
    tags: ['control-flow', 'boolean', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-115',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'Multiple CASE in SELECT',
    text: 'Use multiple CASE expressions in one query.',
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, salary DECIMAL(10,2), years INT);',
    expected: 'Multiple categorizations',
    sample:
      "SELECT id, CASE WHEN salary < 50000 THEN 'Low' WHEN salary < 80000 THEN 'Mid' ELSE 'High' END AS salary_band, CASE WHEN years < 2 THEN 'New' WHEN years < 5 THEN 'Regular' ELSE 'Senior' END AS experience FROM employees;",
    hints: ['Multiple CASE expressions allowed', 'Each is independent'],
    tags: ['control-flow', 'case', 'multiple', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-116',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'CASE with NULL',
    text: 'Handle NULL in CASE expression.',
    setup: 'SELECT from data table',
    setupCode: 'CREATE TABLE data (id INT, value INT);',
    expected: 'Properly handle NULL',
    sample:
      "SELECT CASE WHEN value IS NULL THEN 'Missing' WHEN value = 0 THEN 'Zero' ELSE CAST(value AS CHAR) END FROM data;",
    hints: ['Use IS NULL for NULL check', 'value = NULL does not work'],
    tags: ['control-flow', 'case', 'null', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-117',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'CASE in GROUP BY',
    text: 'Group by a CASE expression.',
    setup: 'SELECT from orders table',
    setupCode: 'CREATE TABLE orders (id INT, amount DECIMAL(10,2));',
    expected: 'Grouped by order size',
    sample:
      "SELECT CASE WHEN amount < 100 THEN 'Small' WHEN amount < 500 THEN 'Medium' ELSE 'Large' END AS order_size, COUNT(*) AS cnt FROM orders GROUP BY CASE WHEN amount < 100 THEN 'Small' WHEN amount < 500 THEN 'Medium' ELSE 'Large' END;",
    hints: ['CASE in both SELECT and GROUP BY', 'Or use column alias with derived table'],
    tags: ['control-flow', 'case', 'group-by', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-118',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'IF for Boolean Display',
    text: 'Convert 1/0 to Yes/No for display.',
    setup: 'SELECT from settings table',
    setupCode: 'CREATE TABLE settings (id INT, enabled TINYINT);',
    expected: 'Yes or No',
    sample: "SELECT id, IF(enabled, 'Yes', 'No') AS status FROM settings;",
    hints: ['Truthy values include non-zero', 'Falsy includes 0 and NULL'],
    tags: ['control-flow', 'if', 'boolean', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-119',
    category: 'Control Flow',
    difficulty: 'hard',
    title: 'Conditional JOIN Logic',
    text: 'Use CASE to determine join value.',
    setup: 'SELECT with conditional join',
    setupCode:
      'CREATE TABLE orders (id INT, customer_type VARCHAR(20), customer_id INT, guest_id INT);',
    expected: 'Join based on type',
    sample:
      "SELECT o.*, CASE o.customer_type WHEN 'member' THEN c.name WHEN 'guest' THEN g.name END AS customer_name FROM orders o LEFT JOIN customers c ON o.customer_id = c.id LEFT JOIN guests g ON o.guest_id = g.id;",
    hints: ['CASE selects which joined value to use', 'Both joins execute, CASE picks result'],
    tags: ['control-flow', 'case', 'join', 'mysql-specific'],
  },
  {
    id: 'mysql-ctrl-120',
    category: 'Control Flow',
    difficulty: 'medium',
    title: 'IFNULL with Expression',
    text: 'Use calculation as default value.',
    setup: 'SELECT from products table',
    setupCode: 'CREATE TABLE products (id INT, price DECIMAL(10,2), discount_price DECIMAL(10,2));',
    expected: 'Discount price or calculated default',
    sample: 'SELECT id, IFNULL(discount_price, price * 0.9) AS final_price FROM products;',
    hints: ['Second arg can be expression', 'Calculated only when needed'],
    tags: ['control-flow', 'ifnull', 'expression', 'mysql-specific'],
  },

  // ============================================================
  // JOINS (40 problems)
  // ============================================================
  {
    id: 'mysql-join-100',
    category: 'Joins',
    difficulty: 'easy',
    title: 'Basic INNER JOIN',
    text: 'Join orders with customers to get customer names.',
    setup: 'SELECT from orders and customers',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: 'Orders with customer names',
    sample:
      'SELECT o.id, c.name, o.amount FROM orders o INNER JOIN customers c ON o.customer_id = c.id;',
    hints: ['INNER JOIN returns matching rows only', 'ON specifies join condition'],
    tags: ['join', 'inner', 'mysql-specific'],
  },
  {
    id: 'mysql-join-101',
    category: 'Joins',
    difficulty: 'easy',
    title: 'LEFT JOIN',
    text: 'Get all customers and their orders, including those without orders.',
    setup: 'SELECT from customers and orders',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: 'All customers, NULLs for no orders',
    sample:
      'SELECT c.name, o.id, o.amount FROM customers c LEFT JOIN orders o ON c.id = o.customer_id;',
    hints: ['LEFT JOIN keeps all left table rows', 'NULLs for non-matching right side'],
    tags: ['join', 'left', 'mysql-specific'],
  },
  {
    id: 'mysql-join-102',
    category: 'Joins',
    difficulty: 'easy',
    title: 'RIGHT JOIN',
    text: 'Get all orders and their customers, including orphan orders.',
    setup: 'SELECT from customers and orders',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'All orders, NULLs for missing customers',
    sample: 'SELECT c.name, o.id FROM customers c RIGHT JOIN orders o ON c.id = o.customer_id;',
    hints: ['RIGHT JOIN keeps all right table rows', 'Less common than LEFT JOIN'],
    tags: ['join', 'right', 'mysql-specific'],
  },
  {
    id: 'mysql-join-103',
    category: 'Joins',
    difficulty: 'medium',
    title: 'CROSS JOIN',
    text: 'Create all combinations of sizes and colors.',
    setup: 'SELECT from sizes and colors',
    setupCode: 'CREATE TABLE sizes (size VARCHAR(10));\nCREATE TABLE colors (color VARCHAR(20));',
    expected: 'Cartesian product',
    sample: 'SELECT s.size, c.color FROM sizes s CROSS JOIN colors c;',
    hints: ['CROSS JOIN creates all combinations', 'No ON clause needed'],
    tags: ['join', 'cross', 'mysql-specific'],
  },
  {
    id: 'mysql-join-104',
    category: 'Joins',
    difficulty: 'medium',
    title: 'Self JOIN',
    text: 'Find employees and their managers.',
    setup: 'SELECT from employees table',
    setupCode: 'CREATE TABLE employees (id INT, name VARCHAR(50), manager_id INT);',
    expected: 'Employee with manager name',
    sample:
      'SELECT e.name AS employee, m.name AS manager FROM employees e LEFT JOIN employees m ON e.manager_id = m.id;',
    hints: ['Self join uses table twice with aliases', 'LEFT JOIN includes those without managers'],
    tags: ['join', 'self', 'mysql-specific'],
  },
  {
    id: 'mysql-join-105',
    category: 'Joins',
    difficulty: 'medium',
    title: 'Multiple Table JOIN',
    text: 'Join orders, customers, and products.',
    setup: 'SELECT from three tables',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE products (id INT, name VARCHAR(100));\nCREATE TABLE orders (id INT, customer_id INT, product_id INT);',
    expected: 'Order details with names',
    sample:
      'SELECT o.id, c.name AS customer, p.name AS product FROM orders o JOIN customers c ON o.customer_id = c.id JOIN products p ON o.product_id = p.id;',
    hints: ['Chain multiple JOINs', 'Each JOIN adds more data'],
    tags: ['join', 'multiple', 'mysql-specific'],
  },
  {
    id: 'mysql-join-106',
    category: 'Joins',
    difficulty: 'medium',
    title: 'JOIN with WHERE',
    text: 'Join and filter results.',
    setup: 'SELECT with JOIN and WHERE',
    setupCode:
      'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2), status VARCHAR(20));\nCREATE TABLE customers (id INT, name VARCHAR(50));',
    expected: 'Filtered join results',
    sample:
      "SELECT c.name, o.amount FROM orders o JOIN customers c ON o.customer_id = c.id WHERE o.status = 'completed' AND o.amount > 100;",
    hints: ['WHERE filters after JOIN', 'ON is for join condition'],
    tags: ['join', 'where', 'filter', 'mysql-specific'],
  },
  {
    id: 'mysql-join-107',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Anti-JOIN Pattern',
    text: 'Find customers with no orders.',
    setup: 'SELECT customers without orders',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'Customers with no orders',
    sample:
      'SELECT c.* FROM customers c LEFT JOIN orders o ON c.id = o.customer_id WHERE o.id IS NULL;',
    hints: ['LEFT JOIN + IS NULL = anti-join', 'Finds rows with no match'],
    tags: ['join', 'anti', 'pattern', 'mysql-specific'],
  },
  {
    id: 'mysql-join-108',
    category: 'Joins',
    difficulty: 'medium',
    title: 'USING Clause',
    text: 'Join tables with same column name using USING.',
    setup: 'SELECT with USING',
    setupCode:
      'CREATE TABLE orders (order_id INT, customer_id INT);\nCREATE TABLE customers (customer_id INT, name VARCHAR(50));',
    expected: 'Joined results',
    sample: 'SELECT o.order_id, c.name FROM orders o JOIN customers c USING (customer_id);',
    hints: ['USING when columns have same name', 'Shorter than ON a.col = b.col'],
    tags: ['join', 'using', 'mysql-specific'],
  },
  {
    id: 'mysql-join-109',
    category: 'Joins',
    difficulty: 'medium',
    title: 'NATURAL JOIN',
    text: 'Automatically join on common columns.',
    setup: 'SELECT with NATURAL JOIN',
    setupCode:
      'CREATE TABLE departments (dept_id INT, dept_name VARCHAR(50));\nCREATE TABLE employees (id INT, name VARCHAR(50), dept_id INT);',
    expected: 'Joined on dept_id',
    sample: 'SELECT * FROM employees NATURAL JOIN departments;',
    hints: ['NATURAL JOIN uses all common columns', 'Be careful with unintended matches'],
    tags: ['join', 'natural', 'mysql-specific'],
  },
  {
    id: 'mysql-join-110',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Composite Key JOIN',
    text: 'Join on multiple columns.',
    setup: 'SELECT with multi-column join',
    setupCode:
      'CREATE TABLE order_items (order_id INT, product_id INT, quantity INT);\nCREATE TABLE inventory (warehouse_id INT, product_id INT, stock INT);',
    expected: 'Matched on both columns',
    sample:
      'SELECT oi.*, i.stock FROM order_items oi JOIN inventory i ON oi.product_id = i.product_id AND i.warehouse_id = 1;',
    hints: ['Multiple conditions with AND', 'Can mix join and filter conditions'],
    tags: ['join', 'composite', 'mysql-specific'],
  },
  {
    id: 'mysql-join-111',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Non-Equi JOIN',
    text: 'Join where value falls in a range.',
    setup: 'SELECT with range condition',
    setupCode:
      'CREATE TABLE employees (id INT, salary DECIMAL(10,2));\nCREATE TABLE tax_brackets (min_salary DECIMAL(10,2), max_salary DECIMAL(10,2), rate DECIMAL(5,2));',
    expected: 'Employee with matching tax bracket',
    sample:
      'SELECT e.id, e.salary, t.rate FROM employees e JOIN tax_brackets t ON e.salary >= t.min_salary AND e.salary < t.max_salary;',
    hints: ['Non-equi join uses >, <, BETWEEN', 'Finds ranges that contain values'],
    tags: ['join', 'non-equi', 'range', 'mysql-specific'],
  },
  {
    id: 'mysql-join-112',
    category: 'Joins',
    difficulty: 'medium',
    title: 'LEFT JOIN with Aggregate',
    text: 'Get customers with their order counts.',
    setup: 'SELECT with LEFT JOIN and COUNT',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'Customer with order count (0 for no orders)',
    sample:
      'SELECT c.name, COUNT(o.id) AS order_count FROM customers c LEFT JOIN orders o ON c.id = o.customer_id GROUP BY c.id, c.name;',
    hints: ['COUNT(column) vs COUNT(*)', 'COUNT(o.id) returns 0 for NULLs'],
    tags: ['join', 'aggregate', 'count', 'mysql-specific'],
  },
  {
    id: 'mysql-join-113',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Hierarchical Self JOIN',
    text: 'Find all subordinates under a manager recursively.',
    setup: 'CTE with self join',
    setupCode: 'CREATE TABLE employees (id INT, name VARCHAR(50), manager_id INT);',
    expected: 'All levels of hierarchy',
    sample:
      'WITH RECURSIVE hierarchy AS (SELECT id, name, manager_id, 1 AS level FROM employees WHERE manager_id IS NULL UNION ALL SELECT e.id, e.name, e.manager_id, h.level + 1 FROM employees e JOIN hierarchy h ON e.manager_id = h.id) SELECT * FROM hierarchy;',
    hints: ['Recursive CTE for hierarchy', 'UNION ALL builds levels'],
    tags: ['join', 'self', 'recursive', 'mysql-specific'],
  },
  {
    id: 'mysql-join-114',
    category: 'Joins',
    difficulty: 'medium',
    title: 'Exclusive LEFT JOIN',
    text: 'Find customers that exist only in one table.',
    setup: 'SELECT exclusive records',
    setupCode:
      'CREATE TABLE old_customers (id INT, name VARCHAR(50));\nCREATE TABLE new_customers (id INT, name VARCHAR(50));',
    expected: 'Customers only in old table',
    sample:
      'SELECT o.* FROM old_customers o LEFT JOIN new_customers n ON o.id = n.id WHERE n.id IS NULL;',
    hints: ['Anti-join pattern', 'NULL check finds non-matches'],
    tags: ['join', 'exclusive', 'anti', 'mysql-specific'],
  },
  {
    id: 'mysql-join-115',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Full Outer JOIN Simulation',
    text: 'Simulate FULL OUTER JOIN in MySQL.',
    setup: 'SELECT all from both tables',
    setupCode:
      'CREATE TABLE table_a (id INT, value VARCHAR(50));\nCREATE TABLE table_b (id INT, value VARCHAR(50));',
    expected: 'All rows from both tables',
    sample:
      'SELECT a.id AS a_id, a.value AS a_val, b.id AS b_id, b.value AS b_val FROM table_a a LEFT JOIN table_b b ON a.id = b.id UNION SELECT a.id, a.value, b.id, b.value FROM table_a a RIGHT JOIN table_b b ON a.id = b.id;',
    hints: ['MySQL lacks FULL OUTER JOIN', 'Combine LEFT and RIGHT with UNION'],
    tags: ['join', 'full-outer', 'simulation', 'mysql-specific'],
  },
  {
    id: 'mysql-join-116',
    category: 'Joins',
    difficulty: 'medium',
    title: 'JOIN with Subquery',
    text: 'Join with a derived table.',
    setup: 'SELECT with subquery join',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: 'Join with aggregated data',
    sample:
      'SELECT o.*, t.total FROM orders o JOIN (SELECT customer_id, SUM(amount) AS total FROM orders GROUP BY customer_id) t ON o.customer_id = t.customer_id;',
    hints: ['Subquery in FROM creates derived table', 'Must have alias'],
    tags: ['join', 'subquery', 'derived', 'mysql-specific'],
  },
  {
    id: 'mysql-join-117',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Lateral JOIN',
    text: 'Use LATERAL for correlated subquery in FROM.',
    setup: 'SELECT with LATERAL',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT, order_date DATE);',
    expected: 'Latest 3 orders per customer',
    sample:
      'SELECT c.name, o.order_date FROM customers c, LATERAL (SELECT order_date FROM orders WHERE customer_id = c.id ORDER BY order_date DESC LIMIT 3) o;',
    hints: ['LATERAL allows subquery to reference outer table', 'MySQL 8.0.14+ feature'],
    tags: ['join', 'lateral', 'mysql-8', 'mysql-specific'],
  },
  {
    id: 'mysql-join-118',
    category: 'Joins',
    difficulty: 'medium',
    title: 'Multiple INNER JOINs',
    text: 'Chain multiple INNER JOINs.',
    setup: 'SELECT from four tables',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, product_id INT, shipping_id INT);',
    expected: 'Complete order details',
    sample:
      'SELECT o.id, c.name, p.name, s.address FROM orders o INNER JOIN customers c ON o.customer_id = c.id INNER JOIN products p ON o.product_id = p.id INNER JOIN shipping s ON o.shipping_id = s.id;',
    hints: ['Each JOIN adds one more table', 'Order matters for readability'],
    tags: ['join', 'multiple', 'inner', 'mysql-specific'],
  },
  {
    id: 'mysql-join-119',
    category: 'Joins',
    difficulty: 'hard',
    title: 'Self JOIN for Consecutive',
    text: 'Find consecutive rows in data.',
    setup: 'SELECT consecutive days',
    setupCode: 'CREATE TABLE logs (log_date DATE, value INT);',
    expected: 'Pairs of consecutive dates',
    sample:
      'SELECT l1.log_date, l1.value, l2.log_date AS next_date, l2.value AS next_value FROM logs l1 JOIN logs l2 ON l2.log_date = DATE_ADD(l1.log_date, INTERVAL 1 DAY);',
    hints: ['Self join with date arithmetic', 'Finds rows with specific relationship'],
    tags: ['join', 'self', 'consecutive', 'mysql-specific'],
  },
  {
    id: 'mysql-join-120',
    category: 'Joins',
    difficulty: 'medium',
    title: 'JOIN with OR Condition',
    text: 'Join on multiple possible matches.',
    setup: 'SELECT with OR in join',
    setupCode:
      'CREATE TABLE contacts (id INT, email VARCHAR(100), phone VARCHAR(20));\nCREATE TABLE users (id INT, email VARCHAR(100), phone VARCHAR(20));',
    expected: 'Match on email OR phone',
    sample:
      'SELECT c.id, u.id FROM contacts c JOIN users u ON c.email = u.email OR c.phone = u.phone;',
    hints: [
      'OR in ON clause for multiple match conditions',
      'May produce more matches than expected',
    ],
    tags: ['join', 'or', 'multiple', 'mysql-specific'],
  },

  // ============================================================
  // SUBQUERIES (40 problems)
  // ============================================================
  {
    id: 'mysql-sub-100',
    category: 'Subqueries',
    difficulty: 'easy',
    title: 'Scalar Subquery in SELECT',
    text: 'Get order with total order count.',
    setup: 'SELECT with scalar subquery',
    setupCode: 'CREATE TABLE orders (id INT, amount DECIMAL(10,2));',
    expected: 'Each row with total count',
    sample: 'SELECT id, amount, (SELECT COUNT(*) FROM orders) AS total_orders FROM orders;',
    hints: ['Scalar subquery returns single value', 'Executes for each row'],
    tags: ['subquery', 'scalar', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-101',
    category: 'Subqueries',
    difficulty: 'easy',
    title: 'Subquery in WHERE',
    text: 'Find products more expensive than average.',
    setup: 'SELECT with WHERE subquery',
    setupCode: 'CREATE TABLE products (id INT, name VARCHAR(100), price DECIMAL(10,2));',
    expected: 'Products above average price',
    sample: 'SELECT * FROM products WHERE price > (SELECT AVG(price) FROM products);',
    hints: ['Subquery calculates average', 'Outer query filters by it'],
    tags: ['subquery', 'where', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-102',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'IN Subquery',
    text: 'Find customers who have placed orders.',
    setup: 'SELECT with IN subquery',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'Customers with orders',
    sample: 'SELECT * FROM customers WHERE id IN (SELECT DISTINCT customer_id FROM orders);',
    hints: ['IN checks if value is in subquery result', 'Subquery returns list of values'],
    tags: ['subquery', 'in', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-103',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'NOT IN Subquery',
    text: 'Find products never ordered.',
    setup: 'SELECT with NOT IN',
    setupCode:
      'CREATE TABLE products (id INT, name VARCHAR(100));\nCREATE TABLE order_items (product_id INT);',
    expected: 'Products not in any order',
    sample:
      'SELECT * FROM products WHERE id NOT IN (SELECT DISTINCT product_id FROM order_items WHERE product_id IS NOT NULL);',
    hints: ['NOT IN excludes matching values', 'Handle NULLs in subquery carefully'],
    tags: ['subquery', 'not-in', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-104',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'EXISTS Subquery',
    text: 'Find customers with at least one order.',
    setup: 'SELECT with EXISTS',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'Customers having orders',
    sample:
      'SELECT * FROM customers c WHERE EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);',
    hints: ['EXISTS checks if subquery returns any rows', 'Often more efficient than IN'],
    tags: ['subquery', 'exists', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-105',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'NOT EXISTS Subquery',
    text: 'Find customers without orders.',
    setup: 'SELECT with NOT EXISTS',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'Customers without orders',
    sample:
      'SELECT * FROM customers c WHERE NOT EXISTS (SELECT 1 FROM orders o WHERE o.customer_id = c.id);',
    hints: ['NOT EXISTS = no matching rows', 'Safer than NOT IN with NULLs'],
    tags: ['subquery', 'not-exists', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-106',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'Correlated Subquery',
    text: 'Get employees earning more than their department average.',
    setup: 'SELECT with correlated subquery',
    setupCode:
      'CREATE TABLE employees (id INT, name VARCHAR(50), department VARCHAR(50), salary DECIMAL(10,2));',
    expected: 'Above-average earners per dept',
    sample:
      'SELECT * FROM employees e WHERE salary > (SELECT AVG(salary) FROM employees WHERE department = e.department);',
    hints: ['Correlated subquery references outer query', 'Executes once per outer row'],
    tags: ['subquery', 'correlated', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-107',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'Derived Table',
    text: 'Use subquery in FROM clause.',
    setup: 'SELECT from derived table',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: 'Query from aggregated data',
    sample:
      'SELECT customer_id, total FROM (SELECT customer_id, SUM(amount) AS total FROM orders GROUP BY customer_id) AS customer_totals WHERE total > 1000;',
    hints: ['Subquery in FROM = derived table', 'Must have alias'],
    tags: ['subquery', 'derived', 'from', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-108',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'ALL Comparison',
    text: 'Find products more expensive than all products in category B.',
    setup: 'SELECT with ALL',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(20), price DECIMAL(10,2));',
    expected: 'Products > all in category B',
    sample:
      "SELECT * FROM products WHERE price > ALL (SELECT price FROM products WHERE category = 'B');",
    hints: ['ALL = greater than all values in set', 'Empty set returns TRUE'],
    tags: ['subquery', 'all', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-109',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'ANY/SOME Comparison',
    text: 'Find products more expensive than any product in category B.',
    setup: 'SELECT with ANY',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(20), price DECIMAL(10,2));',
    expected: 'Products > at least one in category B',
    sample:
      "SELECT * FROM products WHERE price > ANY (SELECT price FROM products WHERE category = 'B');",
    hints: ['ANY = greater than at least one', 'SOME is synonym for ANY'],
    tags: ['subquery', 'any', 'some', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-110',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'Multiple Column Subquery',
    text: 'Match on multiple columns using subquery.',
    setup: 'SELECT with row comparison',
    setupCode: 'CREATE TABLE inventory (product_id INT, warehouse_id INT, quantity INT);',
    expected: 'Rows matching multiple conditions',
    sample:
      'SELECT * FROM inventory WHERE (product_id, warehouse_id) IN (SELECT product_id, warehouse_id FROM low_stock);',
    hints: ['Row constructor compares tuples', 'Must match same number of columns'],
    tags: ['subquery', 'multi-column', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-111',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'Subquery with MAX',
    text: 'Find the order with maximum amount.',
    setup: 'SELECT with MAX subquery',
    setupCode: 'CREATE TABLE orders (id INT, amount DECIMAL(10,2));',
    expected: 'Order with highest amount',
    sample: 'SELECT * FROM orders WHERE amount = (SELECT MAX(amount) FROM orders);',
    hints: ['Subquery finds max value', 'Outer query matches it'],
    tags: ['subquery', 'max', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-112',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'Subquery in SELECT with Correlation',
    text: 'Get each order with customer total spend.',
    setup: 'SELECT with correlated scalar subquery',
    setupCode: 'CREATE TABLE orders (id INT, customer_id INT, amount DECIMAL(10,2));',
    expected: 'Order with customer total',
    sample:
      'SELECT id, customer_id, amount, (SELECT SUM(amount) FROM orders o2 WHERE o2.customer_id = o1.customer_id) AS customer_total FROM orders o1;',
    hints: ['Correlated subquery in SELECT', 'Calculates per-row aggregate'],
    tags: ['subquery', 'correlated', 'scalar', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-113',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'Subquery with HAVING',
    text: 'Find departments with above-average employee count.',
    setup: 'SELECT with HAVING subquery',
    setupCode: 'CREATE TABLE employees (id INT, department VARCHAR(50));',
    expected: 'Larger departments',
    sample:
      'SELECT department, COUNT(*) AS emp_count FROM employees GROUP BY department HAVING COUNT(*) > (SELECT AVG(cnt) FROM (SELECT COUNT(*) AS cnt FROM employees GROUP BY department) t);',
    hints: ['Subquery in HAVING', 'Nested subquery for average of counts'],
    tags: ['subquery', 'having', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-114',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'UPDATE with Subquery',
    text: 'Update prices based on another table.',
    setup: 'UPDATE with subquery',
    setupCode:
      'CREATE TABLE products (id INT, price DECIMAL(10,2));\nCREATE TABLE price_updates (product_id INT, new_price DECIMAL(10,2));',
    expected: 'Updated prices',
    sample:
      'UPDATE products p SET price = (SELECT new_price FROM price_updates pu WHERE pu.product_id = p.id) WHERE id IN (SELECT product_id FROM price_updates);',
    hints: ['Subquery in SET clause', 'WHERE limits which rows update'],
    tags: ['subquery', 'update', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-115',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'DELETE with Subquery',
    text: 'Delete products with no orders.',
    setup: 'DELETE with subquery',
    setupCode:
      'CREATE TABLE products (id INT, name VARCHAR(100));\nCREATE TABLE order_items (product_id INT);',
    expected: 'Orphan products deleted',
    sample:
      'DELETE FROM products WHERE id NOT IN (SELECT DISTINCT product_id FROM order_items WHERE product_id IS NOT NULL);',
    hints: ['Subquery identifies rows to keep', 'NOT IN finds rows to delete'],
    tags: ['subquery', 'delete', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-116',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'INSERT with Subquery',
    text: 'Insert summary data from another table.',
    setup: 'INSERT SELECT statement',
    setupCode:
      'CREATE TABLE daily_summary (summary_date DATE, total DECIMAL(12,2));\nCREATE TABLE orders (order_date DATE, amount DECIMAL(10,2));',
    expected: 'Summary rows inserted',
    sample:
      'INSERT INTO daily_summary (summary_date, total) SELECT order_date, SUM(amount) FROM orders WHERE order_date = CURDATE() GROUP BY order_date;',
    hints: ['INSERT ... SELECT copies data', 'Can include aggregation'],
    tags: ['subquery', 'insert', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-117',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'Nested Subqueries',
    text: 'Three-level nested subquery.',
    setup: 'SELECT with deep nesting',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(50), price DECIMAL(10,2));',
    expected: 'Complex filter result',
    sample:
      'SELECT * FROM products WHERE category IN (SELECT category FROM products WHERE price > (SELECT AVG(price) FROM products));',
    hints: ['Subqueries can be nested', 'Evaluate from innermost out'],
    tags: ['subquery', 'nested', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-118',
    category: 'Subqueries',
    difficulty: 'medium',
    title: 'Subquery vs JOIN',
    text: 'Rewrite subquery as JOIN for performance.',
    setup: 'Equivalent queries',
    setupCode:
      'CREATE TABLE customers (id INT, name VARCHAR(50));\nCREATE TABLE orders (id INT, customer_id INT);',
    expected: 'Same result, different approach',
    sample:
      '-- Subquery version:\nSELECT * FROM customers WHERE id IN (SELECT customer_id FROM orders);\n-- JOIN version (often faster):\nSELECT DISTINCT c.* FROM customers c JOIN orders o ON c.id = o.customer_id;',
    hints: ['JOINs often outperform subqueries', 'Check execution plans'],
    tags: ['subquery', 'join', 'performance', 'mysql-specific'],
  },
  {
    id: 'mysql-sub-119',
    category: 'Subqueries',
    difficulty: 'hard',
    title: 'Top-N per Group Subquery',
    text: 'Get top 3 products per category.',
    setup: 'SELECT top N per group',
    setupCode: 'CREATE TABLE products (id INT, category VARCHAR(50), sales INT);',
    expected: 'Top 3 in each category',
    sample:
      'SELECT * FROM products p WHERE (SELECT COUNT(*) FROM products p2 WHERE p2.category = p.category AND p2.sales > p.sales) < 3;',
    hints: ['Correlated subquery counts higher values', '< 3 means 0, 1, or 2 are higher'],
    tags: ['subquery', 'top-n', 'correlated', 'mysql-specific'],
  },
];
