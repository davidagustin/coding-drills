import type { Problem } from '../types';

/**
 * PHP Problems for Coding Drills
 * Covers modern PHP 8.2+ features, Laravel patterns, and best practices
 */

export const phpProblems: Problem[] = [
  // ============================================================
  // ARRAY FUNCTIONS - Transformation (15 problems)
  // ============================================================
  {
    id: 'php-array-001',
    category: 'array',
    difficulty: 'easy',
    title: 'Double Each Number',
    text: 'Double each number in the array using array_map with an arrow function',
    setup: '$nums = [1, 2, 3, 4, 5];',
    setupCode: '$nums = [1, 2, 3, 4, 5];',
    expected: [2, 4, 6, 8, 10],
    sample: 'array_map(fn($n) => $n * 2, $nums)',
    hints: ['Use array_map with an arrow function (fn)'],
    validPatterns: [
      /array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\*\s*2\s*,\s*\$nums\s*\)/,
      /array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*2\s*\*\s*\$\w+\s*,\s*\$nums\s*\)/,
    ],
    tags: ['array_map', 'arrow-function', 'basic'],
  },
  {
    id: 'php-array-002',
    category: 'array',
    difficulty: 'easy',
    title: 'Square Each Number',
    text: 'Square each number in the array',
    setup: '$nums = [1, 2, 3, 4, 5];',
    setupCode: '$nums = [1, 2, 3, 4, 5];',
    expected: [1, 4, 9, 16, 25],
    sample: 'array_map(fn($n) => $n ** 2, $nums)',
    hints: ['Use ** for exponentiation in PHP'],
    validPatterns: [
      /array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\*\*\s*2\s*,\s*\$nums\s*\)/,
      /array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*pow\s*\(\s*\$\w+\s*,\s*2\s*\)\s*,\s*\$nums\s*\)/,
    ],
    tags: ['array_map', 'math'],
  },
  {
    id: 'php-array-003',
    category: 'array',
    difficulty: 'easy',
    title: 'Filter Even Numbers',
    text: 'Filter the array to only include even numbers',
    setup: '$nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];',
    setupCode: '$nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];',
    expected: [2, 4, 6, 8, 10],
    sample: 'array_values(array_filter($nums, fn($n) => $n % 2 === 0))',
    hints: ['Use array_filter with a callback', 'Use array_values to reindex the result'],
    validPatterns: [
      /array_values\s*\(\s*array_filter\s*\(\s*\$nums\s*,\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*%\s*2\s*===?\s*0\s*\)\s*\)/,
    ],
    tags: ['array_filter', 'array_values'],
  },
  {
    id: 'php-array-004',
    category: 'array',
    difficulty: 'easy',
    title: 'Filter Numbers Greater Than 5',
    text: 'Filter the array to only include numbers greater than 5',
    setup: '$nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];',
    setupCode: '$nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];',
    expected: [6, 7, 8, 9, 10],
    sample: 'array_values(array_filter($nums, fn($n) => $n > 5))',
    hints: ['Use array_filter with a comparison'],
    validPatterns: [
      /array_values\s*\(\s*array_filter\s*\(\s*\$nums\s*,\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*>\s*5\s*\)\s*\)/,
    ],
    tags: ['array_filter'],
  },
  {
    id: 'php-array-005',
    category: 'array',
    difficulty: 'easy',
    title: 'Convert to Uppercase',
    text: 'Convert each string in the array to uppercase using first-class callable syntax',
    setup: '$words = ["hello", "world", "php"];',
    setupCode: '$words = ["hello", "world", "php"];',
    expected: ['HELLO', 'WORLD', 'PHP'],
    sample: 'array_map(strtoupper(...), $words)',
    hints: ['Use strtoupper(...) first-class callable syntax (PHP 8.1+)'],
    validPatterns: [
      /array_map\s*\(\s*strtoupper\s*\(\s*\.\.\.\s*\)\s*,\s*\$words\s*\)/,
      /array_map\s*\(\s*'strtoupper'\s*,\s*\$words\s*\)/,
      /array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*strtoupper\s*\(\s*\$\w+\s*\)\s*,\s*\$words\s*\)/,
    ],
    tags: ['array_map', 'first-class-callable'],
  },
  {
    id: 'php-array-006',
    category: 'array',
    difficulty: 'medium',
    title: 'Sum with Reduce',
    text: 'Calculate the sum of all numbers using array_reduce',
    setup: '$nums = [1, 2, 3, 4, 5];',
    setupCode: '$nums = [1, 2, 3, 4, 5];',
    expected: 15,
    sample: 'array_reduce($nums, fn($sum, $n) => $sum + $n, 0)',
    hints: ['Use array_reduce with an initial value of 0', 'Or simply use array_sum'],
    validPatterns: [
      /array_reduce\s*\(\s*\$nums\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\+\s*\$\w+\s*,\s*0\s*\)/,
      /array_sum\s*\(\s*\$nums\s*\)/,
    ],
    tags: ['array_reduce', 'array_sum'],
  },
  {
    id: 'php-array-007',
    category: 'array',
    difficulty: 'medium',
    title: 'Flatten Nested Arrays',
    text: 'Flatten a nested array using array_reduce and the spread operator',
    setup: '$nested = [[1, 2], [3, 4], [5, 6]];',
    setupCode: '$nested = [[1, 2], [3, 4], [5, 6]];',
    expected: [1, 2, 3, 4, 5, 6],
    sample: 'array_reduce($nested, fn($a, $b) => [...$a, ...$b], [])',
    hints: ['Use array_reduce with spread operator', 'Or use array_merge with the splat operator'],
    validPatterns: [
      /array_reduce\s*\(\s*\$nested\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\[\s*\.\.\.\$\w+\s*,\s*\.\.\.\$\w+\s*\]\s*,\s*\[\s*\]\s*\)/,
      /array_merge\s*\(\s*\.\.\.\$nested\s*\)/,
    ],
    tags: ['array_reduce', 'spread-operator'],
  },
  {
    id: 'php-array-008',
    category: 'array',
    difficulty: 'easy',
    title: 'Merge Arrays with Spread',
    text: 'Merge two arrays using the spread operator',
    setup: '$arr1 = [1, 2, 3]; $arr2 = [4, 5, 6];',
    setupCode: '$arr1 = [1, 2, 3]; $arr2 = [4, 5, 6];',
    expected: [1, 2, 3, 4, 5, 6],
    sample: '[...$arr1, ...$arr2]',
    hints: ['Use the spread operator inside array literals'],
    validPatterns: [
      /\[\s*\.\.\.\$arr1\s*,\s*\.\.\.\$arr2\s*\]/,
      /array_merge\s*\(\s*\$arr1\s*,\s*\$arr2\s*\)/,
    ],
    tags: ['spread-operator', 'array_merge'],
  },
  {
    id: 'php-array-009',
    category: 'array',
    difficulty: 'easy',
    title: 'Get Unique Values',
    text: 'Get unique values from the array and reset keys',
    setup: '$nums = [1, 2, 2, 3, 3, 3, 4];',
    setupCode: '$nums = [1, 2, 2, 3, 3, 3, 4];',
    expected: [1, 2, 3, 4],
    sample: 'array_values(array_unique($nums))',
    hints: ['Use array_unique then array_values to reset keys'],
    validPatterns: [/array_values\s*\(\s*array_unique\s*\(\s*\$nums\s*\)\s*\)/],
    tags: ['array_unique', 'array_values'],
  },
  {
    id: 'php-array-010',
    category: 'array',
    difficulty: 'medium',
    title: 'Extract Column from Array of Arrays',
    text: 'Extract the "name" values from an array of associative arrays',
    setup:
      '$users = [["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"], ["id" => 3, "name" => "Charlie"]];',
    setupCode:
      '$users = [["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"], ["id" => 3, "name" => "Charlie"]];',
    expected: ['Alice', 'Bob', 'Charlie'],
    sample: 'array_column($users, "name")',
    hints: ['Use array_column to extract values by key'],
    validPatterns: [/array_column\s*\(\s*\$users\s*,\s*['"]name['"]\s*\)/],
    tags: ['array_column'],
  },
  {
    id: 'php-array-011',
    category: 'array',
    difficulty: 'medium',
    title: 'Index Array by Key',
    text: 'Index the users array by their id',
    setup: '$users = [["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"]];',
    setupCode: '$users = [["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"]];',
    expected: { 1: { id: 1, name: 'Alice' }, 2: { id: 2, name: 'Bob' } },
    sample: 'array_column($users, null, "id")',
    hints: ['Use array_column with null as second parameter to keep full rows'],
    validPatterns: [/array_column\s*\(\s*\$users\s*,\s*null\s*,\s*['"]id['"]\s*\)/],
    tags: ['array_column'],
  },
  {
    id: 'php-array-012',
    category: 'array',
    difficulty: 'medium',
    title: 'Sort with Custom Comparison',
    text: 'Sort the array in descending order using usort with spaceship operator',
    setup: '$nums = [3, 1, 4, 1, 5, 9, 2, 6];',
    setupCode: '$nums = [3, 1, 4, 1, 5, 9, 2, 6];',
    expected: [9, 6, 5, 4, 3, 2, 1, 1],
    sample: 'usort($nums, fn($a, $b) => $b <=> $a); $nums',
    hints: ['Use usort with spaceship operator', 'Swap $a and $b for descending order'],
    validPatterns: [
      /usort\s*\(\s*\$nums\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\$\w+\s*<=>\s*\$\w+\s*\)/,
    ],
    tags: ['usort', 'spaceship-operator'],
  },
  {
    id: 'php-array-013',
    category: 'array',
    difficulty: 'easy',
    title: 'Slice Array',
    text: 'Extract elements from index 2 to 5 (3 elements)',
    setup: '$nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];',
    setupCode: '$nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];',
    expected: [2, 3, 4],
    sample: 'array_slice($nums, 2, 3)',
    hints: ['Use array_slice with offset and length'],
    validPatterns: [/array_slice\s*\(\s*\$nums\s*,\s*2\s*,\s*3\s*\)/],
    tags: ['array_slice'],
  },
  {
    id: 'php-array-014',
    category: 'array',
    difficulty: 'easy',
    title: 'Check Value Exists (Strict)',
    text: 'Check if the integer 2 exists in the array using strict comparison',
    setup: '$arr = [1, "2", 3, "4"];',
    setupCode: '$arr = [1, "2", 3, "4"];',
    expected: false,
    sample: 'in_array(2, $arr, strict: true)',
    hints: ['Use in_array with named argument strict: true (PHP 8+)'],
    validPatterns: [
      /in_array\s*\(\s*2\s*,\s*\$arr\s*,\s*strict:\s*true\s*\)/,
      /in_array\s*\(\s*2\s*,\s*\$arr\s*,\s*true\s*\)/,
    ],
    tags: ['in_array', 'strict-comparison'],
  },
  {
    id: 'php-array-015',
    category: 'array',
    difficulty: 'medium',
    title: 'Chunk Array',
    text: 'Split the array into chunks of 3 elements each',
    setup: '$nums = [1, 2, 3, 4, 5, 6, 7, 8];',
    setupCode: '$nums = [1, 2, 3, 4, 5, 6, 7, 8];',
    expected: [
      [1, 2, 3],
      [4, 5, 6],
      [7, 8],
    ],
    sample: 'array_chunk($nums, 3)',
    hints: ['Use array_chunk with size parameter'],
    validPatterns: [/array_chunk\s*\(\s*\$nums\s*,\s*3\s*\)/],
    tags: ['array_chunk'],
  },

  // ============================================================
  // STRING FUNCTIONS (15 problems)
  // ============================================================
  {
    id: 'php-string-001',
    category: 'string',
    difficulty: 'easy',
    title: 'Check String Contains',
    text: 'Check if the string contains "World" (PHP 8+)',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: true,
    sample: 'str_contains($str, "World")',
    hints: ['Use str_contains (PHP 8.0+)'],
    validPatterns: [/str_contains\s*\(\s*\$str\s*,\s*['"]World['"]\s*\)/],
    tags: ['str_contains', 'php8'],
  },
  {
    id: 'php-string-002',
    category: 'string',
    difficulty: 'easy',
    title: 'Check String Starts With',
    text: 'Check if the string starts with "Hello" (PHP 8+)',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: true,
    sample: 'str_starts_with($str, "Hello")',
    hints: ['Use str_starts_with (PHP 8.0+)'],
    validPatterns: [/str_starts_with\s*\(\s*\$str\s*,\s*['"]Hello['"]\s*\)/],
    tags: ['str_starts_with', 'php8'],
  },
  {
    id: 'php-string-003',
    category: 'string',
    difficulty: 'easy',
    title: 'Check String Ends With',
    text: 'Check if the filename ends with ".jpg"',
    setup: '$filename = "photo.jpg";',
    setupCode: '$filename = "photo.jpg";',
    expected: true,
    sample: 'str_ends_with($filename, ".jpg")',
    hints: ['Use str_ends_with (PHP 8.0+)'],
    validPatterns: [/str_ends_with\s*\(\s*\$filename\s*,\s*['"]\.jpg['"]\s*\)/],
    tags: ['str_ends_with', 'php8'],
  },
  {
    id: 'php-string-004',
    category: 'string',
    difficulty: 'easy',
    title: 'Split String',
    text: 'Split the string by comma into an array',
    setup: '$str = "apple,banana,cherry";',
    setupCode: '$str = "apple,banana,cherry";',
    expected: ['apple', 'banana', 'cherry'],
    sample: 'explode(",", $str)',
    hints: ['Use explode with comma as delimiter'],
    validPatterns: [/explode\s*\(\s*['"],['"],\s*\$str\s*\)/],
    tags: ['explode'],
  },
  {
    id: 'php-string-005',
    category: 'string',
    difficulty: 'easy',
    title: 'Join Array to String',
    text: 'Join the array elements with " - " separator',
    setup: '$arr = ["one", "two", "three"];',
    setupCode: '$arr = ["one", "two", "three"];',
    expected: 'one - two - three',
    sample: 'implode(" - ", $arr)',
    hints: ['Use implode (or join alias)'],
    validPatterns: [
      /implode\s*\(\s*['"]\s*-\s*['"]\s*,\s*\$arr\s*\)/,
      /join\s*\(\s*['"]\s*-\s*['"]\s*,\s*\$arr\s*\)/,
    ],
    tags: ['implode', 'join'],
  },
  {
    id: 'php-string-006',
    category: 'string',
    difficulty: 'easy',
    title: 'Trim Whitespace',
    text: 'Remove leading and trailing whitespace from the string',
    setup: '$str = "  Hello World  ";',
    setupCode: '$str = "  Hello World  ";',
    expected: 'Hello World',
    sample: 'trim($str)',
    hints: ['Use trim to remove whitespace'],
    validPatterns: [/trim\s*\(\s*\$str\s*\)/],
    tags: ['trim'],
  },
  {
    id: 'php-string-007',
    category: 'string',
    difficulty: 'medium',
    title: 'Format String with sprintf',
    text: 'Format the output as "Item: Product, Price: $19.99"',
    setup: '$name = "Product"; $price = 19.99;',
    setupCode: '$name = "Product"; $price = 19.99;',
    expected: 'Item: Product, Price: $19.99',
    sample: 'sprintf("Item: %s, Price: $%.2f", $name, $price)',
    hints: ['Use sprintf with %s for string and %.2f for float with 2 decimals'],
    validPatterns: [
      /sprintf\s*\(\s*['"]Item:\s*%s,\s*Price:\s*\$%.2f['"]\s*,\s*\$name\s*,\s*\$price\s*\)/,
    ],
    tags: ['sprintf', 'formatting'],
  },
  {
    id: 'php-string-008',
    category: 'string',
    difficulty: 'easy',
    title: 'Replace Substring',
    text: 'Replace "world" with "PHP" in the string',
    setup: '$str = "Hello world";',
    setupCode: '$str = "Hello world";',
    expected: 'Hello PHP',
    sample: 'str_replace("world", "PHP", $str)',
    hints: ['Use str_replace'],
    validPatterns: [/str_replace\s*\(\s*['"]world['"]\s*,\s*['"]PHP['"]\s*,\s*\$str\s*\)/],
    tags: ['str_replace'],
  },
  {
    id: 'php-string-009',
    category: 'string',
    difficulty: 'easy',
    title: 'Extract Substring',
    text: 'Extract "World" from the string (characters 6-10)',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 'World',
    sample: 'substr($str, 6)',
    hints: ['Use substr with starting position'],
    validPatterns: [/substr\s*\(\s*\$str\s*,\s*6\s*\)/, /substr\s*\(\s*\$str\s*,\s*6\s*,\s*5\s*\)/],
    tags: ['substr'],
  },
  {
    id: 'php-string-010',
    category: 'string',
    difficulty: 'medium',
    title: 'Regex Extract Number',
    text: 'Extract the numeric price from the string',
    setup: '$str = "Price: $42.99";',
    setupCode: '$str = "Price: $42.99";',
    expected: '42.99',
    sample: 'preg_match("/\\d+\\.\\d+/", $str, $m) ? $m[0] : null',
    hints: ['Use preg_match with a regex pattern for decimals'],
    validPatterns: [/preg_match\s*\(\s*['"]/],
    tags: ['preg_match', 'regex'],
  },
  {
    id: 'php-string-011',
    category: 'string',
    difficulty: 'easy',
    title: 'Pad Number with Zeros',
    text: 'Pad the number to 5 digits with leading zeros',
    setup: '$num = 42;',
    setupCode: '$num = 42;',
    expected: '00042',
    sample: 'sprintf("%05d", $num)',
    hints: ['Use sprintf with %05d format'],
    validPatterns: [
      /sprintf\s*\(\s*['"]%05d['"]\s*,\s*\$num\s*\)/,
      /str_pad\s*\(\s*\$num\s*,\s*5\s*,\s*['"]0['"]\s*,\s*STR_PAD_LEFT\s*\)/,
    ],
    tags: ['sprintf', 'str_pad'],
  },
  {
    id: 'php-string-012',
    category: 'string',
    difficulty: 'medium',
    title: 'Destructuring with Explode',
    text: 'Extract the first word and the rest separately',
    setup: '$str = "Hello World Today";',
    setupCode: '$str = "Hello World Today";',
    expected: ['Hello', 'World Today'],
    sample: 'explode(" ", $str, 2)',
    hints: ['Use explode with limit parameter'],
    validPatterns: [/explode\s*\(\s*['"]\s*['"]\s*,\s*\$str\s*,\s*2\s*\)/],
    tags: ['explode', 'destructuring'],
  },
  {
    id: 'php-string-013',
    category: 'string',
    difficulty: 'medium',
    title: 'Multiple Replacements',
    text: 'Replace both "a" and "e" with "@"',
    setup: '$str = "hacker";',
    setupCode: '$str = "hacker";',
    expected: 'h@ck@r',
    sample: 'str_replace(["a", "e"], "@", $str)',
    hints: ['str_replace accepts arrays for search parameter'],
    validPatterns: [
      /str_replace\s*\(\s*\[\s*['"]a['"]\s*,\s*['"]e['"]\s*\]\s*,\s*['"]@['"]\s*,\s*\$str\s*\)/,
    ],
    tags: ['str_replace', 'array'],
  },
  {
    id: 'php-string-014',
    category: 'string',
    difficulty: 'easy',
    title: 'Convert Case',
    text: 'Convert string to lowercase then capitalize first letter',
    setup: '$str = "hELLO WORLD";',
    setupCode: '$str = "hELLO WORLD";',
    expected: 'Hello world',
    sample: 'ucfirst(strtolower($str))',
    hints: ['Chain strtolower and ucfirst'],
    validPatterns: [/ucfirst\s*\(\s*strtolower\s*\(\s*\$str\s*\)\s*\)/],
    tags: ['strtolower', 'ucfirst'],
  },
  {
    id: 'php-string-015',
    category: 'string',
    difficulty: 'medium',
    title: 'Regex Named Groups',
    text: 'Extract year, month, and day from a date string using named capture groups',
    setup: '$date = "2024-01-15";',
    setupCode: '$date = "2024-01-15";',
    expected: { year: '2024', month: '01', day: '15' },
    sample:
      'preg_match("/(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/", $date, $m) ? ["year" => $m["year"], "month" => $m["month"], "day" => $m["day"]] : null',
    hints: ['Use named capture groups (?<name>pattern)'],
    validPatterns: [/preg_match\s*\(\s*['"]\/\(\?<year>/],
    tags: ['preg_match', 'named-groups'],
  },

  // ============================================================
  // COLLECTION METHODS - Laravel Patterns (15 problems)
  // ============================================================
  {
    id: 'php-collection-001',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection Map',
    text: 'Double each number using Laravel Collection map',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    expected: [2, 4, 6, 8, 10],
    sample: '$nums->map(fn($n) => $n * 2)->all()',
    hints: ['Use the map method with an arrow function'],
    validPatterns: [
      /\$nums->map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\*\s*2\s*\)->all\s*\(\s*\)/,
    ],
    tags: ['collection', 'map', 'laravel'],
  },
  {
    id: 'php-collection-002',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection Filter',
    text: 'Filter to keep only even numbers using Collection',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5, 6]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5, 6]);',
    expected: [2, 4, 6],
    sample: '$nums->filter(fn($n) => $n % 2 === 0)->values()->all()',
    hints: ['Use filter then values to reset keys'],
    validPatterns: [
      /\$nums->filter\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*%\s*2\s*===?\s*0\s*\)->values\s*\(\s*\)->all\s*\(\s*\)/,
    ],
    tags: ['collection', 'filter', 'laravel'],
  },
  {
    id: 'php-collection-003',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection Reduce Sum',
    text: 'Sum all numbers using Collection reduce',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    expected: 15,
    sample: '$nums->reduce(fn($sum, $n) => $sum + $n, 0)',
    hints: ['Use reduce or the simpler sum method'],
    validPatterns: [
      /\$nums->reduce\s*\(\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\+\s*\$\w+\s*,\s*0\s*\)/,
      /\$nums->sum\s*\(\s*\)/,
    ],
    tags: ['collection', 'reduce', 'laravel'],
  },
  {
    id: 'php-collection-004',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection Pluck',
    text: 'Extract all "name" values from users collection',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"]]);',
    expected: ['Alice', 'Bob'],
    sample: '$users->pluck("name")->all()',
    hints: ['Use the pluck method with the key name'],
    validPatterns: [/\$users->pluck\s*\(\s*['"]name['"]\s*\)->all\s*\(\s*\)/],
    tags: ['collection', 'pluck', 'laravel'],
  },
  {
    id: 'php-collection-005',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection Where',
    text: 'Filter users where role is "admin"',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Alice", "role" => "admin"], ["name" => "Bob", "role" => "user"], ["name" => "Charlie", "role" => "admin"]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Alice", "role" => "admin"], ["name" => "Bob", "role" => "user"], ["name" => "Charlie", "role" => "admin"]]);',
    expected: [
      { name: 'Alice', role: 'admin' },
      { name: 'Charlie', role: 'admin' },
    ],
    sample: '$users->where("role", "admin")->values()->all()',
    hints: ['Use where for key-value filtering'],
    validPatterns: [/\$users->where\s*\(\s*['"]role['"]\s*,\s*['"]admin['"]\s*\)/],
    tags: ['collection', 'where', 'laravel'],
  },
  {
    id: 'php-collection-006',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection GroupBy',
    text: 'Group users by their role',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Alice", "role" => "admin"], ["name" => "Bob", "role" => "user"], ["name" => "Charlie", "role" => "admin"]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Alice", "role" => "admin"], ["name" => "Bob", "role" => "user"], ["name" => "Charlie", "role" => "admin"]]);',
    expected: {
      admin: [
        { name: 'Alice', role: 'admin' },
        { name: 'Charlie', role: 'admin' },
      ],
      user: [{ name: 'Bob', role: 'user' }],
    },
    sample: '$users->groupBy("role")->toArray()',
    hints: ['Use groupBy with the key to group by'],
    validPatterns: [/\$users->groupBy\s*\(\s*['"]role['"]\s*\)/],
    tags: ['collection', 'groupBy', 'laravel'],
  },
  {
    id: 'php-collection-007',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection SortBy',
    text: 'Sort users by name alphabetically',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Charlie"], ["name" => "Alice"], ["name" => "Bob"]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Charlie"], ["name" => "Alice"], ["name" => "Bob"]]);',
    expected: [{ name: 'Alice' }, { name: 'Bob' }, { name: 'Charlie' }],
    sample: '$users->sortBy("name")->values()->all()',
    hints: ['Use sortBy then values to reset keys'],
    validPatterns: [/\$users->sortBy\s*\(\s*['"]name['"]\s*\)->values\s*\(\s*\)->all\s*\(\s*\)/],
    tags: ['collection', 'sortBy', 'laravel'],
  },
  {
    id: 'php-collection-008',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection First',
    text: 'Get the first user with role "admin"',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Alice", "role" => "user"], ["name" => "Bob", "role" => "admin"], ["name" => "Charlie", "role" => "admin"]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Alice", "role" => "user"], ["name" => "Bob", "role" => "admin"], ["name" => "Charlie", "role" => "admin"]]);',
    expected: { name: 'Bob', role: 'admin' },
    sample: '$users->first(fn($u) => $u["role"] === "admin")',
    hints: ['Use first with a callback'],
    validPatterns: [
      /\$users->first\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\[\s*['"]role['"]\s*\]\s*===?\s*['"]admin['"]\s*\)/,
      /\$users->firstWhere\s*\(\s*['"]role['"]\s*,\s*['"]admin['"]\s*\)/,
    ],
    tags: ['collection', 'first', 'laravel'],
  },
  {
    id: 'php-collection-009',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection Chunk',
    text: 'Split the collection into chunks of 3',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5, 6, 7, 8]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5, 6, 7, 8]);',
    expected: [
      [1, 2, 3],
      [4, 5, 6],
      [7, 8],
    ],
    sample: '$nums->chunk(3)->map(fn($c) => $c->values()->all())->all()',
    hints: ['Use chunk method'],
    validPatterns: [/\$nums->chunk\s*\(\s*3\s*\)/],
    tags: ['collection', 'chunk', 'laravel'],
  },
  {
    id: 'php-collection-010',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection FlatMap',
    text: 'FlatMap to get all tags from posts',
    setup:
      'use Illuminate\\Support\\Collection; $posts = collect([["tags" => ["php", "laravel"]], ["tags" => ["javascript", "vue"]]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $posts = collect([["tags" => ["php", "laravel"]], ["tags" => ["javascript", "vue"]]]);',
    expected: ['php', 'laravel', 'javascript', 'vue'],
    sample: '$posts->flatMap(fn($p) => $p["tags"])->all()',
    hints: ['Use flatMap to map and flatten in one step'],
    validPatterns: [
      /\$posts->flatMap\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\[\s*['"]tags['"]\s*\]\s*\)->all\s*\(\s*\)/,
    ],
    tags: ['collection', 'flatMap', 'laravel'],
  },
  {
    id: 'php-collection-011',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection Unique',
    text: 'Get unique values from the collection',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 2, 3, 3, 3]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 2, 3, 3, 3]);',
    expected: [1, 2, 3],
    sample: '$nums->unique()->values()->all()',
    hints: ['Use unique then values to reset keys'],
    validPatterns: [/\$nums->unique\s*\(\s*\)->values\s*\(\s*\)->all\s*\(\s*\)/],
    tags: ['collection', 'unique', 'laravel'],
  },
  {
    id: 'php-collection-012',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection Method Chaining',
    text: 'Get names of active users sorted alphabetically',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Charlie", "active" => true], ["name" => "Alice", "active" => false], ["name" => "Bob", "active" => true]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["name" => "Charlie", "active" => true], ["name" => "Alice", "active" => false], ["name" => "Bob", "active" => true]]);',
    expected: ['Bob', 'Charlie'],
    sample: '$users->where("active", true)->sortBy("name")->pluck("name")->values()->all()',
    hints: ['Chain where, sortBy, pluck, values'],
    validPatterns: [
      /\$users->where\s*\(\s*['"]active['"]\s*,\s*true\s*\)->sortBy\s*\(\s*['"]name['"]\s*\)->pluck\s*\(\s*['"]name['"]\s*\)/,
    ],
    tags: ['collection', 'chaining', 'laravel'],
  },
  {
    id: 'php-collection-013',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection Pipe',
    text: 'Use pipe to transform collection to a report object',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    expected: { count: 5, sum: 15, avg: 3 },
    sample:
      '$nums->pipe(fn($c) => ["count" => $c->count(), "sum" => $c->sum(), "avg" => $c->avg()])',
    hints: ['Use pipe to break out of method chaining'],
    validPatterns: [/\$nums->pipe\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>/],
    tags: ['collection', 'pipe', 'laravel'],
  },
  {
    id: 'php-collection-014',
    category: 'collection',
    difficulty: 'easy',
    title: 'Collection Contains',
    text: 'Check if collection contains the value 3',
    setup: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    setupCode: 'use Illuminate\\Support\\Collection; $nums = collect([1, 2, 3, 4, 5]);',
    expected: true,
    sample: '$nums->contains(3)',
    hints: ['Use contains method'],
    validPatterns: [/\$nums->contains\s*\(\s*3\s*\)/],
    tags: ['collection', 'contains', 'laravel'],
  },
  {
    id: 'php-collection-015',
    category: 'collection',
    difficulty: 'medium',
    title: 'Collection KeyBy',
    text: 'Index the users collection by their id',
    setup:
      'use Illuminate\\Support\\Collection; $users = collect([["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"]]);',
    setupCode:
      'use Illuminate\\Support\\Collection; $users = collect([["id" => 1, "name" => "Alice"], ["id" => 2, "name" => "Bob"]]);',
    expected: { 1: { id: 1, name: 'Alice' }, 2: { id: 2, name: 'Bob' } },
    sample: '$users->keyBy("id")->toArray()',
    hints: ['Use keyBy to index by a key'],
    validPatterns: [/\$users->keyBy\s*\(\s*['"]id['"]\s*\)/],
    tags: ['collection', 'keyBy', 'laravel'],
  },

  // ============================================================
  // ELOQUENT ORM (10 problems)
  // ============================================================
  {
    id: 'php-eloquent-001',
    category: 'eloquent',
    difficulty: 'easy',
    title: 'Find by ID',
    text: 'Find a user by ID using Eloquent',
    setup: '// User model extends Eloquent Model',
    setupCode: '// User model extends Eloquent Model',
    expected: 'User model or null',
    sample: 'User::find(1)',
    hints: ['Use the static find method'],
    validPatterns: [/User::find\s*\(\s*1\s*\)/],
    tags: ['eloquent', 'find', 'laravel'],
  },
  {
    id: 'php-eloquent-002',
    category: 'eloquent',
    difficulty: 'easy',
    title: 'Where Clause',
    text: 'Get all active users',
    setup: '// User model with "active" column',
    setupCode: '// User model with "active" column',
    expected: 'Collection of active users',
    sample: 'User::where("active", true)->get()',
    hints: ['Use where with get to retrieve results'],
    validPatterns: [/User::where\s*\(\s*['"]active['"]\s*,\s*true\s*\)->get\s*\(\s*\)/],
    tags: ['eloquent', 'where', 'laravel'],
  },
  {
    id: 'php-eloquent-003',
    category: 'eloquent',
    difficulty: 'medium',
    title: 'Eager Loading',
    text: 'Get all posts with their authors eager loaded',
    setup: '// Post model with belongsTo("author") relationship',
    setupCode: '// Post model with belongsTo("author") relationship',
    expected: 'Collection of posts with authors',
    sample: 'Post::with("author")->get()',
    hints: ['Use with() to eager load relationships'],
    validPatterns: [/Post::with\s*\(\s*['"]author['"]\s*\)->get\s*\(\s*\)/],
    tags: ['eloquent', 'eager-loading', 'laravel'],
  },
  {
    id: 'php-eloquent-004',
    category: 'eloquent',
    difficulty: 'medium',
    title: 'Create Model',
    text: 'Create a new user with name and email',
    setup: '// User model with fillable name and email',
    setupCode: '// User model with fillable name and email',
    expected: 'New User model instance',
    sample: 'User::create(["name" => "John", "email" => "john@example.com"])',
    hints: ['Use the static create method with an array'],
    validPatterns: [
      /User::create\s*\(\s*\[\s*['"]name['"]\s*=>\s*['"]John['"]\s*,\s*['"]email['"]\s*=>\s*['"]john@example\.com['"]\s*\]\s*\)/,
    ],
    tags: ['eloquent', 'create', 'laravel'],
  },
  {
    id: 'php-eloquent-005',
    category: 'eloquent',
    difficulty: 'medium',
    title: 'Update or Create',
    text: 'Update or create a user by email',
    setup: '// User model',
    setupCode: '// User model',
    expected: 'User model (created or updated)',
    sample: 'User::updateOrCreate(["email" => "john@example.com"], ["name" => "John Doe"])',
    hints: ['First array is for lookup, second is for data'],
    validPatterns: [/User::updateOrCreate\s*\(\s*\[\s*['"]email['"]\s*=>/],
    tags: ['eloquent', 'updateOrCreate', 'laravel'],
  },
  {
    id: 'php-eloquent-006',
    category: 'eloquent',
    difficulty: 'medium',
    title: 'Constrained Eager Loading',
    text: 'Get posts with only published comments',
    setup: '// Post model with hasMany("comments") relationship',
    setupCode: '// Post model with hasMany("comments") relationship',
    expected: 'Posts with filtered comments',
    sample: 'Post::with(["comments" => fn($q) => $q->where("published", true)])->get()',
    hints: ['Use array syntax with closure for constrained loading'],
    validPatterns: [
      /Post::with\s*\(\s*\[\s*['"]comments['"]\s*=>\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+->where\s*\(\s*['"]published['"]\s*,\s*true\s*\)\s*\]\s*\)->get\s*\(\s*\)/,
    ],
    tags: ['eloquent', 'constrained-eager-loading', 'laravel'],
  },
  {
    id: 'php-eloquent-007',
    category: 'eloquent',
    difficulty: 'easy',
    title: 'Order Results',
    text: 'Get users ordered by name in descending order',
    setup: '// User model',
    setupCode: '// User model',
    expected: 'Users sorted Z-A',
    sample: 'User::orderByDesc("name")->get()',
    hints: ['Use orderByDesc or orderBy with "desc"'],
    validPatterns: [
      /User::orderByDesc\s*\(\s*['"]name['"]\s*\)->get\s*\(\s*\)/,
      /User::orderBy\s*\(\s*['"]name['"]\s*,\s*['"]desc['"]\s*\)->get\s*\(\s*\)/,
    ],
    tags: ['eloquent', 'ordering', 'laravel'],
  },
  {
    id: 'php-eloquent-008',
    category: 'eloquent',
    difficulty: 'medium',
    title: 'Scope Usage',
    text: 'Use the "active" scope to get active users (scope is already defined)',
    setup: '// User model with scopeActive($query) method',
    setupCode: '// User model with scopeActive($query) method',
    expected: 'Active users',
    sample: 'User::active()->get()',
    hints: ['Scopes are called without the "scope" prefix'],
    validPatterns: [/User::active\s*\(\s*\)->get\s*\(\s*\)/],
    tags: ['eloquent', 'scope', 'laravel'],
  },
  {
    id: 'php-eloquent-009',
    category: 'eloquent',
    difficulty: 'medium',
    title: 'Multiple Eager Loading',
    text: 'Get posts with author and comments eager loaded',
    setup: '// Post model with relationships',
    setupCode: '// Post model with relationships',
    expected: 'Posts with author and comments',
    sample: 'Post::with(["author", "comments"])->get()',
    hints: ['Pass an array to with() for multiple relationships'],
    validPatterns: [
      /Post::with\s*\(\s*\[\s*['"]author['"]\s*,\s*['"]comments['"]\s*\]\s*\)->get\s*\(\s*\)/,
    ],
    tags: ['eloquent', 'eager-loading', 'laravel'],
  },
  {
    id: 'php-eloquent-010',
    category: 'eloquent',
    difficulty: 'hard',
    title: 'Query Builder Closure',
    text: 'Get users where (role is admin OR verified is true)',
    setup: '// User model',
    setupCode: '// User model',
    expected: 'Users matching condition',
    sample: 'User::where(fn($q) => $q->where("role", "admin")->orWhere("verified", true))->get()',
    hints: ['Use closure for grouping conditions'],
    validPatterns: [
      /User::where\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+->where\s*\(\s*['"]role['"]\s*,\s*['"]admin['"]\s*\)->orWhere\s*\(\s*['"]verified['"]\s*,\s*true\s*\)\s*\)->get\s*\(\s*\)/,
    ],
    tags: ['eloquent', 'closure', 'laravel'],
  },

  // ============================================================
  // LARAVEL HELPERS (10 problems)
  // ============================================================
  {
    id: 'php-helper-001',
    category: 'helper',
    difficulty: 'easy',
    title: 'Fluent String',
    text: 'Convert "hello world" to title case using Str::of',
    setup: 'use Illuminate\\Support\\Str;',
    setupCode: 'use Illuminate\\Support\\Str;',
    expected: 'Hello World',
    sample: 'Str::of("hello world")->title()->toString()',
    hints: ['Use Str::of for fluent string manipulation'],
    validPatterns: [/Str::of\s*\(\s*['"]hello world['"]\s*\)->title\s*\(\s*\)/],
    tags: ['str', 'fluent', 'laravel'],
  },
  {
    id: 'php-helper-002',
    category: 'helper',
    difficulty: 'easy',
    title: 'Generate Slug',
    text: 'Generate a URL slug from "Hello World!"',
    setup: 'use Illuminate\\Support\\Str;',
    setupCode: 'use Illuminate\\Support\\Str;',
    expected: 'hello-world',
    sample: 'Str::slug("Hello World!")',
    hints: ['Use Str::slug for URL-friendly strings'],
    validPatterns: [/Str::slug\s*\(\s*['"]Hello World!['"]\s*\)/],
    tags: ['str', 'slug', 'laravel'],
  },
  {
    id: 'php-helper-003',
    category: 'helper',
    difficulty: 'medium',
    title: 'Nested Array Access',
    text: 'Get the value at "user.profile.name" from a nested array',
    setup: 'use Illuminate\\Support\\Arr; $data = ["user" => ["profile" => ["name" => "John"]]];',
    setupCode:
      'use Illuminate\\Support\\Arr; $data = ["user" => ["profile" => ["name" => "John"]]];',
    expected: 'John',
    sample: 'Arr::get($data, "user.profile.name")',
    hints: ['Use Arr::get with dot notation'],
    validPatterns: [/Arr::get\s*\(\s*\$data\s*,\s*['"]user\.profile\.name['"]\s*\)/],
    tags: ['arr', 'dot-notation', 'laravel'],
  },
  {
    id: 'php-helper-004',
    category: 'helper',
    difficulty: 'easy',
    title: 'Array Only',
    text: 'Get only "name" and "email" from the user array',
    setup:
      'use Illuminate\\Support\\Arr; $user = ["id" => 1, "name" => "John", "email" => "john@example.com", "password" => "secret"];',
    setupCode:
      'use Illuminate\\Support\\Arr; $user = ["id" => 1, "name" => "John", "email" => "john@example.com", "password" => "secret"];',
    expected: { name: 'John', email: 'john@example.com' },
    sample: 'Arr::only($user, ["name", "email"])',
    hints: ['Use Arr::only to whitelist keys'],
    validPatterns: [
      /Arr::only\s*\(\s*\$user\s*,\s*\[\s*['"]name['"]\s*,\s*['"]email['"]\s*\]\s*\)/,
    ],
    tags: ['arr', 'only', 'laravel'],
  },
  {
    id: 'php-helper-005',
    category: 'helper',
    difficulty: 'easy',
    title: 'Array Except',
    text: 'Remove "password" from the user array',
    setup:
      'use Illuminate\\Support\\Arr; $user = ["id" => 1, "name" => "John", "password" => "secret"];',
    setupCode:
      'use Illuminate\\Support\\Arr; $user = ["id" => 1, "name" => "John", "password" => "secret"];',
    expected: { id: 1, name: 'John' },
    sample: 'Arr::except($user, ["password"])',
    hints: ['Use Arr::except to blacklist keys'],
    validPatterns: [/Arr::except\s*\(\s*\$user\s*,\s*\[\s*['"]password['"]\s*\]\s*\)/],
    tags: ['arr', 'except', 'laravel'],
  },
  {
    id: 'php-helper-006',
    category: 'helper',
    difficulty: 'medium',
    title: 'Optional Helper',
    text: 'Safely access name property on a possibly null user',
    setup: '$user = null;',
    setupCode: '$user = null;',
    expected: null,
    sample: 'optional($user)->name',
    hints: ['Use optional() to avoid null errors'],
    validPatterns: [/optional\s*\(\s*\$user\s*\)->name/, /\$user\?->name/],
    tags: ['optional', 'null-safety', 'laravel'],
  },
  {
    id: 'php-helper-007',
    category: 'helper',
    difficulty: 'medium',
    title: 'Tap Helper',
    text: 'Update user last_login and return the user using tap',
    setup: '$user = new User();',
    setupCode: '$user = new User();',
    expected: 'User with updated last_login',
    sample: 'tap($user)->update(["last_login" => now()])',
    hints: ['Use tap to perform action and return original'],
    validPatterns: [/tap\s*\(\s*\$user\s*\)->update/],
    tags: ['tap', 'fluent', 'laravel'],
  },
  {
    id: 'php-helper-008',
    category: 'helper',
    difficulty: 'easy',
    title: 'Now Helper',
    text: 'Get the current timestamp using the now() helper',
    setup: '// Laravel application',
    setupCode: '// Laravel application',
    expected: 'Carbon instance',
    sample: 'now()',
    hints: ['now() returns a Carbon instance'],
    validPatterns: [/now\s*\(\s*\)/],
    tags: ['now', 'carbon', 'laravel'],
  },
  {
    id: 'php-helper-009',
    category: 'helper',
    difficulty: 'medium',
    title: 'String Chaining',
    text: 'Convert "  HELLO WORLD  " to "hello-world" using Str::of chain',
    setup: 'use Illuminate\\Support\\Str;',
    setupCode: 'use Illuminate\\Support\\Str;',
    expected: 'hello-world',
    sample: 'Str::of("  HELLO WORLD  ")->trim()->lower()->slug()->toString()',
    hints: ['Chain trim, lower, and slug methods'],
    validPatterns: [
      /Str::of\s*\(\s*['"]\s*HELLO WORLD\s*['"]\s*\)->trim\s*\(\s*\)->lower\s*\(\s*\)->slug\s*\(\s*\)/,
    ],
    tags: ['str', 'chaining', 'laravel'],
  },
  {
    id: 'php-helper-010',
    category: 'helper',
    difficulty: 'medium',
    title: 'Arr Has',
    text: 'Check if nested key "user.profile.name" exists in array',
    setup: 'use Illuminate\\Support\\Arr; $data = ["user" => ["profile" => ["name" => "John"]]];',
    setupCode:
      'use Illuminate\\Support\\Arr; $data = ["user" => ["profile" => ["name" => "John"]]];',
    expected: true,
    sample: 'Arr::has($data, "user.profile.name")',
    hints: ['Use Arr::has with dot notation'],
    validPatterns: [/Arr::has\s*\(\s*\$data\s*,\s*['"]user\.profile\.name['"]\s*\)/],
    tags: ['arr', 'has', 'laravel'],
  },

  // ============================================================
  // MODERN PHP FEATURES (10 problems)
  // ============================================================
  {
    id: 'php-modern-001',
    category: 'modern',
    difficulty: 'easy',
    title: 'Arrow Function',
    text: 'Create an arrow function that doubles a number',
    setup: '',
    setupCode: '',
    expected: 'fn($n) => $n * 2',
    sample: 'fn($n) => $n * 2',
    hints: ['Use fn() => syntax for arrow functions'],
    validPatterns: [/fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\*\s*2/],
    tags: ['arrow-function', 'php74'],
  },
  {
    id: 'php-modern-002',
    category: 'modern',
    difficulty: 'easy',
    title: 'Nullsafe Operator',
    text: 'Access user profile name with nullsafe operator',
    setup: '$user = null;',
    setupCode: '$user = null;',
    expected: null,
    sample: '$user?->profile?->name',
    hints: ['Use ?-> for nullsafe property access'],
    validPatterns: [/\$user\?->profile\?->name/],
    tags: ['nullsafe', 'php8'],
  },
  {
    id: 'php-modern-003',
    category: 'modern',
    difficulty: 'easy',
    title: 'Named Arguments',
    text: 'Call array_slice with named arguments for clarity',
    setup: '$arr = [1, 2, 3, 4, 5];',
    setupCode: '$arr = [1, 2, 3, 4, 5];',
    expected: [3, 4, 5],
    sample: 'array_slice(array: $arr, offset: 2)',
    hints: ['Use argument: value syntax for named arguments'],
    validPatterns: [/array_slice\s*\(\s*array:\s*\$arr\s*,\s*offset:\s*2\s*\)/],
    tags: ['named-arguments', 'php8'],
  },
  {
    id: 'php-modern-004',
    category: 'modern',
    difficulty: 'medium',
    title: 'Match Expression',
    text: 'Use match expression to return day name for 1-7',
    setup: '$day = 1;',
    setupCode: '$day = 1;',
    expected: 'Monday',
    sample:
      'match($day) { 1 => "Monday", 2 => "Tuesday", 3 => "Wednesday", 4 => "Thursday", 5 => "Friday", 6 => "Saturday", 7 => "Sunday" }',
    hints: ['Use match expression (PHP 8+) instead of switch'],
    validPatterns: [/match\s*\(\s*\$day\s*\)\s*\{/],
    tags: ['match', 'php8'],
  },
  {
    id: 'php-modern-005',
    category: 'modern',
    difficulty: 'easy',
    title: 'Null Coalescing',
    text: 'Use null coalescing operator with default value',
    setup: '$config = [];',
    setupCode: '$config = [];',
    expected: 'default',
    sample: '$config["timeout"] ?? "default"',
    hints: ['Use ?? for null coalescing'],
    validPatterns: [/\$config\s*\[\s*['"]timeout['"]\s*\]\s*\?\?\s*['"]default['"]/],
    tags: ['null-coalescing', 'php7'],
  },
  {
    id: 'php-modern-006',
    category: 'modern',
    difficulty: 'easy',
    title: 'Spaceship Operator',
    text: 'Compare two numbers using spaceship operator',
    setup: '$a = 5; $b = 3;',
    setupCode: '$a = 5; $b = 3;',
    expected: 1,
    sample: '$a <=> $b',
    hints: ['<=> returns -1, 0, or 1'],
    validPatterns: [/\$a\s*<=>\s*\$b/],
    tags: ['spaceship', 'php7'],
  },
  {
    id: 'php-modern-007',
    category: 'modern',
    difficulty: 'medium',
    title: 'Spread Operator in Arrays',
    text: 'Add elements to both ends of an array using spread',
    setup: '$middle = [2, 3, 4];',
    setupCode: '$middle = [2, 3, 4];',
    expected: [1, 2, 3, 4, 5],
    sample: '[1, ...$middle, 5]',
    hints: ['Use ... to spread array elements'],
    validPatterns: [/\[\s*1\s*,\s*\.\.\.\$middle\s*,\s*5\s*\]/],
    tags: ['spread', 'php74'],
  },
  {
    id: 'php-modern-008',
    category: 'modern',
    difficulty: 'medium',
    title: 'First Class Callable',
    text: 'Pass strlen as a first-class callable to array_map',
    setup: '$words = ["hi", "hello", "world"];',
    setupCode: '$words = ["hi", "hello", "world"];',
    expected: [2, 5, 5],
    sample: 'array_map(strlen(...), $words)',
    hints: ['Use function_name(...) for first-class callable'],
    validPatterns: [/array_map\s*\(\s*strlen\s*\(\s*\.\.\.\s*\)\s*,\s*\$words\s*\)/],
    tags: ['first-class-callable', 'php81'],
  },
  {
    id: 'php-modern-009',
    category: 'modern',
    difficulty: 'easy',
    title: 'Array Destructuring',
    text: 'Destructure first and second elements from array',
    setup: '$arr = [1, 2, 3, 4, 5];',
    setupCode: '$arr = [1, 2, 3, 4, 5];',
    expected: { first: 1, second: 2 },
    sample: '[$first, $second] = $arr; ["first" => $first, "second" => $second]',
    hints: ['Use [$a, $b] = $arr for destructuring'],
    validPatterns: [/\[\s*\$\w+\s*,\s*\$\w+\s*\]\s*=\s*\$arr/],
    tags: ['destructuring', 'php71'],
  },
  {
    id: 'php-modern-010',
    category: 'modern',
    difficulty: 'medium',
    title: 'Readonly Properties',
    text: 'Define a readonly name property in a class constructor',
    setup: '',
    setupCode: '',
    expected: 'class User { public function __construct(public readonly string $name) {} }',
    sample: 'class User { public function __construct(public readonly string $name) {} }',
    hints: ['Use readonly modifier with constructor promotion'],
    validPatterns: [/public\s+readonly\s+string\s+\$name/],
    tags: ['readonly', 'php81'],
  },

  // ============================================================
  // JSON AND TYPE FUNCTIONS (5 problems)
  // ============================================================
  {
    id: 'php-json-001',
    category: 'json',
    difficulty: 'easy',
    title: 'Encode to JSON',
    text: 'Encode an array to JSON with pretty print',
    setup: '$data = ["name" => "John", "age" => 30];',
    setupCode: '$data = ["name" => "John", "age" => 30];',
    expected: '{\n    "name": "John",\n    "age": 30\n}',
    sample: 'json_encode($data, JSON_PRETTY_PRINT)',
    hints: ['Use JSON_PRETTY_PRINT flag'],
    validPatterns: [/json_encode\s*\(\s*\$data\s*,\s*JSON_PRETTY_PRINT\s*\)/],
    tags: ['json_encode'],
  },
  {
    id: 'php-json-002',
    category: 'json',
    difficulty: 'easy',
    title: 'Decode JSON to Array',
    text: 'Decode JSON string to an associative array',
    setup: '$json = \'{"name":"John","age":30}\';',
    setupCode: '$json = \'{"name":"John","age":30}\';',
    expected: { name: 'John', age: 30 },
    sample: 'json_decode($json, true)',
    hints: ['Pass true as second argument for associative array'],
    validPatterns: [/json_decode\s*\(\s*\$json\s*,\s*true\s*\)/],
    tags: ['json_decode'],
  },
  {
    id: 'php-json-003',
    category: 'json',
    difficulty: 'medium',
    title: 'JSON with Error Handling',
    text: 'Decode JSON with exception throwing on error',
    setup: '$json = \'{"name":"John"}\';',
    setupCode: '$json = \'{"name":"John"}\';',
    expected: { name: 'John' },
    sample: 'json_decode($json, true, 512, JSON_THROW_ON_ERROR)',
    hints: ['Use JSON_THROW_ON_ERROR flag (PHP 7.3+)'],
    validPatterns: [
      /json_decode\s*\(\s*\$json\s*,\s*true\s*,\s*512\s*,\s*JSON_THROW_ON_ERROR\s*\)/,
    ],
    tags: ['json_decode', 'error-handling'],
  },
  {
    id: 'php-type-001',
    category: 'type',
    difficulty: 'easy',
    title: 'Get Debug Type',
    text: 'Get the type name of a value using get_debug_type (PHP 8+)',
    setup: '$value = 42;',
    setupCode: '$value = 42;',
    expected: 'int',
    sample: 'get_debug_type($value)',
    hints: ['get_debug_type returns actual type names'],
    validPatterns: [/get_debug_type\s*\(\s*\$value\s*\)/],
    tags: ['get_debug_type', 'php8'],
  },
  {
    id: 'php-type-002',
    category: 'type',
    difficulty: 'easy',
    title: 'Instance Check',
    text: 'Check if $user is an instance of User class',
    setup: 'class User {} $user = new User();',
    setupCode: 'class User {} $user = new User();',
    expected: true,
    sample: '$user instanceof User',
    hints: ['Use instanceof operator'],
    validPatterns: [/\$user\s+instanceof\s+User/],
    tags: ['instanceof'],
  },

  // ============================================================
  // ARRAY FUNCTIONS - Additional (5 problems)
  // ============================================================
  {
    id: 'php-array-016',
    category: 'array',
    difficulty: 'easy',
    title: 'Filter with Callback Key',
    text: 'Filter the array to keep only items where the key starts with "user_"',
    setup:
      '$data = ["user_name" => "John", "user_email" => "john@example.com", "admin_role" => "super", "user_age" => 25];',
    setupCode:
      '$data = ["user_name" => "John", "user_email" => "john@example.com", "admin_role" => "super", "user_age" => 25];',
    expected: { user_name: 'John', user_email: 'john@example.com', user_age: 25 },
    sample: 'array_filter($data, fn($k) => str_starts_with($k, "user_"), ARRAY_FILTER_USE_KEY)',
    hints: ['Use ARRAY_FILTER_USE_KEY to filter by key instead of value'],
    validPatterns: [
      /array_filter\s*\(\s*\$data\s*,\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*str_starts_with\s*\(\s*\$\w+\s*,\s*['"]user_['"]\s*\)\s*,\s*ARRAY_FILTER_USE_KEY\s*\)/,
    ],
    tags: ['array_filter', 'ARRAY_FILTER_USE_KEY', 'str_starts_with'],
  },
  {
    id: 'php-array-017',
    category: 'array',
    difficulty: 'medium',
    title: 'Map with Keys',
    text: 'Double the values and prefix keys with "item_" using array_map with multiple arrays',
    setup: '$nums = ["a" => 1, "b" => 2, "c" => 3];',
    setupCode: '$nums = ["a" => 1, "b" => 2, "c" => 3];',
    expected: { item_a: 2, item_b: 4, item_c: 6 },
    sample:
      'array_combine(array_map(fn($k) => "item_" . $k, array_keys($nums)), array_map(fn($v) => $v * 2, $nums))',
    hints: ['Use array_combine to pair new keys with new values', 'Use array_keys to get the keys'],
    validPatterns: [
      /array_combine\s*\(\s*array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*['"]item_['"]\s*\.\s*\$\w+\s*,\s*array_keys\s*\(\s*\$nums\s*\)\s*\)\s*,\s*array_map/,
    ],
    tags: ['array_combine', 'array_map', 'array_keys'],
  },
  {
    id: 'php-array-018',
    category: 'array',
    difficulty: 'medium',
    title: 'Reduce to Associative Array',
    text: 'Convert array of [key, value] pairs into an associative array using array_reduce',
    setup: '$pairs = [["name", "John"], ["age", 30], ["city", "NYC"]];',
    setupCode: '$pairs = [["name", "John"], ["age", 30], ["city", "NYC"]];',
    expected: { name: 'John', age: 30, city: 'NYC' },
    sample: 'array_reduce($pairs, fn($acc, $p) => [...$acc, $p[0] => $p[1]], [])',
    hints: [
      'Use array_reduce with spread operator',
      'Alternative: array_column with index parameter',
    ],
    validPatterns: [
      /array_reduce\s*\(\s*\$pairs\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\[\s*\.\.\.\$\w+\s*,\s*\$\w+\s*\[\s*0\s*\]\s*=>\s*\$\w+\s*\[\s*1\s*\]\s*\]\s*,\s*\[\s*\]\s*\)/,
      /array_column\s*\(\s*\$pairs\s*,\s*1\s*,\s*0\s*\)/,
    ],
    tags: ['array_reduce', 'spread-operator', 'array_column'],
  },
  {
    id: 'php-array-019',
    category: 'array',
    difficulty: 'easy',
    title: 'Combine Keys and Values',
    text: 'Create an associative array from separate keys and values arrays',
    setup: '$keys = ["name", "age", "city"]; $values = ["Alice", 25, "Boston"];',
    setupCode: '$keys = ["name", "age", "city"]; $values = ["Alice", 25, "Boston"];',
    expected: { name: 'Alice', age: 25, city: 'Boston' },
    sample: 'array_combine($keys, $values)',
    hints: ['Use array_combine to pair keys with values'],
    validPatterns: [/array_combine\s*\(\s*\$keys\s*,\s*\$values\s*\)/],
    tags: ['array_combine'],
  },
  {
    id: 'php-array-020',
    category: 'array',
    difficulty: 'hard',
    title: 'Group and Sum with Reduce',
    text: 'Group products by category and sum their prices using array_reduce',
    setup:
      '$products = [["category" => "fruit", "price" => 10], ["category" => "vegetable", "price" => 5], ["category" => "fruit", "price" => 15], ["category" => "vegetable", "price" => 8]];',
    setupCode:
      '$products = [["category" => "fruit", "price" => 10], ["category" => "vegetable", "price" => 5], ["category" => "fruit", "price" => 15], ["category" => "vegetable", "price" => 8]];',
    expected: { fruit: 25, vegetable: 13 },
    sample:
      'array_reduce($products, fn($acc, $p) => [...$acc, $p["category"] => ($acc[$p["category"]] ?? 0) + $p["price"]], [])',
    hints: [
      'Use null coalescing to handle missing keys',
      'Build up the result array with spread operator',
    ],
    validPatterns: [/array_reduce\s*\(\s*\$products\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>/],
    tags: ['array_reduce', 'grouping', 'aggregation'],
  },

  // ============================================================
  // STRING FUNCTIONS - Additional (5 problems)
  // ============================================================
  {
    id: 'php-string-016',
    category: 'string',
    difficulty: 'easy',
    title: 'Replace Multiple Strings',
    text: 'Replace "cat" with "dog" and "bird" with "fish" in the sentence',
    setup: '$str = "I have a cat and a bird";',
    setupCode: '$str = "I have a cat and a bird";',
    expected: 'I have a dog and a fish',
    sample: 'str_replace(["cat", "bird"], ["dog", "fish"], $str)',
    hints: ['Pass arrays to str_replace for multiple replacements'],
    validPatterns: [
      /str_replace\s*\(\s*\[\s*['"]cat['"]\s*,\s*['"]bird['"]\s*\]\s*,\s*\[\s*['"]dog['"]\s*,\s*['"]fish['"]\s*\]\s*,\s*\$str\s*\)/,
    ],
    tags: ['str_replace', 'multiple-replacement'],
  },
  {
    id: 'php-string-017',
    category: 'string',
    difficulty: 'medium',
    title: 'Extract All Numbers with Regex',
    text: 'Extract all numbers from the string into an array',
    setup: '$str = "Order 123 has 5 items at $49.99";',
    setupCode: '$str = "Order 123 has 5 items at $49.99";',
    expected: ['123', '5', '49', '99'],
    sample: 'preg_match_all("/\\d+/", $str, $m) ? $m[0] : []',
    hints: ['Use preg_match_all to find all matches'],
    validPatterns: [/preg_match_all\s*\(\s*['"]\/\\d\+\/['"]\s*,\s*\$str\s*,\s*\$\w+\s*\)/],
    tags: ['preg_match_all', 'regex'],
  },
  {
    id: 'php-string-018',
    category: 'string',
    difficulty: 'easy',
    title: 'Format Currency with sprintf',
    text: 'Format the price as "$1,234.50" with comma thousands separator',
    setup: '$price = 1234.5;',
    setupCode: '$price = 1234.5;',
    expected: '$1,234.50',
    sample: 'sprintf("$%s", number_format($price, 2))',
    hints: ['Use number_format for comma separators, then sprintf for the dollar sign'],
    validPatterns: [
      /sprintf\s*\(\s*['"$%s'"]\s*,\s*number_format\s*\(\s*\$price\s*,\s*2\s*\)\s*\)/,
      /'\$'\s*\.\s*number_format\s*\(\s*\$price\s*,\s*2\s*\)/,
    ],
    tags: ['sprintf', 'number_format'],
  },
  {
    id: 'php-string-019',
    category: 'string',
    difficulty: 'medium',
    title: 'Pad String Both Sides',
    text: 'Center the text "PHP" within 11 characters using dashes',
    setup: '$text = "PHP";',
    setupCode: '$text = "PHP";',
    expected: '----PHP----',
    sample: 'str_pad($text, 11, "-", STR_PAD_BOTH)',
    hints: ['Use STR_PAD_BOTH to pad on both sides'],
    validPatterns: [/str_pad\s*\(\s*\$text\s*,\s*11\s*,\s*['"][-]['"]\s*,\s*STR_PAD_BOTH\s*\)/],
    tags: ['str_pad', 'STR_PAD_BOTH'],
  },
  {
    id: 'php-string-020',
    category: 'string',
    difficulty: 'medium',
    title: 'Word Wrap Text',
    text: 'Wrap the text at 20 characters per line',
    setup: '$text = "The quick brown fox jumps over the lazy dog";',
    setupCode: '$text = "The quick brown fox jumps over the lazy dog";',
    expected: 'The quick brown fox\njumps over the lazy\ndog',
    sample: 'wordwrap($text, 20, "\\n", false)',
    hints: ['Use wordwrap with width and break character'],
    validPatterns: [/wordwrap\s*\(\s*\$text\s*,\s*20/],
    tags: ['wordwrap'],
  },

  // ============================================================
  // ARRAY SORTING (5 problems)
  // ============================================================
  {
    id: 'php-sort-001',
    category: 'array',
    difficulty: 'medium',
    title: 'Sort Objects by Property',
    text: 'Sort users by age in ascending order using usort',
    setup:
      '$users = [["name" => "John", "age" => 30], ["name" => "Jane", "age" => 25], ["name" => "Bob", "age" => 35]];',
    setupCode:
      '$users = [["name" => "John", "age" => 30], ["name" => "Jane", "age" => 25], ["name" => "Bob", "age" => 35]];',
    expected: [
      { name: 'Jane', age: 25 },
      { name: 'John', age: 30 },
      { name: 'Bob', age: 35 },
    ],
    sample: 'usort($users, fn($a, $b) => $a["age"] <=> $b["age"]); $users',
    hints: ['Use usort with spaceship operator comparing the age property'],
    validPatterns: [
      /usort\s*\(\s*\$users\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\[\s*['"]age['"]\s*\]\s*<=>\s*\$\w+\s*\[\s*['"]age['"]\s*\]\s*\)/,
    ],
    tags: ['usort', 'spaceship-operator'],
  },
  {
    id: 'php-sort-002',
    category: 'array',
    difficulty: 'medium',
    title: 'Sort Associative Array by Value',
    text: 'Sort the scores array by value descending while preserving keys using uasort',
    setup: '$scores = ["Alice" => 85, "Bob" => 92, "Charlie" => 78];',
    setupCode: '$scores = ["Alice" => 85, "Bob" => 92, "Charlie" => 78];',
    expected: { Bob: 92, Alice: 85, Charlie: 78 },
    sample: 'uasort($scores, fn($a, $b) => $b <=> $a); $scores',
    hints: ['Use uasort to maintain key association while sorting by value'],
    validPatterns: [
      /uasort\s*\(\s*\$scores\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*\$\w+\s*<=>\s*\$\w+\s*\)/,
    ],
    tags: ['uasort', 'spaceship-operator'],
  },
  {
    id: 'php-sort-003',
    category: 'array',
    difficulty: 'medium',
    title: 'Sort by Key Custom Order',
    text: 'Sort the array by key length (shortest first) using uksort',
    setup: '$data = ["medium" => 2, "a" => 1, "lengthy" => 3, "xx" => 4];',
    setupCode: '$data = ["medium" => 2, "a" => 1, "lengthy" => 3, "xx" => 4];',
    expected: { a: 1, xx: 4, medium: 2, lengthy: 3 },
    sample: 'uksort($data, fn($a, $b) => strlen($a) <=> strlen($b)); $data',
    hints: ['Use uksort to sort by keys with a custom comparison function'],
    validPatterns: [
      /uksort\s*\(\s*\$data\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*strlen\s*\(\s*\$\w+\s*\)\s*<=>\s*strlen\s*\(\s*\$\w+\s*\)\s*\)/,
    ],
    tags: ['uksort', 'strlen'],
  },
  {
    id: 'php-sort-004',
    category: 'array',
    difficulty: 'hard',
    title: 'Multi-Column Sort',
    text: 'Sort users first by role (admin first), then by name alphabetically using array_multisort',
    setup:
      '$users = [["name" => "Charlie", "role" => "user"], ["name" => "Alice", "role" => "admin"], ["name" => "Bob", "role" => "admin"], ["name" => "Dave", "role" => "user"]];',
    setupCode:
      '$users = [["name" => "Charlie", "role" => "user"], ["name" => "Alice", "role" => "admin"], ["name" => "Bob", "role" => "admin"], ["name" => "Dave", "role" => "user"]];',
    expected: [
      { name: 'Alice', role: 'admin' },
      { name: 'Bob', role: 'admin' },
      { name: 'Charlie', role: 'user' },
      { name: 'Dave', role: 'user' },
    ],
    sample:
      'array_multisort(array_column($users, "role"), SORT_ASC, array_column($users, "name"), SORT_ASC, $users); $users',
    hints: [
      'Use array_multisort with array_column to extract sort columns',
      'Pass the original array last to be sorted',
    ],
    validPatterns: [/array_multisort\s*\(\s*array_column\s*\(\s*\$users\s*,\s*['"]role['"]\s*\)/],
    tags: ['array_multisort', 'array_column', 'multi-sort'],
  },
  {
    id: 'php-sort-005',
    category: 'array',
    difficulty: 'hard',
    title: 'Natural Sort Case-Insensitive',
    text: 'Sort filenames naturally and case-insensitively (img1, IMG2, img10 in correct order)',
    setup: '$files = ["img10.png", "IMG2.png", "img1.png", "Img20.png"];',
    setupCode: '$files = ["img10.png", "IMG2.png", "img1.png", "Img20.png"];',
    expected: ['img1.png', 'IMG2.png', 'img10.png', 'Img20.png'],
    sample: 'usort($files, fn($a, $b) => strnatcasecmp($a, $b)); $files',
    hints: [
      'Use strnatcasecmp for natural, case-insensitive comparison',
      'Or use natcasesort for in-place sorting',
    ],
    validPatterns: [
      /usort\s*\(\s*\$files\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*strnatcasecmp\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*\)/,
      /natcasesort\s*\(\s*\$files\s*\)/,
    ],
    tags: ['strnatcasecmp', 'natural-sort'],
  },

  // ============================================================
  // ARRAY SEARCH (5 problems)
  // ============================================================
  {
    id: 'php-search-001',
    category: 'array',
    difficulty: 'easy',
    title: 'Find Value Index',
    text: 'Find the index of "banana" in the fruits array',
    setup: '$fruits = ["apple", "banana", "cherry", "date"];',
    setupCode: '$fruits = ["apple", "banana", "cherry", "date"];',
    expected: 1,
    sample: 'array_search("banana", $fruits)',
    hints: ['Use array_search to find the key of a value'],
    validPatterns: [/array_search\s*\(\s*['"]banana['"]\s*,\s*\$fruits\s*\)/],
    tags: ['array_search'],
  },
  {
    id: 'php-search-002',
    category: 'array',
    difficulty: 'easy',
    title: 'Check Value Exists Loose',
    text: 'Check if the string "2" exists in the array (using loose comparison)',
    setup: '$nums = [1, 2, 3, 4, 5];',
    setupCode: '$nums = [1, 2, 3, 4, 5];',
    expected: true,
    sample: 'in_array("2", $nums)',
    hints: ['in_array uses loose comparison by default'],
    validPatterns: [/in_array\s*\(\s*['"]2['"]\s*,\s*\$nums\s*\)/],
    tags: ['in_array', 'loose-comparison'],
  },
  {
    id: 'php-search-003',
    category: 'array',
    difficulty: 'easy',
    title: 'Check Key Exists',
    text: 'Check if the key "email" exists in the user array',
    setup: '$user = ["name" => "John", "email" => "john@example.com", "age" => 30];',
    setupCode: '$user = ["name" => "John", "email" => "john@example.com", "age" => 30];',
    expected: true,
    sample: 'array_key_exists("email", $user)',
    hints: ['Use array_key_exists to check for key presence'],
    validPatterns: [/array_key_exists\s*\(\s*['"]email['"]\s*,\s*\$user\s*\)/],
    tags: ['array_key_exists'],
  },
  {
    id: 'php-search-004',
    category: 'array',
    difficulty: 'medium',
    title: 'Find Keys by Value',
    text: 'Find all keys where the value is "admin"',
    setup:
      '$roles = ["alice" => "admin", "bob" => "user", "charlie" => "admin", "dave" => "guest"];',
    setupCode:
      '$roles = ["alice" => "admin", "bob" => "user", "charlie" => "admin", "dave" => "guest"];',
    expected: ['alice', 'charlie'],
    sample: 'array_keys($roles, "admin")',
    hints: ['Pass a search value as second argument to array_keys'],
    validPatterns: [/array_keys\s*\(\s*\$roles\s*,\s*['"]admin['"]\s*\)/],
    tags: ['array_keys', 'search-by-value'],
  },
  {
    id: 'php-search-005',
    category: 'array',
    difficulty: 'hard',
    title: 'Find First Matching Element',
    text: 'Find the first user over 30 years old using array_filter and array key functions',
    setup:
      '$users = [["name" => "Alice", "age" => 25], ["name" => "Bob", "age" => 35], ["name" => "Charlie", "age" => 40]];',
    setupCode:
      '$users = [["name" => "Alice", "age" => 25], ["name" => "Bob", "age" => 35], ["name" => "Charlie", "age" => 40]];',
    expected: { name: 'Bob', age: 35 },
    sample:
      '$filtered = array_filter($users, fn($u) => $u["age"] > 30); $filtered[array_key_first($filtered)]',
    hints: [
      'Filter first, then use array_key_first to get the first key',
      'Or use current() on the filtered result',
    ],
    validPatterns: [
      /array_filter\s*\(\s*\$users\s*,\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*\$\w+\s*\[\s*['"]age['"]\s*\]\s*>\s*30\s*\)/,
    ],
    tags: ['array_filter', 'array_key_first'],
  },

  // ============================================================
  // JSON FUNCTIONS - Additional (5 problems)
  // ============================================================
  {
    id: 'php-json-004',
    category: 'json',
    difficulty: 'easy',
    title: 'Encode with Unicode',
    text: 'Encode an array with Unicode characters unescaped',
    setup: '$data = ["greeting" => "Hello", "emoji" => "smile"];',
    setupCode: '$data = ["greeting" => "Hello", "emoji" => "smile"];',
    expected: '{"greeting":"Hello","emoji":"smile"}',
    sample: 'json_encode($data, JSON_UNESCAPED_UNICODE)',
    hints: ['Use JSON_UNESCAPED_UNICODE to keep Unicode characters as-is'],
    validPatterns: [/json_encode\s*\(\s*\$data\s*,\s*JSON_UNESCAPED_UNICODE\s*\)/],
    tags: ['json_encode', 'JSON_UNESCAPED_UNICODE'],
  },
  {
    id: 'php-json-005',
    category: 'json',
    difficulty: 'medium',
    title: 'Encode with Multiple Flags',
    text: 'Encode data with pretty print, unescaped slashes, and unescaped unicode',
    setup: '$data = ["url" => "https://example.com/path", "name" => "Test"];',
    setupCode: '$data = ["url" => "https://example.com/path", "name" => "Test"];',
    expected: '{\n    "url": "https://example.com/path",\n    "name": "Test"\n}',
    sample:
      'json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE)',
    hints: ['Combine multiple flags with bitwise OR (|)'],
    validPatterns: [
      /json_encode\s*\(\s*\$data\s*,\s*JSON_PRETTY_PRINT\s*\|\s*JSON_UNESCAPED_SLASHES/,
    ],
    tags: ['json_encode', 'flags'],
  },
  {
    id: 'php-json-006',
    category: 'json',
    difficulty: 'medium',
    title: 'Decode to Object',
    text: 'Decode JSON string to stdClass object and access the name property',
    setup: '$json = \'{"name":"John","age":30}\';',
    setupCode: '$json = \'{"name":"John","age":30}\';',
    expected: 'John',
    sample: 'json_decode($json)->name',
    hints: ['Without the second argument, json_decode returns an object'],
    validPatterns: [/json_decode\s*\(\s*\$json\s*\)->name/],
    tags: ['json_decode', 'object'],
  },
  {
    id: 'php-json-007',
    category: 'json',
    difficulty: 'hard',
    title: 'Validate JSON Structure',
    text: 'Decode JSON and check if it has the required keys "id" and "name"',
    setup: '$json = \'{"id":1,"name":"Product","price":99.99}\';',
    setupCode: '$json = \'{"id":1,"name":"Product","price":99.99}\';',
    expected: true,
    sample:
      '($data = json_decode($json, true)) && array_key_exists("id", $data) && array_key_exists("name", $data)',
    hints: [
      'Decode first, then use array_key_exists to validate',
      'Or use isset for a simpler check',
    ],
    validPatterns: [
      /json_decode\s*\(\s*\$json\s*,\s*true\s*\).*array_key_exists/,
      /json_decode\s*\(\s*\$json\s*,\s*true\s*\).*isset/,
    ],
    tags: ['json_decode', 'array_key_exists', 'validation'],
  },
  {
    id: 'php-json-008',
    category: 'json',
    difficulty: 'hard',
    title: 'Recursive JSON Transform',
    text: 'Decode nested JSON, convert all keys to snake_case using array_walk_recursive pattern',
    setup:
      '$json = \'{"firstName":"John","lastName":"Doe","contactInfo":{"phoneNumber":"555-1234"}}\';',
    setupCode:
      '$json = \'{"firstName":"John","lastName":"Doe","contactInfo":{"phoneNumber":"555-1234"}}\';',
    expected: {
      first_name: 'John',
      last_name: 'Doe',
      contact_info: { phone_number: '555-1234' },
    },
    sample:
      'json_decode(preg_replace_callback("/"([^"]+)":/", fn($m) => \'"\' . strtolower(preg_replace("/([A-Z])/", "_$1", $m[1])) . \'":\', $json), true)',
    hints: [
      'Use preg_replace_callback to transform keys before decoding',
      'Or decode first and recursively transform the array',
    ],
    validPatterns: [/preg_replace_callback/, /json_decode.*preg_replace/],
    tags: ['json_decode', 'preg_replace_callback', 'transform'],
  },

  // ============================================================
  // STRING OPERATIONS (25 problems)
  // ============================================================

  // --- EASY (8 problems) ---
  {
    id: 'php-str-001',
    category: 'string',
    difficulty: 'easy',
    title: 'Repeat String',
    text: 'Repeat the string "PHP" 3 times to get "PHPPHPPHP"',
    setup: '$str = "PHP";',
    setupCode: '$str = "PHP";',
    expected: 'PHPPHPPHP',
    sample: 'str_repeat($str, 3)',
    hints: ['Use str_repeat to duplicate a string multiple times'],
    validPatterns: [
      /str_repeat\s*\(\s*\$str\s*,\s*3\s*\)/,
      /str_repeat\s*\(\s*['"]PHP['"]\s*,\s*3\s*\)/,
    ],
    tags: ['str_repeat', 'basic'],
  },
  {
    id: 'php-str-002',
    category: 'string',
    difficulty: 'easy',
    title: 'Capitalize First Letter of Each Word',
    text: 'Convert "hello world php" to "Hello World Php" using ucwords',
    setup: '$str = "hello world php";',
    setupCode: '$str = "hello world php";',
    expected: 'Hello World Php',
    sample: 'ucwords($str)',
    hints: ['Use ucwords to capitalize the first letter of each word'],
    validPatterns: [/ucwords\s*\(\s*\$str\s*\)/, /ucwords\s*\(\s*['"]hello world php['"]\s*\)/],
    tags: ['ucwords', 'case-conversion'],
  },
  {
    id: 'php-str-003',
    category: 'string',
    difficulty: 'easy',
    title: 'Capitalize First Character Only',
    text: 'Convert "hello world" to "Hello world" using ucfirst',
    setup: '$str = "hello world";',
    setupCode: '$str = "hello world";',
    expected: 'Hello world',
    sample: 'ucfirst($str)',
    hints: ['Use ucfirst to capitalize only the first character'],
    validPatterns: [/ucfirst\s*\(\s*\$str\s*\)/, /ucfirst\s*\(\s*['"]hello world['"]\s*\)/],
    tags: ['ucfirst', 'case-conversion'],
  },
  {
    id: 'php-str-004',
    category: 'string',
    difficulty: 'easy',
    title: 'Lowercase First Character',
    text: 'Convert "Hello World" to "hello World" using lcfirst',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 'hello World',
    sample: 'lcfirst($str)',
    hints: ['Use lcfirst to lowercase only the first character'],
    validPatterns: [/lcfirst\s*\(\s*\$str\s*\)/, /lcfirst\s*\(\s*['"]Hello World['"]\s*\)/],
    tags: ['lcfirst', 'case-conversion'],
  },
  {
    id: 'php-str-005',
    category: 'string',
    difficulty: 'easy',
    title: 'Escape HTML Special Characters',
    text: 'Convert "<script>alert(1)</script>" to safe HTML entities',
    setup: '$html = "<script>alert(1)</script>";',
    setupCode: '$html = "<script>alert(1)</script>";',
    expected: '&lt;script&gt;alert(1)&lt;/script&gt;',
    sample: 'htmlspecialchars($html)',
    hints: ['Use htmlspecialchars to prevent XSS attacks'],
    validPatterns: [
      /htmlspecialchars\s*\(\s*\$html\s*\)/,
      /htmlspecialchars\s*\(\s*\$html\s*,\s*ENT_QUOTES\s*\)/,
    ],
    tags: ['htmlspecialchars', 'security', 'html'],
  },
  {
    id: 'php-str-006',
    category: 'string',
    difficulty: 'easy',
    title: 'Strip HTML Tags',
    text: 'Remove all HTML tags from "<p>Hello <b>World</b></p>"',
    setup: '$html = "<p>Hello <b>World</b></p>";',
    setupCode: '$html = "<p>Hello <b>World</b></p>";',
    expected: 'Hello World',
    sample: 'strip_tags($html)',
    hints: ['Use strip_tags to remove all HTML and PHP tags'],
    validPatterns: [/strip_tags\s*\(\s*\$html\s*\)/],
    tags: ['strip_tags', 'html'],
  },
  {
    id: 'php-str-007',
    category: 'string',
    difficulty: 'easy',
    title: 'Format Number with Decimals',
    text: 'Format 1234567.891 with 2 decimal places and thousand separators',
    setup: '$num = 1234567.891;',
    setupCode: '$num = 1234567.891;',
    expected: '1,234,567.89',
    sample: 'number_format($num, 2)',
    hints: ['Use number_format for locale-aware number formatting'],
    validPatterns: [
      /number_format\s*\(\s*\$num\s*,\s*2\s*\)/,
      /number_format\s*\(\s*1234567\.891\s*,\s*2\s*\)/,
    ],
    tags: ['number_format', 'formatting'],
  },
  {
    id: 'php-str-008',
    category: 'string',
    difficulty: 'easy',
    title: 'Case-Insensitive String Comparison',
    text: 'Compare "Hello" and "hello" case-insensitively (should be equal)',
    setup: '$str1 = "Hello"; $str2 = "hello";',
    setupCode: '$str1 = "Hello"; $str2 = "hello";',
    expected: 0,
    sample: 'strcasecmp($str1, $str2)',
    hints: ['Use strcasecmp for case-insensitive comparison (returns 0 if equal)'],
    validPatterns: [/strcasecmp\s*\(\s*\$str1\s*,\s*\$str2\s*\)/],
    tags: ['strcasecmp', 'comparison'],
  },

  // --- MEDIUM (12 problems) ---
  {
    id: 'php-str-009',
    category: 'string',
    difficulty: 'medium',
    title: 'Replace Substring at Position',
    text: 'Replace characters 6-10 in "Hello World!" with "PHP" to get "Hello PHP!"',
    setup: '$str = "Hello World!";',
    setupCode: '$str = "Hello World!";',
    expected: 'Hello PHP!',
    sample: 'substr_replace($str, "PHP", 6, 5)',
    hints: ['Use substr_replace with position and length parameters'],
    validPatterns: [/substr_replace\s*\(\s*\$str\s*,\s*['"]PHP['"]\s*,\s*6\s*,\s*5\s*\)/],
    tags: ['substr_replace', 'manipulation'],
  },
  {
    id: 'php-str-010',
    category: 'string',
    difficulty: 'medium',
    title: 'Insert String at Position',
    text: 'Insert "Beautiful " at position 6 in "Hello World!" to get "Hello Beautiful World!"',
    setup: '$str = "Hello World!";',
    setupCode: '$str = "Hello World!";',
    expected: 'Hello Beautiful World!',
    sample: 'substr_replace($str, "Beautiful ", 6, 0)',
    hints: ['Use substr_replace with length 0 to insert without removing'],
    validPatterns: [/substr_replace\s*\(\s*\$str\s*,\s*['"]Beautiful\s*['"]\s*,\s*6\s*,\s*0\s*\)/],
    tags: ['substr_replace', 'insert'],
  },
  {
    id: 'php-str-011',
    category: 'string',
    difficulty: 'medium',
    title: 'Format String with sprintf',
    text: 'Format "User: John, Age: 25, Score: 95.5" using sprintf with placeholders',
    setup: '$name = "John"; $age = 25; $score = 95.5;',
    setupCode: '$name = "John"; $age = 25; $score = 95.5;',
    expected: 'User: John, Age: 25, Score: 95.5',
    sample: 'sprintf("User: %s, Age: %d, Score: %.1f", $name, $age, $score)',
    hints: ['Use %s for strings, %d for integers, %.1f for floats'],
    validPatterns: [
      /sprintf\s*\(\s*['"]User:\s*%s,\s*Age:\s*%d,\s*Score:\s*%.1f['"]\s*,\s*\$name\s*,\s*\$age\s*,\s*\$score\s*\)/,
    ],
    tags: ['sprintf', 'formatting'],
  },
  {
    id: 'php-str-012',
    category: 'string',
    difficulty: 'medium',
    title: 'Pad Integer with Leading Zeros',
    text: 'Format the number 42 as a 5-digit string with leading zeros: "00042"',
    setup: '$num = 42;',
    setupCode: '$num = 42;',
    expected: '00042',
    sample: 'sprintf("%05d", $num)',
    hints: ['Use %05d format specifier for zero-padded 5-digit integer'],
    validPatterns: [
      /sprintf\s*\(\s*['"]%05d['"]\s*,\s*\$num\s*\)/,
      /str_pad\s*\(\s*\$num\s*,\s*5\s*,\s*['"]0['"]\s*,\s*STR_PAD_LEFT\s*\)/,
    ],
    tags: ['sprintf', 'str_pad', 'formatting'],
  },
  {
    id: 'php-str-013',
    category: 'string',
    difficulty: 'medium',
    title: 'Extract Email with Regex',
    text: 'Extract the email address from "Contact: john.doe@example.com for info"',
    setup: '$text = "Contact: john.doe@example.com for info";',
    setupCode: '$text = "Contact: john.doe@example.com for info";',
    expected: 'john.doe@example.com',
    sample: 'preg_match("/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}/", $text, $m); $m[0]',
    hints: ['Use preg_match with email regex pattern'],
    validPatterns: [/preg_match\s*\(\s*['"]\/.*@.*\/['"]/],
    tags: ['preg_match', 'regex', 'email'],
  },
  {
    id: 'php-str-014',
    category: 'string',
    difficulty: 'medium',
    title: 'Replace All Digits',
    text: 'Replace all digits in "Phone: 123-456-7890" with "*"',
    setup: '$str = "Phone: 123-456-7890";',
    setupCode: '$str = "Phone: 123-456-7890";',
    expected: 'Phone: ***-***-****',
    sample: 'preg_replace("/\\d/", "*", $str)',
    hints: ['Use preg_replace with \\d to match digits'],
    validPatterns: [
      /preg_replace\s*\(\s*['"]\/\\d\/['"]\s*,\s*['"]\*['"]\s*,\s*\$str\s*\)/,
      /preg_replace\s*\(\s*['"]\/\[0-9\]\/['"]\s*,\s*['"]\*['"]\s*,\s*\$str\s*\)/,
    ],
    tags: ['preg_replace', 'regex'],
  },
  {
    id: 'php-str-015',
    category: 'string',
    difficulty: 'medium',
    title: 'Split by Multiple Delimiters',
    text: 'Split "apple,banana;cherry|date" by comma, semicolon, or pipe',
    setup: '$str = "apple,banana;cherry|date";',
    setupCode: '$str = "apple,banana;cherry|date";',
    expected: ['apple', 'banana', 'cherry', 'date'],
    sample: 'preg_split("/[,;|]/", $str)',
    hints: ['Use preg_split with character class for multiple delimiters'],
    validPatterns: [/preg_split\s*\(\s*['"]\/\[,;\|?\]\/['"]\s*,\s*\$str\s*\)/],
    tags: ['preg_split', 'regex'],
  },
  {
    id: 'php-str-016',
    category: 'string',
    difficulty: 'medium',
    title: 'Calculate String Similarity',
    text: 'Calculate the similarity percentage between "Hello" and "Hallo"',
    setup: '$str1 = "Hello"; $str2 = "Hallo";',
    setupCode: '$str1 = "Hello"; $str2 = "Hallo";',
    expected: 80,
    sample: 'similar_text($str1, $str2, $percent); round($percent)',
    hints: ['Use similar_text with third parameter to get percentage'],
    validPatterns: [/similar_text\s*\(\s*\$str1\s*,\s*\$str2\s*,\s*\$\w+\s*\)/],
    tags: ['similar_text', 'comparison'],
  },
  {
    id: 'php-str-017',
    category: 'string',
    difficulty: 'medium',
    title: 'Multibyte String Length',
    text: 'Get the character count of the UTF-8 string "Hello World" (with emoji)',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 12,
    sample: 'mb_strlen($str)',
    hints: ['Use mb_strlen for accurate multibyte string length'],
    validPatterns: [
      /mb_strlen\s*\(\s*\$str\s*\)/,
      /mb_strlen\s*\(\s*\$str\s*,\s*['"]UTF-?8['"]\s*\)/i,
    ],
    tags: ['mb_strlen', 'multibyte'],
  },
  {
    id: 'php-str-018',
    category: 'string',
    difficulty: 'medium',
    title: 'Multibyte Substring',
    text: 'Extract "World" from "Hello, World!" starting at position 7 for 5 characters (UTF-8 safe)',
    setup: '$str = "Hello, World!";',
    setupCode: '$str = "Hello, World!";',
    expected: 'World',
    sample: 'mb_substr($str, 7, 5)',
    hints: ['Use mb_substr for multibyte-safe substring extraction'],
    validPatterns: [/mb_substr\s*\(\s*\$str\s*,\s*7\s*,\s*5\s*\)/],
    tags: ['mb_substr', 'multibyte'],
  },
  {
    id: 'php-str-019',
    category: 'string',
    difficulty: 'medium',
    title: 'Format Array with vsprintf',
    text: 'Format "Name: John, City: NYC" using vsprintf with array of values',
    setup: '$format = "Name: %s, City: %s"; $values = ["John", "NYC"];',
    setupCode: '$format = "Name: %s, City: %s"; $values = ["John", "NYC"];',
    expected: 'Name: John, City: NYC',
    sample: 'vsprintf($format, $values)',
    hints: ['Use vsprintf when arguments are in an array'],
    validPatterns: [/vsprintf\s*\(\s*\$format\s*,\s*\$values\s*\)/],
    tags: ['vsprintf', 'formatting'],
  },
  {
    id: 'php-str-020',
    category: 'string',
    difficulty: 'medium',
    title: 'Case-Sensitive String Comparison',
    text: 'Compare "apple" and "banana" alphabetically using strcmp',
    setup: '$str1 = "apple"; $str2 = "banana";',
    setupCode: '$str1 = "apple"; $str2 = "banana";',
    expected: -1,
    sample: 'strcmp($str1, $str2) < 0 ? -1 : (strcmp($str1, $str2) > 0 ? 1 : 0)',
    hints: ['strcmp returns negative if first string is less, positive if greater, 0 if equal'],
    validPatterns: [/strcmp\s*\(\s*\$str1\s*,\s*\$str2\s*\)/],
    tags: ['strcmp', 'comparison'],
  },

  // --- HARD (5 problems) ---
  {
    id: 'php-str-021',
    category: 'string',
    difficulty: 'hard',
    title: 'Convert camelCase to snake_case with Regex',
    text: 'Convert "getUserName" to "get_user_name" using preg_replace',
    setup: '$str = "getUserName";',
    setupCode: '$str = "getUserName";',
    expected: 'get_user_name',
    sample: 'strtolower(preg_replace("/([a-z])([A-Z])/", "$1_$2", $str))',
    hints: ['Use preg_replace to insert underscore before uppercase letters'],
    validPatterns: [
      /preg_replace\s*\(\s*['"]\/\(\[a-z\]\)\(\[A-Z\]\)\/['"]\s*,\s*['"]\$1_\$2['"]/,
      /preg_replace\s*\(\s*['"]\/\(\?<=[a-z]\)\(\?=[A-Z]\)\/['"]/,
    ],
    tags: ['preg_replace', 'regex', 'case-conversion'],
  },
  {
    id: 'php-str-022',
    category: 'string',
    difficulty: 'hard',
    title: 'Extract All URLs from Text',
    text: 'Extract all URLs from "Visit https://example.com and http://test.org for more"',
    setup: '$text = "Visit https://example.com and http://test.org for more";',
    setupCode: '$text = "Visit https://example.com and http://test.org for more";',
    expected: ['https://example.com', 'http://test.org'],
    sample: 'preg_match_all("/https?:\\/\\/[^\\s]+/", $text, $matches); $matches[0]',
    hints: ['Use preg_match_all to find all matches', 'Use https? to match both http and https'],
    validPatterns: [/preg_match_all\s*\(\s*['"]\/https?\??:\\?\/\\?\//],
    tags: ['preg_match_all', 'regex', 'url'],
  },
  {
    id: 'php-str-023',
    category: 'string',
    difficulty: 'hard',
    title: 'Multibyte Title Case',
    text: 'Convert "HELLO WORLD" to title case "Hello World" preserving multibyte characters',
    setup: '$str = "HELLO WORLD";',
    setupCode: '$str = "HELLO WORLD";',
    expected: 'Hello World',
    sample: 'mb_convert_case($str, MB_CASE_TITLE)',
    hints: ['Use mb_convert_case with MB_CASE_TITLE for Unicode-safe title case'],
    validPatterns: [
      /mb_convert_case\s*\(\s*\$str\s*,\s*MB_CASE_TITLE\s*\)/,
      /mb_convert_case\s*\(\s*\$str\s*,\s*MB_CASE_TITLE\s*,\s*['"]UTF-?8['"]\s*\)/i,
    ],
    tags: ['mb_convert_case', 'multibyte', 'case-conversion'],
  },
  {
    id: 'php-str-024',
    category: 'string',
    difficulty: 'hard',
    title: 'Replace with Callback',
    text: 'Double all numbers in "Item 5 costs $10" to get "Item 10 costs $20"',
    setup: '$str = "Item 5 costs $10";',
    setupCode: '$str = "Item 5 costs $10";',
    expected: 'Item 10 costs $20',
    sample: 'preg_replace_callback("/\\d+/", fn($m) => $m[0] * 2, $str)',
    hints: ['Use preg_replace_callback with arrow function to transform matches'],
    validPatterns: [
      /preg_replace_callback\s*\(\s*['"]\/\\d\+\/['"]\s*,\s*fn\s*\(\s*\$\w+\s*\)\s*=>/,
    ],
    tags: ['preg_replace_callback', 'regex', 'callback'],
  },
  {
    id: 'php-str-025',
    category: 'string',
    difficulty: 'hard',
    title: 'European Number Format',
    text: 'Format 1234567.89 European style (dots for thousands, comma for decimal)',
    setup: '$num = 1234567.89;',
    setupCode: '$num = 1234567.89;',
    expected: '1.234.567,89',
    sample: 'number_format($num, 2, ",", ".")',
    hints: ['Use number_format with custom decimal and thousands separators'],
    validPatterns: [
      /number_format\s*\(\s*\$num\s*,\s*2\s*,\s*['"],['"],\s*['"]\.['"]s*\)/,
      /number_format\s*\(\s*1234567\.89\s*,\s*2\s*,\s*['"],['"],\s*['"]\.['"]s*\)/,
    ],
    tags: ['number_format', 'formatting', 'localization'],
  },

  // ============================================================
  // ARRAY MANIPULATION - Callbacks, Combining, Extraction, Keys (25 problems)
  // ============================================================

  // --- EASY (8 problems) ---
  {
    id: 'php-arr-001',
    category: 'array',
    difficulty: 'easy',
    title: 'Array Walk with Reference',
    text: 'Use array_walk to append " items" to each numeric value in place',
    setup: '$inventory = ["apples" => 5, "oranges" => 3, "bananas" => 7];',
    setupCode: '$inventory = ["apples" => 5, "oranges" => 3, "bananas" => 7];',
    expected: { apples: '5 items', oranges: '3 items', bananas: '7 items' },
    sample: 'array_walk($inventory, fn(&$val) => $val = "$val items"); $inventory',
    hints: [
      'Use array_walk with a reference parameter (&$val)',
      'The callback modifies values in place',
    ],
    validPatterns: [
      /array_walk\s*\(\s*\$inventory\s*,\s*fn\s*\(\s*&\$\w+\s*\)/,
      /array_walk\s*\(\s*\$inventory\s*,\s*function\s*\(\s*&\$\w+\s*\)/,
    ],
    tags: ['array_walk', 'reference', 'callback'],
  },
  {
    id: 'php-arr-002',
    category: 'array',
    difficulty: 'easy',
    title: 'Flip Keys and Values',
    text: 'Exchange keys and values in the country codes array',
    setup: '$codes = ["US" => "United States", "UK" => "United Kingdom", "CA" => "Canada"];',
    setupCode: '$codes = ["US" => "United States", "UK" => "United Kingdom", "CA" => "Canada"];',
    expected: { 'United States': 'US', 'United Kingdom': 'UK', Canada: 'CA' },
    sample: 'array_flip($codes)',
    hints: ['Use array_flip to swap keys with their associated values'],
    validPatterns: [/array_flip\s*\(\s*\$codes\s*\)/],
    tags: ['array_flip', 'keys'],
  },
  {
    id: 'php-arr-003',
    category: 'array',
    difficulty: 'easy',
    title: 'Change Keys to Lowercase',
    text: 'Convert all array keys to lowercase',
    setup: '$config = ["HOST" => "localhost", "PORT" => 3306, "USER" => "admin"];',
    setupCode: '$config = ["HOST" => "localhost", "PORT" => 3306, "USER" => "admin"];',
    expected: { host: 'localhost', port: 3306, user: 'admin' },
    sample: 'array_change_key_case($config, CASE_LOWER)',
    hints: ['Use array_change_key_case with CASE_LOWER constant'],
    validPatterns: [
      /array_change_key_case\s*\(\s*\$config\s*,\s*CASE_LOWER\s*\)/,
      /array_change_key_case\s*\(\s*\$config\s*\)/,
    ],
    tags: ['array_change_key_case', 'keys'],
  },
  {
    id: 'php-arr-004',
    category: 'array',
    difficulty: 'easy',
    title: 'Slice from Middle',
    text: 'Extract 3 elements starting from index 2',
    setup: '$letters = ["a", "b", "c", "d", "e", "f", "g"];',
    setupCode: '$letters = ["a", "b", "c", "d", "e", "f", "g"];',
    expected: ['c', 'd', 'e'],
    sample: 'array_slice($letters, 2, 3)',
    hints: ['Use array_slice with offset and length parameters'],
    validPatterns: [/array_slice\s*\(\s*\$letters\s*,\s*2\s*,\s*3\s*\)/],
    tags: ['array_slice', 'extraction'],
  },
  {
    id: 'php-arr-005',
    category: 'array',
    difficulty: 'easy',
    title: 'Chunk into Pairs',
    text: 'Split the array into chunks of 2 elements each',
    setup: '$nums = [1, 2, 3, 4, 5, 6, 7];',
    setupCode: '$nums = [1, 2, 3, 4, 5, 6, 7];',
    expected: [[1, 2], [3, 4], [5, 6], [7]],
    sample: 'array_chunk($nums, 2)',
    hints: ['Use array_chunk with size 2'],
    validPatterns: [/array_chunk\s*\(\s*\$nums\s*,\s*2\s*\)/],
    tags: ['array_chunk', 'extraction'],
  },
  {
    id: 'php-arr-006',
    category: 'array',
    difficulty: 'easy',
    title: 'Replace Values from Second Array',
    text: 'Replace values in the first array with matching keys from the second',
    setup:
      '$defaults = ["color" => "blue", "size" => "medium", "qty" => 1]; $options = ["color" => "red", "qty" => 5];',
    setupCode:
      '$defaults = ["color" => "blue", "size" => "medium", "qty" => 1]; $options = ["color" => "red", "qty" => 5];',
    expected: { color: 'red', size: 'medium', qty: 5 },
    sample: 'array_replace($defaults, $options)',
    hints: ['Use array_replace - values from later arrays overwrite earlier ones'],
    validPatterns: [/array_replace\s*\(\s*\$defaults\s*,\s*\$options\s*\)/],
    tags: ['array_replace', 'combining'],
  },
  {
    id: 'php-arr-007',
    category: 'array',
    difficulty: 'easy',
    title: 'Get Current Element with Pointer',
    text: 'Get the current element after moving the pointer with next()',
    setup: '$fruits = ["apple", "banana", "cherry"]; next($fruits);',
    setupCode: '$fruits = ["apple", "banana", "cherry"]; next($fruits);',
    expected: 'banana',
    sample: 'current($fruits)',
    hints: ['Use current() to get the element at the internal pointer position'],
    validPatterns: [/current\s*\(\s*\$fruits\s*\)/],
    tags: ['current', 'pointer'],
  },
  {
    id: 'php-arr-008',
    category: 'array',
    difficulty: 'easy',
    title: 'Get First and Last Keys',
    text: 'Get the first and last keys of the associative array',
    setup: '$data = ["a" => 1, "b" => 2, "c" => 3, "d" => 4];',
    setupCode: '$data = ["a" => 1, "b" => 2, "c" => 3, "d" => 4];',
    expected: { first: 'a', last: 'd' },
    sample: '["first" => array_key_first($data), "last" => array_key_last($data)]',
    hints: ['Use array_key_first and array_key_last (PHP 7.3+)'],
    validPatterns: [/array_key_first\s*\(\s*\$data\s*\)/, /array_key_last\s*\(\s*\$data\s*\)/],
    tags: ['array_key_first', 'array_key_last', 'keys'],
  },

  // --- MEDIUM (12 problems) ---
  {
    id: 'php-arr-009',
    category: 'array',
    difficulty: 'medium',
    title: 'Walk with Key and User Data',
    text: 'Use array_walk to format prices with currency symbol passed as user data',
    setup: '$prices = ["apple" => 1.50, "banana" => 0.75]; $currency = "$";',
    setupCode: '$prices = ["apple" => 1.50, "banana" => 0.75]; $currency = "$";',
    expected: { apple: '$1.50', banana: '$0.75' },
    sample:
      'array_walk($prices, fn(&$val, $key, $curr) => $val = $curr . number_format($val, 2), $currency); $prices',
    hints: [
      'array_walk accepts a third parameter that gets passed to the callback',
      'The callback receives value, key, and user data',
    ],
    validPatterns: [
      /array_walk\s*\(\s*\$prices\s*,\s*fn\s*\(\s*&\$\w+\s*,\s*\$\w+\s*,\s*\$\w+\s*\)/,
    ],
    tags: ['array_walk', 'callback', 'userdata'],
  },
  {
    id: 'php-arr-010',
    category: 'array',
    difficulty: 'medium',
    title: 'Merge Recursive Deep',
    text: 'Deep merge two configuration arrays, combining nested arrays',
    setup:
      '$base = ["db" => ["host" => "localhost", "options" => ["timeout" => 30]]]; $override = ["db" => ["port" => 3306, "options" => ["retry" => 3]]];',
    setupCode:
      '$base = ["db" => ["host" => "localhost", "options" => ["timeout" => 30]]]; $override = ["db" => ["port" => 3306, "options" => ["retry" => 3]]];',
    expected: {
      db: { host: 'localhost', options: { timeout: 30, retry: 3 }, port: 3306 },
    },
    sample: 'array_merge_recursive($base, $override)',
    hints: [
      'Use array_merge_recursive to deeply merge arrays',
      'Nested arrays are merged rather than replaced',
    ],
    validPatterns: [/array_merge_recursive\s*\(\s*\$base\s*,\s*\$override\s*\)/],
    tags: ['array_merge_recursive', 'combining', 'nested'],
  },
  {
    id: 'php-arr-011',
    category: 'array',
    difficulty: 'medium',
    title: 'Splice to Insert',
    text: 'Insert [10, 11, 12] at position 3 without removing any elements',
    setup: '$nums = [1, 2, 3, 6, 7, 8];',
    setupCode: '$nums = [1, 2, 3, 6, 7, 8];',
    expected: [1, 2, 3, 10, 11, 12, 6, 7, 8],
    sample: 'array_splice($nums, 3, 0, [10, 11, 12]); $nums',
    hints: ['Use array_splice with length 0 to insert without removing'],
    validPatterns: [
      /array_splice\s*\(\s*\$nums\s*,\s*3\s*,\s*0\s*,\s*\[\s*10\s*,\s*11\s*,\s*12\s*\]\s*\)/,
    ],
    tags: ['array_splice', 'insertion'],
  },
  {
    id: 'php-arr-012',
    category: 'array',
    difficulty: 'medium',
    title: 'Filter Using Both Key and Value',
    text: 'Filter array keeping elements where key starts with "active_" AND value is true',
    setup:
      '$flags = ["active_feature1" => true, "active_feature2" => false, "beta_feature" => true, "active_feature3" => true];',
    setupCode:
      '$flags = ["active_feature1" => true, "active_feature2" => false, "beta_feature" => true, "active_feature3" => true];',
    expected: { active_feature1: true, active_feature3: true },
    sample:
      'array_filter($flags, fn($val, $key) => str_starts_with($key, "active_") && $val === true, ARRAY_FILTER_USE_BOTH)',
    hints: ['Use ARRAY_FILTER_USE_BOTH to access both value and key in callback'],
    validPatterns: [
      /array_filter\s*\(\s*\$flags\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\).*ARRAY_FILTER_USE_BOTH\s*\)/,
    ],
    tags: ['array_filter', 'ARRAY_FILTER_USE_BOTH', 'callback'],
  },
  {
    id: 'php-arr-013',
    category: 'array',
    difficulty: 'medium',
    title: 'Difference by Key',
    text: 'Get elements from first array whose keys do not exist in the second array',
    setup:
      '$all = ["id" => 1, "name" => "John", "email" => "john@example.com", "password" => "secret"]; $exclude = ["password" => null, "email" => null];',
    setupCode:
      '$all = ["id" => 1, "name" => "John", "email" => "john@example.com", "password" => "secret"]; $exclude = ["password" => null, "email" => null];',
    expected: { id: 1, name: 'John' },
    sample: 'array_diff_key($all, $exclude)',
    hints: ['Use array_diff_key to exclude by key regardless of value'],
    validPatterns: [/array_diff_key\s*\(\s*\$all\s*,\s*\$exclude\s*\)/],
    tags: ['array_diff_key', 'comparison'],
  },
  {
    id: 'php-arr-014',
    category: 'array',
    difficulty: 'medium',
    title: 'Intersection by Key and Value',
    text: 'Find elements that exist in both arrays with same key AND same value',
    setup:
      '$arr1 = ["a" => 1, "b" => 2, "c" => 3]; $arr2 = ["a" => 1, "b" => 99, "c" => 3, "d" => 4];',
    setupCode:
      '$arr1 = ["a" => 1, "b" => 2, "c" => 3]; $arr2 = ["a" => 1, "b" => 99, "c" => 3, "d" => 4];',
    expected: { a: 1, c: 3 },
    sample: 'array_intersect_assoc($arr1, $arr2)',
    hints: ['Use array_intersect_assoc to compare both keys and values'],
    validPatterns: [/array_intersect_assoc\s*\(\s*\$arr1\s*,\s*\$arr2\s*\)/],
    tags: ['array_intersect_assoc', 'comparison'],
  },
  {
    id: 'php-arr-015',
    category: 'array',
    difficulty: 'medium',
    title: 'Extract Column with Index Key',
    text: 'Extract "email" values indexed by "id" from the users array',
    setup:
      '$users = [["id" => 101, "name" => "Alice", "email" => "alice@test.com"], ["id" => 102, "name" => "Bob", "email" => "bob@test.com"]];',
    setupCode:
      '$users = [["id" => 101, "name" => "Alice", "email" => "alice@test.com"], ["id" => 102, "name" => "Bob", "email" => "bob@test.com"]];',
    expected: { 101: 'alice@test.com', 102: 'bob@test.com' },
    sample: 'array_column($users, "email", "id")',
    hints: ['Use array_column with third parameter to specify index key'],
    validPatterns: [/array_column\s*\(\s*\$users\s*,\s*['"]email['"]\s*,\s*['"]id['"]\s*\)/],
    tags: ['array_column', 'multidimensional', 'extraction'],
  },
  {
    id: 'php-arr-016',
    category: 'array',
    difficulty: 'medium',
    title: 'Replace Recursive Deep',
    text: 'Recursively replace nested config values, keeping unreplaced values',
    setup:
      '$defaults = ["app" => ["name" => "MyApp", "debug" => false, "log" => ["level" => "error"]]]; $env = ["app" => ["debug" => true, "log" => ["level" => "debug"]]];',
    setupCode:
      '$defaults = ["app" => ["name" => "MyApp", "debug" => false, "log" => ["level" => "error"]]]; $env = ["app" => ["debug" => true, "log" => ["level" => "debug"]]];',
    expected: { app: { name: 'MyApp', debug: true, log: { level: 'debug' } } },
    sample: 'array_replace_recursive($defaults, $env)',
    hints: [
      'Use array_replace_recursive for deep replacement',
      'Unlike array_merge_recursive, this replaces rather than merges values',
    ],
    validPatterns: [/array_replace_recursive\s*\(\s*\$defaults\s*,\s*\$env\s*\)/],
    tags: ['array_replace_recursive', 'combining', 'nested'],
  },
  {
    id: 'php-arr-017',
    category: 'array',
    difficulty: 'medium',
    title: 'Combine Arrays to Associative',
    text: 'Create an associative array using keys from first array and values from second',
    setup:
      '$fields = ["name", "email", "phone"]; $values = ["John Doe", "john@example.com", "555-1234"];',
    setupCode:
      '$fields = ["name", "email", "phone"]; $values = ["John Doe", "john@example.com", "555-1234"];',
    expected: { name: 'John Doe', email: 'john@example.com', phone: '555-1234' },
    sample: 'array_combine($fields, $values)',
    hints: ['Use array_combine to pair keys with values from two arrays'],
    validPatterns: [/array_combine\s*\(\s*\$fields\s*,\s*\$values\s*\)/],
    tags: ['array_combine', 'combining'],
  },
  {
    id: 'php-arr-018',
    category: 'array',
    difficulty: 'medium',
    title: 'Navigate Pointer to End',
    text: 'Navigate to the last element and get its key and value',
    setup: '$data = ["first" => 100, "second" => 200, "third" => 300];',
    setupCode: '$data = ["first" => 100, "second" => 200, "third" => 300];',
    expected: { key: 'third', value: 300 },
    sample: 'end($data); ["key" => key($data), "value" => current($data)]',
    hints: [
      'Use end() to move pointer to last element',
      'Use key() and current() to get key and value at pointer',
    ],
    validPatterns: [
      /end\s*\(\s*\$data\s*\)/,
      /key\s*\(\s*\$data\s*\)/,
      /current\s*\(\s*\$data\s*\)/,
    ],
    tags: ['end', 'key', 'current', 'pointer'],
  },
  {
    id: 'php-arr-019',
    category: 'array',
    difficulty: 'medium',
    title: 'Walk Recursive Uppercase',
    text: 'Use array_walk_recursive to convert all string values to uppercase',
    setup: '$data = ["name" => "john", "address" => ["city" => "new york", "country" => "usa"]];',
    setupCode:
      '$data = ["name" => "john", "address" => ["city" => "new york", "country" => "usa"]];',
    expected: { name: 'JOHN', address: { city: 'NEW YORK', country: 'USA' } },
    sample:
      'array_walk_recursive($data, fn(&$val) => $val = is_string($val) ? strtoupper($val) : $val); $data',
    hints: [
      'Use array_walk_recursive to apply callback to all leaf elements',
      'Check if value is a string before converting',
    ],
    validPatterns: [/array_walk_recursive\s*\(\s*\$data\s*,\s*fn\s*\(\s*&\$\w+\s*\)/],
    tags: ['array_walk_recursive', 'callback', 'nested'],
  },
  {
    id: 'php-arr-020',
    category: 'array',
    difficulty: 'medium',
    title: 'Multisort by Column Descending',
    text: 'Sort the products array by price in descending order',
    setup:
      '$products = [["name" => "Widget", "price" => 25], ["name" => "Gadget", "price" => 50], ["name" => "Tool", "price" => 15]];',
    setupCode:
      '$products = [["name" => "Widget", "price" => 25], ["name" => "Gadget", "price" => 50], ["name" => "Tool", "price" => 15]];',
    expected: [
      { name: 'Gadget', price: 50 },
      { name: 'Widget', price: 25 },
      { name: 'Tool', price: 15 },
    ],
    sample: 'array_multisort(array_column($products, "price"), SORT_DESC, $products); $products',
    hints: ['Use array_multisort with array_column to sort by a specific column'],
    validPatterns: [
      /array_multisort\s*\(\s*array_column\s*\(\s*\$products\s*,\s*['"]price['"]\s*\)\s*,\s*SORT_DESC\s*,\s*\$products\s*\)/,
    ],
    tags: ['array_multisort', 'array_column', 'sorting', 'multidimensional'],
  },

  // --- HARD (5 problems) ---
  {
    id: 'php-arr-021',
    category: 'array',
    difficulty: 'hard',
    title: 'Custom Comparison Diff',
    text: 'Find elements in first array not in second using case-insensitive comparison',
    setup: '$have = ["Apple", "BANANA", "Cherry"]; $exclude = ["apple", "cherry"];',
    setupCode: '$have = ["Apple", "BANANA", "Cherry"]; $exclude = ["apple", "cherry"];',
    expected: ['BANANA'],
    sample: 'array_values(array_udiff($have, $exclude, fn($a, $b) => strcasecmp($a, $b)))',
    hints: [
      'Use array_udiff with a custom comparison callback',
      'strcasecmp performs case-insensitive string comparison',
    ],
    validPatterns: [
      /array_udiff\s*\(\s*\$have\s*,\s*\$exclude\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*strcasecmp\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*\)/,
    ],
    tags: ['array_udiff', 'comparison', 'callback'],
  },
  {
    id: 'php-arr-022',
    category: 'array',
    difficulty: 'hard',
    title: 'Group and Sum with Reduce',
    text: 'Group transactions by category and calculate totals using array_reduce',
    setup:
      '$transactions = [["category" => "food", "amount" => 25], ["category" => "transport", "amount" => 30], ["category" => "food", "amount" => 15], ["category" => "transport", "amount" => 20]];',
    setupCode:
      '$transactions = [["category" => "food", "amount" => 25], ["category" => "transport", "amount" => 30], ["category" => "food", "amount" => 15], ["category" => "transport", "amount" => 20]];',
    expected: { food: 40, transport: 50 },
    sample:
      'array_reduce($transactions, fn($acc, $t) => [...$acc, $t["category"] => ($acc[$t["category"]] ?? 0) + $t["amount"]], [])',
    hints: [
      'Use array_reduce to accumulate grouped totals',
      'Use null coalescing (??) to initialize missing keys',
    ],
    validPatterns: [/array_reduce\s*\(\s*\$transactions\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)/],
    tags: ['array_reduce', 'grouping', 'aggregation'],
  },
  {
    id: 'php-arr-023',
    category: 'array',
    difficulty: 'hard',
    title: 'Intersect with Custom Key Callback',
    text: 'Find elements with matching keys using case-insensitive key comparison',
    setup:
      '$arr1 = ["Name" => "John", "EMAIL" => "john@test.com", "Age" => 30]; $arr2 = ["name" => "Jane", "email" => "jane@test.com", "city" => "NYC"];',
    setupCode:
      '$arr1 = ["Name" => "John", "EMAIL" => "john@test.com", "Age" => 30]; $arr2 = ["name" => "Jane", "email" => "jane@test.com", "city" => "NYC"];',
    expected: { Name: 'John', EMAIL: 'john@test.com' },
    sample: 'array_intersect_ukey($arr1, $arr2, fn($a, $b) => strcasecmp($a, $b))',
    hints: [
      'Use array_intersect_ukey with a custom key comparison callback',
      'The callback compares keys, not values',
    ],
    validPatterns: [
      /array_intersect_ukey\s*\(\s*\$arr1\s*,\s*\$arr2\s*,\s*fn\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*=>\s*strcasecmp\s*\(\s*\$\w+\s*,\s*\$\w+\s*\)\s*\)/,
    ],
    tags: ['array_intersect_ukey', 'comparison', 'callback', 'keys'],
  },
  {
    id: 'php-arr-024',
    category: 'array',
    difficulty: 'hard',
    title: 'Deep Flatten Nested Array',
    text: 'Flatten an arbitrarily deep nested array into a single level array',
    setup: '$nested = [1, [2, [3, [4, 5]], 6], 7, [8, 9]];',
    setupCode: '$nested = [1, [2, [3, [4, 5]], 6], 7, [8, 9]];',
    expected: [1, 2, 3, 4, 5, 6, 7, 8, 9],
    sample:
      '$flatten = function($arr) use (&$flatten) { return array_reduce($arr, fn($carry, $item) => [...$carry, ...(is_array($item) ? $flatten($item) : [$item])], []); }; $flatten($nested)',
    hints: [
      'Use a recursive function with array_reduce',
      'Check if each item is an array and recurse if needed',
      'Use spread operator to merge results',
    ],
    validPatterns: [
      /function\s*\(\s*\$\w+\s*\)\s*use\s*\(\s*&\$\w+\s*\)/,
      /array_reduce.*is_array/,
    ],
    tags: ['array_reduce', 'recursion', 'flatten', 'nested'],
  },
  {
    id: 'php-arr-025',
    category: 'array',
    difficulty: 'hard',
    title: 'Transform Keys to Snake Case',
    text: 'Convert all camelCase keys to snake_case using array manipulation',
    setup: '$data = ["firstName" => "John", "lastName" => "Doe", "phoneNumber" => "555-1234"];',
    setupCode: '$data = ["firstName" => "John", "lastName" => "Doe", "phoneNumber" => "555-1234"];',
    expected: { first_name: 'John', last_name: 'Doe', phone_number: '555-1234' },
    sample:
      'array_combine(array_map(fn($k) => strtolower(preg_replace("/([a-z])([A-Z])/", "$1_$2", $k)), array_keys($data)), array_values($data))',
    hints: [
      'Use array_combine with transformed keys and original values',
      'Use preg_replace to insert underscores before capitals',
      'Convert the result to lowercase',
    ],
    validPatterns: [
      /array_combine\s*\(\s*array_map\s*\(\s*fn\s*\(\s*\$\w+\s*\)\s*=>\s*strtolower\s*\(\s*preg_replace/,
    ],
    tags: ['array_combine', 'array_map', 'array_keys', 'transformation'],
  },

  // ============================================================
  // CONSTRUCTOR PROPERTY PROMOTION (PHP 8.0) - 25 problems
  // ============================================================
  {
    id: 'php-cpp-200',
    category: 'constructor-promotion',
    difficulty: 'easy',
    title: 'Basic Constructor Promotion',
    text: 'Create a User class with promoted public name and email properties',
    setup: '',
    setupCode: '',
    expected:
      'class User { public function __construct(public string $name, public string $email) {} }',
    sample:
      'class User { public function __construct(public string $name, public string $email) {} }',
    hints: ['Use public keyword before parameter in constructor'],
    tags: ['constructor-promotion', 'php8'],
  },
  {
    id: 'php-cpp-201',
    category: 'constructor-promotion',
    difficulty: 'easy',
    title: 'Private Promoted Property',
    text: 'Create a BankAccount class with private promoted balance property',
    setup: '',
    setupCode: '',
    expected: 'class BankAccount { public function __construct(private float $balance) {} }',
    sample: 'class BankAccount { public function __construct(private float $balance) {} }',
    hints: ['Use private keyword before parameter'],
    tags: ['constructor-promotion', 'private', 'php8'],
  },
  {
    id: 'php-cpp-202',
    category: 'constructor-promotion',
    difficulty: 'easy',
    title: 'Protected Promoted Property',
    text: 'Create a BaseModel class with protected promoted id property',
    setup: '',
    setupCode: '',
    expected: 'class BaseModel { public function __construct(protected int $id) {} }',
    sample: 'class BaseModel { public function __construct(protected int $id) {} }',
    hints: ['Use protected keyword for inheritance access'],
    tags: ['constructor-promotion', 'protected', 'php8'],
  },
  {
    id: 'php-cpp-203',
    category: 'constructor-promotion',
    difficulty: 'easy',
    title: 'Multiple Promoted Properties',
    text: 'Create a Product class with promoted name, price, and quantity',
    setup: '',
    setupCode: '',
    expected:
      'class Product { public function __construct(public string $name, public float $price, public int $quantity) {} }',
    sample:
      'class Product { public function __construct(public string $name, public float $price, public int $quantity) {} }',
    hints: ['List multiple promoted properties separated by commas'],
    tags: ['constructor-promotion', 'php8'],
  },
  {
    id: 'php-cpp-204',
    category: 'constructor-promotion',
    difficulty: 'medium',
    title: 'Promoted with Default Value',
    text: 'Create a Config class with promoted debug property defaulting to false',
    setup: '',
    setupCode: '',
    expected: 'class Config { public function __construct(public bool $debug = false) {} }',
    sample: 'class Config { public function __construct(public bool $debug = false) {} }',
    hints: ['Add default value after the property name'],
    tags: ['constructor-promotion', 'default-value', 'php8'],
  },
  {
    id: 'php-cpp-205',
    category: 'constructor-promotion',
    difficulty: 'medium',
    title: 'Mixed Promoted and Regular',
    text: 'Create a class with promoted $name and regular parameter $validate',
    setup: '',
    setupCode: '',
    expected:
      'class Entity { public function __construct(public string $name, bool $validate = true) { if ($validate) { /* validate */ } } }',
    sample:
      'class Entity { public function __construct(public string $name, bool $validate = true) { if ($validate) { /* validate */ } } }',
    hints: ['Mix promoted and non-promoted parameters'],
    tags: ['constructor-promotion', 'php8'],
  },
  {
    id: 'php-cpp-206',
    category: 'constructor-promotion',
    difficulty: 'medium',
    title: 'Readonly Promoted Property',
    text: 'Create an ImmutablePoint class with readonly promoted x and y coordinates',
    setup: '',
    setupCode: '',
    expected:
      'class ImmutablePoint { public function __construct(public readonly int $x, public readonly int $y) {} }',
    sample:
      'class ImmutablePoint { public function __construct(public readonly int $x, public readonly int $y) {} }',
    hints: ['Combine public readonly in constructor'],
    tags: ['constructor-promotion', 'readonly', 'php81'],
  },
  {
    id: 'php-cpp-207',
    category: 'constructor-promotion',
    difficulty: 'medium',
    title: 'Nullable Promoted Property',
    text: 'Create a Customer class with nullable promoted middleName',
    setup: '',
    setupCode: '',
    expected:
      'class Customer { public function __construct(public string $firstName, public ?string $middleName = null) {} }',
    sample:
      'class Customer { public function __construct(public string $firstName, public ?string $middleName = null) {} }',
    hints: ['Use ?string for nullable type'],
    tags: ['constructor-promotion', 'nullable', 'php8'],
  },
  {
    id: 'php-cpp-208',
    category: 'constructor-promotion',
    difficulty: 'medium',
    title: 'Array Type Promoted Property',
    text: 'Create a Cart class with promoted items array property',
    setup: '',
    setupCode: '',
    expected: 'class Cart { public function __construct(public array $items = []) {} }',
    sample: 'class Cart { public function __construct(public array $items = []) {} }',
    hints: ['Use array type with empty array default'],
    tags: ['constructor-promotion', 'array', 'php8'],
  },
  {
    id: 'php-cpp-209',
    category: 'constructor-promotion',
    difficulty: 'hard',
    title: 'Union Type Promoted Property',
    text: 'Create a Response class with promoted data accepting string or array',
    setup: '',
    setupCode: '',
    expected: 'class Response { public function __construct(public string|array $data) {} }',
    sample: 'class Response { public function __construct(public string|array $data) {} }',
    hints: ['Use pipe | for union types'],
    tags: ['constructor-promotion', 'union-types', 'php8'],
  },
  {
    id: 'php-cpp-210',
    category: 'constructor-promotion',
    difficulty: 'hard',
    title: 'Promoted with Validation',
    text: 'Create Age class that validates promoted value is positive',
    setup: '',
    setupCode: '',
    expected:
      'class Age { public function __construct(public int $value) { if ($value < 0) throw new InvalidArgumentException("Age must be positive"); } }',
    sample:
      'class Age { public function __construct(public int $value) { if ($value < 0) throw new InvalidArgumentException("Age must be positive"); } }',
    hints: ['Add validation logic in constructor body'],
    tags: ['constructor-promotion', 'validation', 'php8'],
  },

  // ============================================================
  // ENUMS (PHP 8.1) - 30 problems
  // ============================================================
  {
    id: 'php-enum-211',
    category: 'enum',
    difficulty: 'easy',
    title: 'Basic Unit Enum',
    text: 'Create a Status enum with Pending, Active, and Completed cases',
    setup: '',
    setupCode: '',
    expected: 'enum Status { case Pending; case Active; case Completed; }',
    sample: 'enum Status { case Pending; case Active; case Completed; }',
    hints: ['Use enum keyword and case for each value'],
    tags: ['enum', 'php81'],
  },
  {
    id: 'php-enum-212',
    category: 'enum',
    difficulty: 'easy',
    title: 'String Backed Enum',
    text: 'Create a Color enum backed by string values',
    setup: '',
    setupCode: '',
    expected: 'enum Color: string { case Red = "red"; case Green = "green"; case Blue = "blue"; }',
    sample: 'enum Color: string { case Red = "red"; case Green = "green"; case Blue = "blue"; }',
    hints: ['Use : string after enum name for backed enum'],
    tags: ['enum', 'backed-enum', 'php81'],
  },
  {
    id: 'php-enum-213',
    category: 'enum',
    difficulty: 'easy',
    title: 'Integer Backed Enum',
    text: 'Create a Priority enum with Low=1, Medium=2, High=3',
    setup: '',
    setupCode: '',
    expected: 'enum Priority: int { case Low = 1; case Medium = 2; case High = 3; }',
    sample: 'enum Priority: int { case Low = 1; case Medium = 2; case High = 3; }',
    hints: ['Use : int for integer backed enum'],
    tags: ['enum', 'backed-enum', 'php81'],
  },
  {
    id: 'php-enum-214',
    category: 'enum',
    difficulty: 'easy',
    title: 'Get Enum Value',
    text: 'Get the string value from a backed enum case',
    setup: 'enum Status: string { case Active = "active"; case Inactive = "inactive"; }',
    setupCode: 'enum Status: string { case Active = "active"; case Inactive = "inactive"; }',
    expected: 'active',
    sample: 'Status::Active->value',
    hints: ['Use ->value to get the backed value'],
    tags: ['enum', 'value', 'php81'],
  },
  {
    id: 'php-enum-215',
    category: 'enum',
    difficulty: 'easy',
    title: 'Get Enum Name',
    text: 'Get the case name as a string',
    setup: 'enum Status: string { case Active = "active"; }',
    setupCode: 'enum Status: string { case Active = "active"; }',
    expected: 'Active',
    sample: 'Status::Active->name',
    hints: ['Use ->name to get the case name'],
    tags: ['enum', 'name', 'php81'],
  },
  {
    id: 'php-enum-216',
    category: 'enum',
    difficulty: 'medium',
    title: 'Enum from Value',
    text: 'Create an enum case from its backed value',
    setup: 'enum Status: string { case Active = "active"; case Inactive = "inactive"; }',
    setupCode: 'enum Status: string { case Active = "active"; case Inactive = "inactive"; }',
    expected: 'Status::Active',
    sample: 'Status::from("active")',
    hints: ['Use ::from() to create from value'],
    tags: ['enum', 'from', 'php81'],
  },
  {
    id: 'php-enum-217',
    category: 'enum',
    difficulty: 'medium',
    title: 'Safe Enum from Value',
    text: 'Safely try to create enum from value, returning null if invalid',
    setup: 'enum Status: string { case Active = "active"; }',
    setupCode: 'enum Status: string { case Active = "active"; }',
    expected: null,
    sample: 'Status::tryFrom("unknown")',
    hints: ['Use ::tryFrom() for safe conversion'],
    tags: ['enum', 'tryFrom', 'php81'],
  },
  {
    id: 'php-enum-218',
    category: 'enum',
    difficulty: 'medium',
    title: 'List All Enum Cases',
    text: 'Get an array of all enum cases',
    setup: 'enum Day { case Monday; case Tuesday; case Wednesday; }',
    setupCode: 'enum Day { case Monday; case Tuesday; case Wednesday; }',
    expected: ['Day::Monday', 'Day::Tuesday', 'Day::Wednesday'],
    sample: 'Day::cases()',
    hints: ['Use ::cases() to get all cases'],
    tags: ['enum', 'cases', 'php81'],
  },
  {
    id: 'php-enum-219',
    category: 'enum',
    difficulty: 'medium',
    title: 'Enum with Method',
    text: 'Create an enum with a method that returns a label',
    setup: '',
    setupCode: '',
    expected:
      'enum Status: string { case Pending = "pending"; public function label(): string { return ucfirst($this->value); } }',
    sample:
      'enum Status: string { case Pending = "pending"; public function label(): string { return ucfirst($this->value); } }',
    hints: ['Enums can have methods'],
    tags: ['enum', 'methods', 'php81'],
  },
  {
    id: 'php-enum-220',
    category: 'enum',
    difficulty: 'medium',
    title: 'Enum Implementing Interface',
    text: 'Create an enum that implements Stringable interface',
    setup: '',
    setupCode: '',
    expected:
      'enum Color: string implements Stringable { case Red = "red"; public function __toString(): string { return $this->value; } }',
    sample:
      'enum Color: string implements Stringable { case Red = "red"; public function __toString(): string { return $this->value; } }',
    hints: ['Enums can implement interfaces'],
    tags: ['enum', 'interface', 'php81'],
  },
  {
    id: 'php-enum-221',
    category: 'enum',
    difficulty: 'hard',
    title: 'Enum with Static Method',
    text: 'Create enum with static factory method',
    setup: '',
    setupCode: '',
    expected:
      'enum HttpMethod: string { case Get = "GET"; case Post = "POST"; public static function fromRequest(): self { return self::from($_SERVER["REQUEST_METHOD"] ?? "GET"); } }',
    sample:
      'enum HttpMethod: string { case Get = "GET"; case Post = "POST"; public static function fromRequest(): self { return self::from($_SERVER["REQUEST_METHOD"] ?? "GET"); } }',
    hints: ['Use static methods in enums'],
    tags: ['enum', 'static', 'php81'],
  },
  {
    id: 'php-enum-222',
    category: 'enum',
    difficulty: 'hard',
    title: 'Enum with Match Expression',
    text: 'Use match expression with enum cases',
    setup: 'enum Status { case Pending; case Active; case Completed; } $status = Status::Active;',
    setupCode:
      'enum Status { case Pending; case Active; case Completed; } $status = Status::Active;',
    expected: 'In Progress',
    sample:
      'match($status) { Status::Pending => "Waiting", Status::Active => "In Progress", Status::Completed => "Done" }',
    hints: ['Match expressions work great with enums'],
    tags: ['enum', 'match', 'php81'],
  },
  {
    id: 'php-enum-223',
    category: 'enum',
    difficulty: 'hard',
    title: 'Enum with Trait',
    text: 'Create an enum that uses a trait for shared functionality',
    setup: '',
    setupCode: '',
    expected:
      'trait Labelable { public function label(): string { return ucfirst(strtolower($this->name)); } } enum Status { use Labelable; case PENDING; case ACTIVE; }',
    sample:
      'trait Labelable { public function label(): string { return ucfirst(strtolower($this->name)); } } enum Status { use Labelable; case PENDING; case ACTIVE; }',
    hints: ['Enums can use traits'],
    tags: ['enum', 'trait', 'php81'],
  },

  // ============================================================
  // READONLY PROPERTIES (PHP 8.1/8.2) - 25 problems
  // ============================================================
  {
    id: 'php-readonly-224',
    category: 'readonly',
    difficulty: 'easy',
    title: 'Basic Readonly Property',
    text: 'Create a class with a readonly id property',
    setup: '',
    setupCode: '',
    expected:
      'class Entity { public readonly int $id; public function __construct(int $id) { $this->id = $id; } }',
    sample:
      'class Entity { public readonly int $id; public function __construct(int $id) { $this->id = $id; } }',
    hints: ['Use readonly modifier before type'],
    tags: ['readonly', 'php81'],
  },
  {
    id: 'php-readonly-225',
    category: 'readonly',
    difficulty: 'easy',
    title: 'Readonly with Promotion',
    text: 'Use constructor promotion with readonly',
    setup: '',
    setupCode: '',
    expected: 'class User { public function __construct(public readonly string $email) {} }',
    sample: 'class User { public function __construct(public readonly string $email) {} }',
    hints: ['Combine public readonly in constructor'],
    tags: ['readonly', 'constructor-promotion', 'php81'],
  },
  {
    id: 'php-readonly-226',
    category: 'readonly',
    difficulty: 'easy',
    title: 'Multiple Readonly Properties',
    text: 'Create a Point class with readonly x and y',
    setup: '',
    setupCode: '',
    expected:
      'class Point { public function __construct(public readonly float $x, public readonly float $y) {} }',
    sample:
      'class Point { public function __construct(public readonly float $x, public readonly float $y) {} }',
    hints: ['Each property needs its own readonly modifier'],
    tags: ['readonly', 'php81'],
  },
  {
    id: 'php-readonly-227',
    category: 'readonly',
    difficulty: 'medium',
    title: 'Readonly Class (PHP 8.2)',
    text: 'Create a readonly class where all properties are implicitly readonly',
    setup: '',
    setupCode: '',
    expected:
      'readonly class Config { public function __construct(public string $env, public bool $debug) {} }',
    sample:
      'readonly class Config { public function __construct(public string $env, public bool $debug) {} }',
    hints: ['Use readonly modifier on class itself in PHP 8.2'],
    tags: ['readonly', 'readonly-class', 'php82'],
  },
  {
    id: 'php-readonly-228',
    category: 'readonly',
    difficulty: 'medium',
    title: 'Readonly with Object Type',
    text: 'Create a class with readonly DateTime property',
    setup: '',
    setupCode: '',
    expected:
      'class Event { public function __construct(public readonly DateTimeImmutable $date) {} }',
    sample:
      'class Event { public function __construct(public readonly DateTimeImmutable $date) {} }',
    hints: ['Readonly works with object types'],
    tags: ['readonly', 'datetime', 'php81'],
  },
  {
    id: 'php-readonly-229',
    category: 'readonly',
    difficulty: 'medium',
    title: 'Readonly Private Property',
    text: 'Create a class with private readonly property and getter',
    setup: '',
    setupCode: '',
    expected:
      'class Secret { public function __construct(private readonly string $value) {} public function getValue(): string { return $this->value; } }',
    sample:
      'class Secret { public function __construct(private readonly string $value) {} public function getValue(): string { return $this->value; } }',
    hints: ['Readonly can be combined with private'],
    tags: ['readonly', 'private', 'php81'],
  },
  {
    id: 'php-readonly-230',
    category: 'readonly',
    difficulty: 'hard',
    title: 'Readonly with Clone',
    text: 'Create a readonly class with a method that returns a modified clone',
    setup: '',
    setupCode: '',
    expected:
      'readonly class Money { public function __construct(public int $amount, public string $currency) {} public function add(int $value): self { return new self($this->amount + $value, $this->currency); } }',
    sample:
      'readonly class Money { public function __construct(public int $amount, public string $currency) {} public function add(int $value): self { return new self($this->amount + $value, $this->currency); } }',
    hints: ['Create new instance instead of modifying readonly'],
    tags: ['readonly', 'immutable', 'php82'],
  },

  // ============================================================
  // UNION TYPES (PHP 8.0) - 20 problems
  // ============================================================
  {
    id: 'php-union-231',
    category: 'union-types',
    difficulty: 'easy',
    title: 'Basic Union Type',
    text: 'Create a function that accepts int or float',
    setup: '',
    setupCode: '',
    expected: 'function double(int|float $value): int|float { return $value * 2; }',
    sample: 'function double(int|float $value): int|float { return $value * 2; }',
    hints: ['Use pipe | to separate types'],
    tags: ['union-types', 'php8'],
  },
  {
    id: 'php-union-232',
    category: 'union-types',
    difficulty: 'easy',
    title: 'Union with Null',
    text: 'Create a function accepting string or null',
    setup: '',
    setupCode: '',
    expected:
      'function greet(string|null $name): string { return "Hello, " . ($name ?? "Guest"); }',
    sample: 'function greet(string|null $name): string { return "Hello, " . ($name ?? "Guest"); }',
    hints: ['string|null is equivalent to ?string'],
    tags: ['union-types', 'nullable', 'php8'],
  },
  {
    id: 'php-union-233',
    category: 'union-types',
    difficulty: 'medium',
    title: 'Union Property Type',
    text: 'Create a class property that can hold array or object',
    setup: '',
    setupCode: '',
    expected: 'class Container { public array|object $data; }',
    sample: 'class Container { public array|object $data; }',
    hints: ['Union types work on properties too'],
    tags: ['union-types', 'property', 'php8'],
  },
  {
    id: 'php-union-234',
    category: 'union-types',
    difficulty: 'medium',
    title: 'Union Return Type',
    text: 'Create a function that returns string or false',
    setup: '',
    setupCode: '',
    expected: 'function findUser(int $id): string|false { return $id > 0 ? "User $id" : false; }',
    sample: 'function findUser(int $id): string|false { return $id > 0 ? "User $id" : false; }',
    hints: ['false can be used in unions'],
    tags: ['union-types', 'return-type', 'php8'],
  },
  {
    id: 'php-union-235',
    category: 'union-types',
    difficulty: 'hard',
    title: 'Union with Classes',
    text: 'Create a function accepting multiple class types',
    setup: 'class Dog {} class Cat {}',
    setupCode: 'class Dog {} class Cat {}',
    expected: 'function pet(Dog|Cat $animal): string { return "Petting a " . get_class($animal); }',
    sample: 'function pet(Dog|Cat $animal): string { return "Petting a " . get_class($animal); }',
    hints: ['Union types work with class names'],
    tags: ['union-types', 'classes', 'php8'],
  },

  // ============================================================
  // INTERSECTION TYPES (PHP 8.1) - 15 problems
  // ============================================================
  {
    id: 'php-intersection-236',
    category: 'intersection-types',
    difficulty: 'medium',
    title: 'Basic Intersection Type',
    text: 'Create a function requiring both Countable and Iterator',
    setup: '',
    setupCode: '',
    expected: 'function process(Countable&Iterator $items): int { return count($items); }',
    sample: 'function process(Countable&Iterator $items): int { return count($items); }',
    hints: ['Use & for intersection types'],
    tags: ['intersection-types', 'php81'],
  },
  {
    id: 'php-intersection-237',
    category: 'intersection-types',
    difficulty: 'medium',
    title: 'Intersection Property',
    text: 'Create a class with intersection type property',
    setup: 'interface Renderable {} interface Cacheable {}',
    setupCode: 'interface Renderable {} interface Cacheable {}',
    expected: 'class View { public Renderable&Cacheable $template; }',
    sample: 'class View { public Renderable&Cacheable $template; }',
    hints: ['Intersection works on properties'],
    tags: ['intersection-types', 'php81'],
  },
  {
    id: 'php-intersection-238',
    category: 'intersection-types',
    difficulty: 'hard',
    title: 'Intersection Return Type',
    text: 'Create a factory returning intersection type',
    setup: 'interface Serializable {} interface JsonSerializable {}',
    setupCode: 'interface Serializable {} interface JsonSerializable {}',
    expected:
      'function createSerializer(): Serializable&JsonSerializable { return new class implements Serializable, JsonSerializable { public function jsonSerialize(): mixed { return []; } }; }',
    sample:
      'function createSerializer(): Serializable&JsonSerializable { return new class implements Serializable, JsonSerializable { public function jsonSerialize(): mixed { return []; } }; }',
    hints: ['Return type can be intersection'],
    tags: ['intersection-types', 'php81'],
  },

  // ============================================================
  // MATCH EXPRESSION (PHP 8.0) - 20 problems
  // ============================================================
  {
    id: 'php-match-239',
    category: 'match',
    difficulty: 'easy',
    title: 'Basic Match Expression',
    text: 'Use match to return day name from number',
    setup: '$day = 1;',
    setupCode: '$day = 1;',
    expected: 'Monday',
    sample: 'match($day) { 1 => "Monday", 2 => "Tuesday", 3 => "Wednesday", default => "Unknown" }',
    hints: ['Match returns a value and uses strict comparison'],
    tags: ['match', 'php8'],
  },
  {
    id: 'php-match-240',
    category: 'match',
    difficulty: 'easy',
    title: 'Match Multiple Conditions',
    text: 'Match multiple values to same result',
    setup: '$day = 6;',
    setupCode: '$day = 6;',
    expected: 'Weekend',
    sample: 'match($day) { 1, 2, 3, 4, 5 => "Weekday", 6, 7 => "Weekend" }',
    hints: ['Comma-separate values for same result'],
    tags: ['match', 'php8'],
  },
  {
    id: 'php-match-241',
    category: 'match',
    difficulty: 'medium',
    title: 'Match with Default',
    text: 'Use match with default for unknown values',
    setup: '$status = 999;',
    setupCode: '$status = 999;',
    expected: 'Unknown Status',
    sample:
      'match($status) { 200 => "OK", 404 => "Not Found", 500 => "Error", default => "Unknown Status" }',
    hints: ['Use default for fallback'],
    tags: ['match', 'default', 'php8'],
  },
  {
    id: 'php-match-242',
    category: 'match',
    difficulty: 'medium',
    title: 'Match with Expression Arms',
    text: 'Use expressions in match arms',
    setup: '$score = 85;',
    setupCode: '$score = 85;',
    expected: 'B',
    sample:
      'match(true) { $score >= 90 => "A", $score >= 80 => "B", $score >= 70 => "C", default => "F" }',
    hints: ['Match on true for expression conditions'],
    tags: ['match', 'expression', 'php8'],
  },
  {
    id: 'php-match-243',
    category: 'match',
    difficulty: 'hard',
    title: 'Match with Callable Arms',
    text: 'Use match to select and call different functions',
    setup: '$op = "add"; $a = 5; $b = 3;',
    setupCode: '$op = "add"; $a = 5; $b = 3;',
    expected: 8,
    sample: 'match($op) { "add" => $a + $b, "sub" => $a - $b, "mul" => $a * $b, "div" => $a / $b }',
    hints: ['Each arm can be any expression'],
    tags: ['match', 'callable', 'php8'],
  },

  // ============================================================
  // NAMED ARGUMENTS (PHP 8.0) - 15 problems
  // ============================================================
  {
    id: 'php-named-244',
    category: 'named-arguments',
    difficulty: 'easy',
    title: 'Basic Named Arguments',
    text: 'Call str_pad with named arguments',
    setup: '$str = "PHP";',
    setupCode: '$str = "PHP";',
    expected: '...PHP...',
    sample: 'str_pad(string: $str, length: 9, pad_string: ".", pad_type: STR_PAD_BOTH)',
    hints: ['Use name: value syntax'],
    tags: ['named-arguments', 'php8'],
  },
  {
    id: 'php-named-245',
    category: 'named-arguments',
    difficulty: 'easy',
    title: 'Skip Optional Parameters',
    text: 'Use named arguments to skip optional parameters',
    setup: '',
    setupCode: '',
    expected:
      'function greet(string $name, string $greeting = "Hello", string $punctuation = "!"): string { return "$greeting, $name$punctuation"; } greet(name: "World", punctuation: "?")',
    sample: 'greet(name: "World", punctuation: "?")',
    hints: ['Named arguments let you skip defaults'],
    tags: ['named-arguments', 'php8'],
  },
  {
    id: 'php-named-246',
    category: 'named-arguments',
    difficulty: 'medium',
    title: 'Named with Array Spread',
    text: 'Use named arguments with array spread',
    setup: '$args = ["length" => 10, "pad_string" => "*"];',
    setupCode: '$args = ["length" => 10, "pad_string" => "*"];',
    expected: '***PHP****',
    sample: 'str_pad("PHP", ...$args, pad_type: STR_PAD_BOTH)',
    hints: ['Spread named arrays with ...'],
    tags: ['named-arguments', 'spread', 'php8'],
  },

  // ============================================================
  // ATTRIBUTES (PHP 8.0) - 20 problems
  // ============================================================
  {
    id: 'php-attr-247',
    category: 'attributes',
    difficulty: 'easy',
    title: 'Basic Attribute',
    text: 'Create a simple Route attribute',
    setup: '',
    setupCode: '',
    expected: '#[Attribute] class Route { public function __construct(public string $path) {} }',
    sample: '#[Attribute] class Route { public function __construct(public string $path) {} }',
    hints: ['Use #[Attribute] to mark as attribute'],
    tags: ['attributes', 'php8'],
  },
  {
    id: 'php-attr-248',
    category: 'attributes',
    difficulty: 'easy',
    title: 'Apply Attribute to Method',
    text: 'Apply Route attribute to a controller method',
    setup: '#[Attribute] class Route { public function __construct(public string $path) {} }',
    setupCode: '#[Attribute] class Route { public function __construct(public string $path) {} }',
    expected: 'class UserController { #[Route("/users")] public function index() {} }',
    sample: 'class UserController { #[Route("/users")] public function index() {} }',
    hints: ['Place attribute before method'],
    tags: ['attributes', 'method', 'php8'],
  },
  {
    id: 'php-attr-249',
    category: 'attributes',
    difficulty: 'medium',
    title: 'Multiple Attributes',
    text: 'Apply multiple attributes to a property',
    setup: '',
    setupCode: '',
    expected: 'class User { #[Required] #[MaxLength(255)] public string $email; }',
    sample: 'class User { #[Required] #[MaxLength(255)] public string $email; }',
    hints: ['Stack multiple attributes'],
    tags: ['attributes', 'property', 'php8'],
  },
  {
    id: 'php-attr-250',
    category: 'attributes',
    difficulty: 'hard',
    title: 'Read Attributes via Reflection',
    text: 'Read attributes from a class method using reflection',
    setup:
      '#[Attribute] class Route { public function __construct(public string $path) {} } class Controller { #[Route("/home")] public function home() {} }',
    setupCode:
      '#[Attribute] class Route { public function __construct(public string $path) {} } class Controller { #[Route("/home")] public function home() {} }',
    expected: '/home',
    sample:
      '(new ReflectionMethod(Controller::class, "home"))->getAttributes(Route::class)[0]->newInstance()->path',
    hints: ['Use ReflectionMethod and getAttributes'],
    tags: ['attributes', 'reflection', 'php8'],
  },

  // ============================================================
  // FIBERS (PHP 8.1) - 15 problems
  // ============================================================
  {
    id: 'php-fiber-251',
    category: 'fibers',
    difficulty: 'medium',
    title: 'Basic Fiber Creation',
    text: 'Create a simple fiber that suspends and resumes',
    setup: '',
    setupCode: '',
    expected:
      '$fiber = new Fiber(function(): void { $value = Fiber::suspend("suspended"); echo $value; });',
    sample:
      '$fiber = new Fiber(function(): void { $value = Fiber::suspend("suspended"); echo $value; });',
    hints: ['Use new Fiber with a callable'],
    tags: ['fibers', 'php81'],
  },
  {
    id: 'php-fiber-252',
    category: 'fibers',
    difficulty: 'medium',
    title: 'Start and Resume Fiber',
    text: 'Start a fiber and resume it with a value',
    setup: '$fiber = new Fiber(fn() => Fiber::suspend("paused"));',
    setupCode: '$fiber = new Fiber(fn() => Fiber::suspend("paused"));',
    expected: 'paused',
    sample: '$result = $fiber->start(); $fiber->resume("continue"); $result',
    hints: ['Use start() then resume()'],
    tags: ['fibers', 'php81'],
  },
  {
    id: 'php-fiber-253',
    category: 'fibers',
    difficulty: 'hard',
    title: 'Fiber with Return Value',
    text: 'Get the return value from a completed fiber',
    setup: '$fiber = new Fiber(fn() => "completed");',
    setupCode: '$fiber = new Fiber(fn() => "completed");',
    expected: 'completed',
    sample: '$fiber->start(); $fiber->getReturn()',
    hints: ['Use getReturn() after fiber completes'],
    tags: ['fibers', 'return', 'php81'],
  },
  {
    id: 'php-fiber-254',
    category: 'fibers',
    difficulty: 'hard',
    title: 'Check Fiber Status',
    text: 'Check if a fiber is suspended',
    setup: '$fiber = new Fiber(fn() => Fiber::suspend()); $fiber->start();',
    setupCode: '$fiber = new Fiber(fn() => Fiber::suspend()); $fiber->start();',
    expected: true,
    sample: '$fiber->isSuspended()',
    hints: ['Use isSuspended() to check state'],
    tags: ['fibers', 'status', 'php81'],
  },

  // ============================================================
  // CLOSURES (20 problems)
  // ============================================================
  {
    id: 'php-closure-255',
    category: 'closures',
    difficulty: 'easy',
    title: 'Basic Closure',
    text: 'Create a closure that adds two numbers',
    setup: '',
    setupCode: '',
    expected: '$add = fn($a, $b) => $a + $b; $add(2, 3)',
    sample: '$add = fn($a, $b) => $a + $b; $add(2, 3)',
    hints: ['Use arrow function syntax'],
    tags: ['closures', 'arrow-function'],
  },
  {
    id: 'php-closure-256',
    category: 'closures',
    difficulty: 'easy',
    title: 'Closure with Use',
    text: 'Create a closure that captures an external variable',
    setup: '$multiplier = 3;',
    setupCode: '$multiplier = 3;',
    expected: 9,
    sample: '$triple = function($n) use ($multiplier) { return $n * $multiplier; }; $triple(3)',
    hints: ['Use "use" keyword to capture variables'],
    tags: ['closures', 'use'],
  },
  {
    id: 'php-closure-257',
    category: 'closures',
    difficulty: 'medium',
    title: 'First-Class Callable',
    text: 'Create a first-class callable from strlen function',
    setup: '',
    setupCode: '',
    expected: 5,
    sample: '$len = strlen(...); $len("hello")',
    hints: ['Use function_name(...) syntax'],
    tags: ['closures', 'first-class-callable', 'php81'],
  },
  {
    id: 'php-closure-258',
    category: 'closures',
    difficulty: 'medium',
    title: 'Closure Bind',
    text: 'Bind a closure to a different object scope',
    setup: 'class Counter { private int $count = 0; } $counter = new Counter();',
    setupCode: 'class Counter { private int $count = 0; } $counter = new Counter();',
    expected: 1,
    sample:
      '$increment = Closure::bind(function() { return ++$this->count; }, $counter, Counter::class); $increment()',
    hints: ['Use Closure::bind to change scope'],
    tags: ['closures', 'bind'],
  },
  {
    id: 'php-closure-259',
    category: 'closures',
    difficulty: 'hard',
    title: 'Closure from Callable',
    text: 'Convert a callable string to a Closure',
    setup: 'class Math { public static function double(int $n): int { return $n * 2; } }',
    setupCode: 'class Math { public static function double(int $n): int { return $n * 2; } }',
    expected: 10,
    sample: '$double = Closure::fromCallable([Math::class, "double"]); $double(5)',
    hints: ['Use Closure::fromCallable'],
    tags: ['closures', 'fromCallable'],
  },

  // ============================================================
  // GENERATORS (20 problems)
  // ============================================================
  {
    id: 'php-gen-260',
    category: 'generators',
    difficulty: 'easy',
    title: 'Basic Generator',
    text: 'Create a generator that yields 1, 2, 3',
    setup: '',
    setupCode: '',
    expected: [1, 2, 3],
    sample: 'function nums() { yield 1; yield 2; yield 3; } iterator_to_array(nums())',
    hints: ['Use yield keyword'],
    tags: ['generators', 'yield'],
  },
  {
    id: 'php-gen-261',
    category: 'generators',
    difficulty: 'easy',
    title: 'Generator Range',
    text: 'Create a generator for range 1 to 5',
    setup: '',
    setupCode: '',
    expected: [1, 2, 3, 4, 5],
    sample:
      'function xrange($start, $end) { for ($i = $start; $i <= $end; $i++) { yield $i; } } iterator_to_array(xrange(1, 5))',
    hints: ['Yield inside a loop'],
    tags: ['generators', 'range'],
  },
  {
    id: 'php-gen-262',
    category: 'generators',
    difficulty: 'medium',
    title: 'Generator with Keys',
    text: 'Create a generator yielding key-value pairs',
    setup: '',
    setupCode: '',
    expected: { a: 1, b: 2 },
    sample: 'function pairs() { yield "a" => 1; yield "b" => 2; } iterator_to_array(pairs())',
    hints: ['Use yield key => value'],
    tags: ['generators', 'keys'],
  },
  {
    id: 'php-gen-263',
    category: 'generators',
    difficulty: 'medium',
    title: 'Yield From',
    text: 'Use yield from to delegate to another generator',
    setup: '',
    setupCode: '',
    expected: [1, 2, 3, 4],
    sample:
      'function inner() { yield 2; yield 3; } function outer() { yield 1; yield from inner(); yield 4; } iterator_to_array(outer())',
    hints: ['Use yield from for delegation'],
    tags: ['generators', 'yield-from'],
  },
  {
    id: 'php-gen-264',
    category: 'generators',
    difficulty: 'hard',
    title: 'Generator Return Value',
    text: 'Get the return value from a generator',
    setup: '',
    setupCode: '',
    expected: 'done',
    sample:
      'function gen() { yield 1; return "done"; } $g = gen(); foreach($g as $v) {} $g->getReturn()',
    hints: ['Use getReturn() after iteration'],
    tags: ['generators', 'return'],
  },

  // ============================================================
  // DATETIME (25 problems)
  // ============================================================
  {
    id: 'php-dt-265',
    category: 'datetime',
    difficulty: 'easy',
    title: 'Create DateTimeImmutable',
    text: 'Create a DateTimeImmutable for 2024-01-15',
    setup: '',
    setupCode: '',
    expected: '2024-01-15',
    sample: '(new DateTimeImmutable("2024-01-15"))->format("Y-m-d")',
    hints: ['Use new DateTimeImmutable'],
    tags: ['datetime', 'DateTimeImmutable'],
  },
  {
    id: 'php-dt-266',
    category: 'datetime',
    difficulty: 'easy',
    title: 'Current DateTime',
    text: 'Get current date formatted as Y-m-d',
    setup: '',
    setupCode: '',
    expected: 'current date',
    sample: '(new DateTimeImmutable())->format("Y-m-d")',
    hints: ['Omit parameter for now'],
    tags: ['datetime', 'format'],
  },
  {
    id: 'php-dt-267',
    category: 'datetime',
    difficulty: 'easy',
    title: 'Add Days',
    text: 'Add 7 days to a date',
    setup: '$date = new DateTimeImmutable("2024-01-15");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15");',
    expected: '2024-01-22',
    sample: '$date->modify("+7 days")->format("Y-m-d")',
    hints: ['Use modify with relative format'],
    tags: ['datetime', 'modify'],
  },
  {
    id: 'php-dt-268',
    category: 'datetime',
    difficulty: 'medium',
    title: 'DateInterval Creation',
    text: 'Create a 2 week interval',
    setup: '',
    setupCode: '',
    expected: 'P2W',
    sample: '(new DateInterval("P2W"))->format("%d days")',
    hints: ['Use ISO 8601 duration format'],
    tags: ['datetime', 'DateInterval'],
  },
  {
    id: 'php-dt-269',
    category: 'datetime',
    difficulty: 'medium',
    title: 'Date Difference',
    text: 'Calculate days between two dates',
    setup:
      '$date1 = new DateTimeImmutable("2024-01-01"); $date2 = new DateTimeImmutable("2024-01-15");',
    setupCode:
      '$date1 = new DateTimeImmutable("2024-01-01"); $date2 = new DateTimeImmutable("2024-01-15");',
    expected: 14,
    sample: '$date1->diff($date2)->days',
    hints: ['Use diff method'],
    tags: ['datetime', 'diff'],
  },
  {
    id: 'php-dt-270',
    category: 'datetime',
    difficulty: 'medium',
    title: 'DatePeriod',
    text: 'Generate all dates in January 2024',
    setup: '',
    setupCode: '',
    expected: 31,
    sample:
      'iterator_count(new DatePeriod(new DateTimeImmutable("2024-01-01"), new DateInterval("P1D"), new DateTimeImmutable("2024-02-01")))',
    hints: ['Use DatePeriod for ranges'],
    tags: ['datetime', 'DatePeriod'],
  },
  {
    id: 'php-dt-271',
    category: 'datetime',
    difficulty: 'hard',
    title: 'Timezone Conversion',
    text: 'Convert UTC time to America/New_York',
    setup: '$utc = new DateTimeImmutable("2024-01-15 12:00:00", new DateTimeZone("UTC"));',
    setupCode: '$utc = new DateTimeImmutable("2024-01-15 12:00:00", new DateTimeZone("UTC"));',
    expected: '07:00:00',
    sample: '$utc->setTimezone(new DateTimeZone("America/New_York"))->format("H:i:s")',
    hints: ['Use setTimezone'],
    tags: ['datetime', 'timezone'],
  },

  // ============================================================
  // JSON (20 problems)
  // ============================================================
  {
    id: 'php-json-272',
    category: 'json',
    difficulty: 'easy',
    title: 'Encode Array',
    text: 'Encode an array to JSON',
    setup: '$data = ["name" => "John", "age" => 30];',
    setupCode: '$data = ["name" => "John", "age" => 30];',
    expected: '{"name":"John","age":30}',
    sample: 'json_encode($data)',
    hints: ['Use json_encode'],
    tags: ['json', 'encode'],
  },
  {
    id: 'php-json-273',
    category: 'json',
    difficulty: 'easy',
    title: 'Decode to Array',
    text: 'Decode JSON to associative array',
    setup: '$json = \'{"name":"John"}\';',
    setupCode: '$json = \'{"name":"John"}\';',
    expected: { name: 'John' },
    sample: 'json_decode($json, true)',
    hints: ['Pass true for associative array'],
    tags: ['json', 'decode'],
  },
  {
    id: 'php-json-274',
    category: 'json',
    difficulty: 'medium',
    title: 'JsonSerializable Interface',
    text: 'Implement JsonSerializable for custom encoding',
    setup: '',
    setupCode: '',
    expected:
      'class User implements JsonSerializable { public function __construct(private string $name) {} public function jsonSerialize(): mixed { return ["user" => $this->name]; } }',
    sample:
      'class User implements JsonSerializable { public function __construct(private string $name) {} public function jsonSerialize(): mixed { return ["user" => $this->name]; } }',
    hints: ['Implement jsonSerialize method'],
    tags: ['json', 'JsonSerializable'],
  },
  {
    id: 'php-json-275',
    category: 'json',
    difficulty: 'medium',
    title: 'JSON Encode Flags',
    text: 'Encode with multiple flags',
    setup: '$data = ["url" => "https://example.com"];',
    setupCode: '$data = ["url" => "https://example.com"];',
    expected: '{\n    "url": "https://example.com"\n}',
    sample: 'json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES)',
    hints: ['Combine flags with |'],
    tags: ['json', 'flags'],
  },
  {
    id: 'php-json-276',
    category: 'json',
    difficulty: 'hard',
    title: 'JSON Validate (PHP 8.3)',
    text: 'Validate JSON string without decoding',
    setup: '$json = \'{"valid":true}\';',
    setupCode: '$json = \'{"valid":true}\';',
    expected: true,
    sample: 'json_validate($json)',
    hints: ['Use json_validate in PHP 8.3+'],
    tags: ['json', 'validate', 'php83'],
  },

  // ============================================================
  // REGULAR EXPRESSIONS (25 problems)
  // ============================================================
  {
    id: 'php-regex-277',
    category: 'regex',
    difficulty: 'easy',
    title: 'Simple Match',
    text: 'Check if string contains a digit',
    setup: '$str = "abc123";',
    setupCode: '$str = "abc123";',
    expected: 1,
    sample: 'preg_match("/\\d/", $str)',
    hints: ['Use \\d for digit'],
    tags: ['regex', 'preg_match'],
  },
  {
    id: 'php-regex-278',
    category: 'regex',
    difficulty: 'easy',
    title: 'Match All',
    text: 'Find all words in a string',
    setup: '$str = "Hello World PHP";',
    setupCode: '$str = "Hello World PHP";',
    expected: ['Hello', 'World', 'PHP'],
    sample: 'preg_match_all("/\\w+/", $str, $m); $m[0]',
    hints: ['Use preg_match_all'],
    tags: ['regex', 'preg_match_all'],
  },
  {
    id: 'php-regex-279',
    category: 'regex',
    difficulty: 'medium',
    title: 'Replace with Pattern',
    text: 'Remove all non-alphanumeric characters',
    setup: '$str = "Hello, World! 123";',
    setupCode: '$str = "Hello, World! 123";',
    expected: 'HelloWorld123',
    sample: 'preg_replace("/[^a-zA-Z0-9]/", "", $str)',
    hints: ['Use negated character class'],
    tags: ['regex', 'preg_replace'],
  },
  {
    id: 'php-regex-280',
    category: 'regex',
    difficulty: 'medium',
    title: 'Capture Groups',
    text: 'Extract area code from phone number',
    setup: '$phone = "(555) 123-4567";',
    setupCode: '$phone = "(555) 123-4567";',
    expected: '555',
    sample: 'preg_match("/\\((\\d{3})\\)/", $phone, $m); $m[1]',
    hints: ['Use parentheses for capture groups'],
    tags: ['regex', 'capture-groups'],
  },
  {
    id: 'php-regex-281',
    category: 'regex',
    difficulty: 'hard',
    title: 'Replace Callback',
    text: 'Uppercase all words starting with "a"',
    setup: '$str = "apple and apricot are amazing";',
    setupCode: '$str = "apple and apricot are amazing";',
    expected: 'APPLE AND APRICOT are AMAZING',
    sample: 'preg_replace_callback("/\\ba\\w*/i", fn($m) => strtoupper($m[0]), $str)',
    hints: ['Use preg_replace_callback'],
    tags: ['regex', 'preg_replace_callback'],
  },

  // ============================================================
  // FILE OPERATIONS (20 problems)
  // ============================================================
  {
    id: 'php-file-282',
    category: 'file',
    difficulty: 'easy',
    title: 'Read File Contents',
    text: 'Read entire file into a string',
    setup: '$path = "/tmp/test.txt";',
    setupCode: '$path = "/tmp/test.txt";',
    expected: 'file contents',
    sample: 'file_get_contents($path)',
    hints: ['Use file_get_contents'],
    tags: ['file', 'file_get_contents'],
  },
  {
    id: 'php-file-283',
    category: 'file',
    difficulty: 'easy',
    title: 'Write File',
    text: 'Write string to a file',
    setup: '$path = "/tmp/output.txt"; $data = "Hello";',
    setupCode: '$path = "/tmp/output.txt"; $data = "Hello";',
    expected: 5,
    sample: 'file_put_contents($path, $data)',
    hints: ['Returns bytes written'],
    tags: ['file', 'file_put_contents'],
  },
  {
    id: 'php-file-284',
    category: 'file',
    difficulty: 'medium',
    title: 'SplFileInfo',
    text: 'Get file extension using SplFileInfo',
    setup: '$file = new SplFileInfo("/path/to/file.txt");',
    setupCode: '$file = new SplFileInfo("/path/to/file.txt");',
    expected: 'txt',
    sample: '$file->getExtension()',
    hints: ['Use getExtension method'],
    tags: ['file', 'SplFileInfo'],
  },
  {
    id: 'php-file-285',
    category: 'file',
    difficulty: 'medium',
    title: 'Append to File',
    text: 'Append content to existing file',
    setup: '$path = "/tmp/log.txt"; $data = "new line\\n";',
    setupCode: '$path = "/tmp/log.txt"; $data = "new line\\n";',
    expected: 'bytes written',
    sample: 'file_put_contents($path, $data, FILE_APPEND)',
    hints: ['Use FILE_APPEND flag'],
    tags: ['file', 'append'],
  },
  {
    id: 'php-file-286',
    category: 'file',
    difficulty: 'hard',
    title: 'Directory Iterator',
    text: 'List PHP files in a directory',
    setup: '$dir = "/path/to/dir";',
    setupCode: '$dir = "/path/to/dir";',
    expected: 'array of php files',
    sample:
      'array_filter(iterator_to_array(new DirectoryIterator($dir)), fn($f) => $f->getExtension() === "php")',
    hints: ['Use DirectoryIterator'],
    tags: ['file', 'DirectoryIterator'],
  },

  // ============================================================
  // COLLECTIONS (SPL) - 20 problems
  // ============================================================
  {
    id: 'php-spl-287',
    category: 'collections',
    difficulty: 'easy',
    title: 'ArrayObject Creation',
    text: 'Create an ArrayObject from an array',
    setup: '$arr = [1, 2, 3];',
    setupCode: '$arr = [1, 2, 3];',
    expected: 3,
    sample: '(new ArrayObject($arr))->count()',
    hints: ['Use new ArrayObject'],
    tags: ['collections', 'ArrayObject'],
  },
  {
    id: 'php-spl-288',
    category: 'collections',
    difficulty: 'easy',
    title: 'SplFixedArray',
    text: 'Create a fixed-size array of 5 elements',
    setup: '',
    setupCode: '',
    expected: 5,
    sample: '(new SplFixedArray(5))->getSize()',
    hints: ['Use SplFixedArray for memory efficiency'],
    tags: ['collections', 'SplFixedArray'],
  },
  {
    id: 'php-spl-289',
    category: 'collections',
    difficulty: 'medium',
    title: 'SplObjectStorage',
    text: 'Store objects with associated data',
    setup: '$storage = new SplObjectStorage(); $obj = new stdClass();',
    setupCode: '$storage = new SplObjectStorage(); $obj = new stdClass();',
    expected: 'data',
    sample: '$storage[$obj] = "data"; $storage[$obj]',
    hints: ['Use objects as keys'],
    tags: ['collections', 'SplObjectStorage'],
  },
  {
    id: 'php-spl-290',
    category: 'collections',
    difficulty: 'medium',
    title: 'SplDoublyLinkedList',
    text: 'Create a doubly linked list and add elements',
    setup: '',
    setupCode: '',
    expected: 'first',
    sample:
      '$list = new SplDoublyLinkedList(); $list->push("first"); $list->push("second"); $list->bottom()',
    hints: ['Use push and bottom methods'],
    tags: ['collections', 'SplDoublyLinkedList'],
  },
  {
    id: 'php-spl-291',
    category: 'collections',
    difficulty: 'hard',
    title: 'SplPriorityQueue',
    text: 'Create a priority queue with priorities',
    setup: '',
    setupCode: '',
    expected: 'urgent',
    sample:
      '$pq = new SplPriorityQueue(); $pq->insert("normal", 1); $pq->insert("urgent", 10); $pq->extract()',
    hints: ['Higher priority extracted first'],
    tags: ['collections', 'SplPriorityQueue'],
  },

  // ============================================================
  // OBJECT-ORIENTED (30 problems)
  // ============================================================
  {
    id: 'php-oop-292',
    category: 'oop',
    difficulty: 'easy',
    title: 'Interface Definition',
    text: 'Create a Printable interface with print method',
    setup: '',
    setupCode: '',
    expected: 'interface Printable { public function print(): void; }',
    sample: 'interface Printable { public function print(): void; }',
    hints: ['Use interface keyword'],
    tags: ['oop', 'interface'],
  },
  {
    id: 'php-oop-293',
    category: 'oop',
    difficulty: 'easy',
    title: 'Trait Definition',
    text: 'Create a Timestampable trait with createdAt property',
    setup: '',
    setupCode: '',
    expected:
      'trait Timestampable { public DateTimeImmutable $createdAt; public function touch(): void { $this->createdAt = new DateTimeImmutable(); } }',
    sample:
      'trait Timestampable { public DateTimeImmutable $createdAt; public function touch(): void { $this->createdAt = new DateTimeImmutable(); } }',
    hints: ['Use trait keyword'],
    tags: ['oop', 'trait'],
  },
  {
    id: 'php-oop-294',
    category: 'oop',
    difficulty: 'easy',
    title: 'Abstract Class',
    text: 'Create an abstract Shape class with abstract area method',
    setup: '',
    setupCode: '',
    expected: 'abstract class Shape { abstract public function area(): float; }',
    sample: 'abstract class Shape { abstract public function area(): float; }',
    hints: ['Use abstract keyword'],
    tags: ['oop', 'abstract'],
  },
  {
    id: 'php-oop-295',
    category: 'oop',
    difficulty: 'medium',
    title: 'Implement Interface',
    text: 'Create a Document class implementing Printable',
    setup: 'interface Printable { public function print(): void; }',
    setupCode: 'interface Printable { public function print(): void; }',
    expected:
      'class Document implements Printable { public function print(): void { echo "Printing..."; } }',
    sample:
      'class Document implements Printable { public function print(): void { echo "Printing..."; } }',
    hints: ['Use implements keyword'],
    tags: ['oop', 'implements'],
  },
  {
    id: 'php-oop-296',
    category: 'oop',
    difficulty: 'medium',
    title: 'Use Trait',
    text: 'Create a Post class using Timestampable trait',
    setup: 'trait Timestampable { public function touch(): void {} }',
    setupCode: 'trait Timestampable { public function touch(): void {} }',
    expected: 'class Post { use Timestampable; }',
    sample: 'class Post { use Timestampable; }',
    hints: ['Use "use" inside class'],
    tags: ['oop', 'trait', 'use'],
  },
  {
    id: 'php-oop-297',
    category: 'oop',
    difficulty: 'medium',
    title: 'Static Method',
    text: 'Create a class with static factory method',
    setup: '',
    setupCode: '',
    expected:
      'class User { public static function create(string $name): self { return new self($name); } private function __construct(private string $name) {} }',
    sample:
      'class User { public static function create(string $name): self { return new self($name); } private function __construct(private string $name) {} }',
    hints: ['Use static keyword'],
    tags: ['oop', 'static'],
  },
  {
    id: 'php-oop-298',
    category: 'oop',
    difficulty: 'hard',
    title: 'Trait Conflict Resolution',
    text: 'Resolve method conflict between two traits',
    setup:
      'trait A { public function hello(): string { return "A"; } } trait B { public function hello(): string { return "B"; } }',
    setupCode:
      'trait A { public function hello(): string { return "A"; } } trait B { public function hello(): string { return "B"; } }',
    expected: 'class C { use A, B { A::hello insteadof B; B::hello as helloB; } }',
    sample: 'class C { use A, B { A::hello insteadof B; B::hello as helloB; } }',
    hints: ['Use insteadof and as'],
    tags: ['oop', 'trait', 'conflict'],
  },
  {
    id: 'php-oop-299',
    category: 'oop',
    difficulty: 'hard',
    title: 'Anonymous Class',
    text: 'Create an anonymous class implementing an interface',
    setup: 'interface Logger { public function log(string $msg): void; }',
    setupCode: 'interface Logger { public function log(string $msg): void; }',
    expected:
      'new class implements Logger { public function log(string $msg): void { echo $msg; } }',
    sample:
      '$logger = new class implements Logger { public function log(string $msg): void { echo $msg; } };',
    hints: ['Use new class syntax'],
    tags: ['oop', 'anonymous-class'],
  },

  // ============================================================
  // MORE ARRAY FUNCTIONS (50 problems)
  // ============================================================
  {
    id: 'php-arr-300',
    category: 'array',
    difficulty: 'easy',
    title: 'Reverse Array',
    text: 'Reverse the order of elements in the array',
    setup: '$arr = [1, 2, 3, 4, 5];',
    setupCode: '$arr = [1, 2, 3, 4, 5];',
    expected: [5, 4, 3, 2, 1],
    sample: 'array_reverse($arr)',
    hints: ['Use array_reverse'],
    tags: ['array', 'array_reverse'],
  },
  {
    id: 'php-arr-301',
    category: 'array',
    difficulty: 'easy',
    title: 'Count Array Elements',
    text: 'Count the number of elements in the array',
    setup: '$arr = ["a", "b", "c", "d"];',
    setupCode: '$arr = ["a", "b", "c", "d"];',
    expected: 4,
    sample: 'count($arr)',
    hints: ['Use count or sizeof'],
    tags: ['array', 'count'],
  },
  {
    id: 'php-arr-302',
    category: 'array',
    difficulty: 'easy',
    title: 'Get Maximum Value',
    text: 'Find the maximum value in the array',
    setup: '$nums = [3, 7, 2, 9, 1];',
    setupCode: '$nums = [3, 7, 2, 9, 1];',
    expected: 9,
    sample: 'max($nums)',
    hints: ['Use max function'],
    tags: ['array', 'max'],
  },
  {
    id: 'php-arr-303',
    category: 'array',
    difficulty: 'easy',
    title: 'Get Minimum Value',
    text: 'Find the minimum value in the array',
    setup: '$nums = [3, 7, 2, 9, 1];',
    setupCode: '$nums = [3, 7, 2, 9, 1];',
    expected: 1,
    sample: 'min($nums)',
    hints: ['Use min function'],
    tags: ['array', 'min'],
  },
  {
    id: 'php-arr-304',
    category: 'array',
    difficulty: 'easy',
    title: 'Array Sum',
    text: 'Calculate the sum of all elements',
    setup: '$nums = [1, 2, 3, 4, 5];',
    setupCode: '$nums = [1, 2, 3, 4, 5];',
    expected: 15,
    sample: 'array_sum($nums)',
    hints: ['Use array_sum'],
    tags: ['array', 'array_sum'],
  },
  {
    id: 'php-arr-305',
    category: 'array',
    difficulty: 'easy',
    title: 'Array Product',
    text: 'Calculate the product of all elements',
    setup: '$nums = [1, 2, 3, 4];',
    setupCode: '$nums = [1, 2, 3, 4];',
    expected: 24,
    sample: 'array_product($nums)',
    hints: ['Use array_product'],
    tags: ['array', 'array_product'],
  },
  {
    id: 'php-arr-306',
    category: 'array',
    difficulty: 'easy',
    title: 'Push to Array',
    text: 'Add an element to the end of the array',
    setup: '$arr = [1, 2, 3];',
    setupCode: '$arr = [1, 2, 3];',
    expected: [1, 2, 3, 4],
    sample: 'array_push($arr, 4); $arr',
    hints: ['Use array_push or $arr[] = value'],
    tags: ['array', 'array_push'],
  },
  {
    id: 'php-arr-307',
    category: 'array',
    difficulty: 'easy',
    title: 'Pop from Array',
    text: 'Remove and return the last element',
    setup: '$arr = [1, 2, 3, 4];',
    setupCode: '$arr = [1, 2, 3, 4];',
    expected: 4,
    sample: 'array_pop($arr)',
    hints: ['Use array_pop'],
    tags: ['array', 'array_pop'],
  },
  {
    id: 'php-arr-308',
    category: 'array',
    difficulty: 'easy',
    title: 'Shift from Array',
    text: 'Remove and return the first element',
    setup: '$arr = [1, 2, 3, 4];',
    setupCode: '$arr = [1, 2, 3, 4];',
    expected: 1,
    sample: 'array_shift($arr)',
    hints: ['Use array_shift'],
    tags: ['array', 'array_shift'],
  },
  {
    id: 'php-arr-309',
    category: 'array',
    difficulty: 'easy',
    title: 'Unshift to Array',
    text: 'Add an element to the beginning of the array',
    setup: '$arr = [2, 3, 4];',
    setupCode: '$arr = [2, 3, 4];',
    expected: [1, 2, 3, 4],
    sample: 'array_unshift($arr, 1); $arr',
    hints: ['Use array_unshift'],
    tags: ['array', 'array_unshift'],
  },
  {
    id: 'php-arr-310',
    category: 'array',
    difficulty: 'easy',
    title: 'Fill Array',
    text: 'Create an array of 5 elements all set to 0',
    setup: '',
    setupCode: '',
    expected: [0, 0, 0, 0, 0],
    sample: 'array_fill(0, 5, 0)',
    hints: ['Use array_fill with start, count, value'],
    tags: ['array', 'array_fill'],
  },
  {
    id: 'php-arr-311',
    category: 'array',
    difficulty: 'medium',
    title: 'Fill Keys',
    text: 'Create associative array with given keys all set to null',
    setup: '$keys = ["name", "email", "phone"];',
    setupCode: '$keys = ["name", "email", "phone"];',
    expected: { name: null, email: null, phone: null },
    sample: 'array_fill_keys($keys, null)',
    hints: ['Use array_fill_keys'],
    tags: ['array', 'array_fill_keys'],
  },
  {
    id: 'php-arr-312',
    category: 'array',
    difficulty: 'medium',
    title: 'Array Pad',
    text: 'Pad array to length 7 with zeros',
    setup: '$arr = [1, 2, 3];',
    setupCode: '$arr = [1, 2, 3];',
    expected: [1, 2, 3, 0, 0, 0, 0],
    sample: 'array_pad($arr, 7, 0)',
    hints: ['Use array_pad'],
    tags: ['array', 'array_pad'],
  },
  {
    id: 'php-arr-313',
    category: 'array',
    difficulty: 'medium',
    title: 'Random Element',
    text: 'Get a random key from the array',
    setup: '$arr = ["a" => 1, "b" => 2, "c" => 3];',
    setupCode: '$arr = ["a" => 1, "b" => 2, "c" => 3];',
    expected: 'random key',
    sample: 'array_rand($arr)',
    hints: ['Use array_rand'],
    tags: ['array', 'array_rand'],
  },
  {
    id: 'php-arr-314',
    category: 'array',
    difficulty: 'medium',
    title: 'Shuffle Array',
    text: 'Randomly shuffle array elements',
    setup: '$arr = [1, 2, 3, 4, 5];',
    setupCode: '$arr = [1, 2, 3, 4, 5];',
    expected: 'shuffled array',
    sample: 'shuffle($arr); $arr',
    hints: ['Use shuffle (modifies in place)'],
    tags: ['array', 'shuffle'],
  },
  {
    id: 'php-arr-315',
    category: 'array',
    difficulty: 'medium',
    title: 'Array Difference',
    text: 'Find values in first array not in second',
    setup: '$arr1 = [1, 2, 3, 4, 5]; $arr2 = [3, 4, 5, 6, 7];',
    setupCode: '$arr1 = [1, 2, 3, 4, 5]; $arr2 = [3, 4, 5, 6, 7];',
    expected: [1, 2],
    sample: 'array_values(array_diff($arr1, $arr2))',
    hints: ['Use array_diff'],
    tags: ['array', 'array_diff'],
  },
  {
    id: 'php-arr-316',
    category: 'array',
    difficulty: 'medium',
    title: 'Array Intersection',
    text: 'Find values common to both arrays',
    setup: '$arr1 = [1, 2, 3, 4, 5]; $arr2 = [3, 4, 5, 6, 7];',
    setupCode: '$arr1 = [1, 2, 3, 4, 5]; $arr2 = [3, 4, 5, 6, 7];',
    expected: [3, 4, 5],
    sample: 'array_values(array_intersect($arr1, $arr2))',
    hints: ['Use array_intersect'],
    tags: ['array', 'array_intersect'],
  },
  {
    id: 'php-arr-317',
    category: 'array',
    difficulty: 'medium',
    title: 'Count Value Occurrences',
    text: 'Count how many times each value appears',
    setup: '$arr = ["a", "b", "a", "c", "a", "b"];',
    setupCode: '$arr = ["a", "b", "a", "c", "a", "b"];',
    expected: { a: 3, b: 2, c: 1 },
    sample: 'array_count_values($arr)',
    hints: ['Use array_count_values'],
    tags: ['array', 'array_count_values'],
  },
  {
    id: 'php-arr-318',
    category: 'array',
    difficulty: 'medium',
    title: 'Is List Check',
    text: 'Check if array is a list (sequential integer keys from 0)',
    setup: '$arr = [1, 2, 3];',
    setupCode: '$arr = [1, 2, 3];',
    expected: true,
    sample: 'array_is_list($arr)',
    hints: ['Use array_is_list (PHP 8.1+)'],
    tags: ['array', 'array_is_list', 'php81'],
  },
  {
    id: 'php-arr-319',
    category: 'array',
    difficulty: 'hard',
    title: 'Recursive Array Map',
    text: 'Apply strtoupper to all string values recursively',
    setup: '$arr = ["name" => "john", "address" => ["city" => "nyc"]];',
    setupCode: '$arr = ["name" => "john", "address" => ["city" => "nyc"]];',
    expected: { name: 'JOHN', address: { city: 'NYC' } },
    sample: 'array_map_recursive(fn($v) => is_string($v) ? strtoupper($v) : $v, $arr)',
    hints: ['Create custom recursive function'],
    tags: ['array', 'recursion'],
  },
  {
    id: 'php-arr-320',
    category: 'array',
    difficulty: 'hard',
    title: 'Nested Value Access',
    text: 'Get nested value using dot notation path',
    setup: '$arr = ["user" => ["profile" => ["name" => "John"]]]; $path = "user.profile.name";',
    setupCode: '$arr = ["user" => ["profile" => ["name" => "John"]]]; $path = "user.profile.name";',
    expected: 'John',
    sample: 'array_reduce(explode(".", $path), fn($a, $k) => $a[$k] ?? null, $arr)',
    hints: ['Split path and reduce through array'],
    tags: ['array', 'nested', 'dot-notation'],
  },

  // ============================================================
  // MORE STRING FUNCTIONS (30 problems)
  // ============================================================
  {
    id: 'php-str-321',
    category: 'string',
    difficulty: 'easy',
    title: 'String Length',
    text: 'Get the length of the string',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 11,
    sample: 'strlen($str)',
    hints: ['Use strlen'],
    tags: ['string', 'strlen'],
  },
  {
    id: 'php-str-322',
    category: 'string',
    difficulty: 'easy',
    title: 'Find Substring Position',
    text: 'Find the position of "World" in the string',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 6,
    sample: 'strpos($str, "World")',
    hints: ['Use strpos'],
    tags: ['string', 'strpos'],
  },
  {
    id: 'php-str-323',
    category: 'string',
    difficulty: 'easy',
    title: 'Case-Insensitive Position',
    text: 'Find position of "world" case-insensitively',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 6,
    sample: 'stripos($str, "world")',
    hints: ['Use stripos for case-insensitive'],
    tags: ['string', 'stripos'],
  },
  {
    id: 'php-str-324',
    category: 'string',
    difficulty: 'easy',
    title: 'Last Occurrence',
    text: 'Find position of last occurrence of "o"',
    setup: '$str = "Hello World";',
    setupCode: '$str = "Hello World";',
    expected: 7,
    sample: 'strrpos($str, "o")',
    hints: ['Use strrpos'],
    tags: ['string', 'strrpos'],
  },
  {
    id: 'php-str-325',
    category: 'string',
    difficulty: 'easy',
    title: 'Reverse String',
    text: 'Reverse the characters in the string',
    setup: '$str = "Hello";',
    setupCode: '$str = "Hello";',
    expected: 'olleH',
    sample: 'strrev($str)',
    hints: ['Use strrev'],
    tags: ['string', 'strrev'],
  },
  {
    id: 'php-str-326',
    category: 'string',
    difficulty: 'easy',
    title: 'Count Words',
    text: 'Count the number of words in the string',
    setup: '$str = "Hello World PHP";',
    setupCode: '$str = "Hello World PHP";',
    expected: 3,
    sample: 'str_word_count($str)',
    hints: ['Use str_word_count'],
    tags: ['string', 'str_word_count'],
  },
  {
    id: 'php-str-327',
    category: 'string',
    difficulty: 'medium',
    title: 'Extract Words to Array',
    text: 'Get all words as an array',
    setup: '$str = "Hello World PHP";',
    setupCode: '$str = "Hello World PHP";',
    expected: ['Hello', 'World', 'PHP'],
    sample: 'str_word_count($str, 1)',
    hints: ['Pass 1 as second argument'],
    tags: ['string', 'str_word_count'],
  },
  {
    id: 'php-str-328',
    category: 'string',
    difficulty: 'medium',
    title: 'Character Frequency',
    text: 'Count occurrences of each character',
    setup: '$str = "hello";',
    setupCode: '$str = "hello";',
    expected: { h: 1, e: 1, l: 2, o: 1 },
    sample: 'array_count_values(str_split($str))',
    hints: ['Split string and count values'],
    tags: ['string', 'str_split', 'array_count_values'],
  },
  {
    id: 'php-str-329',
    category: 'string',
    difficulty: 'medium',
    title: 'String to Character Array',
    text: 'Split string into array of characters',
    setup: '$str = "PHP";',
    setupCode: '$str = "PHP";',
    expected: ['P', 'H', 'P'],
    sample: 'str_split($str)',
    hints: ['Use str_split'],
    tags: ['string', 'str_split'],
  },
  {
    id: 'php-str-330',
    category: 'string',
    difficulty: 'medium',
    title: 'Chunk String',
    text: 'Split string into chunks of 2 characters',
    setup: '$str = "abcdef";',
    setupCode: '$str = "abcdef";',
    expected: ['ab', 'cd', 'ef'],
    sample: 'str_split($str, 2)',
    hints: ['Pass chunk size as second argument'],
    tags: ['string', 'str_split'],
  },

  // ============================================================
  // MORE MODERN PHP (40 problems)
  // ============================================================
  {
    id: 'php-modern-331',
    category: 'modern',
    difficulty: 'easy',
    title: 'Null Coalescing Assignment',
    text: 'Use null coalescing assignment operator',
    setup: '$arr = []; $arr["key"] ??= "default";',
    setupCode: '$arr = []; $arr["key"] ??= "default";',
    expected: 'default',
    sample: '$arr["key"]',
    hints: ['Use ??= operator'],
    tags: ['modern', 'null-coalescing', 'php74'],
  },
  {
    id: 'php-modern-332',
    category: 'modern',
    difficulty: 'easy',
    title: 'Spread in Array Expression',
    text: 'Merge arrays using spread operator',
    setup: '$a = [1, 2]; $b = [3, 4];',
    setupCode: '$a = [1, 2]; $b = [3, 4];',
    expected: [1, 2, 3, 4],
    sample: '[...$a, ...$b]',
    hints: ['Use ... in array literals'],
    tags: ['modern', 'spread', 'php74'],
  },
  {
    id: 'php-modern-333',
    category: 'modern',
    difficulty: 'medium',
    title: 'Arrow Function Capturing',
    text: 'Arrow function automatically captures outer scope',
    setup: '$multiplier = 5;',
    setupCode: '$multiplier = 5;',
    expected: 25,
    sample: '$fn = fn($x) => $x * $multiplier; $fn(5)',
    hints: ['Arrow functions auto-capture by value'],
    tags: ['modern', 'arrow-function', 'php74'],
  },
  {
    id: 'php-modern-334',
    category: 'modern',
    difficulty: 'medium',
    title: 'Throw Expression',
    text: 'Use throw as an expression (PHP 8)',
    setup: '$value = null;',
    setupCode: '$value = null;',
    expected: 'exception thrown',
    sample: '$result = $value ?? throw new InvalidArgumentException("Value required")',
    hints: ['throw can be used in expressions'],
    tags: ['modern', 'throw', 'php8'],
  },
  {
    id: 'php-modern-335',
    category: 'modern',
    difficulty: 'medium',
    title: 'Static Return Type',
    text: 'Use static return type for fluent interface',
    setup: '',
    setupCode: '',
    expected: 'class Builder { public function set(string $key): static { return $this; } }',
    sample: 'class Builder { public function set(string $key): static { return $this; } }',
    hints: ['Use static for late static binding return'],
    tags: ['modern', 'static', 'php8'],
  },
  {
    id: 'php-modern-336',
    category: 'modern',
    difficulty: 'medium',
    title: 'Mixed Type',
    text: 'Use mixed type for any value',
    setup: '',
    setupCode: '',
    expected: 'function process(mixed $value): mixed { return $value; }',
    sample: 'function process(mixed $value): mixed { return $value; }',
    hints: ['mixed accepts any type'],
    tags: ['modern', 'mixed', 'php8'],
  },
  {
    id: 'php-modern-337',
    category: 'modern',
    difficulty: 'hard',
    title: 'Weak Reference',
    text: 'Create a weak reference to an object',
    setup: '$obj = new stdClass();',
    setupCode: '$obj = new stdClass();',
    expected: 'stdClass',
    sample: '$ref = WeakReference::create($obj); get_class($ref->get())',
    hints: ['Use WeakReference::create'],
    tags: ['modern', 'WeakReference', 'php74'],
  },
  {
    id: 'php-modern-338',
    category: 'modern',
    difficulty: 'hard',
    title: 'New in Initializers',
    text: 'Use new in default parameter value (PHP 8.1)',
    setup: '',
    setupCode: '',
    expected: 'function log(DateTimeImmutable $date = new DateTimeImmutable()): void {}',
    sample: 'function log(DateTimeImmutable $date = new DateTimeImmutable()): void {}',
    hints: ['new can be used in parameter defaults'],
    tags: ['modern', 'new-initializers', 'php81'],
  },
  {
    id: 'php-modern-339',
    category: 'modern',
    difficulty: 'hard',
    title: 'Never Return Type',
    text: 'Use never return type for functions that never return',
    setup: '',
    setupCode: '',
    expected: 'function fail(): never { throw new Exception("Failed"); }',
    sample: 'function fail(): never { throw new Exception("Failed"); }',
    hints: ['never means function throws or exits'],
    tags: ['modern', 'never', 'php81'],
  },
  {
    id: 'php-modern-340',
    category: 'modern',
    difficulty: 'hard',
    title: 'Final Class Constants',
    text: 'Declare a final class constant (PHP 8.1)',
    setup: '',
    setupCode: '',
    expected: 'class Config { final public const VERSION = "1.0"; }',
    sample: 'class Config { final public const VERSION = "1.0"; }',
    hints: ['final prevents override in child classes'],
    tags: ['modern', 'final', 'const', 'php81'],
  },

  // ============================================================
  // MORE DATETIME (20 problems)
  // ============================================================
  {
    id: 'php-dt-341',
    category: 'datetime',
    difficulty: 'easy',
    title: 'Format Date',
    text: 'Format date as "January 15, 2024"',
    setup: '$date = new DateTimeImmutable("2024-01-15");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15");',
    expected: 'January 15, 2024',
    sample: '$date->format("F j, Y")',
    hints: ['Use format with F j, Y'],
    tags: ['datetime', 'format'],
  },
  {
    id: 'php-dt-342',
    category: 'datetime',
    difficulty: 'easy',
    title: 'Get Day of Week',
    text: 'Get the day of week name',
    setup: '$date = new DateTimeImmutable("2024-01-15");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15");',
    expected: 'Monday',
    sample: '$date->format("l")',
    hints: ['Use l for full day name'],
    tags: ['datetime', 'format'],
  },
  {
    id: 'php-dt-343',
    category: 'datetime',
    difficulty: 'easy',
    title: 'Unix Timestamp',
    text: 'Get Unix timestamp from date',
    setup: '$date = new DateTimeImmutable("2024-01-01");',
    setupCode: '$date = new DateTimeImmutable("2024-01-01");',
    expected: 1704067200,
    sample: '$date->getTimestamp()',
    hints: ['Use getTimestamp method'],
    tags: ['datetime', 'timestamp'],
  },
  {
    id: 'php-dt-344',
    category: 'datetime',
    difficulty: 'medium',
    title: 'Create from Timestamp',
    text: 'Create DateTimeImmutable from Unix timestamp',
    setup: '$timestamp = 1704067200;',
    setupCode: '$timestamp = 1704067200;',
    expected: '2024-01-01',
    sample: '(new DateTimeImmutable("@$timestamp"))->format("Y-m-d")',
    hints: ['Prefix timestamp with @'],
    tags: ['datetime', 'timestamp'],
  },
  {
    id: 'php-dt-345',
    category: 'datetime',
    difficulty: 'medium',
    title: 'Subtract Months',
    text: 'Subtract 3 months from a date',
    setup: '$date = new DateTimeImmutable("2024-06-15");',
    setupCode: '$date = new DateTimeImmutable("2024-06-15");',
    expected: '2024-03-15',
    sample: '$date->modify("-3 months")->format("Y-m-d")',
    hints: ['Use negative value in modify'],
    tags: ['datetime', 'modify'],
  },
  {
    id: 'php-dt-346',
    category: 'datetime',
    difficulty: 'medium',
    title: 'Start of Day',
    text: 'Get the start of the day (midnight)',
    setup: '$date = new DateTimeImmutable("2024-01-15 14:30:00");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15 14:30:00");',
    expected: '2024-01-15 00:00:00',
    sample: '$date->setTime(0, 0, 0)->format("Y-m-d H:i:s")',
    hints: ['Use setTime to reset time'],
    tags: ['datetime', 'setTime'],
  },
  {
    id: 'php-dt-347',
    category: 'datetime',
    difficulty: 'medium',
    title: 'End of Day',
    text: 'Get the end of the day',
    setup: '$date = new DateTimeImmutable("2024-01-15 14:30:00");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15 14:30:00");',
    expected: '2024-01-15 23:59:59',
    sample: '$date->setTime(23, 59, 59)->format("Y-m-d H:i:s")',
    hints: ['Set time to 23:59:59'],
    tags: ['datetime', 'setTime'],
  },
  {
    id: 'php-dt-348',
    category: 'datetime',
    difficulty: 'hard',
    title: 'First Day of Month',
    text: 'Get the first day of the current month',
    setup: '$date = new DateTimeImmutable("2024-01-15");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15");',
    expected: '2024-01-01',
    sample: '$date->modify("first day of this month")->format("Y-m-d")',
    hints: ['Use relative format'],
    tags: ['datetime', 'modify'],
  },
  {
    id: 'php-dt-349',
    category: 'datetime',
    difficulty: 'hard',
    title: 'Last Day of Month',
    text: 'Get the last day of the current month',
    setup: '$date = new DateTimeImmutable("2024-01-15");',
    setupCode: '$date = new DateTimeImmutable("2024-01-15");',
    expected: '2024-01-31',
    sample: '$date->modify("last day of this month")->format("Y-m-d")',
    hints: ['Use relative format'],
    tags: ['datetime', 'modify'],
  },
  {
    id: 'php-dt-350',
    category: 'datetime',
    difficulty: 'hard',
    title: 'Check Leap Year',
    text: 'Check if year is a leap year',
    setup: '$date = new DateTimeImmutable("2024-01-01");',
    setupCode: '$date = new DateTimeImmutable("2024-01-01");',
    expected: true,
    sample: '$date->format("L") === "1"',
    hints: ['L format returns 1 for leap year'],
    tags: ['datetime', 'format'],
  },

  // ========================================
  // BEGINNER FUNDAMENTALS
  // ========================================
  {
    id: 'php-beginner-loop-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Sum Numbers with For Loop',
    text: 'Use a for loop to sum all numbers from 1 to 10.',
    setup: '',
    setupCode: '',
    expected: 55,
    sample: '$sum = 0; for ($i = 1; $i <= 10; $i++) { $sum += $i; } $sum;',
    hints: ['Initialize sum to 0', 'Loop from 1 to 10 inclusive'],
    tags: ['beginner', 'for-loop', 'sum'],
  },
  {
    id: 'php-beginner-loop-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Count Even Numbers',
    text: 'Use a for loop to count how many even numbers are between 1 and 20.',
    setup: '',
    setupCode: '',
    expected: 10,
    sample: '$count = 0; for ($i = 1; $i <= 20; $i++) { if ($i % 2 === 0) $count++; } $count;',
    hints: [
      'Use modulo operator % to check if even',
      'Increment count when you find an even number',
    ],
    tags: ['beginner', 'for-loop', 'conditionals'],
  },
  {
    id: 'php-beginner-loop-003',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Build a String with Loop',
    text: 'Use a for loop to build the string "123456789" by concatenating numbers 1 through 9.',
    setup: '',
    setupCode: '',
    expected: '123456789',
    sample: '$result = ""; for ($i = 1; $i <= 9; $i++) { $result .= $i; } $result;',
    hints: ['Use .= for string concatenation', 'Numbers are automatically converted to strings'],
    tags: ['beginner', 'for-loop', 'strings'],
  },
  {
    id: 'php-beginner-loop-004',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Foreach Array Iteration',
    text: 'Use a foreach loop to sum all values in the array [5, 10, 15, 20].',
    setup: '$arr = [5, 10, 15, 20];',
    setupCode: '$arr = [5, 10, 15, 20];',
    expected: 50,
    sample: '$sum = 0; foreach ($arr as $val) { $sum += $val; } $sum;',
    hints: ['foreach iterates over each element', 'Use foreach ($arr as $val) syntax'],
    tags: ['beginner', 'foreach', 'arrays'],
  },
  {
    id: 'php-beginner-cond-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Simple If-Else',
    text: 'Write an if-else statement that returns "positive" if a number is greater than 0, otherwise "not positive".',
    setup: '$num = 5;',
    setupCode: '$num = 5;',
    expected: 'positive',
    sample: 'if ($num > 0) { $result = "positive"; } else { $result = "not positive"; } $result;',
    hints: ['Use if-else syntax with curly braces', 'Compare with > operator'],
    tags: ['beginner', 'conditionals', 'if-else'],
  },
  {
    id: 'php-beginner-cond-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Ternary Operator',
    text: 'Use a ternary operator to return "even" if a number is even, "odd" otherwise.',
    setup: '$num = 8;',
    setupCode: '$num = 8;',
    expected: 'even',
    sample: '$num % 2 === 0 ? "even" : "odd";',
    hints: ['Use condition ? true_value : false_value', 'Check even with modulo 2'],
    tags: ['beginner', 'conditionals', 'ternary'],
  },
  {
    id: 'php-beginner-cond-003',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Switch Statement',
    text: 'Use a switch statement to return the day name for a day number (1 = "Monday", 2 = "Tuesday", 3 = "Wednesday").',
    setup: '$day = 2;',
    setupCode: '$day = 2;',
    expected: 'Tuesday',
    sample:
      'switch ($day) { case 1: $result = "Monday"; break; case 2: $result = "Tuesday"; break; case 3: $result = "Wednesday"; break; default: $result = "Unknown"; } $result;',
    hints: ['Remember to use break after each case', 'Include a default case'],
    tags: ['beginner', 'conditionals', 'switch'],
  },
  {
    id: 'php-beginner-array-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Array Push',
    text: 'Create an array with [1, 2, 3], push the number 4 to it, and return the array.',
    setup: '',
    setupCode: '',
    expected: [1, 2, 3, 4],
    sample: '$arr = [1, 2, 3]; $arr[] = 4; $arr;',
    hints: ['Use $arr[] = value to append', 'Or use array_push($arr, value)'],
    tags: ['beginner', 'arrays', 'push'],
  },
  {
    id: 'php-beginner-array-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Array Access',
    text: 'Access the third element (index 2) of the array ["a", "b", "c", "d"].',
    setup: '$arr = ["a", "b", "c", "d"];',
    setupCode: '$arr = ["a", "b", "c", "d"];',
    expected: 'c',
    sample: '$arr[2];',
    hints: ['Arrays are zero-indexed', 'Use bracket notation $arr[index]'],
    tags: ['beginner', 'arrays', 'indexing'],
  },
  {
    id: 'php-beginner-array-003',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Array Count',
    text: 'Return the number of elements in the array [10, 20, 30, 40, 50].',
    setup: '$arr = [10, 20, 30, 40, 50];',
    setupCode: '$arr = [10, 20, 30, 40, 50];',
    expected: 5,
    sample: 'count($arr);',
    hints: ['Use count() function', 'Or sizeof() as an alias'],
    tags: ['beginner', 'arrays', 'count'],
  },
  {
    id: 'php-beginner-assoc-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Create Associative Array',
    text: 'Create an associative array with the key "name" set to "Alice", and return the value for "name".',
    setup: '',
    setupCode: '',
    expected: 'Alice',
    sample: '$arr = ["name" => "Alice"]; $arr["name"];',
    hints: ['Use key => value syntax', 'Access with $arr["key"]'],
    tags: ['beginner', 'associative-array', 'data-structures'],
  },
  {
    id: 'php-beginner-assoc-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Associative Array Keys',
    text: 'Create an associative array with keys "a", "b", "c" and values 1, 2, 3, then return all the keys.',
    setup: '',
    setupCode: '',
    expected: ['a', 'b', 'c'],
    sample: '$arr = ["a" => 1, "b" => 2, "c" => 3]; array_keys($arr);',
    hints: ['Use array_keys() function', 'Returns an indexed array of keys'],
    tags: ['beginner', 'associative-array', 'keys'],
  },
  {
    id: 'php-beginner-string-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'String Concatenation',
    text: 'Concatenate the strings "Hello" and "World" with a space between them.',
    setup: '',
    setupCode: '',
    expected: 'Hello World',
    sample: '"Hello" . " " . "World";',
    hints: ['Use . operator to concatenate strings', 'Add a space string between them'],
    tags: ['beginner', 'string', 'concatenation'],
  },
  {
    id: 'php-beginner-string-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'String Length with strlen',
    text: 'Return the length of the string "PHP is cool" using strlen().',
    setup: '',
    setupCode: '',
    expected: 11,
    sample: 'strlen("PHP is cool");',
    hints: ['Use strlen() function', 'Spaces count as characters'],
    tags: ['beginner', 'string', 'strlen'],
  },
  {
    id: 'php-beginner-while-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Basic While Loop',
    text: 'Use a while loop to sum the numbers from 1 to 5.',
    setup: '',
    setupCode: '',
    expected: 15,
    sample: '$sum = 0; $i = 1; while ($i <= 5) { $sum += $i; $i++; } $sum;',
    hints: ['Initialize sum and counter variables', 'Increment counter inside the loop'],
    tags: ['beginner', 'while', 'loop', 'sum'],
  },
  {
    id: 'php-beginner-while-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Do-While Loop',
    text: 'Use a do-while loop to count from 1 to 3 and return the final count.',
    setup: '',
    setupCode: '',
    expected: 3,
    sample: '$count = 0; do { $count++; } while ($count < 3); $count;',
    hints: ['do-while executes at least once', 'Condition is checked after each iteration'],
    tags: ['beginner', 'do-while', 'loop'],
  },
  {
    id: 'php-beginner-nested-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Nested Foreach Loop',
    text: 'Use nested foreach loops to count all pairs from [1,2] and [3,4] (should be 4 pairs).',
    setup: '',
    setupCode: '',
    expected: 4,
    sample: '$count = 0; foreach ([1,2] as $a) { foreach ([3,4] as $b) { $count++; } } $count;',
    hints: [
      'Outer loop iterates first array',
      'Inner loop iterates second array for each outer element',
    ],
    tags: ['beginner', 'nested', 'foreach', 'loop'],
  },
  {
    id: 'php-beginner-bool-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Boolean AND/OR',
    text: 'Return true if both conditions are met: $x > 5 AND $x < 15, where $x = 10.',
    setup: '',
    setupCode: '',
    expected: true,
    sample: '$x = 10; $x > 5 && $x < 15;',
    hints: ['Use && for logical AND', 'Both conditions must be true'],
    tags: ['beginner', 'boolean', 'operators'],
  },
  {
    id: 'php-beginner-arr-adv-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Array Max',
    text: 'Find the maximum value in the array [3, 7, 2, 9, 4].',
    setup: '',
    setupCode: '',
    expected: 9,
    sample: 'max([3, 7, 2, 9, 4]);',
    hints: ['Use max() function', 'Returns the largest value'],
    tags: ['beginner', 'array', 'max'],
  },
  {
    id: 'php-beginner-arr-adv-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Array in_array',
    text: 'Check if the array [1, 2, 3, 4, 5] contains the value 3.',
    setup: '',
    setupCode: '',
    expected: true,
    sample: 'in_array(3, [1, 2, 3, 4, 5]);',
    hints: ['Use in_array() function', 'First argument is needle, second is haystack'],
    tags: ['beginner', 'array', 'in_array'],
  },
];
