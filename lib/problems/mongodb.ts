import type { Problem } from '../types';

/**
 * MongoDB problems for coding drills
 * Covers CRUD operations, Query Operators, Update Operators,
 * Aggregation Pipeline, Array Operations, Indexes, Text Search, and Geospatial queries
 */

export const mongodbProblems: Problem[] = [
  // ============================================================
  // BASIC FIND OPERATIONS (10 problems)
  // ============================================================
  {
    id: 'mongo-find-001',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find All Documents',
    text: 'Find all documents in the users collection.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [
      { name: 'John', age: 30 },
      { name: 'Jane', age: 25 },
    ],
    sample: 'db.users.find()',
    hints: ['Use find() with no arguments to get all documents', 'find() returns a cursor'],
    validPatterns: [/db\.users\.find\s*\(\s*\)/i],
    tags: ['find', 'basic', 'crud'],
  },
  {
    id: 'mongo-find-002',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find by Field Value',
    text: 'Find all users where age equals 30.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.find({age: 30})',
    hints: ['Use find() with a query object', 'Match documents where age field equals 30'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*30\s*\}\s*\)/i],
    tags: ['find', 'query', 'equality'],
  },
  {
    id: 'mongo-find-003',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with Comparison Operator',
    text: 'Find all users where age is greater than 25.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.find({age: {$gt: 25}})',
    hints: ['Use $gt operator for greater than', 'Syntax: {field: {$gt: value}}'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$gt\s*:\s*25\s*\}\s*\}\s*\)/i],
    tags: ['find', 'query', 'comparison', '$gt'],
  },
  {
    id: 'mongo-find-004',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $in Operator',
    text: 'Find all users where age is either 25 or 30.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [
      { name: 'John', age: 30 },
      { name: 'Jane', age: 25 },
    ],
    sample: 'db.users.find({age: {$in: [25, 30]}})',
    hints: [
      'Use $in operator to match any value in an array',
      'Syntax: {field: {$in: [value1, value2]}}',
    ],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$in\s*:\s*\[\s*25\s*,\s*30\s*\]\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$in'],
  },
  {
    id: 'mongo-find-005',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $and Operator',
    text: 'Find all users where age is greater than 20 AND name equals "John".',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.find({$and: [{age: {$gt: 20}}, {name: "John"}]})',
    hints: ['Use $and operator to combine multiple conditions', 'All conditions must be true'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*\$and\s*:\s*\[/i,
      /\{\s*age\s*:\s*\{\s*\$gt\s*:\s*20\s*\}\s*\}/i,
      /\{\s*name\s*:\s*"John"\s*\}/i,
    ],
    tags: ['find', 'query', '$and'],
  },
  {
    id: 'mongo-find-006',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $or Operator',
    text: 'Find all users where age is less than 25 OR name equals "John".',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [
      { name: 'John', age: 30 },
      { name: 'Bob', age: 20 },
    ],
    sample: 'db.users.find({$or: [{age: {$lt: 25}}, {name: "John"}]})',
    hints: ['Use $or operator to match any condition', 'At least one condition must be true'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\$or\s*:\s*\[/i],
    tags: ['find', 'query', '$or'],
  },
  {
    id: 'mongo-find-007',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with Projection',
    text: 'Find all users but only return the name field.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ name: 'John' }, { name: 'Jane' }],
    sample: 'db.users.find({}, {name: 1, _id: 0})',
    hints: ['Second parameter to find() is projection', 'Use 1 to include, 0 to exclude fields'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\}\s*,\s*\{\s*name\s*:\s*1/i],
    tags: ['find', 'projection'],
  },
  {
    id: 'mongo-find-008',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with Limit',
    text: 'Find the first 2 users.',
    setup: 'Collection: users with documents {name: "John"}, {name: "Jane"}, {name: "Bob"}',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"},
  {name: "Bob"}
]);`,
    expected: [{ name: 'John' }, { name: 'Jane' }],
    sample: 'db.users.find().limit(2)',
    hints: ['Use limit() to restrict number of results', 'Chain limit() after find()'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.limit\s*\(\s*2\s*\)/i],
    tags: ['find', 'limit'],
  },
  {
    id: 'mongo-find-009',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with Sort',
    text: 'Find all users sorted by age in ascending order.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [
      { name: 'Jane', age: 25 },
      { name: 'John', age: 30 },
    ],
    sample: 'db.users.find().sort({age: 1})',
    hints: ['Use sort() to order results', '1 for ascending, -1 for descending'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.sort\s*\(\s*\{\s*age\s*:\s*1\s*\}\s*\)/i],
    tags: ['find', 'sort'],
  },
  {
    id: 'mongo-find-010',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find One Document',
    text: 'Find a single user where age is greater than 20.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: { name: 'John', age: 30 },
    sample: 'db.users.findOne({age: {$gt: 20}})',
    hints: [
      'Use findOne() instead of find() for single document',
      'Returns first matching document',
    ],
    validPatterns: [/db\.users\.findOne\s*\(\s*\{\s*age\s*:\s*\{\s*\$gt\s*:\s*20\s*\}\s*\}\s*\)/i],
    tags: ['findOne', 'query'],
  },

  // ============================================================
  // INSERT OPERATIONS (5 problems)
  // ============================================================
  {
    id: 'mongo-insert-001',
    category: 'Insert Operations',
    difficulty: 'easy',
    title: 'Insert Single Document',
    text: 'Insert a single document into the users collection with name "Alice" and age 28.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Inserted document with _id',
    sample: 'db.users.insertOne({name: "Alice", age: 28})',
    hints: ['Use insertOne() to insert a single document', 'Pass document as object'],
    validPatterns: [
      /db\.users\.insertOne\s*\(\s*\{\s*name\s*:\s*"Alice"\s*,\s*age\s*:\s*28\s*\}\s*\)/i,
    ],
    tags: ['insert', 'insertOne', 'crud'],
  },
  {
    id: 'mongo-insert-002',
    category: 'Insert Operations',
    difficulty: 'easy',
    title: 'Insert Multiple Documents',
    text: 'Insert multiple documents into the users collection.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Inserted 2 documents',
    sample: 'db.users.insertMany([{name: "Alice", age: 28}, {name: "Bob", age: 32}])',
    hints: ['Use insertMany() to insert multiple documents', 'Pass array of documents'],
    validPatterns: [/db\.users\.insertMany\s*\(\s*\[/i],
    tags: ['insert', 'insertMany', 'crud'],
  },
  {
    id: 'mongo-insert-003',
    category: 'Insert Operations',
    difficulty: 'easy',
    title: 'Insert with Nested Object',
    text: 'Insert a user document with a nested address object containing city and zip.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Inserted document with _id',
    sample: 'db.users.insertOne({name: "Alice", address: {city: "NYC", zip: "10001"}})',
    hints: [
      'Nested objects are created with object literals',
      'Use dot notation to access nested fields',
    ],
    validPatterns: [/db\.users\.insertOne\s*\(\s*\{\s*name\s*:\s*"Alice"\s*,\s*address\s*:\s*\{/i],
    tags: ['insert', 'nested', 'object'],
  },
  {
    id: 'mongo-insert-004',
    category: 'Insert Operations',
    difficulty: 'easy',
    title: 'Insert with Array Field',
    text: 'Insert a user document with a hobbies array field.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Inserted document with _id',
    sample: 'db.users.insertOne({name: "Alice", hobbies: ["reading", "coding", "music"]})',
    hints: ['Arrays are created with square brackets', 'Can contain any data types'],
    validPatterns: [/db\.users\.insertOne\s*\(\s*\{\s*name\s*:\s*"Alice"\s*,\s*hobbies\s*:\s*\[/i],
    tags: ['insert', 'array'],
  },
  {
    id: 'mongo-insert-005',
    category: 'Insert Operations',
    difficulty: 'medium',
    title: 'Insert with Custom _id',
    text: 'Insert a document with a custom _id field value.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Inserted document with _id: user123',
    sample: "db.users.insertOne({_id: 'user123', name: 'Alice', age: 28})",
    hints: ['You can specify _id field manually', '_id must be unique'],
    validPatterns: [/db\.users\.insertOne\s*\(\s*\{\s*_id\s*:/i],
    tags: ['insert', '_id'],
  },

  // ============================================================
  // UPDATE OPERATIONS (10 problems)
  // ============================================================
  {
    id: 'mongo-update-001',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Update with $set',
    text: 'Update the age field to 31 for the user with name "John".',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$set: {age: 31}})',
    hints: ['Use updateOne() to update a single document', 'Use $set operator to set field values'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*age\s*:\s*31\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'updateOne', '$set'],
  },
  {
    id: 'mongo-update-002',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Update Multiple Documents',
    text: 'Update age to 30 for all users where age is less than 25.',
    setup: 'Collection: users with documents {name: "John", age: 20}, {name: "Jane", age: 22}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 20},
  {name: "Jane", age: 22}
]);`,
    expected: { acknowledged: true, modifiedCount: 2 },
    sample: 'db.users.updateMany({age: {$lt: 25}}, {$set: {age: 30}})',
    hints: [
      'Use updateMany() to update multiple documents',
      'First parameter is query, second is update',
    ],
    validPatterns: [
      /db\.users\.updateMany\s*\(\s*\{\s*age\s*:\s*\{\s*\$lt\s*:\s*25\s*\}\s*\}\s*,\s*\{\s*\$set\s*:/i,
    ],
    tags: ['update', 'updateMany', '$set'],
  },
  {
    id: 'mongo-update-003',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Increment Numeric Field',
    text: 'Increment the age field by 1 for the user with name "John".',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$inc: {age: 1}})',
    hints: [
      'Use $inc operator to increment numeric values',
      'Can use negative numbers to decrement',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$inc\s*:\s*\{\s*age\s*:\s*1\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$inc'],
  },
  {
    id: 'mongo-update-004',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Add Element to Array',
    text: 'Add "swimming" to the hobbies array for the user with name "John".',
    setup: 'Collection: users with document {name: "John", hobbies: ["reading", "coding"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$push: {hobbies: "swimming"}})',
    hints: ['Use $push to add element to array', 'Adds to end of array'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$push\s*:\s*\{\s*hobbies\s*:\s*"swimming"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$push', 'array'],
  },
  {
    id: 'mongo-update-005',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Remove Element from Array',
    text: 'Remove "coding" from the hobbies array for the user with name "John".',
    setup:
      'Collection: users with document {name: "John", hobbies: ["reading", "coding", "music"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding", "music"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$pull: {hobbies: "coding"}})',
    hints: ['Use $pull to remove element from array', 'Removes all matching values'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$pull\s*:\s*\{\s*hobbies\s*:\s*"coding"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$pull', 'array'],
  },
  {
    id: 'mongo-update-006',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Add to Array if Not Exists',
    text: 'Add "swimming" to hobbies array only if it does not already exist.',
    setup: 'Collection: users with document {name: "John", hobbies: ["reading", "coding"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$addToSet: {hobbies: "swimming"}})',
    hints: ['Use $addToSet to add only if not exists', 'Prevents duplicates'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$addToSet\s*:\s*\{\s*hobbies\s*:\s*"swimming"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$addToSet', 'array'],
  },
  {
    id: 'mongo-update-007',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update Nested Field',
    text: 'Update the city field inside the address object for user "John".',
    setup: 'Collection: users with document {name: "John", address: {city: "NYC", zip: "10001"}}',
    setupCode: `db.users.insertOne({name: "John", address: {city: "NYC", zip: "10001"}});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$set: {"address.city": "Boston"}})',
    hints: ['Use dot notation to update nested fields', 'Quote the field path with dots'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*"address\.city"\s*:/i,
    ],
    tags: ['update', 'nested', 'dot-notation'],
  },
  {
    id: 'mongo-update-008',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Remove Field',
    text: 'Remove the age field from the user with name "John".',
    setup: 'Collection: users with document {name: "John", age: 30, city: "NYC"}',
    setupCode: `db.users.insertOne({name: "John", age: 30, city: "NYC"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$unset: {age: ""}})',
    hints: ['Use $unset to remove a field', 'Value can be empty string or 1'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$unset\s*:\s*\{\s*age\s*:/i,
    ],
    tags: ['update', '$unset'],
  },
  {
    id: 'mongo-update-009',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update with Upsert',
    text: 'Update user "John" age to 31, or insert if not exists.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Upserted document',
    sample: 'db.users.updateOne({name: "John"}, {$set: {age: 31}}, {upsert: true})',
    hints: ['Use upsert option to insert if not found', 'Third parameter is options object'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:/i,
      /upsert\s*:\s*true/i,
    ],
    tags: ['update', 'upsert'],
  },
  {
    id: 'mongo-update-010',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array Element',
    text: 'Update the first element in the scores array to 100 for user "John".',
    setup: 'Collection: users with document {name: "John", scores: [80, 90, 85]}',
    setupCode: `db.users.insertOne({name: "John", scores: [80, 90, 85]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$set: {"scores.0": 100}})',
    hints: ['Use array index with dot notation', 'Array indices start at 0'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*"scores\.0"\s*:\s*100\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', 'index'],
  },

  // ============================================================
  // DELETE OPERATIONS (5 problems)
  // ============================================================
  {
    id: 'mongo-delete-001',
    category: 'Delete Operations',
    difficulty: 'easy',
    title: 'Delete Single Document',
    text: 'Delete the user with name "John".',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: { acknowledged: true, deletedCount: 1 },
    sample: 'db.users.deleteOne({name: "John"})',
    hints: ['Use deleteOne() to delete a single document', 'Takes query object as parameter'],
    validPatterns: [/db\.users\.deleteOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*\)/i],
    tags: ['delete', 'deleteOne', 'crud'],
  },
  {
    id: 'mongo-delete-002',
    category: 'Delete Operations',
    difficulty: 'easy',
    title: 'Delete Multiple Documents',
    text: 'Delete all users where age is less than 25.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 20}, {name: "Bob", age: 22}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 20},
  {name: "Bob", age: 22}
]);`,
    expected: { acknowledged: true, deletedCount: 2 },
    sample: 'db.users.deleteMany({age: {$lt: 25}})',
    hints: [
      'Use deleteMany() to delete multiple documents',
      'Matches all documents meeting criteria',
    ],
    validPatterns: [
      /db\.users\.deleteMany\s*\(\s*\{\s*age\s*:\s*\{\s*\$lt\s*:\s*25\s*\}\s*\}\s*\)/i,
    ],
    tags: ['delete', 'deleteMany'],
  },
  {
    id: 'mongo-delete-003',
    category: 'Delete Operations',
    difficulty: 'easy',
    title: 'Delete All Documents',
    text: 'Delete all documents from the users collection.',
    setup: 'Collection: users with documents {name: "John"}, {name: "Jane"}',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: { acknowledged: true, deletedCount: 2 },
    sample: 'db.users.deleteMany({})',
    hints: ['Use deleteMany() with empty query object', 'Deletes all documents in collection'],
    validPatterns: [/db\.users\.deleteMany\s*\(\s*\{\s*\}\s*\)/i],
    tags: ['delete', 'deleteMany'],
  },
  {
    id: 'mongo-delete-004',
    category: 'Delete Operations',
    difficulty: 'medium',
    title: 'Delete with Multiple Conditions',
    text: 'Delete users where age is greater than 30 OR name equals "Bob".',
    setup:
      'Collection: users with documents {name: "John", age: 35}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 35},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: { acknowledged: true, deletedCount: 2 },
    sample: 'db.users.deleteMany({$or: [{age: {$gt: 30}}, {name: "Bob"}]})',
    hints: ['Use $or operator in delete query', 'Matches documents meeting any condition'],
    validPatterns: [/db\.users\.deleteMany\s*\(\s*\{\s*\$or\s*:/i],
    tags: ['delete', '$or'],
  },
  {
    id: 'mongo-delete-005',
    category: 'Delete Operations',
    difficulty: 'hard',
    title: 'Delete Collection',
    text: 'Drop the entire users collection.',
    setup: 'Collection: users with documents',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: true,
    sample: 'db.users.drop()',
    hints: ['Use drop() to remove entire collection', 'Returns true if successful'],
    validPatterns: [/db\.users\.drop\s*\(\s*\)/i],
    tags: ['delete', 'drop', 'collection'],
  },

  // ============================================================
  // ADVANCED QUERY OPERATORS (10 problems)
  // ============================================================
  {
    id: 'mongo-query-001',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $ne Operator',
    text: 'Find all users where age is not equal to 30.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 35}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 35}
]);`,
    expected: [
      { name: 'Jane', age: 25 },
      { name: 'Bob', age: 35 },
    ],
    sample: 'db.users.find({age: {$ne: 30}})',
    hints: ['Use $ne for not equal', 'Syntax: {field: {$ne: value}}'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$ne\s*:\s*30\s*\}\s*\}\s*\)/i],
    tags: ['find', 'query', '$ne'],
  },
  {
    id: 'mongo-query-002',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with Range Query',
    text: 'Find all users where age is between 25 and 35 (inclusive).',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [
      { name: 'John', age: 30 },
      { name: 'Jane', age: 25 },
    ],
    sample: 'db.users.find({age: {$gte: 25, $lte: 35}})',
    hints: [
      'Use $gte for greater than or equal',
      'Use $lte for less than or equal',
      'Combine in same object',
    ],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$gte\s*:\s*25\s*,\s*\$lte\s*:\s*35\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$gte', '$lte'],
  },
  {
    id: 'mongo-query-003',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $exists',
    text: 'Find all users that have an email field.',
    setup:
      'Collection: users with documents {name: "John", email: "john@test.com"}, {name: "Jane"}',
    setupCode: `db.users.insertMany([
  {name: "John", email: "john@test.com"},
  {name: "Jane"}
]);`,
    expected: [{ name: 'John', email: 'john@test.com' }],
    sample: 'db.users.find({email: {$exists: true}})',
    hints: [
      'Use $exists to check field presence',
      'true checks field exists, false checks it does not',
    ],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*email\s*:\s*\{\s*\$exists\s*:\s*true\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$exists'],
  },
  {
    id: 'mongo-query-004',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $regex',
    text: 'Find all users where name starts with "J".',
    setup: 'Collection: users with documents {name: "John"}, {name: "Jane"}, {name: "Bob"}',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"},
  {name: "Bob"}
]);`,
    expected: [{ name: 'John' }, { name: 'Jane' }],
    sample: 'db.users.find({name: {$regex: /^J/}})',
    hints: [
      'Use $regex for pattern matching',
      '^ means start of string',
      'Can use regex literal or string',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*name\s*:\s*\{\s*\$regex\s*:/i],
    tags: ['find', 'query', '$regex'],
  },
  {
    id: 'mongo-query-005',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $nin',
    text: 'Find all users where age is not in [20, 25].',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.find({age: {$nin: [20, 25]}})',
    hints: ['Use $nin for not in', 'Opposite of $in operator'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$nin\s*:\s*\[/i],
    tags: ['find', 'query', '$nin'],
  },
  {
    id: 'mongo-query-006',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with $all',
    text: 'Find all users where hobbies array contains both "reading" and "coding".',
    setup:
      'Collection: users with documents {name: "John", hobbies: ["reading", "coding", "music"]}, {name: "Jane", hobbies: ["reading"]}',
    setupCode: `db.users.insertMany([
  {name: "John", hobbies: ["reading", "coding", "music"]},
  {name: "Jane", hobbies: ["reading"]}
]);`,
    expected: [{ name: 'John', hobbies: ['reading', 'coding', 'music'] }],
    sample: 'db.users.find({hobbies: {$all: ["reading", "coding"]}})',
    hints: [
      'Use $all to match arrays containing all specified values',
      'Array must contain all values in $all',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*hobbies\s*:\s*\{\s*\$all\s*:\s*\[/i],
    tags: ['find', 'query', '$all', 'array'],
  },
  {
    id: 'mongo-query-007',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $size',
    text: 'Find all users where hobbies array has exactly 3 elements.',
    setup:
      'Collection: users with documents {name: "John", hobbies: ["reading", "coding", "music"]}, {name: "Jane", hobbies: ["reading"]}',
    setupCode: `db.users.insertMany([
  {name: "John", hobbies: ["reading", "coding", "music"]},
  {name: "Jane", hobbies: ["reading"]}
]);`,
    expected: [{ name: 'John', hobbies: ['reading', 'coding', 'music'] }],
    sample: 'db.users.find({hobbies: {$size: 3}})',
    hints: ['Use $size to match array length', 'Must match exact size'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*hobbies\s*:\s*\{\s*\$size\s*:\s*3\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$size', 'array'],
  },
  {
    id: 'mongo-query-008',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with $elemMatch',
    text: 'Find all users where scores array contains an element greater than 90.',
    setup:
      'Collection: users with documents {name: "John", scores: [80, 95, 85]}, {name: "Jane", scores: [70, 75, 80]}',
    setupCode: `db.users.insertMany([
  {name: "John", scores: [80, 95, 85]},
  {name: "Jane", scores: [70, 75, 80]}
]);`,
    expected: [{ name: 'John', scores: [80, 95, 85] }],
    sample: 'db.users.find({scores: {$elemMatch: {$gt: 90}}})',
    hints: [
      'Use $elemMatch to query array elements',
      'Matches if at least one element meets criteria',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*scores\s*:\s*\{\s*\$elemMatch\s*:/i],
    tags: ['find', 'query', '$elemMatch', 'array'],
  },
  {
    id: 'mongo-query-009',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $type',
    text: 'Find all users where age field is a number type.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: "25"}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: "25"}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.find({age: {$type: "number"}})',
    hints: [
      'Use $type to match by BSON type',
      'Common types: "number", "string", "object", "array"',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$type\s*:/i],
    tags: ['find', 'query', '$type'],
  },
  {
    id: 'mongo-query-010',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with $not',
    text: 'Find all users where age is not greater than 30.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 35}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 35}
]);`,
    expected: [
      { name: 'John', age: 30 },
      { name: 'Jane', age: 25 },
    ],
    sample: 'db.users.find({age: {$not: {$gt: 30}}})',
    hints: ['Use $not to negate a condition', 'Wraps another query operator'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$not\s*:/i],
    tags: ['find', 'query', '$not'],
  },

  // ============================================================
  // AGGREGATION PIPELINE (15 problems)
  // ============================================================
  {
    id: 'mongo-agg-001',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: 'Basic $match Stage',
    text: 'Use aggregation to find all users where age is greater than 25.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.aggregate([{$match: {age: {$gt: 25}}}])',
    hints: ['Use aggregate() with pipeline array', '$match filters documents like find()'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$match\s*:/i],
    tags: ['aggregation', '$match'],
  },
  {
    id: 'mongo-agg-002',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: 'Basic $project Stage',
    text: 'Use aggregation to return only name field from users.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ name: 'John' }, { name: 'Jane' }],
    sample: 'db.users.aggregate([{$project: {name: 1, _id: 0}}])',
    hints: ['Use $project to reshape documents', '1 to include, 0 to exclude fields'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$project\s*:/i],
    tags: ['aggregation', '$project'],
  },
  {
    id: 'mongo-agg-003',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: 'Basic $group Stage',
    text: 'Group users by age and count how many in each group.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 30}, {name: "Bob", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 30},
  {name: "Bob", age: 25}
]);`,
    expected: [
      { _id: 30, count: 2 },
      { _id: 25, count: 1 },
    ],
    sample: 'db.users.aggregate([{$group: {_id: "$age", count: {$sum: 1}}}])',
    hints: ['Use $group to group documents', '_id is the grouping field', 'Use $sum to count'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:/i, /\$sum\s*:\s*1/i],
    tags: ['aggregation', '$group', '$sum'],
  },
  {
    id: 'mongo-agg-004',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Aggregation with $sort',
    text: 'Find all users, project name and age, then sort by age descending.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [
      { name: 'John', age: 30 },
      { name: 'Jane', age: 25 },
    ],
    sample: 'db.users.aggregate([{$project: {name: 1, age: 1, _id: 0}}, {$sort: {age: -1}}])',
    hints: ['Chain multiple stages in pipeline', '$sort uses -1 for descending, 1 for ascending'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$project\s*:/i,
      /\{\s*\$sort\s*:\s*\{\s*age\s*:\s*-1\s*\}\s*\}/i,
    ],
    tags: ['aggregation', '$sort'],
  },
  {
    id: 'mongo-agg-005',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Aggregation with $limit',
    text: 'Find all users, sort by age descending, and return only the top 2.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 35}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 35}
]);`,
    expected: [
      { name: 'Bob', age: 35 },
      { name: 'John', age: 30 },
    ],
    sample: 'db.users.aggregate([{$sort: {age: -1}}, {$limit: 2}])',
    hints: ['Use $limit to restrict results', 'Place after $sort to get top N'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$sort\s*:/i,
      /\{\s*\$limit\s*:\s*2\s*\}/i,
    ],
    tags: ['aggregation', '$limit'],
  },
  {
    id: 'mongo-agg-006',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Aggregation with $sum',
    text: 'Calculate the total age of all users.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ totalAge: 55 }],
    sample: 'db.users.aggregate([{$group: {_id: null, totalAge: {$sum: "$age"}}}])',
    hints: ['Use _id: null to group all documents', '$sum can sum field values'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:\s*\{\s*_id\s*:\s*null/i,
      /\$sum\s*:\s*"\$age"/i,
    ],
    tags: ['aggregation', '$group', '$sum'],
  },
  {
    id: 'mongo-agg-007',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Aggregation with $avg',
    text: 'Calculate the average age of all users.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 35}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 35}
]);`,
    expected: [{ avgAge: 30 }],
    sample: 'db.users.aggregate([{$group: {_id: null, avgAge: {$avg: "$age"}}}])',
    hints: ['Use $avg to calculate average', 'Groups all documents with _id: null'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:\s*\{\s*_id\s*:\s*null/i,
      /\$avg\s*:\s*"\$age"/i,
    ],
    tags: ['aggregation', '$group', '$avg'],
  },
  {
    id: 'mongo-agg-008',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Aggregation with $min and $max',
    text: 'Find the minimum and maximum age of all users.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 35}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 35}
]);`,
    expected: [{ minAge: 25, maxAge: 35 }],
    sample:
      'db.users.aggregate([{$group: {_id: null, minAge: {$min: "$age"}, maxAge: {$max: "$age"}}}])',
    hints: ['Use $min to find minimum value', 'Use $max to find maximum value'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:/i,
      /\$min\s*:\s*"\$age"/i,
      /\$max\s*:\s*"\$age"/i,
    ],
    tags: ['aggregation', '$group', '$min', '$max'],
  },
  {
    id: 'mongo-agg-009',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $lookup',
    text: 'Join users with orders collection to get user orders.',
    setup: 'Collections: users {_id: 1, name: "John"}, orders {userId: 1, product: "Book"}',
    setupCode: `db.users.insertOne({_id: 1, name: "John"});
db.orders.insertOne({userId: 1, product: "Book"});`,
    expected: [{ _id: 1, name: 'John', orders: [{ userId: 1, product: 'Book' }] }],
    sample:
      'db.users.aggregate([{$lookup: {from: "orders", localField: "_id", foreignField: "userId", as: "orders"}}])',
    hints: [
      'Use $lookup to join collections',
      'from: source collection, localField/foreignField: join keys, as: output array',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$lookup\s*:/i, /from\s*:\s*"orders"/i],
    tags: ['aggregation', '$lookup', 'join'],
  },
  {
    id: 'mongo-agg-010',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $unwind',
    text: 'Unwind the hobbies array to create one document per hobby.',
    setup: 'Collection: users with document {name: "John", hobbies: ["reading", "coding"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding"]});`,
    expected: [
      { name: 'John', hobbies: 'reading' },
      { name: 'John', hobbies: 'coding' },
    ],
    sample: 'db.users.aggregate([{$unwind: "$hobbies"}])',
    hints: ['Use $unwind to deconstruct array', 'Creates one document per array element'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$unwind\s*:\s*"\$hobbies"\s*\}\s*\]\s*\)/i,
    ],
    tags: ['aggregation', '$unwind', 'array'],
  },
  {
    id: 'mongo-agg-011',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $addFields',
    text: 'Add a new field "isAdult" that is true if age >= 18.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 16}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 16}
]);`,
    expected: [
      { name: 'John', age: 30, isAdult: true },
      { name: 'Jane', age: 16, isAdult: false },
    ],
    sample: 'db.users.aggregate([{$addFields: {isAdult: {$gte: ["$age", 18]}}}])',
    hints: ['Use $addFields to add computed fields', 'Use $gte in expression to compare'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$addFields\s*:/i],
    tags: ['aggregation', '$addFields'],
  },
  {
    id: 'mongo-agg-012',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $cond',
    text: 'Add a "status" field: "senior" if age >= 65, "adult" if age >= 18, else "minor".',
    setup:
      'Collection: users with documents {name: "John", age: 70}, {name: "Jane", age: 25}, {name: "Bob", age: 15}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 70},
  {name: "Jane", age: 25},
  {name: "Bob", age: 15}
]);`,
    expected: [
      { name: 'John', age: 70, status: 'senior' },
      { name: 'Jane', age: 25, status: 'adult' },
      { name: 'Bob', age: 15, status: 'minor' },
    ],
    sample:
      'db.users.aggregate([{$addFields: {status: {$cond: {if: {$gte: ["$age", 65]}, then: "senior", else: {$cond: {if: {$gte: ["$age", 18]}, then: "adult", else: "minor"}}}}}}])',
    hints: [
      'Use $cond for conditional logic',
      'Nest $cond for multiple conditions',
      'if/then/else structure',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$addFields\s*:/i, /\$cond\s*:/i],
    tags: ['aggregation', '$cond', '$addFields'],
  },
  {
    id: 'mongo-agg-013',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Aggregation with $count',
    text: 'Count how many users have age greater than 25.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [{ count: 1 }],
    sample: 'db.users.aggregate([{$match: {age: {$gt: 25}}}, {$count: "count"}])',
    hints: ['Use $count to count documents', 'Place after $match to count filtered results'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$match\s*:/i,
      /\{\s*\$count\s*:\s*"count"\s*\}/i,
    ],
    tags: ['aggregation', '$count'],
  },
  {
    id: 'mongo-agg-014',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $facet',
    text: 'Use $facet to get both count and average age in one aggregation.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: [{ total: [{ count: 2 }], stats: [{ avgAge: 27.5 }] }],
    sample:
      'db.users.aggregate([{$facet: {total: [{$count: "count"}], stats: [{$group: {_id: null, avgAge: {$avg: "$age"}}}]}}])',
    hints: ['Use $facet to run multiple pipelines', 'Each key runs independent pipeline'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$facet\s*:/i],
    tags: ['aggregation', '$facet'],
  },
  {
    id: 'mongo-agg-015',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $group and $push',
    text: 'Group users by age and collect all names in each group.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 30}, {name: "Bob", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 30},
  {name: "Bob", age: 25}
]);`,
    expected: [
      { _id: 30, names: ['John', 'Jane'] },
      { _id: 25, names: ['Bob'] },
    ],
    sample: 'db.users.aggregate([{$group: {_id: "$age", names: {$push: "$name"}}}])',
    hints: ['Use $push to collect values into array', 'Groups documents and pushes field values'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:/i, /\$push\s*:\s*"\$name"/i],
    tags: ['aggregation', '$group', '$push'],
  },

  // ============================================================
  // ARRAY QUERY OPERATORS (10 problems)
  // ============================================================
  {
    id: 'mongo-array-001',
    category: 'Array Operations',
    difficulty: 'easy',
    title: 'Find Document with Array Element',
    text: 'Find all users where hobbies array contains "reading".',
    setup:
      'Collection: users with documents {name: "John", hobbies: ["reading", "coding"]}, {name: "Jane", hobbies: ["music"]}',
    setupCode: `db.users.insertMany([
  {name: "John", hobbies: ["reading", "coding"]},
  {name: "Jane", hobbies: ["music"]}
]);`,
    expected: [{ name: 'John', hobbies: ['reading', 'coding'] }],
    sample: 'db.users.find({hobbies: "reading"})',
    hints: ['Query array field directly with value', 'Matches if array contains the value'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*hobbies\s*:\s*"reading"\s*\}\s*\)/i],
    tags: ['find', 'array', 'query'],
  },
  {
    id: 'mongo-array-002',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Find with Array Index',
    text: 'Find all users where the first element in hobbies array is "reading".',
    setup:
      'Collection: users with documents {name: "John", hobbies: ["reading", "coding"]}, {name: "Jane", hobbies: ["music", "reading"]}',
    setupCode: `db.users.insertMany([
  {name: "John", hobbies: ["reading", "coding"]},
  {name: "Jane", hobbies: ["music", "reading"]}
]);`,
    expected: [{ name: 'John', hobbies: ['reading', 'coding'] }],
    sample: 'db.users.find({"hobbies.0": "reading"})',
    hints: ['Use dot notation with index to query array element', 'Array indices start at 0'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*"hobbies\.0"\s*:\s*"reading"\s*\}\s*\)/i],
    tags: ['find', 'array', 'index'],
  },
  {
    id: 'mongo-array-003',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Find with $all Operator',
    text: 'Find all users where hobbies array contains both "reading" and "coding".',
    setup:
      'Collection: users with documents {name: "John", hobbies: ["reading", "coding", "music"]}, {name: "Jane", hobbies: ["reading"]}',
    setupCode: `db.users.insertMany([
  {name: "John", hobbies: ["reading", "coding", "music"]},
  {name: "Jane", hobbies: ["reading"]}
]);`,
    expected: [{ name: 'John', hobbies: ['reading', 'coding', 'music'] }],
    sample: 'db.users.find({hobbies: {$all: ["reading", "coding"]}})',
    hints: [
      'Use $all to match arrays containing all specified values',
      'All values must be present',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*hobbies\s*:\s*\{\s*\$all\s*:\s*\[/i],
    tags: ['find', 'array', '$all'],
  },
  {
    id: 'mongo-array-004',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Update Array with $push',
    text: 'Add "swimming" to the end of hobbies array for user "John".',
    setup: 'Collection: users with document {name: "John", hobbies: ["reading", "coding"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$push: {hobbies: "swimming"}})',
    hints: ['Use $push to add element to end of array', 'Adds single value or entire array'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$push\s*:\s*\{\s*hobbies\s*:\s*"swimming"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', '$push'],
  },
  {
    id: 'mongo-array-005',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Update Array with $pull',
    text: 'Remove "coding" from hobbies array for user "John".',
    setup:
      'Collection: users with document {name: "John", hobbies: ["reading", "coding", "music"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding", "music"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$pull: {hobbies: "coding"}})',
    hints: ['Use $pull to remove matching elements', 'Removes all occurrences of value'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$pull\s*:\s*\{\s*hobbies\s*:\s*"coding"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', '$pull'],
  },
  {
    id: 'mongo-array-006',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Update Array with $addToSet',
    text: 'Add "swimming" to hobbies array only if it does not already exist.',
    setup: 'Collection: users with document {name: "John", hobbies: ["reading", "coding"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$addToSet: {hobbies: "swimming"}})',
    hints: ['Use $addToSet to add only if not exists', 'Prevents duplicate values'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$addToSet\s*:\s*\{\s*hobbies\s*:\s*"swimming"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', '$addToSet'],
  },
  {
    id: 'mongo-array-007',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update Array Element by Index',
    text: 'Update the second element (index 1) in scores array to 100 for user "John".',
    setup: 'Collection: users with document {name: "John", scores: [80, 90, 85]}',
    setupCode: `db.users.insertOne({name: "John", scores: [80, 90, 85]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$set: {"scores.1": 100}})',
    hints: ['Use dot notation with index to update array element', 'Array indices start at 0'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*"scores\.1"\s*:\s*100\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', 'index'],
  },
  {
    id: 'mongo-array-008',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update Array with $pop',
    text: 'Remove the last element from hobbies array for user "John".',
    setup:
      'Collection: users with document {name: "John", hobbies: ["reading", "coding", "music"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding", "music"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$pop: {hobbies: 1}})',
    hints: [
      'Use $pop to remove first (1) or last (-1) element',
      '1 removes last, -1 removes first',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$pop\s*:\s*\{\s*hobbies\s*:\s*1\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', '$pop'],
  },
  {
    id: 'mongo-array-009',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update Array with $pullAll',
    text: 'Remove both "reading" and "coding" from hobbies array for user "John".',
    setup:
      'Collection: users with document {name: "John", hobbies: ["reading", "coding", "music", "reading"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding", "music", "reading"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$pullAll: {hobbies: ["reading", "coding"]}})',
    hints: [
      'Use $pullAll to remove multiple values',
      'Removes all occurrences of all values in array',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$pullAll\s*:\s*\{\s*hobbies\s*:\s*\[/i,
    ],
    tags: ['update', 'array', '$pullAll'],
  },
  {
    id: 'mongo-array-010',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Query Nested Array Elements',
    text: 'Find all users where scores array contains an element greater than 90.',
    setup:
      'Collection: users with documents {name: "John", scores: [80, 95, 85]}, {name: "Jane", scores: [70, 75, 80]}',
    setupCode: `db.users.insertMany([
  {name: "John", scores: [80, 95, 85]},
  {name: "Jane", scores: [70, 75, 80]}
]);`,
    expected: [{ name: 'John', scores: [80, 95, 85] }],
    sample: 'db.users.find({scores: {$elemMatch: {$gt: 90}}})',
    hints: [
      'Use $elemMatch to query array elements',
      'Matches if at least one element meets criteria',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*scores\s*:\s*\{\s*\$elemMatch\s*:/i],
    tags: ['find', 'array', '$elemMatch'],
  },

  // ============================================================
  // TEXT SEARCH (5 problems)
  // ============================================================
  {
    id: 'mongo-text-001',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Create Text Index',
    text: 'Create a text index on the name field of users collection.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: 'Text index created',
    sample: 'db.users.createIndex({name: "text"})',
    hints: ['Use createIndex() to create index', 'Use "text" as value for text index'],
    validPatterns: [/db\.users\.createIndex\s*\(\s*\{\s*name\s*:\s*"text"\s*\}\s*\)/i],
    tags: ['index', 'text', 'createIndex'],
  },
  {
    id: 'mongo-text-002',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Text Search Query',
    text: 'Search for users where name field contains "John".',
    setup: 'Collection: users with text index on name, documents {name: "John"}, {name: "Jane"}',
    setupCode: `db.users.createIndex({name: "text"});
db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: [{ name: 'John' }],
    sample: 'db.users.find({$text: {$search: "John"}})',
    hints: ['Use $text operator for text search', '$search contains search terms'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*\$text\s*:\s*\{\s*\$search\s*:\s*"John"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'text', '$text'],
  },
  {
    id: 'mongo-text-003',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Text Search with Score',
    text: 'Search for "John" and return documents with text score.',
    setup: 'Collection: users with text index on name, document {name: "John"}',
    setupCode: `db.users.createIndex({name: "text"});
db.users.insertOne({name: "John"});`,
    expected: 'Document with text score',
    sample: 'db.users.find({$text: {$search: "John"}}, {score: {$meta: "textScore"}})',
    hints: ['Use $meta to include text score', 'Score indicates relevance'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\$text\s*:/i, /\$meta\s*:\s*"textScore"/i],
    tags: ['find', 'text', '$meta'],
  },
  {
    id: 'mongo-text-004',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Text Search with Multiple Fields',
    text: 'Create a text index on both name and description fields.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John", description: "Developer"});',
    expected: 'Text index created on multiple fields',
    sample: 'db.users.createIndex({name: "text", description: "text"})',
    hints: ['Include multiple fields in index object', 'All fields use "text" value'],
    validPatterns: [
      /db\.users\.createIndex\s*\(\s*\{\s*name\s*:\s*"text"\s*,\s*description\s*:\s*"text"\s*\}\s*\)/i,
    ],
    tags: ['index', 'text', 'multiple-fields'],
  },
  {
    id: 'mongo-text-005',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Text Search Exclude Term',
    text: 'Search for documents containing "John" but not "Jane".',
    setup:
      'Collection: users with text index, documents {name: "John"}, {name: "Jane"}, {name: "John Jane"}',
    setupCode: `db.users.createIndex({name: "text"});
db.users.insertMany([
  {name: "John"},
  {name: "Jane"},
  {name: "John Jane"}
]);`,
    expected: [{ name: 'John' }],
    sample: 'db.users.find({$text: {$search: "John -Jane"}})',
    hints: ['Use minus sign to exclude terms', 'Syntax: "term1 -term2"'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\$text\s*:\s*\{\s*\$search\s*:\s*"John\s+-Jane"/i],
    tags: ['find', 'text', 'exclude'],
  },

  // ============================================================
  // INDEX OPERATIONS (5 problems)
  // ============================================================
  {
    id: 'mongo-index-001',
    category: 'Index Operations',
    difficulty: 'easy',
    title: 'Create Single Field Index',
    text: 'Create an index on the age field of users collection.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John", age: 30});',
    expected: 'Index created',
    sample: 'db.users.createIndex({age: 1})',
    hints: ['Use createIndex() to create index', '1 for ascending, -1 for descending'],
    validPatterns: [/db\.users\.createIndex\s*\(\s*\{\s*age\s*:\s*1\s*\}\s*\)/i],
    tags: ['index', 'createIndex'],
  },
  {
    id: 'mongo-index-002',
    category: 'Index Operations',
    difficulty: 'easy',
    title: 'Create Compound Index',
    text: 'Create a compound index on name (ascending) and age (descending).',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John", age: 30});',
    expected: 'Compound index created',
    sample: 'db.users.createIndex({name: 1, age: -1})',
    hints: ['Include multiple fields in index', 'Order matters for compound indexes'],
    validPatterns: [
      /db\.users\.createIndex\s*\(\s*\{\s*name\s*:\s*1\s*,\s*age\s*:\s*-1\s*\}\s*\)/i,
    ],
    tags: ['index', 'compound', 'createIndex'],
  },
  {
    id: 'mongo-index-003',
    category: 'Index Operations',
    difficulty: 'medium',
    title: 'List All Indexes',
    text: 'List all indexes on the users collection.',
    setup: 'Collection: users with indexes',
    setupCode: 'db.users.createIndex({name: 1});',
    expected: [
      { v: 2, key: { _id: 1 }, name: '_id_' },
      { v: 2, key: { name: 1 }, name: 'name_1' },
    ],
    sample: 'db.users.getIndexes()',
    hints: ['Use getIndexes() to list all indexes', 'Returns array of index definitions'],
    validPatterns: [/db\.users\.getIndexes\s*\(\s*\)/i],
    tags: ['index', 'getIndexes'],
  },
  {
    id: 'mongo-index-004',
    category: 'Index Operations',
    difficulty: 'medium',
    title: 'Drop Index',
    text: 'Drop the index on the age field.',
    setup: 'Collection: users with index on age',
    setupCode: 'db.users.createIndex({age: 1});',
    expected: { nIndexesWas: 2, ok: 1 },
    sample: 'db.users.dropIndex({age: 1})',
    hints: ['Use dropIndex() to remove index', 'Pass index specification or name'],
    validPatterns: [/db\.users\.dropIndex\s*\(\s*\{\s*age\s*:\s*1\s*\}\s*\)/i],
    tags: ['index', 'dropIndex'],
  },
  {
    id: 'mongo-index-005',
    category: 'Index Operations',
    difficulty: 'hard',
    title: 'Create Unique Index',
    text: 'Create a unique index on the email field.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John", email: "john@test.com"});',
    expected: 'Unique index created',
    sample: 'db.users.createIndex({email: 1}, {unique: true})',
    hints: ['Use options object as second parameter', 'Set unique: true for unique constraint'],
    validPatterns: [
      /db\.users\.createIndex\s*\(\s*\{\s*email\s*:\s*1\s*\}\s*,\s*\{\s*unique\s*:\s*true\s*\}\s*\)/i,
    ],
    tags: ['index', 'unique', 'createIndex'],
  },

  // ============================================================
  // GEOSPATIAL QUERIES (10 problems)
  // ============================================================
  {
    id: 'mongo-geo-001',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: 'Create 2dsphere Index',
    text: 'Create a 2dsphere index on the location field of users collection.',
    setup: 'Collection: users',
    setupCode:
      'db.users.insertOne({name: "John", location: {type: "Point", coordinates: [-73.97, 40.77]});',
    expected: '2dsphere index created',
    sample: 'db.users.createIndex({location: "2dsphere"})',
    hints: ['Use "2dsphere" for geospatial index', 'Required for geospatial queries'],
    validPatterns: [/db\.users\.createIndex\s*\(\s*\{\s*location\s*:\s*"2dsphere"\s*\}\s*\)/i],
    tags: ['index', 'geospatial', '2dsphere'],
  },
  {
    id: 'mongo-geo-002',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: 'Find Near Location',
    text: 'Find all users within 1000 meters of coordinates [-73.97, 40.77].',
    setup:
      'Collection: users with 2dsphere index, document {name: "John", location: {type: "Point", coordinates: [-73.97, 40.77]}}',
    setupCode: `db.users.createIndex({location: "2dsphere"});
db.users.insertOne({name: "John", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: [{ name: 'John', location: { type: 'Point', coordinates: [-73.97, 40.77] } }],
    sample:
      'db.users.find({location: {$near: {$geometry: {type: "Point", coordinates: [-73.97, 40.77]}, $maxDistance: 1000}}})',
    hints: [
      'Use $near for proximity search',
      '$geometry specifies center point',
      '$maxDistance in meters',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*location\s*:\s*\{\s*\$near\s*:/i],
    tags: ['find', 'geospatial', '$near'],
  },
  {
    id: 'mongo-geo-003',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: 'Find Within Polygon',
    text: 'Find all users within a specified polygon area.',
    setup: 'Collection: users with 2dsphere index',
    setupCode: `db.users.createIndex({location: "2dsphere"});
db.users.insertOne({name: "John", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: [{ name: 'John', location: { type: 'Point', coordinates: [-73.97, 40.77] } }],
    sample:
      'db.users.find({location: {$geoWithin: {$geometry: {type: "Polygon", coordinates: [[[-74, 40], [-73, 40], [-73, 41], [-74, 41], [-74, 40]]]}}}}})',
    hints: [
      'Use $geoWithin to find points inside geometry',
      'Polygon coordinates must form closed ring',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*location\s*:\s*\{\s*\$geoWithin\s*:/i],
    tags: ['find', 'geospatial', '$geoWithin'],
  },
  {
    id: 'mongo-geo-004',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: 'Find Intersecting Geometry',
    text: 'Find all users whose location intersects with a specified line.',
    setup: 'Collection: users with 2dsphere index',
    setupCode: `db.users.createIndex({location: "2dsphere"});
db.users.insertOne({name: "John", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: [{ name: 'John', location: { type: 'Point', coordinates: [-73.97, 40.77] } }],
    sample:
      'db.users.find({location: {$geoIntersects: {$geometry: {type: "LineString", coordinates: [[-74, 40], [-73, 41]]}}}}})',
    hints: ['Use $geoIntersects to find geometries that intersect', 'Works with any geometry type'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*location\s*:\s*\{\s*\$geoIntersects\s*:/i],
    tags: ['find', 'geospatial', '$geoIntersects'],
  },
  {
    id: 'mongo-geo-005',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: 'Create 2d Index',
    text: 'Create a 2d index on coordinates array [longitude, latitude].',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John", coordinates: [-73.97, 40.77]});',
    expected: '2d index created',
    sample: 'db.users.createIndex({coordinates: "2d"})',
    hints: ['Use "2d" for flat coordinate pairs', 'Coordinates must be [longitude, latitude]'],
    validPatterns: [/db\.users\.createIndex\s*\(\s*\{\s*coordinates\s*:\s*"2d"\s*\}\s*\)/i],
    tags: ['index', 'geospatial', '2d'],
  },

  // ============================================================
  // DATE OPERATIONS (5 problems)
  // ============================================================
  {
    id: 'mongo-date-001',
    category: 'Date Operations',
    difficulty: 'easy',
    title: 'Find by Date Range',
    text: 'Find all users created between January 1, 2024 and January 31, 2024.',
    setup:
      'Collection: users with documents {name: "John", createdAt: ISODate("2024-01-15")}, {name: "Jane", createdAt: ISODate("2024-02-01")}',
    setupCode: `db.users.insertMany([
  {name: "John", createdAt: ISODate("2024-01-15")},
  {name: "Jane", createdAt: ISODate("2024-02-01")}
]);`,
    expected: 'Users created in January 2024',
    sample:
      'db.users.find({createdAt: {$gte: ISODate("2024-01-01"), $lte: ISODate("2024-01-31")}})',
    hints: ['Use ISODate() to create date objects', 'Use $gte and $lte for date ranges'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*createdAt\s*:\s*\{\s*\$gte\s*:\s*ISODate/i,
      /\$lte\s*:\s*ISODate/i,
    ],
    tags: ['find', 'date', 'range'],
  },
  {
    id: 'mongo-date-002',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Find Documents from Last 7 Days',
    text: 'Find all users created in the last 7 days.',
    setup: 'Collection: users with documents',
    setupCode: `db.users.insertOne({name: "John", createdAt: new Date()});`,
    expected: 'Users from last 7 days',
    sample: 'db.users.find({createdAt: {$gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)}})',
    hints: [
      'Use Date.now() for current timestamp',
      'Subtract milliseconds for past dates',
      '7 days = 7 * 24 * 60 * 60 * 1000 ms',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*createdAt\s*:\s*\{\s*\$gte\s*:\s*new\s+Date/i],
    tags: ['find', 'date', 'relative'],
  },
  {
    id: 'mongo-date-003',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Aggregation with Date Grouping',
    text: 'Group users by year of creation and count documents in each year.',
    setup:
      'Collection: users with documents {name: "John", createdAt: ISODate("2024-01-15")}, {name: "Jane", createdAt: ISODate("2024-06-20")}, {name: "Bob", createdAt: ISODate("2023-12-01")}',
    setupCode: `db.users.insertMany([
  {name: "John", createdAt: ISODate("2024-01-15")},
  {name: "Jane", createdAt: ISODate("2024-06-20")},
  {name: "Bob", createdAt: ISODate("2023-12-01")}
]);`,
    expected: [
      { _id: 2024, count: 2 },
      { _id: 2023, count: 1 },
    ],
    sample: 'db.users.aggregate([{$group: {_id: {$year: "$createdAt"}, count: {$sum: 1}}}])',
    hints: ['Use $year to extract year from date', 'Group by year field'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:/i,
      /\$year\s*:\s*"\$createdAt"/i,
    ],
    tags: ['aggregation', 'date', '$year'],
  },
  {
    id: 'mongo-date-004',
    category: 'Date Operations',
    difficulty: 'hard',
    title: 'Aggregation with Date Formatting',
    text: 'Add formatted date string field using $dateToString.',
    setup: 'Collection: users with document {name: "John", createdAt: ISODate("2024-01-15")}',
    setupCode: `db.users.insertOne({name: "John", createdAt: ISODate("2024-01-15")});`,
    expected: 'Document with formatted date string',
    sample:
      'db.users.aggregate([{$addFields: {dateStr: {$dateToString: {format: "%Y-%m-%d", date: "$createdAt"}}}}])',
    hints: ['Use $dateToString to format dates', 'format uses strftime-style format strings'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$addFields\s*:/i,
      /\$dateToString\s*:/i,
    ],
    tags: ['aggregation', 'date', '$dateToString'],
  },
  {
    id: 'mongo-date-005',
    category: 'Date Operations',
    difficulty: 'hard',
    title: 'Calculate Date Difference',
    text: 'Add a field showing days since creation using $subtract.',
    setup: 'Collection: users with document {name: "John", createdAt: ISODate("2024-01-01")}',
    setupCode: `db.users.insertOne({name: "John", createdAt: ISODate("2024-01-01")});`,
    expected: 'Document with daysSinceCreation field',
    sample:
      'db.users.aggregate([{$addFields: {daysSinceCreation: {$divide: [{$subtract: [new Date(), "$createdAt"]}, 1000 * 60 * 60 * 24]}}}])',
    hints: [
      'Use $subtract to get time difference in milliseconds',
      'Divide by milliseconds per day',
      '1000 * 60 * 60 * 24 = ms per day',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$addFields\s*:/i, /\$subtract\s*:/i],
    tags: ['aggregation', 'date', '$subtract'],
  },

  // ============================================================
  // REPLACE OPERATIONS (5 problems)
  // ============================================================
  {
    id: 'mongo-replace-001',
    category: 'Replace Operations',
    difficulty: 'easy',
    title: 'Replace One Document',
    text: 'Replace the entire document for user "John" with new data.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.replaceOne({name: "John"}, {name: "John", age: 31, city: "NYC"})',
    hints: ['Use replaceOne() to replace entire document', 'Second parameter is new document'],
    validPatterns: [/db\.users\.replaceOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{/i],
    tags: ['replace', 'replaceOne'],
  },
  {
    id: 'mongo-replace-002',
    category: 'Replace Operations',
    difficulty: 'medium',
    title: 'Replace with Upsert',
    text: 'Replace user "John" or insert if not exists.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Upserted document',
    sample: 'db.users.replaceOne({name: "John"}, {name: "John", age: 30}, {upsert: true})',
    hints: ['Use upsert option to insert if not found', 'Third parameter is options object'],
    validPatterns: [
      /db\.users\.replaceOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{/i,
      /upsert\s*:\s*true/i,
    ],
    tags: ['replace', 'upsert'],
  },
  {
    id: 'mongo-replace-003',
    category: 'Replace Operations',
    difficulty: 'hard',
    title: 'Find and Replace',
    text: 'Find user "John" and replace with new document, returning the original.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { name: 'John', age: 30 },
    sample:
      'db.users.findOneAndReplace({name: "John"}, {name: "John", age: 31}, {returnDocument: "before"})',
    hints: [
      'Use findOneAndReplace() for atomic operation',
      'returnDocument: "before" returns original, "after" returns new',
    ],
    validPatterns: [/db\.users\.findOneAndReplace\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{/i],
    tags: ['replace', 'findOneAndReplace'],
  },
  {
    id: 'mongo-replace-004',
    category: 'Replace Operations',
    difficulty: 'hard',
    title: 'Find and Replace with Return New',
    text: 'Replace user "John" and return the new document.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { name: 'John', age: 31 },
    sample:
      'db.users.findOneAndReplace({name: "John"}, {name: "John", age: 31}, {returnDocument: "after"})',
    hints: ['Use returnDocument: "after" to get new document', 'Default is "before"'],
    validPatterns: [
      /db\.users\.findOneAndReplace\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{/i,
      /returnDocument\s*:\s*"after"/i,
    ],
    tags: ['replace', 'findOneAndReplace'],
  },
  {
    id: 'mongo-replace-005',
    category: 'Replace Operations',
    difficulty: 'medium',
    title: 'Bulk Replace Operations',
    text: 'Replace multiple users in a single operation using bulkWrite.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: { acknowledged: true, modifiedCount: 2 },
    sample:
      'db.users.bulkWrite([{replaceOne: {filter: {name: "John"}, replacement: {name: "John", age: 31}}}, {replaceOne: {filter: {name: "Jane"}, replacement: {name: "Jane", age: 26}}}])',
    hints: ['Use bulkWrite() for multiple operations', 'Each operation is an object in array'],
    validPatterns: [/db\.users\.bulkWrite\s*\(\s*\[/i, /replaceOne\s*:/i],
    tags: ['replace', 'bulkWrite'],
  },

  // ============================================================
  // ADVANCED AGGREGATION (10 problems)
  // ============================================================
  {
    id: 'mongo-agg-016',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $filter',
    text: 'Filter scores array to only include values greater than 80.',
    setup: 'Collection: users with document {name: "John", scores: [80, 95, 70, 85]}',
    setupCode: `db.users.insertOne({name: "John", scores: [80, 95, 70, 85]});`,
    expected: [{ name: 'John', highScores: [95, 85] }],
    sample:
      'db.users.aggregate([{$project: {name: 1, highScores: {$filter: {input: "$scores", as: "score", cond: {$gt: ["$$score", 80]}}}}}])',
    hints: [
      'Use $filter to filter array elements',
      'input: array, as: variable name, cond: condition',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$project\s*:/i, /\$filter\s*:/i],
    tags: ['aggregation', '$filter', 'array'],
  },
  {
    id: 'mongo-agg-017',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $map',
    text: 'Double all values in scores array.',
    setup: 'Collection: users with document {name: "John", scores: [10, 20, 30]}',
    setupCode: `db.users.insertOne({name: "John", scores: [10, 20, 30]});`,
    expected: [{ name: 'John', doubledScores: [20, 40, 60] }],
    sample:
      'db.users.aggregate([{$project: {name: 1, doubledScores: {$map: {input: "$scores", as: "score", in: {$multiply: ["$$score", 2]}}}}}])',
    hints: ['Use $map to transform array elements', 'in: expression to apply to each element'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$project\s*:/i, /\$map\s*:/i],
    tags: ['aggregation', '$map', 'array'],
  },
  {
    id: 'mongo-agg-018',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $reduce',
    text: 'Calculate sum of all scores in scores array.',
    setup: 'Collection: users with document {name: "John", scores: [10, 20, 30]}',
    setupCode: `db.users.insertOne({name: "John", scores: [10, 20, 30]});`,
    expected: [{ name: 'John', totalScore: 60 }],
    sample:
      'db.users.aggregate([{$project: {name: 1, totalScore: {$reduce: {input: "$scores", initialValue: 0, in: {$add: ["$$value", "$$this"]}}}}}])',
    hints: [
      'Use $reduce to accumulate array values',
      'initialValue: starting value, in: accumulation expression',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$project\s*:/i, /\$reduce\s*:/i],
    tags: ['aggregation', '$reduce', 'array'],
  },
  {
    id: 'mongo-agg-019',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $bucket',
    text: 'Group users into age buckets: 0-25, 25-50, 50+.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 20}, {name: "Bob", age: 60}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 20},
  {name: "Bob", age: 60}
]);`,
    expected: [
      { _id: 0, count: 1 },
      { _id: 25, count: 1 },
      { _id: 50, count: 1 },
    ],
    sample:
      'db.users.aggregate([{$bucket: {groupBy: "$age", boundaries: [0, 25, 50, 100], default: "other"}}])',
    hints: [
      'Use $bucket to group into ranges',
      'boundaries: array of bucket edges',
      'default: bucket for values outside boundaries',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$bucket\s*:/i],
    tags: ['aggregation', '$bucket'],
  },
  {
    id: 'mongo-agg-020',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $merge',
    text: 'Group users by age and merge results into summary collection.',
    setup: 'Collection: users with documents',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 30}
]);`,
    expected: 'Results merged into summary collection',
    sample:
      'db.users.aggregate([{$group: {_id: "$age", count: {$sum: 1}}}, {$merge: {into: "ageSummary"}}])',
    hints: ['Use $merge to write results to collection', 'into: target collection name'],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:/i,
      /\{\s*\$merge\s*:\s*\{\s*into\s*:\s*"ageSummary"/i,
    ],
    tags: ['aggregation', '$merge'],
  },
  {
    id: 'mongo-agg-021',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $out',
    text: 'Group users by age and output to ageGroups collection.',
    setup: 'Collection: users with documents',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 30}
]);`,
    expected: 'Results written to ageGroups collection',
    sample: 'db.users.aggregate([{$group: {_id: "$age", count: {$sum: 1}}}, {$out: "ageGroups"}])',
    hints: [
      'Use $out to write results to new collection',
      'Replaces existing collection if it exists',
    ],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$group\s*:/i,
      /\{\s*\$out\s*:\s*"ageGroups"\s*\}/i,
    ],
    tags: ['aggregation', '$out'],
  },
  {
    id: 'mongo-agg-022',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $unionWith',
    text: 'Combine results from users and admins collections.',
    setup: 'Collections: users and admins',
    setupCode: `db.users.insertOne({name: "John", role: "user"});
db.admins.insertOne({name: "Admin", role: "admin"});`,
    expected: [
      { name: 'John', role: 'user' },
      { name: 'Admin', role: 'admin' },
    ],
    sample: 'db.users.aggregate([{$unionWith: {coll: "admins"}}])',
    hints: ['Use $unionWith to combine collections', 'coll: collection name to union with'],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$unionWith\s*:/i],
    tags: ['aggregation', '$unionWith'],
  },
  {
    id: 'mongo-agg-023',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $graphLookup',
    text: 'Find all managers in hierarchy using recursive lookup.',
    setup: 'Collection: employees with manager references',
    setupCode: `db.employees.insertMany([
  {_id: 1, name: "CEO", managerId: null},
  {_id: 2, name: "Manager", managerId: 1},
  {_id: 3, name: "Employee", managerId: 2}
]);`,
    expected: 'Employee with all managers in hierarchy',
    sample:
      'db.employees.aggregate([{$match: {_id: 3}}, {$graphLookup: {from: "employees", startWith: "$managerId", connectFromField: "managerId", connectToField: "_id", as: "managers"}}])',
    hints: [
      'Use $graphLookup for recursive relationships',
      'startWith: starting value, connectFromField/connectToField: relationship fields',
    ],
    validPatterns: [/db\.employees\.aggregate\s*\(\s*\[\s*\{\s*\$match\s*:/i, /\$graphLookup\s*:/i],
    tags: ['aggregation', '$graphLookup'],
  },
  {
    id: 'mongo-agg-024',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $densify',
    text: 'Create missing time series data points between existing points.',
    setup: 'Collection: metrics with time series data',
    setupCode: `db.metrics.insertMany([
  {time: ISODate("2024-01-01"), value: 10},
  {time: ISODate("2024-01-03"), value: 20}
]);`,
    expected: 'Densified time series with interpolated points',
    sample:
      'db.metrics.aggregate([{$densify: {field: "time", range: {step: 1, unit: "day"}, partitionByFields: []}}])',
    hints: [
      'Use $densify to fill gaps in time series',
      'range: step size and unit',
      'partitionByFields: optional grouping',
    ],
    validPatterns: [/db\.metrics\.aggregate\s*\(\s*\[\s*\{\s*\$densify\s*:/i],
    tags: ['aggregation', '$densify'],
  },
  {
    id: 'mongo-agg-025',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Aggregation with $setWindowFields',
    text: 'Calculate running total of scores using window function.',
    setup:
      'Collection: users with documents {name: "John", score: 10}, {name: "Jane", score: 20}, {name: "Bob", score: 30}',
    setupCode: `db.users.insertMany([
  {name: "John", score: 10},
  {name: "Jane", score: 20},
  {name: "Bob", score: 30}
]);`,
    expected: [
      { name: 'John', score: 10, runningTotal: 10 },
      { name: 'Jane', score: 20, runningTotal: 30 },
      { name: 'Bob', score: 30, runningTotal: 60 },
    ],
    sample:
      'db.users.aggregate([{$setWindowFields: {sortBy: {name: 1}, output: {runningTotal: {$sum: "$score", window: {documents: ["unboundedPreceding", "current"]}}}}}}])',
    hints: [
      'Use $setWindowFields for window functions',
      'window: range of documents to include',
      'unboundedPreceding: from start',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$setWindowFields\s*:/i],
    tags: ['aggregation', '$setWindowFields'],
  },

  // ============================================================
  // COLLECTION AND DATABASE OPERATIONS (10 problems)
  // ============================================================
  {
    id: 'mongo-collection-001',
    category: 'Collection Operations',
    difficulty: 'easy',
    title: 'List All Collections',
    text: 'List all collections in the current database.',
    setup: 'Database with collections',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: ['users'],
    sample: 'db.getCollectionNames()',
    hints: ['Use getCollectionNames() to list collections', 'Returns array of collection names'],
    validPatterns: [/db\.getCollectionNames\s*\(\s*\)/i],
    tags: ['collection', 'getCollectionNames'],
  },
  {
    id: 'mongo-collection-002',
    category: 'Collection Operations',
    difficulty: 'easy',
    title: 'Count Documents',
    text: 'Count total number of documents in users collection.',
    setup: 'Collection: users with 3 documents',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"},
  {name: "Bob"}
]);`,
    expected: 3,
    sample: 'db.users.countDocuments()',
    hints: ['Use countDocuments() to count documents', 'More accurate than count()'],
    validPatterns: [/db\.users\.countDocuments\s*\(\s*\)/i],
    tags: ['collection', 'countDocuments'],
  },
  {
    id: 'mongo-collection-003',
    category: 'Collection Operations',
    difficulty: 'easy',
    title: 'Count with Query',
    text: 'Count users where age is greater than 25.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: 1,
    sample: 'db.users.countDocuments({age: {$gt: 25}})',
    hints: ['Pass query object to countDocuments()', 'Counts only matching documents'],
    validPatterns: [
      /db\.users\.countDocuments\s*\(\s*\{\s*age\s*:\s*\{\s*\$gt\s*:\s*25\s*\}\s*\}\s*\)/i,
    ],
    tags: ['collection', 'countDocuments', 'query'],
  },
  {
    id: 'mongo-collection-004',
    category: 'Collection Operations',
    difficulty: 'medium',
    title: 'Get Collection Stats',
    text: 'Get statistics about the users collection.',
    setup: 'Collection: users with documents',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: 'Collection statistics object',
    sample: 'db.users.stats()',
    hints: ['Use stats() to get collection statistics', 'Returns size, count, indexes info'],
    validPatterns: [/db\.users\.stats\s*\(\s*\)/i],
    tags: ['collection', 'stats'],
  },
  {
    id: 'mongo-collection-005',
    category: 'Collection Operations',
    difficulty: 'medium',
    title: 'Validate Collection',
    text: 'Validate the users collection for data integrity.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: 'Validation result object',
    sample: 'db.users.validate()',
    hints: ['Use validate() to check collection integrity', 'Returns validation report'],
    validPatterns: [/db\.users\.validate\s*\(\s*\)/i],
    tags: ['collection', 'validate'],
  },
  {
    id: 'mongo-collection-006',
    category: 'Collection Operations',
    difficulty: 'hard',
    title: 'Rename Collection',
    text: 'Rename users collection to customers.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: { ok: 1 },
    sample: 'db.users.renameCollection("customers")',
    hints: ['Use renameCollection() to rename', 'Takes new collection name as parameter'],
    validPatterns: [/db\.users\.renameCollection\s*\(\s*"customers"\s*\)/i],
    tags: ['collection', 'renameCollection'],
  },
  {
    id: 'mongo-collection-007',
    category: 'Collection Operations',
    difficulty: 'hard',
    title: 'Copy Collection',
    text: 'Copy all documents from users to users_backup collection.',
    setup: 'Collection: users with documents',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: 'Documents copied to users_backup',
    sample: 'db.users.aggregate([{$out: "users_backup"}])',
    hints: [
      'Use $out in aggregation to copy collection',
      'Creates new collection with all documents',
    ],
    validPatterns: [
      /db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$out\s*:\s*"users_backup"\s*\}\s*\]\s*\)/i,
    ],
    tags: ['collection', 'copy', '$out'],
  },
  {
    id: 'mongo-collection-008',
    category: 'Collection Operations',
    difficulty: 'medium',
    title: 'Get Distinct Values',
    text: 'Get all distinct age values from users collection.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 30}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 30}
]);`,
    expected: [25, 30],
    sample: 'db.users.distinct("age")',
    hints: ['Use distinct() to get unique values', 'Pass field name as string'],
    validPatterns: [/db\.users\.distinct\s*\(\s*"age"\s*\)/i],
    tags: ['collection', 'distinct'],
  },
  {
    id: 'mongo-collection-009',
    category: 'Collection Operations',
    difficulty: 'medium',
    title: 'Get Distinct with Query',
    text: 'Get distinct age values for users where name starts with "J".',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 20}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 20}
]);`,
    expected: [25, 30],
    sample: 'db.users.distinct("age", {name: {$regex: /^J/}})',
    hints: [
      'distinct() accepts query as second parameter',
      'Filters before getting distinct values',
    ],
    validPatterns: [/db\.users\.distinct\s*\(\s*"age"\s*,\s*\{\s*name\s*:/i],
    tags: ['collection', 'distinct', 'query'],
  },
  {
    id: 'mongo-collection-010',
    category: 'Collection Operations',
    difficulty: 'hard',
    title: 'Estimated Document Count',
    text: 'Get estimated document count for users collection (faster than countDocuments).',
    setup: 'Collection: users with documents',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: 2,
    sample: 'db.users.estimatedDocumentCount()',
    hints: [
      'Use estimatedDocumentCount() for fast count',
      'Uses collection metadata, may be approximate',
    ],
    validPatterns: [/db\.users\.estimatedDocumentCount\s*\(\s*\)/i],
    tags: ['collection', 'estimatedDocumentCount'],
  },

  // ============================================================
  // ADVANCED UPDATE OPERATORS (15 problems)
  // ============================================================
  {
    id: 'mongo-update-011',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $mul',
    text: 'Multiply the age field by 2 for user "John".',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$mul: {age: 2}})',
    hints: ['Use $mul to multiply numeric field', 'Multiplies current value by specified number'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$mul\s*:\s*\{\s*age\s*:\s*2\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$mul'],
  },
  {
    id: 'mongo-update-012',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $min',
    text: 'Set age to minimum of current age and 25 for user "John".',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$min: {age: 25}})',
    hints: ['Use $min to set field to minimum value', 'Only updates if new value is smaller'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$min\s*:\s*\{\s*age\s*:\s*25\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$min'],
  },
  {
    id: 'mongo-update-013',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $max',
    text: 'Set age to maximum of current age and 35 for user "John".',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$max: {age: 35}})',
    hints: ['Use $max to set field to maximum value', 'Only updates if new value is larger'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$max\s*:\s*\{\s*age\s*:\s*35\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$max'],
  },
  {
    id: 'mongo-update-014',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $currentDate',
    text: 'Set lastModified field to current date for user "John".',
    setup: 'Collection: users with document {name: "John"}',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$currentDate: {lastModified: true}})',
    hints: [
      'Use $currentDate to set current timestamp',
      'true sets to Date, {$type: "timestamp"} sets to Timestamp',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$currentDate\s*:/i,
    ],
    tags: ['update', '$currentDate'],
  },
  {
    id: 'mongo-update-015',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $rename',
    text: 'Rename the "name" field to "fullName" for user "John".',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$rename: {name: "fullName"}})',
    hints: ['Use $rename to rename field', 'Syntax: {oldName: "newName"}'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$rename\s*:\s*\{\s*name\s*:\s*"fullName"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$rename'],
  },
  {
    id: 'mongo-update-016',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array with $position',
    text: 'Add "swimming" to hobbies array at position 0 (beginning).',
    setup: 'Collection: users with document {name: "John", hobbies: ["reading", "coding"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({name: "John"}, {$push: {hobbies: {$each: ["swimming"], $position: 0}}})',
    hints: ['Use $each with $position in $push', '$position: 0 inserts at beginning'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$push\s*:\s*\{\s*hobbies\s*:\s*\{\s*\$each\s*:/i,
      /\$position\s*:\s*0/i,
    ],
    tags: ['update', '$push', '$each', '$position'],
  },
  {
    id: 'mongo-update-017',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array with $slice',
    text: 'Add "swimming" to hobbies and keep only last 3 elements.',
    setup:
      'Collection: users with document {name: "John", hobbies: ["reading", "coding", "music"]}',
    setupCode: `db.users.insertOne({name: "John", hobbies: ["reading", "coding", "music"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({name: "John"}, {$push: {hobbies: {$each: ["swimming"], $slice: -3}}})',
    hints: ['Use $slice with $push to limit array size', 'Negative number keeps last N elements'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$push\s*:\s*\{\s*hobbies\s*:\s*\{\s*\$each\s*:/i,
      /\$slice\s*:\s*-3/i,
    ],
    tags: ['update', '$push', '$slice'],
  },
  {
    id: 'mongo-update-018',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array Element with $',
    text: 'Update the first score greater than 80 to 100.',
    setup: 'Collection: users with document {name: "John", scores: [80, 95, 85]}',
    setupCode: `db.users.insertOne({name: "John", scores: [80, 95, 85]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({scores: {$gt: 80}}, {$set: {"scores.$": 100}})',
    hints: [
      'Use $ positional operator to update matched array element',
      'Matches first element meeting query condition',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*scores\s*:\s*\{\s*\$gt\s*:\s*80\s*\}\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*"scores\.\$"\s*:\s*100\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', 'positional'],
  },
  {
    id: 'mongo-update-019',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array with $[]',
    text: 'Update all elements in scores array to multiply by 2.',
    setup: 'Collection: users with document {name: "John", scores: [10, 20, 30]}',
    setupCode: `db.users.insertOne({name: "John", scores: [10, 20, 30]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$mul: {"scores[]": 2}})',
    hints: ['Use [] to update all array elements', 'Applies operation to every element'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$mul\s*:\s*\{\s*"scores\[\]"\s*:\s*2\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'array', 'all-elements'],
  },
  {
    id: 'mongo-update-020',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array with $[<identifier>]',
    text: 'Update all scores greater than 80 to 100 using filtered positional operator.',
    setup: 'Collection: users with document {name: "John", scores: [80, 95, 85]}',
    setupCode: `db.users.insertOne({name: "John", scores: [80, 95, 85]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({name: "John"}, {$set: {"scores[$elem]": 100}}, {arrayFilters: [{"elem": {$gt: 80}}]})',
    hints: [
      'Use arrayFilters with filtered positional operator',
      'arrayFilters: conditions for which elements to update',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:/i,
      /arrayFilters\s*:/i,
    ],
    tags: ['update', 'array', 'arrayFilters'],
  },
  {
    id: 'mongo-update-021',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $bit',
    text: 'Perform bitwise AND operation on flags field with value 7.',
    setup: 'Collection: users with document {name: "John", flags: 15}',
    setupCode: `db.users.insertOne({name: "John", flags: 15});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$bit: {flags: {and: 7}}})',
    hints: [
      'Use $bit for bitwise operations',
      'and: bitwise AND, or: bitwise OR, xor: bitwise XOR',
    ],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$bit\s*:\s*\{\s*flags\s*:\s*\{\s*and\s*:\s*7\s*\}\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$bit'],
  },
  {
    id: 'mongo-update-022',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $setOnInsert',
    text: 'Set createdAt field only if document is inserted (not updated).',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Upserted document with createdAt',
    sample:
      'db.users.updateOne({name: "John"}, {$set: {age: 30}, $setOnInsert: {createdAt: new Date()}}, {upsert: true})',
    hints: ['Use $setOnInsert to set fields only on insert', 'Useful with upsert operations'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:/i,
      /\$setOnInsert\s*:/i,
      /upsert\s*:\s*true/i,
    ],
    tags: ['update', '$setOnInsert', 'upsert'],
  },
  {
    id: 'mongo-update-023',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $replaceRoot',
    text: 'Replace document root with nested user object.',
    setup: 'Collection: users with document {_id: 1, user: {name: "John", age: 30}}',
    setupCode: `db.users.insertOne({_id: 1, user: {name: "John", age: 30}});`,
    expected: { name: 'John', age: 30 },
    sample: 'db.users.aggregate([{$replaceRoot: {newRoot: "$user"}}])',
    hints: [
      'Use $replaceRoot in aggregation to promote nested object',
      'newRoot: field to become root',
    ],
    validPatterns: [/db\.users\.aggregate\s*\(\s*\[\s*\{\s*\$replaceRoot\s*:/i],
    tags: ['aggregation', '$replaceRoot'],
  },
  {
    id: 'mongo-update-024',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Bulk Update Operations',
    text: 'Update multiple users in a single bulkWrite operation.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: { acknowledged: true, modifiedCount: 2 },
    sample:
      'db.users.bulkWrite([{updateOne: {filter: {name: "John"}, update: {$set: {age: 31}}}}, {updateOne: {filter: {name: "Jane"}, update: {$set: {age: 26}}}}])',
    hints: [
      'Use bulkWrite() for multiple update operations',
      'Each operation is an object in array',
    ],
    validPatterns: [/db\.users\.bulkWrite\s*\(\s*\[/i, /updateOne\s*:/i],
    tags: ['update', 'bulkWrite'],
  },
  {
    id: 'mongo-update-025',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Find and Update',
    text: 'Find user "John" and update age to 31, returning the updated document.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { name: 'John', age: 31 },
    sample:
      'db.users.findOneAndUpdate({name: "John"}, {$set: {age: 31}}, {returnDocument: "after"})',
    hints: [
      'Use findOneAndUpdate() for atomic find and update',
      'returnDocument: "after" returns updated document',
    ],
    validPatterns: [
      /db\.users\.findOneAndUpdate\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:/i,
      /returnDocument\s*:\s*"after"/i,
    ],
    tags: ['update', 'findOneAndUpdate'],
  },

  // ============================================================
  // TRANSACTIONS AND CONSISTENCY (5 problems)
  // ============================================================
  {
    id: 'mongo-transaction-001',
    category: 'Transactions',
    difficulty: 'hard',
    title: 'Start Session',
    text: 'Start a MongoDB session for transaction support.',
    setup: 'MongoDB with replica set',
    setupCode: '// Requires replica set',
    expected: 'Session started',
    sample: 'const session = db.getMongo().startSession()',
    hints: ['Use startSession() to create session', 'Required for multi-document transactions'],
    validPatterns: [/startSession\s*\(\s*\)/i, /getMongo\s*\(\s*\)\s*\.startSession/i],
    tags: ['transaction', 'session'],
  },
  {
    id: 'mongo-transaction-002',
    category: 'Transactions',
    difficulty: 'hard',
    title: 'Multi-Document Transaction',
    text: 'Perform transaction: update user and insert order atomically.',
    setup: 'Collections: users and orders',
    setupCode: `db.users.insertOne({_id: 1, name: "John", balance: 100});
db.orders.deleteMany({});`,
    expected: 'Transaction completed',
    sample:
      'const session = db.getMongo().startSession(); session.startTransaction(); try { db.users.updateOne({_id: 1}, {$inc: {balance: -50}}, {session}); db.orders.insertOne({userId: 1, amount: 50}, {session}); session.commitTransaction(); } catch(e) { session.abortTransaction(); }',
    hints: [
      'Start transaction with startTransaction()',
      'Pass {session} to operations',
      'Commit or abort transaction',
    ],
    validPatterns: [/session\.startTransaction\s*\(\s*\)/i, /session\.commitTransaction/i],
    tags: ['transaction', 'multi-document'],
  },
  {
    id: 'mongo-transaction-003',
    category: 'Transactions',
    difficulty: 'hard',
    title: 'Read Concern',
    text: 'Read with majority read concern for strong consistency.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: [{ name: 'John' }],
    sample: 'db.users.find({name: "John"}).readConcern("majority")',
    hints: [
      'Use readConcern() to set read concern level',
      '"majority" ensures read from majority of replicas',
    ],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*\)\s*\.readConcern\s*\(\s*"majority"\s*\)/i,
    ],
    tags: ['read', 'readConcern'],
  },
  {
    id: 'mongo-transaction-004',
    category: 'Transactions',
    difficulty: 'hard',
    title: 'Write Concern',
    text: 'Insert with majority write concern for durability.',
    setup: 'Collection: users',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Document inserted with write concern',
    sample: 'db.users.insertOne({name: "John"}, {writeConcern: {w: "majority", wtimeout: 5000}})',
    hints: [
      'Use writeConcern option in insert operations',
      'w: "majority" waits for majority acknowledgment',
    ],
    validPatterns: [
      /db\.users\.insertOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*writeConcern\s*:/i,
    ],
    tags: ['insert', 'writeConcern'],
  },
  {
    id: 'mongo-transaction-005',
    category: 'Transactions',
    difficulty: 'hard',
    title: 'Change Streams',
    text: 'Watch for changes to users collection using change streams.',
    setup: 'Collection: users',
    setupCode: 'db.users.insertOne({name: "John"});',
    expected: 'Change stream watching collection',
    sample: 'db.users.watch()',
    hints: ['Use watch() to create change stream', 'Returns cursor with change events'],
    validPatterns: [/db\.users\.watch\s*\(\s*\)/i],
    tags: ['change-streams', 'watch'],
  },

  // ============================================================
  // NEW PROBLEMS - QUERY OPERATORS EXTENDED (50 problems)
  // ============================================================
  {
    id: 'mongo-query-200',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $eq Explicit',
    text: 'Find all users where status explicitly equals "active".',
    setup:
      'Collection: users with documents {name: "John", status: "active"}, {name: "Jane", status: "inactive"}',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "inactive"}
]);`,
    expected: [{ name: 'John', status: 'active' }],
    sample: 'db.users.find({status: {$eq: "active"}})',
    hints: ['Use $eq for explicit equality', 'Equivalent to {status: "active"}'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*status\s*:\s*\{\s*\$eq\s*:\s*"active"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$eq'],
  },
  {
    id: 'mongo-query-201',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $ne Operator',
    text: 'Find all users where status is not equal to "inactive".',
    setup:
      'Collection: users with documents {name: "John", status: "active"}, {name: "Jane", status: "inactive"}',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "inactive"}
]);`,
    expected: [{ name: 'John', status: 'active' }],
    sample: 'db.users.find({status: {$ne: "inactive"}})',
    hints: ['Use $ne for not equal', 'Returns documents where field does not match'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*status\s*:\s*\{\s*\$ne\s*:\s*"inactive"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$ne'],
  },
  {
    id: 'mongo-query-202',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $lt Operator',
    text: 'Find all products where price is less than 50.',
    setup:
      'Collection: products with documents {name: "Apple", price: 30}, {name: "Orange", price: 60}',
    setupCode: `db.products.insertMany([
  {name: "Apple", price: 30},
  {name: "Orange", price: 60}
]);`,
    expected: [{ name: 'Apple', price: 30 }],
    sample: 'db.products.find({price: {$lt: 50}})',
    hints: ['Use $lt for less than', 'Does not include the boundary value'],
    validPatterns: [
      /db\.products\.find\s*\(\s*\{\s*price\s*:\s*\{\s*\$lt\s*:\s*50\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$lt'],
  },
  {
    id: 'mongo-query-203',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $lte Operator',
    text: 'Find all products where price is less than or equal to 50.',
    setup:
      'Collection: products with documents {name: "Apple", price: 50}, {name: "Orange", price: 60}',
    setupCode: `db.products.insertMany([
  {name: "Apple", price: 50},
  {name: "Orange", price: 60}
]);`,
    expected: [{ name: 'Apple', price: 50 }],
    sample: 'db.products.find({price: {$lte: 50}})',
    hints: ['Use $lte for less than or equal', 'Includes the boundary value'],
    validPatterns: [
      /db\.products\.find\s*\(\s*\{\s*price\s*:\s*\{\s*\$lte\s*:\s*50\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$lte'],
  },
  {
    id: 'mongo-query-204',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $gte Operator',
    text: 'Find all products where price is greater than or equal to 50.',
    setup:
      'Collection: products with documents {name: "Apple", price: 50}, {name: "Orange", price: 30}',
    setupCode: `db.products.insertMany([
  {name: "Apple", price: 50},
  {name: "Orange", price: 30}
]);`,
    expected: [{ name: 'Apple', price: 50 }],
    sample: 'db.products.find({price: {$gte: 50}})',
    hints: ['Use $gte for greater than or equal', 'Includes the boundary value'],
    validPatterns: [
      /db\.products\.find\s*\(\s*\{\s*price\s*:\s*\{\s*\$gte\s*:\s*50\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$gte'],
  },
  {
    id: 'mongo-query-205',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with $nin Operator',
    text: 'Find all users where role is not in ["admin", "moderator"].',
    setup:
      'Collection: users with documents {name: "John", role: "user"}, {name: "Jane", role: "admin"}',
    setupCode: `db.users.insertMany([
  {name: "John", role: "user"},
  {name: "Jane", role: "admin"}
]);`,
    expected: [{ name: 'John', role: 'user' }],
    sample: 'db.users.find({role: {$nin: ["admin", "moderator"]}})',
    hints: ['Use $nin to exclude multiple values', 'Opposite of $in operator'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*role\s*:\s*\{\s*\$nin\s*:\s*\[/i],
    tags: ['find', 'query', '$nin'],
  },
  {
    id: 'mongo-query-206',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $regex Case Insensitive',
    text: 'Find all users where name starts with "john" (case insensitive).',
    setup: 'Collection: users with documents {name: "John"}, {name: "JOHN"}, {name: "Jane"}',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "JOHN"},
  {name: "Jane"}
]);`,
    expected: [{ name: 'John' }, { name: 'JOHN' }],
    sample: 'db.users.find({name: {$regex: /^john/i}})',
    hints: ['Use $regex for pattern matching', 'Use i flag for case insensitive'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*name\s*:\s*\{\s*\$regex\s*:/i],
    tags: ['find', 'query', '$regex'],
  },
  {
    id: 'mongo-query-207',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $regex Contains',
    text: 'Find all products where description contains "organic".',
    setup:
      'Collection: products with documents {name: "Apple", description: "Fresh organic apple"}, {name: "Orange", description: "Fresh citrus"}',
    setupCode: `db.products.insertMany([
  {name: "Apple", description: "Fresh organic apple"},
  {name: "Orange", description: "Fresh citrus"}
]);`,
    expected: [{ name: 'Apple', description: 'Fresh organic apple' }],
    sample: 'db.products.find({description: {$regex: /organic/}})',
    hints: [
      'Use $regex without anchors to find substring',
      'Pattern can appear anywhere in string',
    ],
    validPatterns: [/db\.products\.find\s*\(\s*\{\s*description\s*:\s*\{\s*\$regex\s*:/i],
    tags: ['find', 'query', '$regex'],
  },
  {
    id: 'mongo-query-208',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $regex Ends With',
    text: 'Find all users where email ends with "@gmail.com".',
    setup:
      'Collection: users with documents {name: "John", email: "john@gmail.com"}, {name: "Jane", email: "jane@yahoo.com"}',
    setupCode: `db.users.insertMany([
  {name: "John", email: "john@gmail.com"},
  {name: "Jane", email: "jane@yahoo.com"}
]);`,
    expected: [{ name: 'John', email: 'john@gmail.com' }],
    sample: 'db.users.find({email: {$regex: /@gmail\\.com$/}})',
    hints: ['Use $ anchor to match end of string', 'Escape dots with backslash'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*email\s*:\s*\{\s*\$regex\s*:/i],
    tags: ['find', 'query', '$regex'],
  },
  {
    id: 'mongo-query-209',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with Range Query',
    text: 'Find all products where price is between 20 and 50 (inclusive).',
    setup:
      'Collection: products with documents {name: "Apple", price: 30}, {name: "Orange", price: 60}, {name: "Banana", price: 15}',
    setupCode: `db.products.insertMany([
  {name: "Apple", price: 30},
  {name: "Orange", price: 60},
  {name: "Banana", price: 15}
]);`,
    expected: [{ name: 'Apple', price: 30 }],
    sample: 'db.products.find({price: {$gte: 20, $lte: 50}})',
    hints: ['Combine $gte and $lte for range', 'Both operators in same object'],
    validPatterns: [
      /db\.products\.find\s*\(\s*\{\s*price\s*:\s*\{\s*\$gte\s*:\s*20\s*,\s*\$lte\s*:\s*50\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', 'range'],
  },
  {
    id: 'mongo-query-210',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $exists True',
    text: 'Find all users where the email field exists.',
    setup:
      'Collection: users with documents {name: "John", email: "john@test.com"}, {name: "Jane"}',
    setupCode: `db.users.insertMany([
  {name: "John", email: "john@test.com"},
  {name: "Jane"}
]);`,
    expected: [{ name: 'John', email: 'john@test.com' }],
    sample: 'db.users.find({email: {$exists: true}})',
    hints: ['Use $exists to check field presence', 'true matches documents with field'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*email\s*:\s*\{\s*\$exists\s*:\s*true\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$exists'],
  },
  {
    id: 'mongo-query-211',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $exists False',
    text: 'Find all users where the phone field does not exist.',
    setup: 'Collection: users with documents {name: "John", phone: "123"}, {name: "Jane"}',
    setupCode: `db.users.insertMany([
  {name: "John", phone: "123"},
  {name: "Jane"}
]);`,
    expected: [{ name: 'Jane' }],
    sample: 'db.users.find({phone: {$exists: false}})',
    hints: ['Use $exists: false to find missing fields', 'Matches documents without the field'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*phone\s*:\s*\{\s*\$exists\s*:\s*false\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$exists'],
  },
  {
    id: 'mongo-query-212',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $type String',
    text: 'Find all users where the age field is of type string.',
    setup: 'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: "25"}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: "25"}
]);`,
    expected: [{ name: 'Jane', age: '25' }],
    sample: 'db.users.find({age: {$type: "string"}})',
    hints: ['Use $type to filter by BSON type', 'Can use type name or number'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*age\s*:\s*\{\s*\$type\s*:\s*"string"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$type'],
  },
  {
    id: 'mongo-query-213',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $type Array',
    text: 'Find all documents where the tags field is an array.',
    setup:
      'Collection: posts with documents {title: "Post1", tags: ["tech"]}, {title: "Post2", tags: "tech"}',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["tech"]},
  {title: "Post2", tags: "tech"}
]);`,
    expected: [{ title: 'Post1', tags: ['tech'] }],
    sample: 'db.posts.find({tags: {$type: "array"}})',
    hints: ['Use $type: "array" for array fields', 'Distinguishes arrays from scalars'],
    validPatterns: [
      /db\.posts\.find\s*\(\s*\{\s*tags\s*:\s*\{\s*\$type\s*:\s*"array"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$type', 'array'],
  },
  {
    id: 'mongo-query-214',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with $nor Operator',
    text: 'Find all users where age is neither 25 nor 30.',
    setup:
      'Collection: users with documents {name: "John", age: 30}, {name: "Jane", age: 25}, {name: "Bob", age: 35}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25},
  {name: "Bob", age: 35}
]);`,
    expected: [{ name: 'Bob', age: 35 }],
    sample: 'db.users.find({$nor: [{age: 25}, {age: 30}]})',
    hints: [
      'Use $nor to exclude multiple conditions',
      'Returns docs matching none of the conditions',
    ],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\$nor\s*:\s*\[/i],
    tags: ['find', 'query', '$nor'],
  },
  {
    id: 'mongo-query-215',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with Nested $and and $or',
    text: 'Find users where (age > 25 AND status is active) OR role is admin.',
    setup:
      'Collection: users with documents {name: "John", age: 30, status: "active", role: "user"}, {name: "Jane", age: 20, status: "active", role: "admin"}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30, status: "active", role: "user"},
  {name: "Jane", age: 20, status: "active", role: "admin"}
]);`,
    expected: [
      { name: 'John', age: 30, status: 'active', role: 'user' },
      { name: 'Jane', age: 20, status: 'active', role: 'admin' },
    ],
    sample:
      'db.users.find({$or: [{$and: [{age: {$gt: 25}}, {status: "active"}]}, {role: "admin"}]})',
    hints: ['Nest $and inside $or', 'Build complex boolean logic'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\$or\s*:\s*\[/i],
    tags: ['find', 'query', '$and', '$or'],
  },
  {
    id: 'mongo-query-216',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find Documents with Null Value',
    text: 'Find all users where the middleName field is null.',
    setup:
      'Collection: users with documents {name: "John", middleName: null}, {name: "Jane", middleName: "Marie"}',
    setupCode: `db.users.insertMany([
  {name: "John", middleName: null},
  {name: "Jane", middleName: "Marie"}
]);`,
    expected: [{ name: 'John', middleName: null }],
    sample: 'db.users.find({middleName: null})',
    hints: ['Query with null to match null values', 'Also matches missing fields by default'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*middleName\s*:\s*null\s*\}\s*\)/i],
    tags: ['find', 'query', 'null'],
  },
  {
    id: 'mongo-query-217',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with $mod Operator',
    text: 'Find all products where quantity is divisible by 5.',
    setup:
      'Collection: products with documents {name: "Apple", quantity: 10}, {name: "Orange", quantity: 7}',
    setupCode: `db.products.insertMany([
  {name: "Apple", quantity: 10},
  {name: "Orange", quantity: 7}
]);`,
    expected: [{ name: 'Apple', quantity: 10 }],
    sample: 'db.products.find({quantity: {$mod: [5, 0]}})',
    hints: ['Use $mod for modulo operation', 'Array: [divisor, remainder]'],
    validPatterns: [
      /db\.products\.find\s*\(\s*\{\s*quantity\s*:\s*\{\s*\$mod\s*:\s*\[\s*5\s*,\s*0\s*\]\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$mod'],
  },
  {
    id: 'mongo-query-218',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with Skip',
    text: 'Find all users, skipping the first 2 documents.',
    setup:
      'Collection: users with documents {name: "John"}, {name: "Jane"}, {name: "Bob"}, {name: "Alice"}',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"},
  {name: "Bob"},
  {name: "Alice"}
]);`,
    expected: [{ name: 'Bob' }, { name: 'Alice' }],
    sample: 'db.users.find().skip(2)',
    hints: ['Use skip() for pagination', 'Skips specified number of documents'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.skip\s*\(\s*2\s*\)/i],
    tags: ['find', 'pagination', 'skip'],
  },
  {
    id: 'mongo-query-219',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with Skip and Limit',
    text: 'Implement pagination: get page 2 with 3 items per page.',
    setup: 'Collection: users with 10 documents',
    setupCode: `db.users.insertMany([
  {name: "User1"}, {name: "User2"}, {name: "User3"},
  {name: "User4"}, {name: "User5"}, {name: "User6"},
  {name: "User7"}, {name: "User8"}, {name: "User9"}, {name: "User10"}
]);`,
    expected: [{ name: 'User4' }, { name: 'User5' }, { name: 'User6' }],
    sample: 'db.users.find().skip(3).limit(3)',
    hints: ['Skip = (page - 1) * pageSize', 'Limit = pageSize'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.skip\s*\(\s*3\s*\)\s*\.limit\s*\(\s*3\s*\)/i],
    tags: ['find', 'pagination', 'skip', 'limit'],
  },
  {
    id: 'mongo-query-220',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with Multiple Sort Fields',
    text: 'Find all users sorted by status ascending, then by name descending.',
    setup:
      'Collection: users with documents {name: "John", status: "active"}, {name: "Jane", status: "active"}, {name: "Bob", status: "inactive"}',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "active"},
  {name: "Bob", status: "inactive"}
]);`,
    expected: [
      { name: 'John', status: 'active' },
      { name: 'Jane', status: 'active' },
      { name: 'Bob', status: 'inactive' },
    ],
    sample: 'db.users.find().sort({status: 1, name: -1})',
    hints: ['Include multiple fields in sort object', 'Order of fields matters'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\)\s*\.sort\s*\(\s*\{\s*status\s*:\s*1\s*,\s*name\s*:\s*-1\s*\}\s*\)/i,
    ],
    tags: ['find', 'sort', 'multiple'],
  },
  {
    id: 'mongo-query-221',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Count Documents',
    text: 'Count all users where status is "active".',
    setup:
      'Collection: users with documents {name: "John", status: "active"}, {name: "Jane", status: "inactive"}',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "inactive"}
]);`,
    expected: 1,
    sample: 'db.users.countDocuments({status: "active"})',
    hints: ['Use countDocuments() for counting', 'Pass query filter as parameter'],
    validPatterns: [/db\.users\.countDocuments\s*\(\s*\{\s*status\s*:\s*"active"\s*\}\s*\)/i],
    tags: ['count', 'countDocuments'],
  },
  {
    id: 'mongo-query-222',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Estimated Document Count',
    text: 'Get the estimated total count of documents in users collection.',
    setup: 'Collection: users with multiple documents',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"},
  {name: "Bob"}
]);`,
    expected: 3,
    sample: 'db.users.estimatedDocumentCount()',
    hints: ['Use estimatedDocumentCount() for fast count', 'Uses collection metadata'],
    validPatterns: [/db\.users\.estimatedDocumentCount\s*\(\s*\)/i],
    tags: ['count', 'estimatedDocumentCount'],
  },
  {
    id: 'mongo-query-223',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Distinct Values',
    text: 'Get all distinct status values from the users collection.',
    setup:
      'Collection: users with documents {name: "John", status: "active"}, {name: "Jane", status: "inactive"}, {name: "Bob", status: "active"}',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "inactive"},
  {name: "Bob", status: "active"}
]);`,
    expected: ['active', 'inactive'],
    sample: 'db.users.distinct("status")',
    hints: ['Use distinct() to get unique values', 'Pass field name as string'],
    validPatterns: [/db\.users\.distinct\s*\(\s*"status"\s*\)/i],
    tags: ['distinct', 'unique'],
  },
  {
    id: 'mongo-query-224',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Distinct with Query',
    text: 'Get distinct cities for users where age is greater than 25.',
    setup:
      'Collection: users with documents {name: "John", age: 30, city: "NYC"}, {name: "Jane", age: 20, city: "LA"}',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30, city: "NYC"},
  {name: "Jane", age: 20, city: "LA"}
]);`,
    expected: ['NYC'],
    sample: 'db.users.distinct("city", {age: {$gt: 25}})',
    hints: ['Second parameter is filter query', 'Applies filter before distinct'],
    validPatterns: [
      /db\.users\.distinct\s*\(\s*"city"\s*,\s*\{\s*age\s*:\s*\{\s*\$gt\s*:\s*25\s*\}\s*\}\s*\)/i,
    ],
    tags: ['distinct', 'query'],
  },
  {
    id: 'mongo-query-225',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with $expr Operator',
    text: 'Find all products where quantity is greater than minStock.',
    setup:
      'Collection: products with documents {name: "Apple", quantity: 100, minStock: 50}, {name: "Orange", quantity: 30, minStock: 50}',
    setupCode: `db.products.insertMany([
  {name: "Apple", quantity: 100, minStock: 50},
  {name: "Orange", quantity: 30, minStock: 50}
]);`,
    expected: [{ name: 'Apple', quantity: 100, minStock: 50 }],
    sample: 'db.products.find({$expr: {$gt: ["$quantity", "$minStock"]}})',
    hints: ['Use $expr to compare fields', 'Reference fields with $ prefix'],
    validPatterns: [
      /db\.products\.find\s*\(\s*\{\s*\$expr\s*:\s*\{\s*\$gt\s*:\s*\["\$quantity"\s*,\s*"\$minStock"\]\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', '$expr'],
  },
  {
    id: 'mongo-query-226',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find Nested Field',
    text: 'Find all users where address.city equals "NYC".',
    setup:
      'Collection: users with documents {name: "John", address: {city: "NYC"}}, {name: "Jane", address: {city: "LA"}}',
    setupCode: `db.users.insertMany([
  {name: "John", address: {city: "NYC"}},
  {name: "Jane", address: {city: "LA"}}
]);`,
    expected: [{ name: 'John', address: { city: 'NYC' } }],
    sample: 'db.users.find({"address.city": "NYC"})',
    hints: ['Use dot notation for nested fields', 'Quote the entire path'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*"address\.city"\s*:\s*"NYC"\s*\}\s*\)/i],
    tags: ['find', 'query', 'nested'],
  },
  {
    id: 'mongo-query-227',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find Deeply Nested Field',
    text: 'Find all users where profile.settings.theme equals "dark".',
    setup: 'Collection: users with nested profile.settings.theme',
    setupCode: `db.users.insertMany([
  {name: "John", profile: {settings: {theme: "dark"}}},
  {name: "Jane", profile: {settings: {theme: "light"}}}
]);`,
    expected: [{ name: 'John', profile: { settings: { theme: 'dark' } } }],
    sample: 'db.users.find({"profile.settings.theme": "dark"})',
    hints: ['Chain dot notation for deep nesting', 'Any depth level works'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*"profile\.settings\.theme"\s*:\s*"dark"\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', 'nested', 'deep'],
  },
  {
    id: 'mongo-query-228',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find Array Contains Value',
    text: 'Find all posts where tags array contains "mongodb".',
    setup:
      'Collection: posts with documents {title: "Post1", tags: ["mongodb", "database"]}, {title: "Post2", tags: ["javascript"]}',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database"]},
  {title: "Post2", tags: ["javascript"]}
]);`,
    expected: [{ title: 'Post1', tags: ['mongodb', 'database'] }],
    sample: 'db.posts.find({tags: "mongodb"})',
    hints: ['Query array field with scalar value', 'Matches if array contains value'],
    validPatterns: [/db\.posts\.find\s*\(\s*\{\s*tags\s*:\s*"mongodb"\s*\}\s*\)/i],
    tags: ['find', 'query', 'array'],
  },
  {
    id: 'mongo-query-229',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find Array Exact Match',
    text: 'Find posts where tags array exactly equals ["mongodb", "database"].',
    setup: 'Collection: posts with various tag arrays',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database"]},
  {title: "Post2", tags: ["database", "mongodb"]},
  {title: "Post3", tags: ["mongodb"]}
]);`,
    expected: [{ title: 'Post1', tags: ['mongodb', 'database'] }],
    sample: 'db.posts.find({tags: ["mongodb", "database"]})',
    hints: ['Use array literal for exact match', 'Order and length must match exactly'],
    validPatterns: [
      /db\.posts\.find\s*\(\s*\{\s*tags\s*:\s*\[\s*"mongodb"\s*,\s*"database"\s*\]\s*\}\s*\)/i,
    ],
    tags: ['find', 'query', 'array', 'exact'],
  },
  {
    id: 'mongo-query-230',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Query Array by Index',
    text: 'Find posts where the first tag is "mongodb".',
    setup: 'Collection: posts with tag arrays',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database"]},
  {title: "Post2", tags: ["javascript", "mongodb"]}
]);`,
    expected: [{ title: 'Post1', tags: ['mongodb', 'database'] }],
    sample: 'db.posts.find({"tags.0": "mongodb"})',
    hints: ['Use dot notation with index', 'Array indices start at 0'],
    validPatterns: [/db\.posts\.find\s*\(\s*\{\s*"tags\.0"\s*:\s*"mongodb"\s*\}\s*\)/i],
    tags: ['find', 'query', 'array', 'index'],
  },
  {
    id: 'mongo-query-231',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with $where Operator',
    text: 'Find all users where firstName and lastName are the same.',
    setup: 'Collection: users with firstName and lastName',
    setupCode: `db.users.insertMany([
  {firstName: "John", lastName: "John"},
  {firstName: "Jane", lastName: "Doe"}
]);`,
    expected: [{ firstName: 'John', lastName: 'John' }],
    sample: 'db.users.find({$where: "this.firstName === this.lastName"})',
    hints: ['Use $where for JavaScript expressions', 'this refers to document'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*\$where\s*:/i],
    tags: ['find', 'query', '$where'],
  },
  {
    id: 'mongo-query-232',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with Comment',
    text: 'Find users with status "active" and add a comment for logging.',
    setup: 'Collection: users',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "inactive"}
]);`,
    expected: [{ name: 'John', status: 'active' }],
    sample: 'db.users.find({status: "active"}).comment("Finding active users")',
    hints: ['Use comment() for query logging', 'Appears in profiler and logs'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*status\s*:\s*"active"\s*\}\s*\)\s*\.comment\s*\(/i,
    ],
    tags: ['find', 'comment', 'logging'],
  },
  {
    id: 'mongo-query-233',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Find with Hint',
    text: 'Find users by name using the name_1 index.',
    setup: 'Collection: users with index on name',
    setupCode: `db.users.createIndex({name: 1});
db.users.insertOne({name: "John"});`,
    expected: [{ name: 'John' }],
    sample: 'db.users.find({name: "John"}).hint({name: 1})',
    hints: ['Use hint() to force index', 'Pass index specification'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*\)\s*\.hint\s*\(\s*\{\s*name\s*:\s*1\s*\}\s*\)/i,
    ],
    tags: ['find', 'hint', 'index'],
  },
  {
    id: 'mongo-query-234',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Explain Query',
    text: 'Get the execution plan for finding users by age.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: 'Query execution plan',
    sample: 'db.users.find({age: 30}).explain()',
    hints: ['Use explain() for query analysis', 'Shows index usage and stats'],
    validPatterns: [/db\.users\.find\s*\(\s*\{\s*age\s*:\s*30\s*\}\s*\)\s*\.explain\s*\(\s*\)/i],
    tags: ['explain', 'performance'],
  },
  {
    id: 'mongo-query-235',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Explain with Execution Stats',
    text: 'Get detailed execution statistics for a query.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: 'Detailed execution statistics',
    sample: 'db.users.find({age: 30}).explain("executionStats")',
    hints: ['Pass "executionStats" for detailed info', 'Shows actual execution metrics'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*age\s*:\s*30\s*\}\s*\)\s*\.explain\s*\(\s*"executionStats"\s*\)/i,
    ],
    tags: ['explain', 'performance', 'stats'],
  },
  {
    id: 'mongo-query-236',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Find with Max Time',
    text: 'Find all users with a 5 second timeout.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: [{ name: 'John' }],
    sample: 'db.users.find().maxTimeMS(5000)',
    hints: ['Use maxTimeMS() to set timeout', 'Time in milliseconds'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.maxTimeMS\s*\(\s*5000\s*\)/i],
    tags: ['find', 'timeout', 'maxTimeMS'],
  },
  {
    id: 'mongo-query-237',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Find with Batch Size',
    text: 'Find all users with a batch size of 10.',
    setup: 'Collection: users with many documents',
    setupCode: `db.users.insertMany([
  {name: "User1"}, {name: "User2"}, {name: "User3"},
  {name: "User4"}, {name: "User5"}
]);`,
    expected: 'Cursor with batch size 10',
    sample: 'db.users.find().batchSize(10)',
    hints: ['Use batchSize() to control cursor batches', 'Affects network round trips'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.batchSize\s*\(\s*10\s*\)/i],
    tags: ['find', 'cursor', 'batchSize'],
  },
  {
    id: 'mongo-query-238',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Min Value Query',
    text: 'Find users where age is at least 25 using min() with index.',
    setup: 'Collection: users with index on age',
    setupCode: `db.users.createIndex({age: 1});
db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 20}
]);`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.find().min({age: 25}).hint({age: 1})',
    hints: ['Use min() with hint()', 'Sets lower bound for index scan'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\)\s*\.min\s*\(\s*\{\s*age\s*:\s*25\s*\}\s*\)\s*\.hint\s*\(/i,
    ],
    tags: ['find', 'min', 'index'],
  },
  {
    id: 'mongo-query-239',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Max Value Query',
    text: 'Find users where age is at most 30 using max() with index.',
    setup: 'Collection: users with index on age',
    setupCode: `db.users.createIndex({age: 1});
db.users.insertMany([
  {name: "John", age: 25},
  {name: "Jane", age: 35}
]);`,
    expected: [{ name: 'John', age: 25 }],
    sample: 'db.users.find().max({age: 30}).hint({age: 1})',
    hints: ['Use max() with hint()', 'Sets upper bound for index scan'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\)\s*\.max\s*\(\s*\{\s*age\s*:\s*30\s*\}\s*\)\s*\.hint\s*\(/i,
    ],
    tags: ['find', 'max', 'index'],
  },
  {
    id: 'mongo-query-240',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Convert Cursor to Array',
    text: 'Find all users and convert the cursor to an array.',
    setup: 'Collection: users',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: [{ name: 'John' }, { name: 'Jane' }],
    sample: 'db.users.find().toArray()',
    hints: ['Use toArray() to get all results', 'Consumes entire cursor'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.toArray\s*\(\s*\)/i],
    tags: ['find', 'cursor', 'toArray'],
  },
  {
    id: 'mongo-query-241',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Iterate Cursor with forEach',
    text: 'Find all users and print each name using forEach.',
    setup: 'Collection: users',
    setupCode: `db.users.insertMany([
  {name: "John"},
  {name: "Jane"}
]);`,
    expected: 'Printed names',
    sample: 'db.users.find().forEach(function(doc) { print(doc.name); })',
    hints: ['Use forEach() to iterate cursor', 'Pass callback function'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.forEach\s*\(/i],
    tags: ['find', 'cursor', 'forEach'],
  },
  {
    id: 'mongo-query-242',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Map Cursor Results',
    text: 'Find all users and extract just the names using map.',
    setup: 'Collection: users',
    setupCode: `db.users.insertMany([
  {name: "John", age: 30},
  {name: "Jane", age: 25}
]);`,
    expected: ['John', 'Jane'],
    sample: 'db.users.find().map(function(doc) { return doc.name; })',
    hints: ['Use map() to transform results', 'Returns array of transformed values'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.map\s*\(/i],
    tags: ['find', 'cursor', 'map'],
  },
  {
    id: 'mongo-query-243',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Check if Cursor Has Next',
    text: 'Check if there are more documents in the cursor.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: true,
    sample: 'var cursor = db.users.find(); cursor.hasNext()',
    hints: ['Use hasNext() to check for more docs', 'Returns boolean'],
    validPatterns: [/\.hasNext\s*\(\s*\)/i],
    tags: ['cursor', 'hasNext'],
  },
  {
    id: 'mongo-query-244',
    category: 'Query Operators',
    difficulty: 'easy',
    title: 'Get Next Document from Cursor',
    text: 'Get the next document from the cursor.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: { name: 'John' },
    sample: 'var cursor = db.users.find(); cursor.next()',
    hints: ['Use next() to get next document', 'Advances cursor position'],
    validPatterns: [/\.next\s*\(\s*\)/i],
    tags: ['cursor', 'next'],
  },
  {
    id: 'mongo-query-245',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Close Cursor',
    text: 'Close a cursor to free resources.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: 'Cursor closed',
    sample: 'var cursor = db.users.find(); cursor.close()',
    hints: ['Use close() to release cursor', 'Important for long-running operations'],
    validPatterns: [/\.close\s*\(\s*\)/i],
    tags: ['cursor', 'close'],
  },
  {
    id: 'mongo-query-246',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Get Cursor ID',
    text: 'Get the ID of a cursor.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: 'Cursor ID number',
    sample: 'var cursor = db.users.find(); cursor.getId()',
    hints: ['Use getId() to get cursor identifier', 'Used for cursor management'],
    validPatterns: [/\.getId\s*\(\s*\)/i],
    tags: ['cursor', 'getId'],
  },
  {
    id: 'mongo-query-247',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Tailable Cursor',
    text: 'Create a tailable cursor on a capped collection.',
    setup: 'Capped collection: logs',
    setupCode: `db.createCollection("logs", {capped: true, size: 100000});
db.logs.insertOne({message: "test"});`,
    expected: 'Tailable cursor',
    sample: 'db.logs.find().tailable()',
    hints: ['Use tailable() for capped collections', 'Cursor stays open for new docs'],
    validPatterns: [/db\.logs\.find\s*\(\s*\)\s*\.tailable\s*\(\s*\)/i],
    tags: ['cursor', 'tailable', 'capped'],
  },
  {
    id: 'mongo-query-248',
    category: 'Query Operators',
    difficulty: 'medium',
    title: 'Return Key Only',
    text: 'Return only the index keys, not the full documents.',
    setup: 'Collection: users with index on name',
    setupCode: `db.users.createIndex({name: 1});
db.users.insertOne({name: "John", age: 30});`,
    expected: [{ name: 'John' }],
    sample: 'db.users.find({name: "John"}).returnKey()',
    hints: ['Use returnKey() for index-only queries', 'Returns just indexed fields'],
    validPatterns: [
      /db\.users\.find\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*\)\s*\.returnKey\s*\(\s*\)/i,
    ],
    tags: ['find', 'returnKey', 'index'],
  },
  {
    id: 'mongo-query-249',
    category: 'Query Operators',
    difficulty: 'hard',
    title: 'Show Record ID',
    text: 'Include the record ID in query results.',
    setup: 'Collection: users',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: 'Documents with $recordId',
    sample: 'db.users.find().showRecordId()',
    hints: ['Use showRecordId() to include record ID', 'Shows internal document position'],
    validPatterns: [/db\.users\.find\s*\(\s*\)\s*\.showRecordId\s*\(\s*\)/i],
    tags: ['find', 'showRecordId'],
  },

  // ============================================================
  // UPDATE OPERATORS EXTENDED (50 problems)
  // ============================================================
  {
    id: 'mongo-update-250',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Set Multiple Fields',
    text: 'Update both name and age for user with id 1.',
    setup: 'Collection: users with document {_id: 1, name: "John", age: 30}',
    setupCode: `db.users.insertOne({_id: 1, name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({_id: 1}, {$set: {name: "Jane", age: 25}})',
    hints: ['$set can update multiple fields', 'Include all fields in one $set'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*name\s*:\s*"Jane"\s*,\s*age\s*:\s*25\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$set', 'multiple'],
  },
  {
    id: 'mongo-update-251',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Increment Multiple Fields',
    text: 'Increment both views by 1 and likes by 5 for a post.',
    setup: 'Collection: posts with document {_id: 1, views: 100, likes: 50}',
    setupCode: `db.posts.insertOne({_id: 1, views: 100, likes: 50});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, {$inc: {views: 1, likes: 5}})',
    hints: ['$inc can increment multiple fields', 'Use positive or negative values'],
    validPatterns: [
      /db\.posts\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$inc\s*:\s*\{\s*views\s*:\s*1\s*,\s*likes\s*:\s*5\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$inc', 'multiple'],
  },
  {
    id: 'mongo-update-252',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Decrement Field Value',
    text: 'Decrement the stock by 5 for product with id 1.',
    setup: 'Collection: products with document {_id: 1, stock: 100}',
    setupCode: `db.products.insertOne({_id: 1, stock: 100});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.products.updateOne({_id: 1}, {$inc: {stock: -5}})',
    hints: ['Use negative value with $inc to decrement', 'Works with any numeric type'],
    validPatterns: [
      /db\.products\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$inc\s*:\s*\{\s*stock\s*:\s*-5\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$inc', 'decrement'],
  },
  {
    id: 'mongo-update-253',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Multiply Field Value',
    text: 'Multiply the price by 1.1 (10% increase) for product with id 1.',
    setup: 'Collection: products with document {_id: 1, price: 100}',
    setupCode: `db.products.insertOne({_id: 1, price: 100});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.products.updateOne({_id: 1}, {$mul: {price: 1.1}})',
    hints: ['Use $mul to multiply field value', 'Multiply by 1.1 for 10% increase'],
    validPatterns: [
      /db\.products\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$mul\s*:\s*\{\s*price\s*:\s*1\.1\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$mul'],
  },
  {
    id: 'mongo-update-254',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Rename Field',
    text: 'Rename the field "userName" to "username" for all documents.',
    setup: 'Collection: users with documents having userName field',
    setupCode: `db.users.insertOne({userName: "john123"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateMany({}, {$rename: {"userName": "username"}})',
    hints: ['Use $rename to rename fields', 'Old name to new name mapping'],
    validPatterns: [
      /db\.users\.updateMany\s*\(\s*\{\s*\}\s*,\s*\{\s*\$rename\s*:\s*\{\s*"userName"\s*:\s*"username"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$rename'],
  },
  {
    id: 'mongo-update-255',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Set On Insert',
    text: 'Set createdAt field only when inserting a new document.',
    setup: 'Collection: users (empty)',
    setupCode: 'db.users.deleteMany({});',
    expected: 'Document with createdAt',
    sample:
      'db.users.updateOne({name: "John"}, {$set: {age: 30}, $setOnInsert: {createdAt: new Date()}}, {upsert: true})',
    hints: ['Use $setOnInsert with upsert', 'Only applies on insert, not update'],
    validPatterns: [/\$setOnInsert\s*:\s*\{\s*createdAt\s*:/i],
    tags: ['update', '$setOnInsert', 'upsert'],
  },
  {
    id: 'mongo-update-256',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Min Update Operator',
    text: 'Update lowScore to 50 only if current value is greater than 50.',
    setup: 'Collection: stats with document {_id: 1, lowScore: 75}',
    setupCode: `db.stats.insertOne({_id: 1, lowScore: 75});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.stats.updateOne({_id: 1}, {$min: {lowScore: 50}})',
    hints: ['Use $min to set minimum value', 'Only updates if new value is less'],
    validPatterns: [
      /db\.stats\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$min\s*:\s*\{\s*lowScore\s*:\s*50\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$min'],
  },
  {
    id: 'mongo-update-257',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Max Update Operator',
    text: 'Update highScore to 100 only if current value is less than 100.',
    setup: 'Collection: stats with document {_id: 1, highScore: 75}',
    setupCode: `db.stats.insertOne({_id: 1, highScore: 75});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.stats.updateOne({_id: 1}, {$max: {highScore: 100}})',
    hints: ['Use $max to set maximum value', 'Only updates if new value is greater'],
    validPatterns: [
      /db\.stats\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$max\s*:\s*\{\s*highScore\s*:\s*100\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$max'],
  },
  {
    id: 'mongo-update-258',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Current Date Operator',
    text: 'Set lastModified to current date for document with id 1.',
    setup: 'Collection: users with document {_id: 1, name: "John"}',
    setupCode: `db.users.insertOne({_id: 1, name: "John"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({_id: 1}, {$currentDate: {lastModified: true}})',
    hints: ['Use $currentDate for timestamps', 'true sets as Date type'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$currentDate\s*:\s*\{\s*lastModified\s*:\s*true\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$currentDate'],
  },
  {
    id: 'mongo-update-259',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Current Date as Timestamp',
    text: 'Set lastModified as a MongoDB timestamp type.',
    setup: 'Collection: users with document {_id: 1, name: "John"}',
    setupCode: `db.users.insertOne({_id: 1, name: "John"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({_id: 1}, {$currentDate: {lastModified: {$type: "timestamp"}}})',
    hints: ['Use $type: "timestamp" for timestamp type', 'Different from Date type'],
    validPatterns: [
      /\$currentDate\s*:\s*\{\s*lastModified\s*:\s*\{\s*\$type\s*:\s*"timestamp"\s*\}\s*\}/i,
    ],
    tags: ['update', '$currentDate', 'timestamp'],
  },
  {
    id: 'mongo-update-260',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Unset Multiple Fields',
    text: 'Remove both tempField and obsoleteField from document.',
    setup:
      'Collection: data with document {_id: 1, tempField: "x", obsoleteField: "y", name: "test"}',
    setupCode: `db.data.insertOne({_id: 1, tempField: "x", obsoleteField: "y", name: "test"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.data.updateOne({_id: 1}, {$unset: {tempField: "", obsoleteField: ""}})',
    hints: ['$unset can remove multiple fields', 'Value can be empty string'],
    validPatterns: [/\$unset\s*:\s*\{\s*tempField\s*:\s*""\s*,\s*obsoleteField\s*:\s*""\s*\}/i],
    tags: ['update', '$unset', 'multiple'],
  },
  {
    id: 'mongo-update-261',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Push Multiple Elements',
    text: 'Push multiple items to the tags array at once.',
    setup: 'Collection: posts with document {_id: 1, tags: ["mongodb"]}',
    setupCode: `db.posts.insertOne({_id: 1, tags: ["mongodb"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, {$push: {tags: {$each: ["database", "nosql"]}}})',
    hints: ['Use $each with $push for multiple items', 'Items added in order'],
    validPatterns: [/\$push\s*:\s*\{\s*tags\s*:\s*\{\s*\$each\s*:\s*\[/i],
    tags: ['update', '$push', '$each'],
  },
  {
    id: 'mongo-update-262',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Push with Position',
    text: 'Push "urgent" to the beginning of the tags array.',
    setup: 'Collection: posts with document {_id: 1, tags: ["mongodb", "database"]}',
    setupCode: `db.posts.insertOne({_id: 1, tags: ["mongodb", "database"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, {$push: {tags: {$each: ["urgent"], $position: 0}}})',
    hints: ['Use $position with $push', '0 inserts at beginning'],
    validPatterns: [
      /\$push\s*:\s*\{\s*tags\s*:\s*\{\s*\$each\s*:\s*\["urgent"\]\s*,\s*\$position\s*:\s*0\s*\}\s*\}/i,
    ],
    tags: ['update', '$push', '$position'],
  },
  {
    id: 'mongo-update-263',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Push with Sort',
    text: 'Push a score and keep the scores array sorted in descending order.',
    setup: 'Collection: players with document {_id: 1, scores: [90, 80, 70]}',
    setupCode: `db.players.insertOne({_id: 1, scores: [90, 80, 70]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.players.updateOne({_id: 1}, {$push: {scores: {$each: [85], $sort: -1}}})',
    hints: ['Use $sort with $push to maintain order', '-1 for descending'],
    validPatterns: [
      /\$push\s*:\s*\{\s*scores\s*:\s*\{\s*\$each\s*:\s*\[85\]\s*,\s*\$sort\s*:\s*-1\s*\}\s*\}/i,
    ],
    tags: ['update', '$push', '$sort'],
  },
  {
    id: 'mongo-update-264',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Push with Slice',
    text: 'Push a score and keep only the top 3 scores.',
    setup: 'Collection: players with document {_id: 1, scores: [90, 80, 70]}',
    setupCode: `db.players.insertOne({_id: 1, scores: [90, 80, 70]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.players.updateOne({_id: 1}, {$push: {scores: {$each: [95], $sort: -1, $slice: 3}}})',
    hints: ['Use $slice to limit array size', 'Combine with $sort for top N'],
    validPatterns: [
      /\$push\s*:\s*\{\s*scores\s*:\s*\{\s*\$each\s*:\s*\[95\]\s*,\s*\$sort\s*:\s*-1\s*,\s*\$slice\s*:\s*3\s*\}\s*\}/i,
    ],
    tags: ['update', '$push', '$slice'],
  },
  {
    id: 'mongo-update-265',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'AddToSet Multiple Values',
    text: 'Add multiple unique tags using $addToSet.',
    setup: 'Collection: posts with document {_id: 1, tags: ["mongodb"]}',
    setupCode: `db.posts.insertOne({_id: 1, tags: ["mongodb"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, {$addToSet: {tags: {$each: ["database", "nosql"]}}})',
    hints: ['Use $each with $addToSet', 'Only adds if not exists'],
    validPatterns: [/\$addToSet\s*:\s*\{\s*tags\s*:\s*\{\s*\$each\s*:\s*\[/i],
    tags: ['update', '$addToSet', '$each'],
  },
  {
    id: 'mongo-update-266',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Pull Multiple Values',
    text: 'Remove all occurrences of "spam" and "junk" from tags array.',
    setup:
      'Collection: posts with document {_id: 1, tags: ["mongodb", "spam", "database", "junk"]}',
    setupCode: `db.posts.insertOne({_id: 1, tags: ["mongodb", "spam", "database", "junk"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, {$pull: {tags: {$in: ["spam", "junk"]}}})',
    hints: ['Use $in with $pull for multiple values', 'Removes all matches'],
    validPatterns: [/\$pull\s*:\s*\{\s*tags\s*:\s*\{\s*\$in\s*:\s*\[/i],
    tags: ['update', '$pull', '$in'],
  },
  {
    id: 'mongo-update-267',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Pull with Condition',
    text: 'Remove all scores less than 60 from the scores array.',
    setup: 'Collection: students with document {_id: 1, scores: [85, 45, 92, 55, 78]}',
    setupCode: `db.students.insertOne({_id: 1, scores: [85, 45, 92, 55, 78]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.students.updateOne({_id: 1}, {$pull: {scores: {$lt: 60}}})',
    hints: ['$pull can use query conditions', 'Removes all matching elements'],
    validPatterns: [/\$pull\s*:\s*\{\s*scores\s*:\s*\{\s*\$lt\s*:\s*60\s*\}\s*\}/i],
    tags: ['update', '$pull', 'condition'],
  },
  {
    id: 'mongo-update-268',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Pop First Element',
    text: 'Remove the first element from the queue array.',
    setup: 'Collection: queues with document {_id: 1, queue: ["first", "second", "third"]}',
    setupCode: `db.queues.insertOne({_id: 1, queue: ["first", "second", "third"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.queues.updateOne({_id: 1}, {$pop: {queue: -1}})',
    hints: ['Use $pop with -1 for first element', '1 removes last element'],
    validPatterns: [
      /db\.queues\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$pop\s*:\s*\{\s*queue\s*:\s*-1\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$pop', 'array'],
  },
  {
    id: 'mongo-update-269',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Pop Last Element',
    text: 'Remove the last element from the stack array.',
    setup: 'Collection: stacks with document {_id: 1, stack: ["first", "second", "third"]}',
    setupCode: `db.stacks.insertOne({_id: 1, stack: ["first", "second", "third"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.stacks.updateOne({_id: 1}, {$pop: {stack: 1}})',
    hints: ['Use $pop with 1 for last element', '-1 removes first element'],
    validPatterns: [
      /db\.stacks\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{\s*\$pop\s*:\s*\{\s*stack\s*:\s*1\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$pop', 'array'],
  },
  {
    id: 'mongo-update-270',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Positional $ Operator',
    text: 'Update the first matching element in the items array where quantity > 10.',
    setup:
      'Collection: orders with document {_id: 1, items: [{name: "A", quantity: 5}, {name: "B", quantity: 15}]}',
    setupCode: `db.orders.insertOne({_id: 1, items: [{name: "A", quantity: 5}, {name: "B", quantity: 15}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.orders.updateOne({_id: 1, "items.quantity": {$gt: 10}}, {$set: {"items.$.quantity": 20}})',
    hints: ['Use $ to reference matched element', 'Query must include array condition'],
    validPatterns: [/\$set\s*:\s*\{\s*"items\.\$\.quantity"\s*:\s*20\s*\}/i],
    tags: ['update', '$', 'positional'],
  },
  {
    id: 'mongo-update-271',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update All Array Elements',
    text: 'Increment quantity by 10 for all items in the array.',
    setup:
      'Collection: orders with document {_id: 1, items: [{name: "A", quantity: 5}, {name: "B", quantity: 15}]}',
    setupCode: `db.orders.insertOne({_id: 1, items: [{name: "A", quantity: 5}, {name: "B", quantity: 15}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.orders.updateOne({_id: 1}, {$inc: {"items.$[].quantity": 10}})',
    hints: ['Use $[] to update all elements', 'No filter applied'],
    validPatterns: [/\$inc\s*:\s*\{\s*"items\.\$\[\]\.quantity"\s*:\s*10\s*\}/i],
    tags: ['update', '$[]', 'array'],
  },
  {
    id: 'mongo-update-272',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Filtered Array Elements',
    text: 'Update quantity to 0 for items where status is "discontinued".',
    setup: 'Collection: orders with items having status field',
    setupCode: `db.orders.insertOne({_id: 1, items: [{name: "A", status: "active", quantity: 5}, {name: "B", status: "discontinued", quantity: 15}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.orders.updateOne({_id: 1}, {$set: {"items.$[elem].quantity": 0}}, {arrayFilters: [{"elem.status": "discontinued"}]})',
    hints: ['Use $[identifier] with arrayFilters', 'Filter specifies which elements'],
    validPatterns: [
      /\$set\s*:\s*\{\s*"items\.\$\[elem\]\.quantity"\s*:\s*0\s*\}/i,
      /arrayFilters/i,
    ],
    tags: ['update', '$[identifier]', 'arrayFilters'],
  },
  {
    id: 'mongo-update-273',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Multiple Array Filters',
    text: 'Update items where status is "active" AND quantity < 10.',
    setup: 'Collection: inventory with items array',
    setupCode: `db.inventory.insertOne({_id: 1, items: [{name: "A", status: "active", quantity: 5}, {name: "B", status: "active", quantity: 15}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.inventory.updateOne({_id: 1}, {$set: {"items.$[elem].restock": true}}, {arrayFilters: [{"elem.status": "active", "elem.quantity": {$lt: 10}}]})',
    hints: ['Combine conditions in arrayFilters', 'All conditions must match'],
    validPatterns: [/arrayFilters\s*:\s*\[\s*\{\s*"elem\.status"\s*:\s*"active"/i],
    tags: ['update', 'arrayFilters', 'multiple'],
  },
  {
    id: 'mongo-update-274',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Replace Document',
    text: 'Replace the entire document for user with id 1.',
    setup: 'Collection: users with document {_id: 1, name: "John", age: 30}',
    setupCode: `db.users.insertOne({_id: 1, name: "John", age: 30});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.replaceOne({_id: 1}, {name: "Jane", age: 25, city: "NYC"})',
    hints: ['replaceOne replaces entire document', 'Does not use update operators'],
    validPatterns: [/db\.users\.replaceOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\{/i],
    tags: ['update', 'replaceOne'],
  },
  {
    id: 'mongo-update-275',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Find and Modify',
    text: 'Find user by name, update age, and return the old document.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { name: 'John', age: 30 },
    sample: 'db.users.findOneAndUpdate({name: "John"}, {$set: {age: 31}})',
    hints: ['findOneAndUpdate returns document', 'Default returns old document'],
    validPatterns: [
      /db\.users\.findOneAndUpdate\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:/i,
    ],
    tags: ['update', 'findOneAndUpdate'],
  },
  {
    id: 'mongo-update-276',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Find and Replace',
    text: 'Find user by name and replace the document, returning the new version.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { name: 'Jane', age: 25 },
    sample:
      'db.users.findOneAndReplace({name: "John"}, {name: "Jane", age: 25}, {returnDocument: "after"})',
    hints: ['findOneAndReplace replaces entire doc', 'returnDocument: "after" returns new doc'],
    validPatterns: [/db\.users\.findOneAndReplace\s*\(\s*\{\s*name\s*:\s*"John"\s*\}/i],
    tags: ['update', 'findOneAndReplace'],
  },
  {
    id: 'mongo-update-277',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Bulk Write Operations',
    text: 'Perform multiple update operations in a single batch.',
    setup: 'Collection: users with multiple documents',
    setupCode: `db.users.insertMany([{name: "John"}, {name: "Jane"}]);`,
    expected: { ok: 1, nModified: 2 },
    sample: `db.users.bulkWrite([
  {updateOne: {filter: {name: "John"}, update: {$set: {age: 30}}}},
  {updateOne: {filter: {name: "Jane"}, update: {$set: {age: 25}}}}
])`,
    hints: ['Use bulkWrite for batch operations', 'Array of operation objects'],
    validPatterns: [/db\.users\.bulkWrite\s*\(\s*\[/i],
    tags: ['update', 'bulkWrite'],
  },
  {
    id: 'mongo-update-278',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update with Array Filter Index',
    text: 'Update the second element in nested array.',
    setup: 'Collection: data with nested arrays',
    setupCode: `db.data.insertOne({_id: 1, matrix: [[1,2], [3,4], [5,6]]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.data.updateOne({_id: 1}, {$set: {"matrix.1.0": 10}})',
    hints: ['Use dot notation with indices', 'matrix.1.0 = second array, first element'],
    validPatterns: [/\$set\s*:\s*\{\s*"matrix\.1\.0"\s*:\s*10\s*\}/i],
    tags: ['update', 'nested', 'array'],
  },
  {
    id: 'mongo-update-279',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Update First Matching',
    text: 'Update the first user where status is "pending" to "active".',
    setup: 'Collection: users with multiple pending users',
    setupCode: `db.users.insertMany([{name: "John", status: "pending"}, {name: "Jane", status: "pending"}]);`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({status: "pending"}, {$set: {status: "active"}})',
    hints: ['updateOne only modifies first match', 'Use updateMany for all'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*status\s*:\s*"pending"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*status\s*:\s*"active"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'updateOne'],
  },
  {
    id: 'mongo-update-280',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Conditional Update with $set',
    text: 'Set verified to true only for users where email exists.',
    setup: 'Collection: users with some having email field',
    setupCode: `db.users.insertMany([{name: "John", email: "john@test.com"}, {name: "Jane"}]);`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateMany({email: {$exists: true}}, {$set: {verified: true}})',
    hints: ['Combine query with update', 'Query filters which docs to update'],
    validPatterns: [
      /db\.users\.updateMany\s*\(\s*\{\s*email\s*:\s*\{\s*\$exists\s*:\s*true\s*\}\s*\}\s*,\s*\{\s*\$set\s*:/i,
    ],
    tags: ['update', '$exists', 'conditional'],
  },
  {
    id: 'mongo-update-281',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Bit Update Operator',
    text: 'Perform bitwise AND with value 5 on the permissions field.',
    setup: 'Collection: users with document {_id: 1, permissions: 7}',
    setupCode: `db.users.insertOne({_id: 1, permissions: 7});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({_id: 1}, {$bit: {permissions: {and: 5}}})',
    hints: ['Use $bit for bitwise operations', 'Supports and, or, xor'],
    validPatterns: [/\$bit\s*:\s*\{\s*permissions\s*:\s*\{\s*and\s*:\s*5\s*\}\s*\}/i],
    tags: ['update', '$bit', 'bitwise'],
  },
  {
    id: 'mongo-update-282',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Bit OR Update',
    text: 'Perform bitwise OR with value 4 on the flags field.',
    setup: 'Collection: settings with document {_id: 1, flags: 1}',
    setupCode: `db.settings.insertOne({_id: 1, flags: 1});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.settings.updateOne({_id: 1}, {$bit: {flags: {or: 4}}})',
    hints: ['Use or for bitwise OR', 'Result: 1 | 4 = 5'],
    validPatterns: [/\$bit\s*:\s*\{\s*flags\s*:\s*\{\s*or\s*:\s*4\s*\}\s*\}/i],
    tags: ['update', '$bit', 'bitwise'],
  },
  {
    id: 'mongo-update-283',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update Nested Object Field',
    text: 'Update the street field inside address object.',
    setup: 'Collection: users with document {_id: 1, address: {street: "Main St", city: "NYC"}}',
    setupCode: `db.users.insertOne({_id: 1, address: {street: "Main St", city: "NYC"}});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({_id: 1}, {$set: {"address.street": "Oak Ave"}})',
    hints: ['Use dot notation for nested fields', 'Only updates specified field'],
    validPatterns: [/\$set\s*:\s*\{\s*"address\.street"\s*:\s*"Oak Ave"\s*\}/i],
    tags: ['update', 'nested', 'dot-notation'],
  },
  {
    id: 'mongo-update-284',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Add Field If Not Exists',
    text: 'Add createdAt field only if it does not exist.',
    setup: 'Collection: users with document {_id: 1, name: "John"}',
    setupCode: `db.users.insertOne({_id: 1, name: "John"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({_id: 1, createdAt: {$exists: false}}, {$set: {createdAt: new Date()}})',
    hints: ['Query for field not existing', 'Only updates if field missing'],
    validPatterns: [/createdAt\s*:\s*\{\s*\$exists\s*:\s*false\s*\}/i],
    tags: ['update', '$exists', 'conditional'],
  },
  {
    id: 'mongo-update-285',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Combine Multiple Update Operators',
    text: 'In one update: increment views, set lastViewed, and push to history.',
    setup: 'Collection: posts with document {_id: 1, views: 100, history: []}',
    setupCode: `db.posts.insertOne({_id: 1, views: 100, history: []});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.posts.updateOne({_id: 1}, {$inc: {views: 1}, $set: {lastViewed: new Date()}, $push: {history: "viewed"}})',
    hints: ['Combine multiple operators', 'Each operator in same update object'],
    validPatterns: [/\$inc\s*:\s*\{/, /\$set\s*:\s*\{/, /\$push\s*:\s*\{/],
    tags: ['update', 'multiple', 'operators'],
  },
  {
    id: 'mongo-update-286',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'PullAll Operator',
    text: 'Remove all occurrences of specific values from array.',
    setup: 'Collection: data with document {_id: 1, numbers: [1, 2, 3, 2, 4, 2]}',
    setupCode: `db.data.insertOne({_id: 1, numbers: [1, 2, 3, 2, 4, 2]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.data.updateOne({_id: 1}, {$pullAll: {numbers: [2, 4]}})',
    hints: ['$pullAll removes all matching values', 'Takes array of values to remove'],
    validPatterns: [/\$pullAll\s*:\s*\{\s*numbers\s*:\s*\[\s*2\s*,\s*4\s*\]\s*\}/i],
    tags: ['update', '$pullAll', 'array'],
  },
  {
    id: 'mongo-update-287',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with Aggregation Pipeline',
    text: 'Use aggregation pipeline to set fullName from firstName and lastName.',
    setup: 'Collection: users with document {_id: 1, firstName: "John", lastName: "Doe"}',
    setupCode: `db.users.insertOne({_id: 1, firstName: "John", lastName: "Doe"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({_id: 1}, [{$set: {fullName: {$concat: ["$firstName", " ", "$lastName"]}}}])',
    hints: ['Use array syntax for pipeline update', 'Can reference document fields'],
    validPatterns: [/db\.users\.updateOne\s*\(\s*\{\s*_id\s*:\s*1\s*\}\s*,\s*\[\s*\{\s*\$set\s*:/i],
    tags: ['update', 'pipeline', '$concat'],
  },
  {
    id: 'mongo-update-288',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Conditional Field Update',
    text: 'Set status based on score value using aggregation pipeline.',
    setup: 'Collection: students with document {_id: 1, score: 85}',
    setupCode: `db.students.insertOne({_id: 1, score: 85});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.students.updateOne({_id: 1}, [{$set: {status: {$cond: {if: {$gte: ["$score", 60]}, then: "pass", else: "fail"}}}}])',
    hints: ['Use $cond in pipeline update', 'Can create computed fields'],
    validPatterns: [/\$cond\s*:\s*\{\s*if\s*:/i],
    tags: ['update', 'pipeline', '$cond'],
  },
  {
    id: 'mongo-update-289',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update with WriteConcern',
    text: 'Update with majority write concern.',
    setup: 'Collection: critical with document {_id: 1, data: "important"}',
    setupCode: `db.critical.insertOne({_id: 1, data: "important"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.critical.updateOne({_id: 1}, {$set: {data: "updated"}}, {writeConcern: {w: "majority"}})',
    hints: ['Pass writeConcern in options', 'Ensures durability'],
    validPatterns: [/writeConcern\s*:\s*\{\s*w\s*:\s*"majority"\s*\}/i],
    tags: ['update', 'writeConcern'],
  },
  {
    id: 'mongo-update-290',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update with Collation',
    text: 'Update matching case-insensitive name.',
    setup: 'Collection: users with document {_id: 1, name: "JOHN"}',
    setupCode: `db.users.insertOne({_id: 1, name: "JOHN"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({name: "john"}, {$set: {found: true}}, {collation: {locale: "en", strength: 2}})',
    hints: ['Use collation for locale-aware comparison', 'strength: 2 is case-insensitive'],
    validPatterns: [/collation\s*:\s*\{\s*locale\s*:\s*"en"/i],
    tags: ['update', 'collation'],
  },
  {
    id: 'mongo-update-291',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update Array of Objects',
    text: 'Update status field in array element matching productId.',
    setup: 'Collection: orders with items array containing objects',
    setupCode: `db.orders.insertOne({_id: 1, items: [{productId: "A", status: "pending"}, {productId: "B", status: "pending"}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.orders.updateOne({_id: 1, "items.productId": "A"}, {$set: {"items.$.status": "shipped"}})',
    hints: ['Query must match array element', '$ references matched element'],
    validPatterns: [/"items\.productId"\s*:\s*"A"/, /"items\.\$\.status"\s*:\s*"shipped"/],
    tags: ['update', 'positional', 'array'],
  },
  {
    id: 'mongo-update-292',
    category: 'Update Operators',
    difficulty: 'easy',
    title: 'Simple Field Update',
    text: 'Update the email field for user with name "John".',
    setup: 'Collection: users with document {name: "John", email: "old@test.com"}',
    setupCode: `db.users.insertOne({name: "John", email: "old@test.com"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.users.updateOne({name: "John"}, {$set: {email: "new@test.com"}})',
    hints: ['Use $set to update field value', 'Query by name, update email'],
    validPatterns: [
      /db\.users\.updateOne\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*email\s*:\s*"new@test\.com"\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', '$set', 'basic'],
  },
  {
    id: 'mongo-update-293',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update Boolean Field',
    text: 'Set isActive to false for all users where lastLogin is older than 30 days.',
    setup: 'Collection: users with lastLogin dates',
    setupCode: `db.users.insertOne({name: "John", isActive: true, lastLogin: new Date("2023-01-01")});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateMany({lastLogin: {$lt: new Date(Date.now() - 30*24*60*60*1000)}}, {$set: {isActive: false}})',
    hints: ['Calculate date 30 days ago', 'Use $lt for date comparison'],
    validPatterns: [/\$set\s*:\s*\{\s*isActive\s*:\s*false\s*\}/i],
    tags: ['update', 'date', 'boolean'],
  },
  {
    id: 'mongo-update-294',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Nested Array Update',
    text: 'Update a specific comment in a post nested comments array.',
    setup: 'Collection: posts with nested comments',
    setupCode: `db.posts.insertOne({_id: 1, comments: [{id: 1, text: "old"}, {id: 2, text: "keep"}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.posts.updateOne({_id: 1, "comments.id": 1}, {$set: {"comments.$.text": "updated"}})',
    hints: ['Match nested document by field', 'Use positional $ operator'],
    validPatterns: [/"comments\.id"\s*:\s*1/, /"comments\.\$\.text"\s*:\s*"updated"/],
    tags: ['update', 'nested', 'array'],
  },
  {
    id: 'mongo-update-295',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Toggle Boolean Field',
    text: 'Toggle the featured field value using aggregation pipeline.',
    setup: 'Collection: posts with document {_id: 1, featured: true}',
    setupCode: `db.posts.insertOne({_id: 1, featured: true});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, [{$set: {featured: {$not: "$featured"}}}])',
    hints: ['Use $not in pipeline update', 'Inverts boolean value'],
    validPatterns: [/\$set\s*:\s*\{\s*featured\s*:\s*\{\s*\$not\s*:\s*"\$featured"\s*\}\s*\}/i],
    tags: ['update', 'pipeline', 'boolean'],
  },
  {
    id: 'mongo-update-296',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $mergeObjects',
    text: 'Merge new settings into existing settings object.',
    setup: 'Collection: users with settings object',
    setupCode: `db.users.insertOne({_id: 1, settings: {theme: "dark", lang: "en"}});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.users.updateOne({_id: 1}, [{$set: {settings: {$mergeObjects: ["$settings", {fontSize: 14}]}}}])',
    hints: ['Use $mergeObjects in pipeline', 'Preserves existing fields'],
    validPatterns: [/\$mergeObjects\s*:\s*\["\$settings"/i],
    tags: ['update', 'pipeline', '$mergeObjects'],
  },
  {
    id: 'mongo-update-297',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Update Date Field',
    text: 'Set the updatedAt field to current date.',
    setup: 'Collection: posts with document {_id: 1, title: "Test"}',
    setupCode: `db.posts.insertOne({_id: 1, title: "Test"});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({_id: 1}, {$set: {updatedAt: new Date()}})',
    hints: ['Use new Date() for current time', 'Creates Date object'],
    validPatterns: [/\$set\s*:\s*\{\s*updatedAt\s*:\s*new\s+Date\s*\(\s*\)\s*\}/i],
    tags: ['update', 'date'],
  },
  {
    id: 'mongo-update-298',
    category: 'Update Operators',
    difficulty: 'hard',
    title: 'Update with $switch',
    text: 'Set grade based on score ranges using $switch.',
    setup: 'Collection: students with score field',
    setupCode: `db.students.insertOne({_id: 1, score: 85});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: `db.students.updateOne({_id: 1}, [{$set: {grade: {$switch: {
      branches: [
        {case: {$gte: ["$score", 90]}, then: "A"},
        {case: {$gte: ["$score", 80]}, then: "B"},
        {case: {$gte: ["$score", 70]}, then: "C"}
      ],
      default: "F"
    }}}}])`,
    hints: ['Use $switch for multiple conditions', 'Define branches and default'],
    validPatterns: [/\$switch\s*:\s*\{\s*branches\s*:/i],
    tags: ['update', 'pipeline', '$switch'],
  },
  {
    id: 'mongo-update-299',
    category: 'Update Operators',
    difficulty: 'medium',
    title: 'Atomic Find and Delete',
    text: 'Find and delete a user, returning the deleted document.',
    setup: 'Collection: users with document {name: "John", age: 30}',
    setupCode: `db.users.insertOne({name: "John", age: 30});`,
    expected: { name: 'John', age: 30 },
    sample: 'db.users.findOneAndDelete({name: "John"})',
    hints: ['findOneAndDelete returns deleted doc', 'Atomic operation'],
    validPatterns: [/db\.users\.findOneAndDelete\s*\(\s*\{\s*name\s*:\s*"John"\s*\}\s*\)/i],
    tags: ['delete', 'findOneAndDelete'],
  },

  // ============================================================
  // AGGREGATION PIPELINE EXTENDED (100 problems)
  // ============================================================
  {
    id: 'mongo-agg-300',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: 'Simple $match',
    text: 'Use aggregation to find all active users.',
    setup: 'Collection: users with status field',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "inactive"}
]);`,
    expected: [{ name: 'John', status: 'active' }],
    sample: 'db.users.aggregate([{$match: {status: "active"}}])',
    hints: ['$match filters documents', 'Same syntax as find query'],
    validPatterns: [/\$match\s*:\s*\{\s*status\s*:\s*"active"\s*\}/i],
    tags: ['aggregation', '$match'],
  },
  {
    id: 'mongo-agg-301',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: 'Project Specific Fields',
    text: 'Project only name and email, excluding _id.',
    setup: 'Collection: users with multiple fields',
    setupCode: `db.users.insertOne({name: "John", email: "john@test.com", age: 30});`,
    expected: [{ name: 'John', email: 'john@test.com' }],
    sample: 'db.users.aggregate([{$project: {name: 1, email: 1, _id: 0}}])',
    hints: ['Use 1 to include, 0 to exclude', '_id included by default'],
    validPatterns: [
      /\$project\s*:\s*\{\s*name\s*:\s*1\s*,\s*email\s*:\s*1\s*,\s*_id\s*:\s*0\s*\}/i,
    ],
    tags: ['aggregation', '$project'],
  },
  {
    id: 'mongo-agg-302',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Project Computed Field',
    text: 'Create a fullName field by concatenating firstName and lastName.',
    setup: 'Collection: users with firstName and lastName',
    setupCode: `db.users.insertOne({firstName: "John", lastName: "Doe"});`,
    expected: [{ fullName: 'John Doe' }],
    sample:
      'db.users.aggregate([{$project: {fullName: {$concat: ["$firstName", " ", "$lastName"]}, _id: 0}}])',
    hints: ['Use $concat to join strings', 'Reference fields with $'],
    validPatterns: [/\$concat\s*:\s*\["\$firstName"\s*,\s*" "\s*,\s*"\$lastName"\]/i],
    tags: ['aggregation', '$project', '$concat'],
  },
  {
    id: 'mongo-agg-303',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group and Count',
    text: 'Count users by status.',
    setup: 'Collection: users with status field',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "active"},
  {name: "Bob", status: "inactive"}
]);`,
    expected: [
      { _id: 'active', count: 2 },
      { _id: 'inactive', count: 1 },
    ],
    sample: 'db.users.aggregate([{$group: {_id: "$status", count: {$sum: 1}}}])',
    hints: ['_id is the grouping field', '$sum: 1 counts documents'],
    validPatterns: [
      /\$group\s*:\s*\{\s*_id\s*:\s*"\$status"\s*,\s*count\s*:\s*\{\s*\$sum\s*:\s*1\s*\}\s*\}/i,
    ],
    tags: ['aggregation', '$group', '$sum'],
  },
  {
    id: 'mongo-agg-304',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group with $avg',
    text: 'Calculate average age by department.',
    setup: 'Collection: employees with age and department',
    setupCode: `db.employees.insertMany([
  {name: "John", age: 30, department: "IT"},
  {name: "Jane", age: 25, department: "IT"},
  {name: "Bob", age: 35, department: "HR"}
]);`,
    expected: [
      { _id: 'IT', avgAge: 27.5 },
      { _id: 'HR', avgAge: 35 },
    ],
    sample: 'db.employees.aggregate([{$group: {_id: "$department", avgAge: {$avg: "$age"}}}])',
    hints: ['Use $avg for average calculation', 'Reference field with $'],
    validPatterns: [
      /\$group\s*:\s*\{\s*_id\s*:\s*"\$department"\s*,\s*avgAge\s*:\s*\{\s*\$avg\s*:\s*"\$age"\s*\}\s*\}/i,
    ],
    tags: ['aggregation', '$group', '$avg'],
  },
  {
    id: 'mongo-agg-305',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group with $min and $max',
    text: 'Find min and max salary by department.',
    setup: 'Collection: employees with salary and department',
    setupCode: `db.employees.insertMany([
  {name: "John", salary: 50000, department: "IT"},
  {name: "Jane", salary: 60000, department: "IT"},
  {name: "Bob", salary: 45000, department: "HR"}
]);`,
    expected: [{ _id: 'IT', minSalary: 50000, maxSalary: 60000 }],
    sample:
      'db.employees.aggregate([{$group: {_id: "$department", minSalary: {$min: "$salary"}, maxSalary: {$max: "$salary"}}}])',
    hints: ['Use $min and $max in same group', 'Multiple accumulators allowed'],
    validPatterns: [/\$min\s*:\s*"\$salary"/, /\$max\s*:\s*"\$salary"/],
    tags: ['aggregation', '$group', '$min', '$max'],
  },
  {
    id: 'mongo-agg-306',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group with $push',
    text: 'Group orders by customerId and collect product names.',
    setup: 'Collection: orders with customerId and product',
    setupCode: `db.orders.insertMany([
  {customerId: 1, product: "Apple"},
  {customerId: 1, product: "Orange"},
  {customerId: 2, product: "Banana"}
]);`,
    expected: [
      { _id: 1, products: ['Apple', 'Orange'] },
      { _id: 2, products: ['Banana'] },
    ],
    sample: 'db.orders.aggregate([{$group: {_id: "$customerId", products: {$push: "$product"}}}])',
    hints: ['$push adds to array', 'Creates array of values'],
    validPatterns: [
      /\$group\s*:\s*\{\s*_id\s*:\s*"\$customerId"\s*,\s*products\s*:\s*\{\s*\$push\s*:\s*"\$product"\s*\}\s*\}/i,
    ],
    tags: ['aggregation', '$group', '$push'],
  },
  {
    id: 'mongo-agg-307',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group with $addToSet',
    text: 'Get unique categories per author.',
    setup: 'Collection: posts with author and category',
    setupCode: `db.posts.insertMany([
  {author: "John", category: "tech"},
  {author: "John", category: "tech"},
  {author: "John", category: "news"}
]);`,
    expected: [{ _id: 'John', categories: ['tech', 'news'] }],
    sample:
      'db.posts.aggregate([{$group: {_id: "$author", categories: {$addToSet: "$category"}}}])',
    hints: ['$addToSet creates unique array', 'No duplicates included'],
    validPatterns: [/\$addToSet\s*:\s*"\$category"/i],
    tags: ['aggregation', '$group', '$addToSet'],
  },
  {
    id: 'mongo-agg-308',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group with $first',
    text: 'Get the first order date per customer after sorting.',
    setup: 'Collection: orders with customerId and orderDate',
    setupCode: `db.orders.insertMany([
  {customerId: 1, orderDate: new Date("2024-01-15")},
  {customerId: 1, orderDate: new Date("2024-01-10")}
]);`,
    expected: [{ _id: 1, firstOrder: '2024-01-10' }],
    sample:
      'db.orders.aggregate([{$sort: {orderDate: 1}}, {$group: {_id: "$customerId", firstOrder: {$first: "$orderDate"}}}])',
    hints: ['Sort before group for $first', '$first gets first document value'],
    validPatterns: [/\$first\s*:\s*"\$orderDate"/i],
    tags: ['aggregation', '$group', '$first'],
  },
  {
    id: 'mongo-agg-309',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Group with $last',
    text: 'Get the most recent order per customer.',
    setup: 'Collection: orders with customerId and orderDate',
    setupCode: `db.orders.insertMany([
  {customerId: 1, orderDate: new Date("2024-01-10")},
  {customerId: 1, orderDate: new Date("2024-01-15")}
]);`,
    expected: [{ _id: 1, lastOrder: '2024-01-15' }],
    sample:
      'db.orders.aggregate([{$sort: {orderDate: 1}}, {$group: {_id: "$customerId", lastOrder: {$last: "$orderDate"}}}])',
    hints: ['Sort before group for $last', '$last gets last document value'],
    validPatterns: [/\$last\s*:\s*"\$orderDate"/i],
    tags: ['aggregation', '$group', '$last'],
  },
  {
    id: 'mongo-agg-310',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: '$lookup Join',
    text: 'Join orders with customers collection.',
    setup: 'Collections: orders and customers',
    setupCode: `db.customers.insertOne({_id: 1, name: "John"});
db.orders.insertOne({customerId: 1, amount: 100});`,
    expected: [{ customerId: 1, amount: 100, customer: [{ _id: 1, name: 'John' }] }],
    sample: `db.orders.aggregate([{$lookup: {from: "customers", localField: "customerId", foreignField: "_id", as: "customer"}}])`,
    hints: ['$lookup performs left outer join', 'Result is array of matching docs'],
    validPatterns: [/\$lookup\s*:\s*\{\s*from\s*:\s*"customers"/i],
    tags: ['aggregation', '$lookup', 'join'],
  },
  {
    id: 'mongo-agg-311',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$unwind Array',
    text: 'Flatten the tags array into separate documents.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb", "database"]});`,
    expected: [
      { title: 'Post1', tags: 'mongodb' },
      { title: 'Post1', tags: 'database' },
    ],
    sample: 'db.posts.aggregate([{$unwind: "$tags"}])',
    hints: ['$unwind deconstructs arrays', 'Creates document per element'],
    validPatterns: [/\$unwind\s*:\s*"\$tags"/i],
    tags: ['aggregation', '$unwind'],
  },
  {
    id: 'mongo-agg-312',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$skip Stage',
    text: 'Skip the first 10 documents.',
    setup: 'Collection: users with 20 documents',
    setupCode: `for(let i=1; i<=20; i++) db.users.insertOne({num: i});`,
    expected: 'Documents 11-20',
    sample: 'db.users.aggregate([{$skip: 10}])',
    hints: ['$skip for pagination', 'Skips specified number'],
    validPatterns: [/\$skip\s*:\s*10/i],
    tags: ['aggregation', '$skip'],
  },
  {
    id: 'mongo-agg-313',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: '$limit Stage',
    text: 'Limit results to 5 documents.',
    setup: 'Collection: users with 20 documents',
    setupCode: `for(let i=1; i<=20; i++) db.users.insertOne({num: i});`,
    expected: 'First 5 documents',
    sample: 'db.users.aggregate([{$limit: 5}])',
    hints: ['$limit restricts output', 'Place after $sort for top N'],
    validPatterns: [/\$limit\s*:\s*5/i],
    tags: ['aggregation', '$limit'],
  },
  {
    id: 'mongo-agg-314',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$sample Random Documents',
    text: 'Get 3 random documents from users collection.',
    setup: 'Collection: users with multiple documents',
    setupCode: `db.users.insertMany([{name: "A"}, {name: "B"}, {name: "C"}, {name: "D"}, {name: "E"}]);`,
    expected: '3 random documents',
    sample: 'db.users.aggregate([{$sample: {size: 3}}])',
    hints: ['$sample for random selection', 'size specifies count'],
    validPatterns: [/\$sample\s*:\s*\{\s*size\s*:\s*3\s*\}/i],
    tags: ['aggregation', '$sample'],
  },
  {
    id: 'mongo-agg-315',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$count Stage',
    text: 'Count total matching documents.',
    setup: 'Collection: users with status field',
    setupCode: `db.users.insertMany([
  {name: "John", status: "active"},
  {name: "Jane", status: "active"},
  {name: "Bob", status: "inactive"}
]);`,
    expected: [{ activeUsers: 2 }],
    sample: 'db.users.aggregate([{$match: {status: "active"}}, {$count: "activeUsers"}])',
    hints: ['$count creates count field', 'Use after $match to count filtered'],
    validPatterns: [/\$count\s*:\s*"activeUsers"/i],
    tags: ['aggregation', '$count'],
  },
  {
    id: 'mongo-agg-316',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: '$facet Multiple Pipelines',
    text: 'Get both total count and paginated results.',
    setup: 'Collection: users',
    setupCode: `db.users.insertMany([{name: "A"}, {name: "B"}, {name: "C"}]);`,
    expected: { count: [{ total: 3 }], data: [{ name: 'A' }] },
    sample: `db.users.aggregate([{$facet: {
  count: [{$count: "total"}],
  data: [{$limit: 1}]
}}])`,
    hints: ['$facet runs multiple pipelines', 'Each facet is separate pipeline'],
    validPatterns: [/\$facet\s*:\s*\{/i],
    tags: ['aggregation', '$facet'],
  },
  {
    id: 'mongo-agg-317',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: '$bucket Age Groups',
    text: 'Group users into age buckets: 0-17, 18-34, 35-54, 55+.',
    setup: 'Collection: users with age field',
    setupCode: `db.users.insertMany([{age: 10}, {age: 25}, {age: 40}, {age: 60}]);`,
    expected: [
      { _id: 0, count: 1 },
      { _id: 18, count: 1 },
      { _id: 35, count: 1 },
      { _id: 55, count: 1 },
    ],
    sample: `db.users.aggregate([{$bucket: {
  groupBy: "$age",
  boundaries: [0, 18, 35, 55, 100],
  default: "Other",
  output: {count: {$sum: 1}}
}}])`,
    hints: ['$bucket groups by ranges', 'boundaries define range edges'],
    validPatterns: [/\$bucket\s*:\s*\{/i],
    tags: ['aggregation', '$bucket'],
  },
  {
    id: 'mongo-agg-318',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$addFields',
    text: 'Add a calculated discount field.',
    setup: 'Collection: products with price',
    setupCode: `db.products.insertOne({name: "Apple", price: 100});`,
    expected: [{ name: 'Apple', price: 100, discount: 10 }],
    sample: 'db.products.aggregate([{$addFields: {discount: {$multiply: ["$price", 0.1]}}}])',
    hints: ['$addFields adds new fields', 'Can use expressions'],
    validPatterns: [/\$addFields\s*:\s*\{\s*discount\s*:/i],
    tags: ['aggregation', '$addFields'],
  },
  {
    id: 'mongo-agg-319',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$set Stage',
    text: 'Add/update a field using $set (alias for $addFields).',
    setup: 'Collection: users with name',
    setupCode: `db.users.insertOne({name: "john"});`,
    expected: [{ name: 'john', upperName: 'JOHN' }],
    sample: 'db.users.aggregate([{$set: {upperName: {$toUpper: "$name"}}}])',
    hints: ['$set is alias for $addFields', 'More intuitive name'],
    validPatterns: [/\$set\s*:\s*\{\s*upperName\s*:\s*\{\s*\$toUpper\s*:\s*"\$name"\s*\}\s*\}/i],
    tags: ['aggregation', '$set'],
  },
  {
    id: 'mongo-agg-320',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$unset Remove Fields',
    text: 'Remove password and internal fields from output.',
    setup: 'Collection: users with sensitive fields',
    setupCode: `db.users.insertOne({name: "John", password: "secret", internal: "data"});`,
    expected: [{ name: 'John' }],
    sample: 'db.users.aggregate([{$unset: ["password", "internal"]}])',
    hints: ['$unset removes fields', 'Pass array of field names'],
    validPatterns: [/\$unset\s*:\s*\[\s*"password"\s*,\s*"internal"\s*\]/i],
    tags: ['aggregation', '$unset'],
  },
  {
    id: 'mongo-agg-321',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: '$replaceRoot',
    text: 'Promote nested object to root level.',
    setup: 'Collection: users with profile object',
    setupCode: `db.users.insertOne({userId: 1, profile: {name: "John", age: 30}});`,
    expected: [{ name: 'John', age: 30 }],
    sample: 'db.users.aggregate([{$replaceRoot: {newRoot: "$profile"}}])',
    hints: ['$replaceRoot replaces entire document', 'newRoot specifies new structure'],
    validPatterns: [/\$replaceRoot\s*:\s*\{\s*newRoot\s*:\s*"\$profile"\s*\}/i],
    tags: ['aggregation', '$replaceRoot'],
  },
  {
    id: 'mongo-agg-322',
    category: 'Aggregation Pipeline',
    difficulty: 'easy',
    title: '$sortByCount',
    text: 'Count and sort by tags.',
    setup: 'Collection: posts with tags',
    setupCode: `db.posts.insertMany([{tags: "mongodb"}, {tags: "mongodb"}, {tags: "sql"}]);`,
    expected: [
      { _id: 'mongodb', count: 2 },
      { _id: 'sql', count: 1 },
    ],
    sample: 'db.posts.aggregate([{$sortByCount: "$tags"}])',
    hints: ['$sortByCount groups and sorts', 'Shorthand for $group + $sort'],
    validPatterns: [/\$sortByCount\s*:\s*"\$tags"/i],
    tags: ['aggregation', '$sortByCount'],
  },
  {
    id: 'mongo-agg-323',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Arithmetic $add',
    text: 'Calculate total price as base + tax.',
    setup: 'Collection: products with base and tax',
    setupCode: `db.products.insertOne({name: "Apple", base: 100, tax: 10});`,
    expected: [{ name: 'Apple', total: 110 }],
    sample:
      'db.products.aggregate([{$project: {name: 1, total: {$add: ["$base", "$tax"]}, _id: 0}}])',
    hints: ['$add for addition', 'Takes array of values'],
    validPatterns: [/\$add\s*:\s*\["\$base"\s*,\s*"\$tax"\]/i],
    tags: ['aggregation', '$add'],
  },
  {
    id: 'mongo-agg-324',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Arithmetic $subtract',
    text: 'Calculate profit as revenue minus cost.',
    setup: 'Collection: sales with revenue and cost',
    setupCode: `db.sales.insertOne({item: "A", revenue: 150, cost: 100});`,
    expected: [{ item: 'A', profit: 50 }],
    sample:
      'db.sales.aggregate([{$project: {item: 1, profit: {$subtract: ["$revenue", "$cost"]}, _id: 0}}])',
    hints: ['$subtract for subtraction', 'First value minus second'],
    validPatterns: [/\$subtract\s*:\s*\["\$revenue"\s*,\s*"\$cost"\]/i],
    tags: ['aggregation', '$subtract'],
  },
  {
    id: 'mongo-agg-325',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Arithmetic $multiply',
    text: 'Calculate total as price times quantity.',
    setup: 'Collection: orders with price and quantity',
    setupCode: `db.orders.insertOne({item: "A", price: 10, quantity: 5});`,
    expected: [{ item: 'A', total: 50 }],
    sample:
      'db.orders.aggregate([{$project: {item: 1, total: {$multiply: ["$price", "$quantity"]}, _id: 0}}])',
    hints: ['$multiply for multiplication', 'Can multiply multiple values'],
    validPatterns: [/\$multiply\s*:\s*\["\$price"\s*,\s*"\$quantity"\]/i],
    tags: ['aggregation', '$multiply'],
  },
  {
    id: 'mongo-agg-326',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Arithmetic $divide',
    text: 'Calculate average price per unit.',
    setup: 'Collection: purchases with total and units',
    setupCode: `db.purchases.insertOne({item: "A", total: 100, units: 4});`,
    expected: [{ item: 'A', avgPrice: 25 }],
    sample:
      'db.purchases.aggregate([{$project: {item: 1, avgPrice: {$divide: ["$total", "$units"]}, _id: 0}}])',
    hints: ['$divide for division', 'First divided by second'],
    validPatterns: [/\$divide\s*:\s*\["\$total"\s*,\s*"\$units"\]/i],
    tags: ['aggregation', '$divide'],
  },
  {
    id: 'mongo-agg-327',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$round Number',
    text: 'Round price to 2 decimal places.',
    setup: 'Collection: products with price',
    setupCode: `db.products.insertOne({name: "A", price: 19.876});`,
    expected: [{ name: 'A', price: 19.88 }],
    sample:
      'db.products.aggregate([{$project: {name: 1, price: {$round: ["$price", 2]}, _id: 0}}])',
    hints: ['$round for rounding', 'Second arg is decimal places'],
    validPatterns: [/\$round\s*:\s*\["\$price"\s*,\s*2\]/i],
    tags: ['aggregation', '$round'],
  },
  {
    id: 'mongo-agg-328',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'String $toUpper',
    text: 'Convert name to uppercase.',
    setup: 'Collection: users with name',
    setupCode: `db.users.insertOne({name: "john doe"});`,
    expected: [{ name: 'JOHN DOE' }],
    sample: 'db.users.aggregate([{$project: {name: {$toUpper: "$name"}, _id: 0}}])',
    hints: ['$toUpper converts to uppercase', 'Works on strings only'],
    validPatterns: [/\$toUpper\s*:\s*"\$name"/i],
    tags: ['aggregation', '$toUpper'],
  },
  {
    id: 'mongo-agg-329',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'String $toLower',
    text: 'Convert email to lowercase.',
    setup: 'Collection: users with email',
    setupCode: `db.users.insertOne({email: "JOHN@TEST.COM"});`,
    expected: [{ email: 'john@test.com' }],
    sample: 'db.users.aggregate([{$project: {email: {$toLower: "$email"}, _id: 0}}])',
    hints: ['$toLower converts to lowercase', 'Useful for normalization'],
    validPatterns: [/\$toLower\s*:\s*"\$email"/i],
    tags: ['aggregation', '$toLower'],
  },
  {
    id: 'mongo-agg-330',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'String $substr',
    text: 'Extract first 3 characters of code.',
    setup: 'Collection: items with code',
    setupCode: `db.items.insertOne({code: "ABC123"});`,
    expected: [{ prefix: 'ABC' }],
    sample: 'db.items.aggregate([{$project: {prefix: {$substr: ["$code", 0, 3]}, _id: 0}}])',
    hints: ['$substr extracts substring', 'Args: string, start, length'],
    validPatterns: [/\$substr\s*:\s*\["\$code"\s*,\s*0\s*,\s*3\]/i],
    tags: ['aggregation', '$substr'],
  },
  {
    id: 'mongo-agg-331',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'String $strLenCP',
    text: 'Get length of name string.',
    setup: 'Collection: users with name',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: [{ name: 'John', length: 4 }],
    sample: 'db.users.aggregate([{$project: {name: 1, length: {$strLenCP: "$name"}, _id: 0}}])',
    hints: ['$strLenCP counts code points', 'Works with Unicode'],
    validPatterns: [/\$strLenCP\s*:\s*"\$name"/i],
    tags: ['aggregation', '$strLenCP'],
  },
  {
    id: 'mongo-agg-332',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'String $split',
    text: 'Split full name into array of words.',
    setup: 'Collection: users with fullName',
    setupCode: `db.users.insertOne({fullName: "John Doe Smith"});`,
    expected: [{ parts: ['John', 'Doe', 'Smith'] }],
    sample: 'db.users.aggregate([{$project: {parts: {$split: ["$fullName", " "]}, _id: 0}}])',
    hints: ['$split creates array from string', 'Specify delimiter'],
    validPatterns: [/\$split\s*:\s*\["\$fullName"\s*,\s*" "\]/i],
    tags: ['aggregation', '$split'],
  },
  {
    id: 'mongo-agg-333',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Date $year',
    text: 'Extract year from date field.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ name: 'Event', year: 2024 }],
    sample: 'db.events.aggregate([{$project: {name: 1, year: {$year: "$date"}, _id: 0}}])',
    hints: ['$year extracts year', 'Returns integer'],
    validPatterns: [/\$year\s*:\s*"\$date"/i],
    tags: ['aggregation', '$year', 'date'],
  },
  {
    id: 'mongo-agg-334',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Date $month',
    text: 'Extract month from date field.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ name: 'Event', month: 6 }],
    sample: 'db.events.aggregate([{$project: {name: 1, month: {$month: "$date"}, _id: 0}}])',
    hints: ['$month extracts month (1-12)', 'January is 1'],
    validPatterns: [/\$month\s*:\s*"\$date"/i],
    tags: ['aggregation', '$month', 'date'],
  },
  {
    id: 'mongo-agg-335',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Date $dayOfMonth',
    text: 'Extract day of month from date.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ name: 'Event', day: 15 }],
    sample: 'db.events.aggregate([{$project: {name: 1, day: {$dayOfMonth: "$date"}, _id: 0}}])',
    hints: ['$dayOfMonth extracts day', 'Range: 1-31'],
    validPatterns: [/\$dayOfMonth\s*:\s*"\$date"/i],
    tags: ['aggregation', '$dayOfMonth', 'date'],
  },
  {
    id: 'mongo-agg-336',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: '$dateToString Format',
    text: 'Format date as YYYY-MM-DD string.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ name: 'Event', dateStr: '2024-06-15' }],
    sample:
      'db.events.aggregate([{$project: {name: 1, dateStr: {$dateToString: {format: "%Y-%m-%d", date: "$date"}}, _id: 0}}])',
    hints: ['$dateToString formats dates', 'Use format specifiers'],
    validPatterns: [/\$dateToString\s*:\s*\{\s*format\s*:\s*"%Y-%m-%d"/i],
    tags: ['aggregation', '$dateToString', 'date'],
  },
  {
    id: 'mongo-agg-337',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Conditional $cond',
    text: 'Set status based on score value.',
    setup: 'Collection: tests with score',
    setupCode: `db.tests.insertOne({name: "Test1", score: 75});`,
    expected: [{ name: 'Test1', status: 'pass' }],
    sample:
      'db.tests.aggregate([{$project: {name: 1, status: {$cond: {if: {$gte: ["$score", 60]}, then: "pass", else: "fail"}}, _id: 0}}])',
    hints: ['$cond for if-then-else', 'Returns then or else value'],
    validPatterns: [/\$cond\s*:\s*\{\s*if\s*:/i],
    tags: ['aggregation', '$cond'],
  },
  {
    id: 'mongo-agg-338',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: '$ifNull Default',
    text: 'Use default value if field is null.',
    setup: 'Collection: users with optional nickname',
    setupCode: `db.users.insertOne({name: "John", nickname: null});`,
    expected: [{ displayName: 'John' }],
    sample:
      'db.users.aggregate([{$project: {displayName: {$ifNull: ["$nickname", "$name"]}, _id: 0}}])',
    hints: ['$ifNull provides default', 'Returns first non-null'],
    validPatterns: [/\$ifNull\s*:\s*\["\$nickname"\s*,\s*"\$name"\]/i],
    tags: ['aggregation', '$ifNull'],
  },
  {
    id: 'mongo-agg-339',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: '$switch Multiple Conditions',
    text: 'Assign grade based on score ranges.',
    setup: 'Collection: students with score',
    setupCode: `db.students.insertOne({name: "John", score: 85});`,
    expected: [{ name: 'John', grade: 'B' }],
    sample: `db.students.aggregate([{$project: {name: 1, grade: {$switch: {
      branches: [
        {case: {$gte: ["$score", 90]}, then: "A"},
        {case: {$gte: ["$score", 80]}, then: "B"},
        {case: {$gte: ["$score", 70]}, then: "C"},
        {case: {$gte: ["$score", 60]}, then: "D"}
      ],
      default: "F"
    }}, _id: 0}}])`,
    hints: ['$switch for multiple conditions', 'Like switch statement'],
    validPatterns: [/\$switch\s*:\s*\{\s*branches\s*:/i],
    tags: ['aggregation', '$switch'],
  },
  {
    id: 'mongo-agg-340',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Array $size',
    text: 'Get count of items in array.',
    setup: 'Collection: orders with items array',
    setupCode: `db.orders.insertOne({orderId: 1, items: ["A", "B", "C"]});`,
    expected: [{ orderId: 1, itemCount: 3 }],
    sample: 'db.orders.aggregate([{$project: {orderId: 1, itemCount: {$size: "$items"}, _id: 0}}])',
    hints: ['$size returns array length', 'Works in aggregation'],
    validPatterns: [/\$size\s*:\s*"\$items"/i],
    tags: ['aggregation', '$size', 'array'],
  },
  {
    id: 'mongo-agg-341',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Array $arrayElemAt',
    text: 'Get first element of array.',
    setup: 'Collection: data with values array',
    setupCode: `db.data.insertOne({values: [10, 20, 30]});`,
    expected: [{ first: 10 }],
    sample: 'db.data.aggregate([{$project: {first: {$arrayElemAt: ["$values", 0]}, _id: 0}}])',
    hints: ['$arrayElemAt gets by index', 'Index starts at 0'],
    validPatterns: [/\$arrayElemAt\s*:\s*\["\$values"\s*,\s*0\]/i],
    tags: ['aggregation', '$arrayElemAt', 'array'],
  },
  {
    id: 'mongo-agg-342',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Array $filter',
    text: 'Filter array to keep only values > 20.',
    setup: 'Collection: data with values',
    setupCode: `db.data.insertOne({values: [10, 25, 15, 30]});`,
    expected: [{ filtered: [25, 30] }],
    sample:
      'db.data.aggregate([{$project: {filtered: {$filter: {input: "$values", as: "v", cond: {$gt: ["$$v", 20]}}}, _id: 0}}])',
    hints: ['$filter keeps matching elements', 'as defines variable, cond is filter'],
    validPatterns: [/\$filter\s*:\s*\{\s*input\s*:\s*"\$values"/i],
    tags: ['aggregation', '$filter', 'array'],
  },
  {
    id: 'mongo-agg-343',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Array $map Transform',
    text: 'Double all values in array.',
    setup: 'Collection: data with values',
    setupCode: `db.data.insertOne({values: [1, 2, 3]});`,
    expected: [{ doubled: [2, 4, 6] }],
    sample:
      'db.data.aggregate([{$project: {doubled: {$map: {input: "$values", as: "v", in: {$multiply: ["$$v", 2]}}}, _id: 0}}])',
    hints: ['$map transforms each element', 'in specifies transformation'],
    validPatterns: [/\$map\s*:\s*\{\s*input\s*:\s*"\$values"/i],
    tags: ['aggregation', '$map', 'array'],
  },
  {
    id: 'mongo-agg-344',
    category: 'Aggregation Pipeline',
    difficulty: 'hard',
    title: 'Array $reduce',
    text: 'Sum all values in array.',
    setup: 'Collection: data with values',
    setupCode: `db.data.insertOne({values: [1, 2, 3, 4]});`,
    expected: [{ sum: 10 }],
    sample:
      'db.data.aggregate([{$project: {sum: {$reduce: {input: "$values", initialValue: 0, in: {$add: ["$$value", "$$this"]}}}, _id: 0}}])',
    hints: ['$reduce accumulates values', '$$value is accumulator, $$this is current'],
    validPatterns: [/\$reduce\s*:\s*\{\s*input\s*:\s*"\$values"/i],
    tags: ['aggregation', '$reduce', 'array'],
  },
  {
    id: 'mongo-agg-345',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Array $in Check',
    text: 'Check if value exists in array.',
    setup: 'Collection: users with roles',
    setupCode: `db.users.insertOne({name: "John", roles: ["admin", "user"]});`,
    expected: [{ name: 'John', isAdmin: true }],
    sample:
      'db.users.aggregate([{$project: {name: 1, isAdmin: {$in: ["admin", "$roles"]}, _id: 0}}])',
    hints: ['$in checks array membership', 'First arg is value to find'],
    validPatterns: [/\$in\s*:\s*\["admin"\s*,\s*"\$roles"\]/i],
    tags: ['aggregation', '$in', 'array'],
  },
  {
    id: 'mongo-agg-346',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Array $concatArrays',
    text: 'Merge two arrays into one.',
    setup: 'Collection: data with arr1 and arr2',
    setupCode: `db.data.insertOne({arr1: [1, 2], arr2: [3, 4]});`,
    expected: [{ merged: [1, 2, 3, 4] }],
    sample:
      'db.data.aggregate([{$project: {merged: {$concatArrays: ["$arr1", "$arr2"]}, _id: 0}}])',
    hints: ['$concatArrays joins arrays', 'Takes array of arrays'],
    validPatterns: [/\$concatArrays\s*:\s*\["\$arr1"\s*,\s*"\$arr2"\]/i],
    tags: ['aggregation', '$concatArrays', 'array'],
  },
  {
    id: 'mongo-agg-347',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Boolean $and',
    text: 'Check if both conditions are true.',
    setup: 'Collection: users with isActive and isVerified',
    setupCode: `db.users.insertOne({name: "John", isActive: true, isVerified: true});`,
    expected: [{ name: 'John', canAccess: true }],
    sample:
      'db.users.aggregate([{$project: {name: 1, canAccess: {$and: ["$isActive", "$isVerified"]}, _id: 0}}])',
    hints: ['$and requires all true', 'Returns boolean'],
    validPatterns: [/\$and\s*:\s*\["\$isActive"\s*,\s*"\$isVerified"\]/i],
    tags: ['aggregation', '$and', 'boolean'],
  },
  {
    id: 'mongo-agg-348',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Boolean $or',
    text: 'Check if either condition is true.',
    setup: 'Collection: users with isAdmin and isModerator',
    setupCode: `db.users.insertOne({name: "John", isAdmin: false, isModerator: true});`,
    expected: [{ name: 'John', hasAccess: true }],
    sample:
      'db.users.aggregate([{$project: {name: 1, hasAccess: {$or: ["$isAdmin", "$isModerator"]}, _id: 0}}])',
    hints: ['$or requires at least one true', 'Short-circuits'],
    validPatterns: [/\$or\s*:\s*\["\$isAdmin"\s*,\s*"\$isModerator"\]/i],
    tags: ['aggregation', '$or', 'boolean'],
  },
  {
    id: 'mongo-agg-349',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Boolean $not',
    text: 'Negate a boolean value.',
    setup: 'Collection: users with isBlocked',
    setupCode: `db.users.insertOne({name: "John", isBlocked: false});`,
    expected: [{ name: 'John', canLogin: true }],
    sample: 'db.users.aggregate([{$project: {name: 1, canLogin: {$not: "$isBlocked"}, _id: 0}}])',
    hints: ['$not inverts boolean', 'Single expression input'],
    validPatterns: [/\$not\s*:\s*"\$isBlocked"/i],
    tags: ['aggregation', '$not', 'boolean'],
  },
  {
    id: 'mongo-agg-350',
    category: 'Aggregation Pipeline',
    difficulty: 'medium',
    title: 'Comparison $eq',
    text: 'Check if status equals "active".',
    setup: 'Collection: users with status',
    setupCode: `db.users.insertOne({name: "John", status: "active"});`,
    expected: [{ name: 'John', isActive: true }],
    sample:
      'db.users.aggregate([{$project: {name: 1, isActive: {$eq: ["$status", "active"]}, _id: 0}}])',
    hints: ['$eq compares for equality', 'Returns boolean'],
    validPatterns: [/\$eq\s*:\s*\["\$status"\s*,\s*"active"\]/i],
    tags: ['aggregation', '$eq', 'comparison'],
  },

  // ============================================================
  // ARRAY OPERATIONS (50 problems)
  // ============================================================
  {
    id: 'mongo-array-400',
    category: 'Array Operations',
    difficulty: 'easy',
    title: 'Match Array Contains',
    text: 'Find documents where tags array contains "mongodb".',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database"]},
  {title: "Post2", tags: ["javascript"]}
]);`,
    expected: [{ title: 'Post1', tags: ['mongodb', 'database'] }],
    sample: 'db.posts.find({tags: "mongodb"})',
    hints: ['Query array with scalar value', 'Matches if array contains value'],
    validPatterns: [/db\.posts\.find\s*\(\s*\{\s*tags\s*:\s*"mongodb"\s*\}\s*\)/i],
    tags: ['find', 'array', 'contains'],
  },
  {
    id: 'mongo-array-401',
    category: 'Array Operations',
    difficulty: 'medium',
    title: '$elemMatch Query',
    text: 'Find orders where items array has element with qty > 10 and price < 20.',
    setup: 'Collection: orders with items array of objects',
    setupCode: `db.orders.insertMany([
  {_id: 1, items: [{product: "A", qty: 15, price: 10}, {product: "B", qty: 5, price: 25}]},
  {_id: 2, items: [{product: "C", qty: 5, price: 10}]}
]);`,
    expected: [{ _id: 1 }],
    sample: 'db.orders.find({items: {$elemMatch: {qty: {$gt: 10}, price: {$lt: 20}}}})',
    hints: [
      '$elemMatch for multiple conditions on same element',
      'All conditions must match one element',
    ],
    validPatterns: [/\$elemMatch\s*:\s*\{\s*qty\s*:\s*\{\s*\$gt\s*:\s*10\s*\}/i],
    tags: ['find', 'array', '$elemMatch'],
  },
  {
    id: 'mongo-array-402',
    category: 'Array Operations',
    difficulty: 'medium',
    title: '$all Match All Values',
    text: 'Find documents where tags contains both "mongodb" and "database".',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database", "nosql"]},
  {title: "Post2", tags: ["mongodb"]}
]);`,
    expected: [{ title: 'Post1' }],
    sample: 'db.posts.find({tags: {$all: ["mongodb", "database"]}})',
    hints: ['$all requires all values present', 'Order does not matter'],
    validPatterns: [/\$all\s*:\s*\[\s*"mongodb"\s*,\s*"database"\s*\]/i],
    tags: ['find', 'array', '$all'],
  },
  {
    id: 'mongo-array-403',
    category: 'Array Operations',
    difficulty: 'medium',
    title: '$size Match Array Length',
    text: 'Find documents where tags array has exactly 3 elements.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["a", "b", "c"]},
  {title: "Post2", tags: ["a", "b"]}
]);`,
    expected: [{ title: 'Post1' }],
    sample: 'db.posts.find({tags: {$size: 3}})',
    hints: ['$size matches exact length', 'Cannot use with comparison operators'],
    validPatterns: [/\$size\s*:\s*3/i],
    tags: ['find', 'array', '$size'],
  },
  {
    id: 'mongo-array-404',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Query Array by Index',
    text: 'Find documents where first tag is "mongodb".',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database"]},
  {title: "Post2", tags: ["javascript", "mongodb"]}
]);`,
    expected: [{ title: 'Post1' }],
    sample: 'db.posts.find({"tags.0": "mongodb"})',
    hints: ['Use dot notation with index', 'Index starts at 0'],
    validPatterns: [/"tags\.0"\s*:\s*"mongodb"/i],
    tags: ['find', 'array', 'index'],
  },
  {
    id: 'mongo-array-405',
    category: 'Array Operations',
    difficulty: 'easy',
    title: 'Projection $slice First N',
    text: 'Return only first 2 elements of comments array.',
    setup: 'Collection: posts with comments array',
    setupCode: `db.posts.insertOne({title: "Post1", comments: ["a", "b", "c", "d"]});`,
    expected: [{ title: 'Post1', comments: ['a', 'b'] }],
    sample: 'db.posts.find({}, {comments: {$slice: 2}})',
    hints: ['$slice in projection limits array', 'Positive number for first N'],
    validPatterns: [/\$slice\s*:\s*2/i],
    tags: ['projection', 'array', '$slice'],
  },
  {
    id: 'mongo-array-406',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Projection $slice Last N',
    text: 'Return only last 2 elements of comments array.',
    setup: 'Collection: posts with comments array',
    setupCode: `db.posts.insertOne({title: "Post1", comments: ["a", "b", "c", "d"]});`,
    expected: [{ title: 'Post1', comments: ['c', 'd'] }],
    sample: 'db.posts.find({}, {comments: {$slice: -2}})',
    hints: ['Negative $slice for last N', '-2 returns last 2 elements'],
    validPatterns: [/\$slice\s*:\s*-2/i],
    tags: ['projection', 'array', '$slice'],
  },
  {
    id: 'mongo-array-407',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Projection $slice Skip and Limit',
    text: 'Skip first 1 element and return next 2 from comments.',
    setup: 'Collection: posts with comments array',
    setupCode: `db.posts.insertOne({title: "Post1", comments: ["a", "b", "c", "d"]});`,
    expected: [{ title: 'Post1', comments: ['b', 'c'] }],
    sample: 'db.posts.find({}, {comments: {$slice: [1, 2]}})',
    hints: ['Array syntax: [skip, limit]', 'First number is offset'],
    validPatterns: [/\$slice\s*:\s*\[\s*1\s*,\s*2\s*\]/i],
    tags: ['projection', 'array', '$slice'],
  },
  {
    id: 'mongo-array-408',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Projection $elemMatch',
    text: 'Return only matching element from scores array.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [{subject: "math", score: 90}, {subject: "english", score: 80}]});`,
    expected: [{ name: 'John', scores: [{ subject: 'math', score: 90 }] }],
    sample: 'db.students.find({}, {scores: {$elemMatch: {subject: "math"}}})',
    hints: ['$elemMatch in projection returns first match', 'Filters array elements'],
    validPatterns: [/\$elemMatch\s*:\s*\{\s*subject\s*:\s*"math"\s*\}/i],
    tags: ['projection', 'array', '$elemMatch'],
  },
  {
    id: 'mongo-array-409',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Positional $ Projection',
    text: 'Return only the matched array element using $ operator.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [85, 90, 78]});`,
    expected: [{ name: 'John', scores: [90] }],
    sample: 'db.students.find({scores: {$gte: 90}}, {"scores.$": 1})',
    hints: ['$ returns first matched element', 'Requires query on array'],
    validPatterns: [/"scores\.\$"\s*:\s*1/i],
    tags: ['projection', 'array', '$'],
  },
  {
    id: 'mongo-array-410',
    category: 'Array Operations',
    difficulty: 'easy',
    title: 'Push to Array',
    text: 'Add "new-tag" to the tags array.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({title: "Post1"}, {$push: {tags: "new-tag"}})',
    hints: ['$push adds to end of array', 'Creates array if not exists'],
    validPatterns: [/\$push\s*:\s*\{\s*tags\s*:\s*"new-tag"\s*\}/i],
    tags: ['update', 'array', '$push'],
  },
  {
    id: 'mongo-array-411',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Push Multiple with $each',
    text: 'Add multiple tags at once.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({title: "Post1"}, {$push: {tags: {$each: ["tag1", "tag2"]}}})',
    hints: ['$each with $push for multiple items', 'Items added in order'],
    validPatterns: [/\$each\s*:\s*\[\s*"tag1"\s*,\s*"tag2"\s*\]/i],
    tags: ['update', 'array', '$push', '$each'],
  },
  {
    id: 'mongo-array-412',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Push with $position',
    text: 'Insert "urgent" at the beginning of tags array.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb", "database"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.posts.updateOne({title: "Post1"}, {$push: {tags: {$each: ["urgent"], $position: 0}}})',
    hints: ['$position specifies insert index', '0 is the beginning'],
    validPatterns: [/\$position\s*:\s*0/i],
    tags: ['update', 'array', '$push', '$position'],
  },
  {
    id: 'mongo-array-413',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Push with $sort',
    text: 'Add score and keep array sorted descending.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [90, 80, 70]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.students.updateOne({name: "John"}, {$push: {scores: {$each: [85], $sort: -1}}})',
    hints: ['$sort orders after push', '-1 for descending'],
    validPatterns: [/\$sort\s*:\s*-1/i],
    tags: ['update', 'array', '$push', '$sort'],
  },
  {
    id: 'mongo-array-414',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Push with $slice Limit',
    text: 'Add score and keep only top 5 scores.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [90, 85, 80, 75, 70]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.students.updateOne({name: "John"}, {$push: {scores: {$each: [95], $sort: -1, $slice: 5}}})',
    hints: ['$slice limits array size', 'Combine with $sort for top N'],
    validPatterns: [/\$slice\s*:\s*5/i],
    tags: ['update', 'array', '$push', '$slice'],
  },
  {
    id: 'mongo-array-415',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'AddToSet Unique',
    text: 'Add tag only if it does not already exist.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({title: "Post1"}, {$addToSet: {tags: "database"}})',
    hints: ['$addToSet prevents duplicates', 'No change if already exists'],
    validPatterns: [/\$addToSet\s*:\s*\{\s*tags\s*:\s*"database"\s*\}/i],
    tags: ['update', 'array', '$addToSet'],
  },
  {
    id: 'mongo-array-416',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'AddToSet Multiple with $each',
    text: 'Add multiple unique tags.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({title: "Post1"}, {$addToSet: {tags: {$each: ["tag1", "tag2"]}}})',
    hints: ['$each with $addToSet for multiple', 'Each checked for uniqueness'],
    validPatterns: [/\$addToSet\s*:\s*\{\s*tags\s*:\s*\{\s*\$each\s*:/i],
    tags: ['update', 'array', '$addToSet', '$each'],
  },
  {
    id: 'mongo-array-417',
    category: 'Array Operations',
    difficulty: 'easy',
    title: 'Pull from Array',
    text: 'Remove "mongodb" from tags array.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertOne({title: "Post1", tags: ["mongodb", "database"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.posts.updateOne({title: "Post1"}, {$pull: {tags: "mongodb"}})',
    hints: ['$pull removes matching values', 'Removes all occurrences'],
    validPatterns: [/\$pull\s*:\s*\{\s*tags\s*:\s*"mongodb"\s*\}/i],
    tags: ['update', 'array', '$pull'],
  },
  {
    id: 'mongo-array-418',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Pull with Condition',
    text: 'Remove all scores less than 60.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [85, 45, 92, 55]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.students.updateOne({name: "John"}, {$pull: {scores: {$lt: 60}}})',
    hints: ['$pull can use query conditions', 'Removes all matching'],
    validPatterns: [/\$pull\s*:\s*\{\s*scores\s*:\s*\{\s*\$lt\s*:\s*60\s*\}\s*\}/i],
    tags: ['update', 'array', '$pull'],
  },
  {
    id: 'mongo-array-419',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Pull Object from Array',
    text: 'Remove item with product "A" from items array.',
    setup: 'Collection: orders with items array of objects',
    setupCode: `db.orders.insertOne({_id: 1, items: [{product: "A", qty: 5}, {product: "B", qty: 10}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.orders.updateOne({_id: 1}, {$pull: {items: {product: "A"}}})',
    hints: ['$pull can match object fields', 'Removes matching objects'],
    validPatterns: [/\$pull\s*:\s*\{\s*items\s*:\s*\{\s*product\s*:\s*"A"\s*\}\s*\}/i],
    tags: ['update', 'array', '$pull'],
  },
  {
    id: 'mongo-array-420',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'PullAll Multiple Values',
    text: 'Remove multiple specific values from array.',
    setup: 'Collection: data with numbers array',
    setupCode: `db.data.insertOne({nums: [1, 2, 3, 4, 2, 5, 2]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.data.updateOne({}, {$pullAll: {nums: [2, 4]}})',
    hints: ['$pullAll removes all listed values', 'Removes all occurrences of each'],
    validPatterns: [/\$pullAll\s*:\s*\{\s*nums\s*:\s*\[\s*2\s*,\s*4\s*\]\s*\}/i],
    tags: ['update', 'array', '$pullAll'],
  },
  {
    id: 'mongo-array-421',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Pop First Element',
    text: 'Remove first element from queue array.',
    setup: 'Collection: queues with queue array',
    setupCode: `db.queues.insertOne({name: "q1", queue: ["first", "second", "third"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.queues.updateOne({name: "q1"}, {$pop: {queue: -1}})',
    hints: ['$pop -1 removes first', '-1 for beginning, 1 for end'],
    validPatterns: [/\$pop\s*:\s*\{\s*queue\s*:\s*-1\s*\}/i],
    tags: ['update', 'array', '$pop'],
  },
  {
    id: 'mongo-array-422',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Pop Last Element',
    text: 'Remove last element from stack array.',
    setup: 'Collection: stacks with stack array',
    setupCode: `db.stacks.insertOne({name: "s1", stack: ["first", "second", "third"]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.stacks.updateOne({name: "s1"}, {$pop: {stack: 1}})',
    hints: ['$pop 1 removes last', 'Stack behavior (LIFO)'],
    validPatterns: [/\$pop\s*:\s*\{\s*stack\s*:\s*1\s*\}/i],
    tags: ['update', 'array', '$pop'],
  },
  {
    id: 'mongo-array-423',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update Positional $',
    text: 'Update first matching element in array.',
    setup: 'Collection: students with grades array',
    setupCode: `db.students.insertOne({name: "John", grades: [{subject: "math", score: 80}, {subject: "english", score: 90}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.students.updateOne({name: "John", "grades.subject": "math"}, {$set: {"grades.$.score": 95}})',
    hints: ['$ references matched array element', 'Query must include array match'],
    validPatterns: [/"grades\.\$\.score"\s*:\s*95/i],
    tags: ['update', 'array', '$'],
  },
  {
    id: 'mongo-array-424',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update All Array Elements $[]',
    text: 'Increment all scores in array by 5.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [80, 85, 90]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample: 'db.students.updateOne({name: "John"}, {$inc: {"scores.$[]": 5}})',
    hints: ['$[] updates all elements', 'No filter applied'],
    validPatterns: [/"scores\.\$\[\]"\s*:\s*5/i],
    tags: ['update', 'array', '$[]'],
  },
  {
    id: 'mongo-array-425',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update Filtered Elements $[identifier]',
    text: 'Update scores greater than 85 to 100.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [80, 90, 95]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.students.updateOne({name: "John"}, {$set: {"scores.$[elem]": 100}}, {arrayFilters: [{"elem": {$gt: 85}}]})',
    hints: ['$[identifier] with arrayFilters', 'Filter specifies condition'],
    validPatterns: [/arrayFilters\s*:\s*\[/i],
    tags: ['update', 'array', '$[identifier]', 'arrayFilters'],
  },
  {
    id: 'mongo-array-426',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Update Nested Array Element',
    text: 'Update score in nested grades array.',
    setup: 'Collection: students with nested structure',
    setupCode: `db.students.insertOne({name: "John", classes: [{name: "Math", grades: [{test: 1, score: 80}]}]});`,
    expected: { acknowledged: true, modifiedCount: 1 },
    sample:
      'db.students.updateOne({name: "John", "classes.name": "Math"}, {$set: {"classes.$.grades.0.score": 95}})',
    hints: ['Combine $ with index', 'Navigate nested structure'],
    validPatterns: [/"classes\.\$\.grades\.0\.score"\s*:\s*95/i],
    tags: ['update', 'array', 'nested'],
  },
  {
    id: 'mongo-array-427',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Find Empty Array',
    text: 'Find documents where tags array is empty.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb"]},
  {title: "Post2", tags: []}
]);`,
    expected: [{ title: 'Post2', tags: [] }],
    sample: 'db.posts.find({tags: {$size: 0}})',
    hints: ['$size: 0 matches empty arrays', 'Or use {tags: []}'],
    validPatterns: [/\$size\s*:\s*0/i],
    tags: ['find', 'array', 'empty'],
  },
  {
    id: 'mongo-array-428',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Find Non-Empty Array',
    text: 'Find documents where tags array has at least one element.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb"]},
  {title: "Post2", tags: []}
]);`,
    expected: [{ title: 'Post1' }],
    sample: 'db.posts.find({tags: {$exists: true, $ne: []}})',
    hints: ['Combine $exists with $ne empty', 'Or use $not with $size'],
    validPatterns: [/\$exists\s*:\s*true.*\$ne\s*:\s*\[\s*\]/i],
    tags: ['find', 'array', 'non-empty'],
  },
  {
    id: 'mongo-array-429',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Find Array Length Greater Than',
    text: 'Find documents where tags array has more than 2 elements.',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["a", "b", "c"]},
  {title: "Post2", tags: ["a"]}
]);`,
    expected: [{ title: 'Post1' }],
    sample: 'db.posts.find({$expr: {$gt: [{$size: "$tags"}, 2]}})',
    hints: ['Use $expr with $size', '$size cannot use comparison directly'],
    validPatterns: [/\$expr\s*:\s*\{\s*\$gt\s*:\s*\[\s*\{\s*\$size\s*:\s*"\$tags"\s*\}/i],
    tags: ['find', 'array', '$expr'],
  },
  {
    id: 'mongo-array-430',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Match Last Array Element',
    text: 'Find documents where last element of array is "end".',
    setup: 'Collection: data with values array',
    setupCode: `db.data.insertMany([
  {values: ["start", "middle", "end"]},
  {values: ["start", "end", "other"]}
]);`,
    expected: [{ values: ['start', 'middle', 'end'] }],
    sample: 'db.data.find({$expr: {$eq: [{$arrayElemAt: ["$values", -1]}, "end"]}})',
    hints: ['Use $arrayElemAt with -1 for last', 'Combine with $expr'],
    validPatterns: [/\$arrayElemAt\s*:\s*\["\$values"\s*,\s*-1\]/i],
    tags: ['find', 'array', '$arrayElemAt'],
  },
  {
    id: 'mongo-array-431',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Match Array Element by Condition',
    text: 'Find where any item has qty > 10 and status is "active".',
    setup: 'Collection: orders with items array',
    setupCode: `db.orders.insertMany([
  {_id: 1, items: [{qty: 15, status: "active"}, {qty: 5, status: "inactive"}]},
  {_id: 2, items: [{qty: 15, status: "inactive"}]}
]);`,
    expected: [{ _id: 1 }],
    sample: 'db.orders.find({items: {$elemMatch: {qty: {$gt: 10}, status: "active"}}})',
    hints: ['$elemMatch for compound conditions', 'Conditions on same element'],
    validPatterns: [
      /\$elemMatch\s*:\s*\{\s*qty\s*:\s*\{\s*\$gt\s*:\s*10\s*\}\s*,\s*status\s*:\s*"active"\s*\}/i,
    ],
    tags: ['find', 'array', '$elemMatch'],
  },
  {
    id: 'mongo-array-432',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Match Array Not Contains',
    text: 'Find documents where tags does not contain "spam".',
    setup: 'Collection: posts with tags array',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb", "database"]},
  {title: "Post2", tags: ["spam", "junk"]}
]);`,
    expected: [{ title: 'Post1' }],
    sample: 'db.posts.find({tags: {$nin: ["spam"]}})',
    hints: ['$nin excludes if array contains any', 'Not in array'],
    validPatterns: [/\$nin\s*:\s*\[\s*"spam"\s*\]/i],
    tags: ['find', 'array', '$nin'],
  },
  {
    id: 'mongo-array-433',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Count Array Elements Matching',
    text: 'Count how many items have qty > 10 in aggregation.',
    setup: 'Collection: orders with items array',
    setupCode: `db.orders.insertOne({_id: 1, items: [{qty: 15}, {qty: 5}, {qty: 20}]});`,
    expected: [{ matchCount: 2 }],
    sample:
      'db.orders.aggregate([{$project: {matchCount: {$size: {$filter: {input: "$items", cond: {$gt: ["$$this.qty", 10]}}}}}}])',
    hints: ['Combine $filter with $size', 'Filter then count'],
    validPatterns: [/\$filter\s*:\s*\{\s*input\s*:\s*"\$items"/i],
    tags: ['aggregation', 'array', '$filter', '$size'],
  },
  {
    id: 'mongo-array-434',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Find Max in Array',
    text: 'Find the maximum value in scores array using aggregation.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [85, 92, 78]});`,
    expected: [{ name: 'John', maxScore: 92 }],
    sample: 'db.students.aggregate([{$project: {name: 1, maxScore: {$max: "$scores"}}}])',
    hints: ['$max works on arrays', 'Returns highest value'],
    validPatterns: [/\$max\s*:\s*"\$scores"/i],
    tags: ['aggregation', 'array', '$max'],
  },
  {
    id: 'mongo-array-435',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Find Min in Array',
    text: 'Find the minimum value in scores array using aggregation.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [85, 92, 78]});`,
    expected: [{ name: 'John', minScore: 78 }],
    sample: 'db.students.aggregate([{$project: {name: 1, minScore: {$min: "$scores"}}}])',
    hints: ['$min works on arrays', 'Returns lowest value'],
    validPatterns: [/\$min\s*:\s*"\$scores"/i],
    tags: ['aggregation', 'array', '$min'],
  },
  {
    id: 'mongo-array-436',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Sum Array Values',
    text: 'Calculate sum of all values in amounts array.',
    setup: 'Collection: invoices with amounts array',
    setupCode: `db.invoices.insertOne({_id: 1, amounts: [100, 200, 50]});`,
    expected: [{ total: 350 }],
    sample: 'db.invoices.aggregate([{$project: {total: {$sum: "$amounts"}}}])',
    hints: ['$sum works on arrays', 'Returns total of all elements'],
    validPatterns: [/\$sum\s*:\s*"\$amounts"/i],
    tags: ['aggregation', 'array', '$sum'],
  },
  {
    id: 'mongo-array-437',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Average of Array Values',
    text: 'Calculate average of scores array.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [80, 90, 100]});`,
    expected: [{ avgScore: 90 }],
    sample: 'db.students.aggregate([{$project: {avgScore: {$avg: "$scores"}}}])',
    hints: ['$avg works on arrays', 'Returns mean value'],
    validPatterns: [/\$avg\s*:\s*"\$scores"/i],
    tags: ['aggregation', 'array', '$avg'],
  },
  {
    id: 'mongo-array-438',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Reverse Array',
    text: 'Reverse the order of items array in aggregation.',
    setup: 'Collection: data with items array',
    setupCode: `db.data.insertOne({items: [1, 2, 3, 4]});`,
    expected: [{ reversed: [4, 3, 2, 1] }],
    sample: 'db.data.aggregate([{$project: {reversed: {$reverseArray: "$items"}}}])',
    hints: ['$reverseArray reverses order', 'Returns new array'],
    validPatterns: [/\$reverseArray\s*:\s*"\$items"/i],
    tags: ['aggregation', 'array', '$reverseArray'],
  },
  {
    id: 'mongo-array-439',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Check Array IsArray',
    text: 'Check if tags field is an array.',
    setup: 'Collection: posts with various tag formats',
    setupCode: `db.posts.insertMany([
  {title: "Post1", tags: ["mongodb"]},
  {title: "Post2", tags: "single-tag"}
]);`,
    expected: [
      { title: 'Post1', isArray: true },
      { title: 'Post2', isArray: false },
    ],
    sample: 'db.posts.aggregate([{$project: {title: 1, isArray: {$isArray: "$tags"}}}])',
    hints: ['$isArray checks type', 'Returns boolean'],
    validPatterns: [/\$isArray\s*:\s*"\$tags"/i],
    tags: ['aggregation', 'array', '$isArray'],
  },
  {
    id: 'mongo-array-440',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Array Range Generation',
    text: 'Generate array of numbers 1 to 5.',
    setup: 'Collection: data',
    setupCode: `db.data.insertOne({id: 1});`,
    expected: [{ sequence: [1, 2, 3, 4, 5] }],
    sample: 'db.data.aggregate([{$project: {sequence: {$range: [1, 6]}}}])',
    hints: ['$range generates sequence', 'End is exclusive'],
    validPatterns: [/\$range\s*:\s*\[\s*1\s*,\s*6\s*\]/i],
    tags: ['aggregation', 'array', '$range'],
  },
  {
    id: 'mongo-array-441',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Index of Value in Array',
    text: 'Find index of "B" in items array.',
    setup: 'Collection: data with items array',
    setupCode: `db.data.insertOne({items: ["A", "B", "C"]});`,
    expected: [{ index: 1 }],
    sample: 'db.data.aggregate([{$project: {index: {$indexOfArray: ["$items", "B"]}}}])',
    hints: ['$indexOfArray returns position', '-1 if not found'],
    validPatterns: [/\$indexOfArray\s*:\s*\["\$items"\s*,\s*"B"\]/i],
    tags: ['aggregation', 'array', '$indexOfArray'],
  },
  {
    id: 'mongo-array-442',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Zip Two Arrays',
    text: 'Combine names and ages arrays.',
    setup: 'Collection: data with parallel arrays',
    setupCode: `db.data.insertOne({names: ["John", "Jane"], ages: [30, 25]});`,
    expected: [
      {
        pairs: [
          ['John', 30],
          ['Jane', 25],
        ],
      },
    ],
    sample: 'db.data.aggregate([{$project: {pairs: {$zip: {inputs: ["$names", "$ages"]}}}}])',
    hints: ['$zip combines element-wise', 'Creates array of arrays'],
    validPatterns: [/\$zip\s*:\s*\{\s*inputs\s*:\s*\["\$names"\s*,\s*"\$ages"\]/i],
    tags: ['aggregation', 'array', '$zip'],
  },
  {
    id: 'mongo-array-443',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Check Element Exists in Array',
    text: 'Check if "admin" is in roles array using aggregation.',
    setup: 'Collection: users with roles array',
    setupCode: `db.users.insertOne({name: "John", roles: ["admin", "user"]});`,
    expected: [{ isAdmin: true }],
    sample: 'db.users.aggregate([{$project: {isAdmin: {$in: ["admin", "$roles"]}}}])',
    hints: ['$in checks membership in aggregation', 'First arg is search value'],
    validPatterns: [/\$in\s*:\s*\[\s*"admin"\s*,\s*"\$roles"\s*\]/i],
    tags: ['aggregation', 'array', '$in'],
  },
  {
    id: 'mongo-array-444',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Object to Array',
    text: 'Convert object to array of key-value pairs.',
    setup: 'Collection: data with object field',
    setupCode: `db.data.insertOne({settings: {theme: "dark", lang: "en"}});`,
    expected: [
      {
        arr: [
          { k: 'theme', v: 'dark' },
          { k: 'lang', v: 'en' },
        ],
      },
    ],
    sample: 'db.data.aggregate([{$project: {arr: {$objectToArray: "$settings"}}}])',
    hints: ['$objectToArray for iteration', 'Creates k,v pairs'],
    validPatterns: [/\$objectToArray\s*:\s*"\$settings"/i],
    tags: ['aggregation', 'array', '$objectToArray'],
  },
  {
    id: 'mongo-array-445',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Array to Object',
    text: 'Convert key-value array back to object.',
    setup: 'Collection: data with pairs array',
    setupCode: `db.data.insertOne({pairs: [{k: "a", v: 1}, {k: "b", v: 2}]});`,
    expected: [{ obj: { a: 1, b: 2 } }],
    sample: 'db.data.aggregate([{$project: {obj: {$arrayToObject: "$pairs"}}}])',
    hints: ['$arrayToObject reverses $objectToArray', 'Expects k,v format'],
    validPatterns: [/\$arrayToObject\s*:\s*"\$pairs"/i],
    tags: ['aggregation', 'array', '$arrayToObject'],
  },
  {
    id: 'mongo-array-446',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Set Union of Arrays',
    text: 'Get union of two arrays without duplicates.',
    setup: 'Collection: data with arr1 and arr2',
    setupCode: `db.data.insertOne({arr1: [1, 2, 3], arr2: [2, 3, 4]});`,
    expected: [{ union: [1, 2, 3, 4] }],
    sample: 'db.data.aggregate([{$project: {union: {$setUnion: ["$arr1", "$arr2"]}}}])',
    hints: ['$setUnion combines unique', 'No duplicates'],
    validPatterns: [/\$setUnion\s*:\s*\["\$arr1"\s*,\s*"\$arr2"\]/i],
    tags: ['aggregation', 'array', '$setUnion'],
  },
  {
    id: 'mongo-array-447',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Set Intersection of Arrays',
    text: 'Get common elements between two arrays.',
    setup: 'Collection: data with arr1 and arr2',
    setupCode: `db.data.insertOne({arr1: [1, 2, 3], arr2: [2, 3, 4]});`,
    expected: [{ common: [2, 3] }],
    sample: 'db.data.aggregate([{$project: {common: {$setIntersection: ["$arr1", "$arr2"]}}}])',
    hints: ['$setIntersection finds common', 'Elements in both arrays'],
    validPatterns: [/\$setIntersection\s*:\s*\["\$arr1"\s*,\s*"\$arr2"\]/i],
    tags: ['aggregation', 'array', '$setIntersection'],
  },
  {
    id: 'mongo-array-448',
    category: 'Array Operations',
    difficulty: 'hard',
    title: 'Set Difference of Arrays',
    text: 'Get elements in first array but not in second.',
    setup: 'Collection: data with arr1 and arr2',
    setupCode: `db.data.insertOne({arr1: [1, 2, 3], arr2: [2, 3, 4]});`,
    expected: [{ diff: [1] }],
    sample: 'db.data.aggregate([{$project: {diff: {$setDifference: ["$arr1", "$arr2"]}}}])',
    hints: ['$setDifference subtracts sets', 'Order matters'],
    validPatterns: [/\$setDifference\s*:\s*\["\$arr1"\s*,\s*"\$arr2"\]/i],
    tags: ['aggregation', 'array', '$setDifference'],
  },
  {
    id: 'mongo-array-449',
    category: 'Array Operations',
    difficulty: 'medium',
    title: 'Check Arrays Equal as Sets',
    text: 'Check if two arrays have same elements (ignoring order).',
    setup: 'Collection: data with arr1 and arr2',
    setupCode: `db.data.insertOne({arr1: [1, 2, 3], arr2: [3, 2, 1]});`,
    expected: [{ areEqual: true }],
    sample: 'db.data.aggregate([{$project: {areEqual: {$setEquals: ["$arr1", "$arr2"]}}}])',
    hints: ['$setEquals ignores order', 'Compares as sets'],
    validPatterns: [/\$setEquals\s*:\s*\["\$arr1"\s*,\s*"\$arr2"\]/i],
    tags: ['aggregation', 'array', '$setEquals'],
  },

  // ============================================================
  // GEOSPATIAL QUERIES EXTENDED (30 problems)
  // ============================================================
  {
    id: 'mongo-geo-500',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: 'Create 2dsphere Index',
    text: 'Create a geospatial index on the location field.',
    setup: 'Collection: places',
    setupCode: `db.places.insertOne({name: "Central Park", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Index created',
    sample: 'db.places.createIndex({location: "2dsphere"})',
    hints: ['Use 2dsphere for GeoJSON', 'Required for geospatial queries'],
    validPatterns: [/createIndex\s*\(\s*\{\s*location\s*:\s*"2dsphere"\s*\}\s*\)/i],
    tags: ['index', 'geospatial', '2dsphere'],
  },
  {
    id: 'mongo-geo-501',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: '$near Query',
    text: 'Find places within 1000 meters of a point.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});
db.places.insertOne({name: "Store", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Nearby places',
    sample:
      'db.places.find({location: {$near: {$geometry: {type: "Point", coordinates: [-73.97, 40.77]}, $maxDistance: 1000}}})',
    hints: ['$near finds closest first', '$maxDistance in meters'],
    validPatterns: [/\$near\s*:\s*\{\s*\$geometry\s*:/i],
    tags: ['find', 'geospatial', '$near'],
  },
  {
    id: 'mongo-geo-502',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: '$nearSphere Query',
    text: 'Find places near a point using spherical geometry.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});
db.places.insertOne({name: "Store", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Nearby places',
    sample:
      'db.places.find({location: {$nearSphere: {$geometry: {type: "Point", coordinates: [-73.97, 40.77]}, $maxDistance: 1000}}})',
    hints: ['$nearSphere uses spherical distance', 'More accurate for earth'],
    validPatterns: [/\$nearSphere\s*:\s*\{/i],
    tags: ['find', 'geospatial', '$nearSphere'],
  },
  {
    id: 'mongo-geo-503',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoWithin Polygon',
    text: 'Find places within a polygon area.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});
db.places.insertOne({name: "Store", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Places within polygon',
    sample: `db.places.find({location: {$geoWithin: {$geometry: {type: "Polygon", coordinates: [[[-74, 40.7], [-73.9, 40.7], [-73.9, 40.8], [-74, 40.8], [-74, 40.7]]]}}}})`,
    hints: ['$geoWithin for containment', 'Polygon must close (first=last point)'],
    validPatterns: [/\$geoWithin\s*:\s*\{\s*\$geometry\s*:/i],
    tags: ['find', 'geospatial', '$geoWithin'],
  },
  {
    id: 'mongo-geo-504',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoWithin $center',
    text: 'Find places within a circular area using legacy format.',
    setup: 'Collection: places with 2d index on legacy coords',
    setupCode: `db.places.createIndex({coords: "2d"});
db.places.insertOne({name: "Store", coords: [-73.97, 40.77]});`,
    expected: 'Places within circle',
    sample: 'db.places.find({coords: {$geoWithin: {$center: [[-73.97, 40.77], 0.1]}}})',
    hints: ['$center for legacy 2d', 'Radius in coordinate units'],
    validPatterns: [/\$geoWithin\s*:\s*\{\s*\$center\s*:/i],
    tags: ['find', 'geospatial', '$center'],
  },
  {
    id: 'mongo-geo-505',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoWithin $centerSphere',
    text: 'Find places within a spherical circle.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});
db.places.insertOne({name: "Store", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Places within spherical circle',
    sample:
      'db.places.find({location: {$geoWithin: {$centerSphere: [[-73.97, 40.77], 10/6378.1]}}})',
    hints: ['$centerSphere for spherical geometry', 'Radius in radians (divide km by 6378.1)'],
    validPatterns: [/\$centerSphere\s*:/i],
    tags: ['find', 'geospatial', '$centerSphere'],
  },
  {
    id: 'mongo-geo-506',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoWithin $box',
    text: 'Find places within a rectangular box.',
    setup: 'Collection: places with 2d index',
    setupCode: `db.places.createIndex({coords: "2d"});
db.places.insertOne({name: "Store", coords: [-73.97, 40.77]});`,
    expected: 'Places within box',
    sample: 'db.places.find({coords: {$geoWithin: {$box: [[-74, 40.7], [-73.9, 40.8]]}}})',
    hints: ['$box defines bottom-left and top-right', 'Legacy 2d format'],
    validPatterns: [/\$box\s*:\s*\[\s*\[\s*-74/i],
    tags: ['find', 'geospatial', '$box'],
  },
  {
    id: 'mongo-geo-507',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoIntersects',
    text: 'Find places whose area intersects with a polygon.',
    setup: 'Collection: regions with polygon geometries',
    setupCode: `db.regions.createIndex({area: "2dsphere"});
db.regions.insertOne({name: "Park", area: {type: "Polygon", coordinates: [[[-73.97, 40.77], [-73.96, 40.77], [-73.96, 40.78], [-73.97, 40.78], [-73.97, 40.77]]]}});`,
    expected: 'Intersecting regions',
    sample: `db.regions.find({area: {$geoIntersects: {$geometry: {type: "Polygon", coordinates: [[[-73.97, 40.77], [-73.95, 40.77], [-73.95, 40.79], [-73.97, 40.79], [-73.97, 40.77]]]}}}}})`,
    hints: ['$geoIntersects for overlap', 'Works with any geometry types'],
    validPatterns: [/\$geoIntersects\s*:\s*\{/i],
    tags: ['find', 'geospatial', '$geoIntersects'],
  },
  {
    id: 'mongo-geo-508',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoNear Aggregation',
    text: 'Use $geoNear in aggregation pipeline.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});
db.places.insertOne({name: "Store", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Places with distance',
    sample: `db.places.aggregate([{$geoNear: {near: {type: "Point", coordinates: [-73.97, 40.77]}, distanceField: "distance", maxDistance: 1000}}])`,
    hints: ['$geoNear must be first stage', 'distanceField adds distance to output'],
    validPatterns: [/\$geoNear\s*:\s*\{/i],
    tags: ['aggregation', 'geospatial', '$geoNear'],
  },
  {
    id: 'mongo-geo-509',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoNear with Spherical',
    text: 'Use $geoNear with spherical distance calculation.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});`,
    expected: 'Places with spherical distance',
    sample: `db.places.aggregate([{$geoNear: {near: {type: "Point", coordinates: [-73.97, 40.77]}, distanceField: "distance", spherical: true}}])`,
    hints: ['spherical: true for earth-like geometry', 'Distance in meters'],
    validPatterns: [/spherical\s*:\s*true/i],
    tags: ['aggregation', 'geospatial', '$geoNear'],
  },
  {
    id: 'mongo-geo-510',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: 'Store GeoJSON Point',
    text: 'Insert a document with GeoJSON Point.',
    setup: 'Collection: places',
    setupCode: 'db.places.deleteMany({});',
    expected: 'Document inserted',
    sample:
      'db.places.insertOne({name: "Store", location: {type: "Point", coordinates: [-73.97, 40.77]}})',
    hints: ['GeoJSON format: type + coordinates', 'Coordinates: [longitude, latitude]'],
    validPatterns: [/type\s*:\s*"Point"\s*,\s*coordinates\s*:/i],
    tags: ['insert', 'geospatial', 'GeoJSON'],
  },
  {
    id: 'mongo-geo-511',
    category: 'Geospatial Queries',
    difficulty: 'medium',
    title: 'Store GeoJSON Polygon',
    text: 'Insert a document with GeoJSON Polygon.',
    setup: 'Collection: regions',
    setupCode: 'db.regions.deleteMany({});',
    expected: 'Document inserted',
    sample: `db.regions.insertOne({name: "Park", area: {type: "Polygon", coordinates: [[[-73.97, 40.77], [-73.96, 40.77], [-73.96, 40.78], [-73.97, 40.78], [-73.97, 40.77]]]}})`,
    hints: ['Polygon needs outer ring array', 'First and last point must match'],
    validPatterns: [/type\s*:\s*"Polygon"\s*,\s*coordinates\s*:/i],
    tags: ['insert', 'geospatial', 'GeoJSON'],
  },
  {
    id: 'mongo-geo-512',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: 'Store GeoJSON LineString',
    text: 'Insert a document with GeoJSON LineString.',
    setup: 'Collection: routes',
    setupCode: 'db.routes.deleteMany({});',
    expected: 'Document inserted',
    sample: `db.routes.insertOne({name: "Route1", path: {type: "LineString", coordinates: [[-73.97, 40.77], [-73.96, 40.78], [-73.95, 40.79]]}})`,
    hints: ['LineString is ordered points', 'At least 2 points required'],
    validPatterns: [/type\s*:\s*"LineString"\s*,\s*coordinates\s*:/i],
    tags: ['insert', 'geospatial', 'GeoJSON'],
  },
  {
    id: 'mongo-geo-513',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoNear with Query Filter',
    text: 'Find nearby places filtered by category.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});
db.places.insertMany([
  {name: "Store1", category: "retail", location: {type: "Point", coordinates: [-73.97, 40.77]}},
  {name: "Restaurant", category: "food", location: {type: "Point", coordinates: [-73.96, 40.78]}}
]);`,
    expected: 'Nearby retail places',
    sample: `db.places.aggregate([{$geoNear: {near: {type: "Point", coordinates: [-73.97, 40.77]}, distanceField: "distance", query: {category: "retail"}}}])`,
    hints: ['query option filters results', 'Combine location and attribute query'],
    validPatterns: [/query\s*:\s*\{\s*category\s*:/i],
    tags: ['aggregation', 'geospatial', '$geoNear'],
  },
  {
    id: 'mongo-geo-514',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: '$geoNear with Distance Multiplier',
    text: 'Get distance in kilometers instead of meters.',
    setup: 'Collection: places with 2dsphere index',
    setupCode: `db.places.createIndex({location: "2dsphere"});`,
    expected: 'Distance in kilometers',
    sample: `db.places.aggregate([{$geoNear: {near: {type: "Point", coordinates: [-73.97, 40.77]}, distanceField: "distanceKm", distanceMultiplier: 0.001, spherical: true}}])`,
    hints: ['distanceMultiplier converts units', '0.001 converts meters to km'],
    validPatterns: [/distanceMultiplier\s*:\s*0\.001/i],
    tags: ['aggregation', 'geospatial', '$geoNear'],
  },
  {
    id: 'mongo-geo-515',
    category: 'Geospatial Queries',
    difficulty: 'hard',
    title: 'Geospatial Compound Index',
    text: 'Create compound index with geospatial and regular field.',
    setup: 'Collection: places',
    setupCode: `db.places.insertOne({name: "Store", category: "retail", location: {type: "Point", coordinates: [-73.97, 40.77]}});`,
    expected: 'Compound index created',
    sample: 'db.places.createIndex({location: "2dsphere", category: 1})',
    hints: ['Combine geospatial with other fields', 'Improves filtered geo queries'],
    validPatterns: [/location\s*:\s*"2dsphere"\s*,\s*category\s*:\s*1/i],
    tags: ['index', 'geospatial', 'compound'],
  },

  // ============================================================
  // TEXT SEARCH EXTENDED (30 problems)
  // ============================================================
  {
    id: 'mongo-text-550',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Create Text Index',
    text: 'Create a text index on the content field.',
    setup: 'Collection: articles',
    setupCode: `db.articles.insertOne({title: "MongoDB Guide", content: "Learn MongoDB database operations"});`,
    expected: 'Text index created',
    sample: 'db.articles.createIndex({content: "text"})',
    hints: ['Use "text" as index type', 'Enables full-text search'],
    validPatterns: [/createIndex\s*\(\s*\{\s*content\s*:\s*"text"\s*\}\s*\)/i],
    tags: ['index', 'text'],
  },
  {
    id: 'mongo-text-551',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Compound Text Index',
    text: 'Create text index on multiple fields.',
    setup: 'Collection: articles',
    setupCode: `db.articles.insertOne({title: "MongoDB", content: "Database guide", tags: "nosql"});`,
    expected: 'Compound text index created',
    sample: 'db.articles.createIndex({title: "text", content: "text", tags: "text"})',
    hints: ['All fields use "text" type', 'Searches across all fields'],
    validPatterns: [/title\s*:\s*"text"\s*,\s*content\s*:\s*"text"/i],
    tags: ['index', 'text', 'compound'],
  },
  {
    id: 'mongo-text-552',
    category: 'Text Search',
    difficulty: 'easy',
    title: 'Basic Text Search',
    text: 'Search for articles containing "mongodb".',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});
db.articles.insertMany([
  {title: "A", content: "MongoDB is a database"},
  {title: "B", content: "SQL is also a database"}
]);`,
    expected: 'Articles containing mongodb',
    sample: 'db.articles.find({$text: {$search: "mongodb"}})',
    hints: ['$text enables text search', '$search contains terms'],
    validPatterns: [/\$text\s*:\s*\{\s*\$search\s*:\s*"mongodb"\s*\}/i],
    tags: ['find', 'text', '$text'],
  },
  {
    id: 'mongo-text-553',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Text Search Multiple Words',
    text: 'Search for articles containing "mongodb" OR "database".',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Articles with either term',
    sample: 'db.articles.find({$text: {$search: "mongodb database"}})',
    hints: ['Space-separated = OR', 'Matches either term'],
    validPatterns: [/\$search\s*:\s*"mongodb\s+database"/i],
    tags: ['find', 'text', '$text'],
  },
  {
    id: 'mongo-text-554',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Text Search Phrase',
    text: 'Search for exact phrase "mongodb database".',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Articles with exact phrase',
    sample: `db.articles.find({$text: {$search: '"mongodb database"'}})`,
    hints: ['Wrap phrase in quotes', 'Matches exact phrase'],
    validPatterns: [/\$search\s*:\s*['"]\\"mongodb\s+database\\"/i],
    tags: ['find', 'text', 'phrase'],
  },
  {
    id: 'mongo-text-555',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Text Search Exclude Term',
    text: 'Search for "database" but exclude "sql".',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Articles with database but not sql',
    sample: 'db.articles.find({$text: {$search: "database -sql"}})',
    hints: ['Minus sign excludes term', 'Term must not appear'],
    validPatterns: [/\$search\s*:\s*"database\s+-sql"/i],
    tags: ['find', 'text', 'exclude'],
  },
  {
    id: 'mongo-text-556',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Text Search with Score',
    text: 'Get text search results with relevance score.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Articles with textScore',
    sample: 'db.articles.find({$text: {$search: "mongodb"}}, {score: {$meta: "textScore"}})',
    hints: ['$meta: "textScore" for relevance', 'Higher score = more relevant'],
    validPatterns: [/\$meta\s*:\s*"textScore"/i],
    tags: ['find', 'text', 'score'],
  },
  {
    id: 'mongo-text-557',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Sort by Text Score',
    text: 'Sort search results by relevance score.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Articles sorted by relevance',
    sample:
      'db.articles.find({$text: {$search: "mongodb"}}, {score: {$meta: "textScore"}}).sort({score: {$meta: "textScore"}})',
    hints: ['Sort by $meta textScore', 'Most relevant first'],
    validPatterns: [/\.sort\s*\(\s*\{\s*score\s*:\s*\{\s*\$meta\s*:\s*"textScore"\s*\}\s*\}\s*\)/i],
    tags: ['find', 'text', 'sort'],
  },
  {
    id: 'mongo-text-558',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Text Search with Language',
    text: 'Search with specific language for stemming.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Language-specific search',
    sample: 'db.articles.find({$text: {$search: "running", $language: "english"}})',
    hints: ['$language for stemming rules', 'Matches "run", "runs", etc.'],
    validPatterns: [/\$language\s*:\s*"english"/i],
    tags: ['find', 'text', 'language'],
  },
  {
    id: 'mongo-text-559',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Case Sensitive Text Search',
    text: 'Perform case-sensitive text search.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Case-sensitive results',
    sample: 'db.articles.find({$text: {$search: "MongoDB", $caseSensitive: true}})',
    hints: ['$caseSensitive: true for exact case', 'Default is case-insensitive'],
    validPatterns: [/\$caseSensitive\s*:\s*true/i],
    tags: ['find', 'text', 'case'],
  },
  {
    id: 'mongo-text-560',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Diacritic Sensitive Search',
    text: 'Perform diacritic-sensitive text search.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Diacritic-sensitive results',
    sample: 'db.articles.find({$text: {$search: "cafe", $diacriticSensitive: true}})',
    hints: ['$diacriticSensitive distinguishes accents', 'cafe != cafe'],
    validPatterns: [/\$diacriticSensitive\s*:\s*true/i],
    tags: ['find', 'text', 'diacritic'],
  },
  {
    id: 'mongo-text-561',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Text Index with Weights',
    text: 'Create text index with field weights.',
    setup: 'Collection: articles',
    setupCode: `db.articles.insertOne({title: "MongoDB", content: "Database guide"});`,
    expected: 'Weighted text index',
    sample:
      'db.articles.createIndex({title: "text", content: "text"}, {weights: {title: 10, content: 5}})',
    hints: ['weights prioritize fields', 'Higher weight = more importance'],
    validPatterns: [/weights\s*:\s*\{\s*title\s*:\s*10/i],
    tags: ['index', 'text', 'weights'],
  },
  {
    id: 'mongo-text-562',
    category: 'Text Search',
    difficulty: 'hard',
    title: 'Wildcard Text Index',
    text: 'Create text index on all string fields.',
    setup: 'Collection: documents',
    setupCode: `db.documents.insertOne({title: "Doc1", content: "Content", author: "John"});`,
    expected: 'Wildcard text index',
    sample: 'db.documents.createIndex({"$**": "text"})',
    hints: ['$** matches all fields', 'Indexes all string fields'],
    validPatterns: [/"\$\*\*"\s*:\s*"text"/i],
    tags: ['index', 'text', 'wildcard'],
  },
  {
    id: 'mongo-text-563',
    category: 'Text Search',
    difficulty: 'medium',
    title: 'Text Search in Aggregation',
    text: 'Use text search in aggregation pipeline.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});`,
    expected: 'Aggregation text search results',
    sample:
      'db.articles.aggregate([{$match: {$text: {$search: "mongodb"}}}, {$project: {title: 1, score: {$meta: "textScore"}}}])',
    hints: ['$text works in $match', 'Can include score in projection'],
    validPatterns: [/\$match\s*:\s*\{\s*\$text\s*:/i],
    tags: ['aggregation', 'text'],
  },

  // ============================================================
  // PROJECTION EXTENDED (30 problems)
  // ============================================================
  {
    id: 'mongo-proj-600',
    category: 'Projection',
    difficulty: 'easy',
    title: 'Include Fields',
    text: 'Return only name and email fields.',
    setup: 'Collection: users with multiple fields',
    setupCode: `db.users.insertOne({name: "John", email: "john@test.com", age: 30, city: "NYC"});`,
    expected: [{ name: 'John', email: 'john@test.com' }],
    sample: 'db.users.find({}, {name: 1, email: 1, _id: 0})',
    hints: ['1 to include field', '_id: 0 to exclude _id'],
    validPatterns: [/\{\s*name\s*:\s*1\s*,\s*email\s*:\s*1\s*,\s*_id\s*:\s*0\s*\}/i],
    tags: ['find', 'projection', 'include'],
  },
  {
    id: 'mongo-proj-601',
    category: 'Projection',
    difficulty: 'easy',
    title: 'Exclude Fields',
    text: 'Return all fields except password and internal.',
    setup: 'Collection: users with sensitive fields',
    setupCode: `db.users.insertOne({name: "John", email: "john@test.com", password: "secret", internal: "data"});`,
    expected: [{ name: 'John', email: 'john@test.com' }],
    sample: 'db.users.find({}, {password: 0, internal: 0})',
    hints: ['0 to exclude field', 'All other fields included'],
    validPatterns: [/\{\s*password\s*:\s*0\s*,\s*internal\s*:\s*0\s*\}/i],
    tags: ['find', 'projection', 'exclude'],
  },
  {
    id: 'mongo-proj-602',
    category: 'Projection',
    difficulty: 'medium',
    title: 'Project Nested Field',
    text: 'Return only the address.city nested field.',
    setup: 'Collection: users with nested address',
    setupCode: `db.users.insertOne({name: "John", address: {city: "NYC", zip: "10001"}});`,
    expected: [{ address: { city: 'NYC' } }],
    sample: 'db.users.find({}, {"address.city": 1, _id: 0})',
    hints: ['Use dot notation for nested', 'Quote the path'],
    validPatterns: [/"address\.city"\s*:\s*1/i],
    tags: ['find', 'projection', 'nested'],
  },
  {
    id: 'mongo-proj-603',
    category: 'Projection',
    difficulty: 'medium',
    title: 'Project Array $slice First N',
    text: 'Return only first 3 comments.',
    setup: 'Collection: posts with comments array',
    setupCode: `db.posts.insertOne({title: "Post1", comments: ["a", "b", "c", "d", "e"]});`,
    expected: [{ title: 'Post1', comments: ['a', 'b', 'c'] }],
    sample: 'db.posts.find({}, {title: 1, comments: {$slice: 3}, _id: 0})',
    hints: ['$slice limits array elements', 'Positive for first N'],
    validPatterns: [/comments\s*:\s*\{\s*\$slice\s*:\s*3\s*\}/i],
    tags: ['find', 'projection', '$slice'],
  },
  {
    id: 'mongo-proj-604',
    category: 'Projection',
    difficulty: 'medium',
    title: 'Project Array $slice Last N',
    text: 'Return only last 2 comments.',
    setup: 'Collection: posts with comments array',
    setupCode: `db.posts.insertOne({title: "Post1", comments: ["a", "b", "c", "d", "e"]});`,
    expected: [{ title: 'Post1', comments: ['d', 'e'] }],
    sample: 'db.posts.find({}, {title: 1, comments: {$slice: -2}, _id: 0})',
    hints: ['Negative $slice for last N', '-2 returns last 2'],
    validPatterns: [/comments\s*:\s*\{\s*\$slice\s*:\s*-2\s*\}/i],
    tags: ['find', 'projection', '$slice'],
  },
  {
    id: 'mongo-proj-605',
    category: 'Projection',
    difficulty: 'hard',
    title: 'Project Array $slice Skip and Limit',
    text: 'Skip first 2 and return next 3 comments.',
    setup: 'Collection: posts with comments array',
    setupCode: `db.posts.insertOne({title: "Post1", comments: ["a", "b", "c", "d", "e", "f"]});`,
    expected: [{ title: 'Post1', comments: ['c', 'd', 'e'] }],
    sample: 'db.posts.find({}, {title: 1, comments: {$slice: [2, 3]}, _id: 0})',
    hints: ['Array: [skip, limit]', 'Skip 2, take 3'],
    validPatterns: [/\$slice\s*:\s*\[\s*2\s*,\s*3\s*\]/i],
    tags: ['find', 'projection', '$slice'],
  },
  {
    id: 'mongo-proj-606',
    category: 'Projection',
    difficulty: 'hard',
    title: 'Project Array $elemMatch',
    text: 'Return only matching array element.',
    setup: 'Collection: students with grades array',
    setupCode: `db.students.insertOne({name: "John", grades: [{subject: "math", score: 90}, {subject: "english", score: 80}]});`,
    expected: [{ name: 'John', grades: [{ subject: 'math', score: 90 }] }],
    sample: 'db.students.find({}, {name: 1, grades: {$elemMatch: {subject: "math"}}, _id: 0})',
    hints: ['$elemMatch in projection', 'Returns first matching element'],
    validPatterns: [/grades\s*:\s*\{\s*\$elemMatch\s*:\s*\{\s*subject\s*:\s*"math"\s*\}\s*\}/i],
    tags: ['find', 'projection', '$elemMatch'],
  },
  {
    id: 'mongo-proj-607',
    category: 'Projection',
    difficulty: 'hard',
    title: 'Project Positional $',
    text: 'Return only matched array element using $.',
    setup: 'Collection: students with scores array',
    setupCode: `db.students.insertOne({name: "John", scores: [75, 90, 85]});`,
    expected: [{ name: 'John', scores: [90] }],
    sample: 'db.students.find({scores: {$gte: 90}}, {name: 1, "scores.$": 1, _id: 0})',
    hints: ['$ returns matched element', 'Query must match array'],
    validPatterns: [/"scores\.\$"\s*:\s*1/i],
    tags: ['find', 'projection', '$'],
  },
  {
    id: 'mongo-proj-608',
    category: 'Projection',
    difficulty: 'hard',
    title: 'Project with $meta textScore',
    text: 'Include text search relevance score.',
    setup: 'Collection: articles with text index',
    setupCode: `db.articles.createIndex({content: "text"});
db.articles.insertOne({title: "MongoDB Guide", content: "Learn MongoDB"});`,
    expected: 'Articles with score field',
    sample:
      'db.articles.find({$text: {$search: "mongodb"}}, {title: 1, score: {$meta: "textScore"}, _id: 0})',
    hints: ['$meta: "textScore" for relevance', 'Higher = more relevant'],
    validPatterns: [/\$meta\s*:\s*"textScore"/i],
    tags: ['find', 'projection', '$meta'],
  },
  {
    id: 'mongo-proj-609',
    category: 'Projection',
    difficulty: 'medium',
    title: 'Exclude Nested Field',
    text: 'Exclude address.zip from results.',
    setup: 'Collection: users with nested address',
    setupCode: `db.users.insertOne({name: "John", address: {city: "NYC", zip: "10001", state: "NY"}});`,
    expected: [{ name: 'John', address: { city: 'NYC', state: 'NY' } }],
    sample: 'db.users.find({}, {"address.zip": 0})',
    hints: ['Exclude specific nested field', 'Other fields included'],
    validPatterns: [/"address\.zip"\s*:\s*0/i],
    tags: ['find', 'projection', 'nested', 'exclude'],
  },

  // ============================================================
  // CONDITIONAL AND DATE OPERATORS (70 problems)
  // ============================================================
  {
    id: 'mongo-cond-650',
    category: 'Conditional Operators',
    difficulty: 'medium',
    title: '$cond If-Then-Else',
    text: 'Set status to "pass" if score >= 60, else "fail".',
    setup: 'Collection: tests with score',
    setupCode: `db.tests.insertOne({name: "Test1", score: 75});`,
    expected: [{ name: 'Test1', status: 'pass' }],
    sample:
      'db.tests.aggregate([{$project: {name: 1, status: {$cond: {if: {$gte: ["$score", 60]}, then: "pass", else: "fail"}}}}])',
    hints: ['$cond for conditional logic', 'if-then-else structure'],
    validPatterns: [/\$cond\s*:\s*\{\s*if\s*:\s*\{\s*\$gte\s*:/i],
    tags: ['aggregation', '$cond'],
  },
  {
    id: 'mongo-cond-651',
    category: 'Conditional Operators',
    difficulty: 'medium',
    title: '$cond Array Syntax',
    text: 'Use compact $cond array syntax.',
    setup: 'Collection: users with age',
    setupCode: `db.users.insertOne({name: "John", age: 25});`,
    expected: [{ name: 'John', category: 'adult' }],
    sample:
      'db.users.aggregate([{$project: {name: 1, category: {$cond: [{$gte: ["$age", 18]}, "adult", "minor"]}}}])',
    hints: ['Array syntax: [condition, true, false]', 'More compact'],
    validPatterns: [/\$cond\s*:\s*\[\s*\{\s*\$gte\s*:/i],
    tags: ['aggregation', '$cond'],
  },
  {
    id: 'mongo-cond-652',
    category: 'Conditional Operators',
    difficulty: 'medium',
    title: '$ifNull Default Value',
    text: 'Use "Unknown" if nickname is null or missing.',
    setup: 'Collection: users with optional nickname',
    setupCode: `db.users.insertOne({name: "John", nickname: null});`,
    expected: [{ displayName: 'Unknown' }],
    sample: 'db.users.aggregate([{$project: {displayName: {$ifNull: ["$nickname", "Unknown"]}}}])',
    hints: ['$ifNull provides fallback', 'Returns first non-null'],
    validPatterns: [/\$ifNull\s*:\s*\["\$nickname"\s*,\s*"Unknown"\]/i],
    tags: ['aggregation', '$ifNull'],
  },
  {
    id: 'mongo-cond-653',
    category: 'Conditional Operators',
    difficulty: 'hard',
    title: '$switch Multiple Cases',
    text: 'Assign grade letter based on score.',
    setup: 'Collection: students with score',
    setupCode: `db.students.insertOne({name: "John", score: 85});`,
    expected: [{ name: 'John', grade: 'B' }],
    sample: `db.students.aggregate([{$project: {name: 1, grade: {$switch: {
      branches: [
        {case: {$gte: ["$score", 90]}, then: "A"},
        {case: {$gte: ["$score", 80]}, then: "B"},
        {case: {$gte: ["$score", 70]}, then: "C"}
      ],
      default: "F"
    }}}}])`,
    hints: ['$switch for multiple conditions', 'First matching case wins'],
    validPatterns: [/\$switch\s*:\s*\{\s*branches\s*:/i],
    tags: ['aggregation', '$switch'],
  },
  {
    id: 'mongo-cond-654',
    category: 'Date Operations',
    difficulty: 'easy',
    title: 'Current Date',
    text: 'Get current date/time in aggregation.',
    setup: 'Collection: logs',
    setupCode: `db.logs.insertOne({event: "login"});`,
    expected: 'Document with current date',
    sample: 'db.logs.aggregate([{$addFields: {timestamp: "$$NOW"}}])',
    hints: ['$$NOW is current date/time', 'System variable'],
    validPatterns: [/"\$\$NOW"/i],
    tags: ['aggregation', 'date', '$$NOW'],
  },
  {
    id: 'mongo-cond-655',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Year',
    text: 'Get year from createdAt field.',
    setup: 'Collection: posts with createdAt',
    setupCode: `db.posts.insertOne({title: "Post", createdAt: new Date("2024-06-15")});`,
    expected: [{ year: 2024 }],
    sample: 'db.posts.aggregate([{$project: {year: {$year: "$createdAt"}}}])',
    hints: ['$year extracts year', 'Returns integer'],
    validPatterns: [/\$year\s*:\s*"\$createdAt"/i],
    tags: ['aggregation', 'date', '$year'],
  },
  {
    id: 'mongo-cond-656',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Month',
    text: 'Get month from createdAt field.',
    setup: 'Collection: posts with createdAt',
    setupCode: `db.posts.insertOne({title: "Post", createdAt: new Date("2024-06-15")});`,
    expected: [{ month: 6 }],
    sample: 'db.posts.aggregate([{$project: {month: {$month: "$createdAt"}}}])',
    hints: ['$month returns 1-12', 'January = 1'],
    validPatterns: [/\$month\s*:\s*"\$createdAt"/i],
    tags: ['aggregation', 'date', '$month'],
  },
  {
    id: 'mongo-cond-657',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Day of Month',
    text: 'Get day of month from date.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ day: 15 }],
    sample: 'db.events.aggregate([{$project: {day: {$dayOfMonth: "$date"}}}])',
    hints: ['$dayOfMonth returns 1-31', 'Day of the month'],
    validPatterns: [/\$dayOfMonth\s*:\s*"\$date"/i],
    tags: ['aggregation', 'date', '$dayOfMonth'],
  },
  {
    id: 'mongo-cond-658',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Day of Week',
    text: 'Get day of week from date.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ dayOfWeek: 7 }],
    sample: 'db.events.aggregate([{$project: {dayOfWeek: {$dayOfWeek: "$date"}}}])',
    hints: ['$dayOfWeek returns 1-7', 'Sunday = 1'],
    validPatterns: [/\$dayOfWeek\s*:\s*"\$date"/i],
    tags: ['aggregation', 'date', '$dayOfWeek'],
  },
  {
    id: 'mongo-cond-659',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Day of Year',
    text: 'Get day of year from date.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ dayOfYear: 167 }],
    sample: 'db.events.aggregate([{$project: {dayOfYear: {$dayOfYear: "$date"}}}])',
    hints: ['$dayOfYear returns 1-366', 'Day within year'],
    validPatterns: [/\$dayOfYear\s*:\s*"\$date"/i],
    tags: ['aggregation', 'date', '$dayOfYear'],
  },
  {
    id: 'mongo-cond-660',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Week of Year',
    text: 'Get ISO week number from date.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15")});`,
    expected: [{ week: 24 }],
    sample: 'db.events.aggregate([{$project: {week: {$isoWeek: "$date"}}}])',
    hints: ['$isoWeek returns 1-53', 'ISO week number'],
    validPatterns: [/\$isoWeek\s*:\s*"\$date"/i],
    tags: ['aggregation', 'date', '$isoWeek'],
  },
  {
    id: 'mongo-cond-661',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Hour',
    text: 'Get hour from timestamp.',
    setup: 'Collection: logs with timestamp',
    setupCode: `db.logs.insertOne({event: "login", timestamp: new Date("2024-06-15T14:30:00")});`,
    expected: [{ hour: 14 }],
    sample: 'db.logs.aggregate([{$project: {hour: {$hour: "$timestamp"}}}])',
    hints: ['$hour returns 0-23', '24-hour format'],
    validPatterns: [/\$hour\s*:\s*"\$timestamp"/i],
    tags: ['aggregation', 'date', '$hour'],
  },
  {
    id: 'mongo-cond-662',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Minute',
    text: 'Get minute from timestamp.',
    setup: 'Collection: logs with timestamp',
    setupCode: `db.logs.insertOne({event: "login", timestamp: new Date("2024-06-15T14:30:00")});`,
    expected: [{ minute: 30 }],
    sample: 'db.logs.aggregate([{$project: {minute: {$minute: "$timestamp"}}}])',
    hints: ['$minute returns 0-59', 'Minute component'],
    validPatterns: [/\$minute\s*:\s*"\$timestamp"/i],
    tags: ['aggregation', 'date', '$minute'],
  },
  {
    id: 'mongo-cond-663',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Second',
    text: 'Get second from timestamp.',
    setup: 'Collection: logs with timestamp',
    setupCode: `db.logs.insertOne({event: "login", timestamp: new Date("2024-06-15T14:30:45")});`,
    expected: [{ second: 45 }],
    sample: 'db.logs.aggregate([{$project: {second: {$second: "$timestamp"}}}])',
    hints: ['$second returns 0-59', 'Second component'],
    validPatterns: [/\$second\s*:\s*"\$timestamp"/i],
    tags: ['aggregation', 'date', '$second'],
  },
  {
    id: 'mongo-cond-664',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Extract Millisecond',
    text: 'Get millisecond from timestamp.',
    setup: 'Collection: logs with timestamp',
    setupCode: `db.logs.insertOne({event: "login", timestamp: new Date("2024-06-15T14:30:45.123")});`,
    expected: [{ ms: 123 }],
    sample: 'db.logs.aggregate([{$project: {ms: {$millisecond: "$timestamp"}}}])',
    hints: ['$millisecond returns 0-999', 'Millisecond component'],
    validPatterns: [/\$millisecond\s*:\s*"\$timestamp"/i],
    tags: ['aggregation', 'date', '$millisecond'],
  },
  {
    id: 'mongo-cond-665',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateToString Format',
    text: 'Format date as "YYYY-MM-DD HH:mm:ss".',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({name: "Event", date: new Date("2024-06-15T14:30:00")});`,
    expected: [{ formatted: '2024-06-15 14:30:00' }],
    sample:
      'db.events.aggregate([{$project: {formatted: {$dateToString: {format: "%Y-%m-%d %H:%M:%S", date: "$date"}}}}])',
    hints: ['Use format specifiers', '%Y=year, %m=month, %d=day'],
    validPatterns: [/format\s*:\s*"%Y-%m-%d\s+%H:%M:%S"/i],
    tags: ['aggregation', 'date', '$dateToString'],
  },
  {
    id: 'mongo-cond-666',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateFromString Parse',
    text: 'Parse date string to Date object.',
    setup: 'Collection: imports with dateStr',
    setupCode: `db.imports.insertOne({dateStr: "2024-06-15"});`,
    expected: 'ISODate object',
    sample:
      'db.imports.aggregate([{$project: {date: {$dateFromString: {dateString: "$dateStr", format: "%Y-%m-%d"}}}}])',
    hints: ['Specify input format', 'Creates Date object'],
    validPatterns: [/\$dateFromString\s*:\s*\{/i],
    tags: ['aggregation', 'date', '$dateFromString'],
  },
  {
    id: 'mongo-cond-667',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateDiff Calculate',
    text: 'Calculate days between start and end dates.',
    setup: 'Collection: projects with start and end',
    setupCode: `db.projects.insertOne({name: "Project1", start: new Date("2024-01-01"), end: new Date("2024-01-10")});`,
    expected: [{ duration: 9 }],
    sample:
      'db.projects.aggregate([{$project: {duration: {$dateDiff: {startDate: "$start", endDate: "$end", unit: "day"}}}}])',
    hints: ['$dateDiff calculates difference', 'unit: day, month, year, etc.'],
    validPatterns: [/\$dateDiff\s*:\s*\{.*unit\s*:\s*"day"/i],
    tags: ['aggregation', 'date', '$dateDiff'],
  },
  {
    id: 'mongo-cond-668',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateAdd Days',
    text: 'Add 30 days to start date.',
    setup: 'Collection: subscriptions with startDate',
    setupCode: `db.subscriptions.insertOne({startDate: new Date("2024-01-01")});`,
    expected: 'Date 30 days later',
    sample:
      'db.subscriptions.aggregate([{$project: {endDate: {$dateAdd: {startDate: "$startDate", unit: "day", amount: 30}}}}])',
    hints: ['$dateAdd adds to date', 'Positive amount adds'],
    validPatterns: [/\$dateAdd\s*:\s*\{.*unit\s*:\s*"day"\s*,\s*amount\s*:\s*30/i],
    tags: ['aggregation', 'date', '$dateAdd'],
  },
  {
    id: 'mongo-cond-669',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateSubtract Months',
    text: 'Subtract 1 month from date.',
    setup: 'Collection: reports with date',
    setupCode: `db.reports.insertOne({date: new Date("2024-06-15")});`,
    expected: 'Date 1 month earlier',
    sample:
      'db.reports.aggregate([{$project: {previousMonth: {$dateSubtract: {startDate: "$date", unit: "month", amount: 1}}}}])',
    hints: ['$dateSubtract subtracts from date', 'Opposite of $dateAdd'],
    validPatterns: [/\$dateSubtract\s*:\s*\{.*unit\s*:\s*"month"\s*,\s*amount\s*:\s*1/i],
    tags: ['aggregation', 'date', '$dateSubtract'],
  },
  {
    id: 'mongo-cond-670',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateTrunc to Month',
    text: 'Truncate date to start of month.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({date: new Date("2024-06-15T14:30:00")});`,
    expected: '2024-06-01',
    sample:
      'db.events.aggregate([{$project: {monthStart: {$dateTrunc: {date: "$date", unit: "month"}}}}])',
    hints: ['$dateTrunc truncates to unit', 'Sets smaller units to 0/1'],
    validPatterns: [/\$dateTrunc\s*:\s*\{.*unit\s*:\s*"month"/i],
    tags: ['aggregation', 'date', '$dateTrunc'],
  },
  {
    id: 'mongo-cond-671',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateFromParts Build Date',
    text: 'Build date from year, month, day parts.',
    setup: 'Collection: data with date parts',
    setupCode: `db.data.insertOne({year: 2024, month: 6, day: 15});`,
    expected: 'ISODate("2024-06-15")',
    sample:
      'db.data.aggregate([{$project: {date: {$dateFromParts: {year: "$year", month: "$month", day: "$day"}}}}])',
    hints: ['$dateFromParts constructs Date', 'Specify components'],
    validPatterns: [/\$dateFromParts\s*:\s*\{/i],
    tags: ['aggregation', 'date', '$dateFromParts'],
  },
  {
    id: 'mongo-cond-672',
    category: 'Date Operations',
    difficulty: 'hard',
    title: '$dateToParts Extract All',
    text: 'Extract all date parts to object.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertOne({date: new Date("2024-06-15T14:30:00")});`,
    expected: '{ year: 2024, month: 6, day: 15, hour: 14, minute: 30 }',
    sample: 'db.events.aggregate([{$project: {parts: {$dateToParts: {date: "$date"}}}}])',
    hints: ['$dateToParts extracts all components', 'Returns object'],
    validPatterns: [/\$dateToParts\s*:\s*\{\s*date\s*:\s*"\$date"\s*\}/i],
    tags: ['aggregation', 'date', '$dateToParts'],
  },
  {
    id: 'mongo-cond-673',
    category: 'Date Operations',
    difficulty: 'hard',
    title: 'Group by Date Part',
    text: 'Group events by month.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertMany([
  {name: "A", date: new Date("2024-01-15")},
  {name: "B", date: new Date("2024-01-20")},
  {name: "C", date: new Date("2024-02-10")}
]);`,
    expected: 'Events grouped by month',
    sample: 'db.events.aggregate([{$group: {_id: {$month: "$date"}, count: {$sum: 1}}}])',
    hints: ['Group by date expression', '$month extracts month'],
    validPatterns: [/\$group\s*:\s*\{\s*_id\s*:\s*\{\s*\$month\s*:\s*"\$date"\s*\}/i],
    tags: ['aggregation', 'date', '$group'],
  },
  {
    id: 'mongo-cond-674',
    category: 'Date Operations',
    difficulty: 'hard',
    title: 'Group by Year-Month',
    text: 'Group sales by year and month.',
    setup: 'Collection: sales with date',
    setupCode: `db.sales.insertMany([
  {amount: 100, date: new Date("2024-01-15")},
  {amount: 200, date: new Date("2024-01-20")}
]);`,
    expected: 'Sales grouped by year-month',
    sample:
      'db.sales.aggregate([{$group: {_id: {year: {$year: "$date"}, month: {$month: "$date"}}, total: {$sum: "$amount"}}}])',
    hints: ['Compound group key', 'Multiple date parts'],
    validPatterns: [/\$group\s*:\s*\{\s*_id\s*:\s*\{\s*year\s*:\s*\{\s*\$year/i],
    tags: ['aggregation', 'date', '$group'],
  },
  {
    id: 'mongo-cond-675',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Compare Dates',
    text: 'Find events after a specific date.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertMany([
  {name: "A", date: new Date("2024-01-15")},
  {name: "B", date: new Date("2024-06-15")}
]);`,
    expected: 'Events after 2024-03-01',
    sample: 'db.events.find({date: {$gt: new Date("2024-03-01")}})',
    hints: ['Use Date object in query', 'Comparison operators work'],
    validPatterns: [/\$gt\s*:\s*new\s+Date\s*\(/i],
    tags: ['find', 'date', 'comparison'],
  },
  {
    id: 'mongo-cond-676',
    category: 'Date Operations',
    difficulty: 'medium',
    title: 'Date Range Query',
    text: 'Find events in date range.',
    setup: 'Collection: events with date',
    setupCode: `db.events.insertMany([
  {name: "A", date: new Date("2024-01-15")},
  {name: "B", date: new Date("2024-03-15")},
  {name: "C", date: new Date("2024-06-15")}
]);`,
    expected: 'Events in Q1 2024',
    sample: 'db.events.find({date: {$gte: new Date("2024-01-01"), $lt: new Date("2024-04-01")}})',
    hints: ['Combine $gte and $lt', 'Define range bounds'],
    validPatterns: [/\$gte\s*:\s*new\s+Date.*\$lt\s*:\s*new\s+Date/i],
    tags: ['find', 'date', 'range'],
  },
  {
    id: 'mongo-cond-677',
    category: 'Conditional Operators',
    difficulty: 'hard',
    title: 'Nested $cond',
    text: 'Use nested $cond for multiple conditions.',
    setup: 'Collection: products with stock',
    setupCode: `db.products.insertOne({name: "Product", stock: 5});`,
    expected: 'Stock status: low',
    sample: `db.products.aggregate([{$project: {name: 1, stockStatus: {$cond: {
      if: {$eq: ["$stock", 0]}, then: "out",
      else: {$cond: {if: {$lt: ["$stock", 10]}, then: "low", else: "ok"}}
    }}}}])`,
    hints: ['Nest $cond in else', 'Multiple levels possible'],
    validPatterns: [/\$cond\s*:\s*\{\s*if.*else\s*:\s*\{\s*\$cond/i],
    tags: ['aggregation', '$cond', 'nested'],
  },
  {
    id: 'mongo-cond-678',
    category: 'Conditional Operators',
    difficulty: 'medium',
    title: '$ifNull Chain',
    text: 'Try multiple fields with $ifNull.',
    setup: 'Collection: users with optional fields',
    setupCode: `db.users.insertOne({name: "John"});`,
    expected: 'Display name: John',
    sample:
      'db.users.aggregate([{$project: {displayName: {$ifNull: ["$nickname", {$ifNull: ["$username", "$name"]}]}}}])',
    hints: ['Nest $ifNull for fallback chain', 'First non-null wins'],
    validPatterns: [/\$ifNull\s*:\s*\[.*\{\s*\$ifNull\s*:/i],
    tags: ['aggregation', '$ifNull', 'chain'],
  },
  {
    id: 'mongo-cond-679',
    category: 'Conditional Operators',
    difficulty: 'hard',
    title: '$let Define Variables',
    text: 'Use $let to define and use variables.',
    setup: 'Collection: orders with price and qty',
    setupCode: `db.orders.insertOne({price: 10, qty: 5, discount: 0.1});`,
    expected: 'Final price with discount',
    sample: `db.orders.aggregate([{$project: {final: {$let: {
      vars: {subtotal: {$multiply: ["$price", "$qty"]}},
      in: {$multiply: ["$$subtotal", {$subtract: [1, "$discount"]}]}
    }}}}])`,
    hints: ['vars defines local variables', 'in uses them with $$'],
    validPatterns: [/\$let\s*:\s*\{\s*vars\s*:/i],
    tags: ['aggregation', '$let'],
  },

  // ========================================
  // BEGINNER FUNDAMENTALS
  // ========================================
  {
    id: 'mongo-beginner-find-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Find All Documents',
    text: 'Find all documents in the employees collection.',
    setup: 'Collection: employees with documents containing name, department, and salary fields',
    setupCode: `db.employees.insertMany([
  {name: "Alice", department: "Engineering", salary: 75000},
  {name: "Bob", department: "Sales", salary: 55000}
]);`,
    expected: 'All employee documents',
    sample: 'db.employees.find()',
    hints: [
      'Use find() with no arguments to get all documents',
      'find() returns a cursor that iterates over all matching documents',
    ],
    validPatterns: [/db\.employees\.find\s*\(\s*\)/i],
    tags: ['find', 'beginner', 'all-documents'],
  },
  {
    id: 'mongo-beginner-find-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Find with Specific Fields',
    text: 'Find all employees but only return the name and department fields (exclude _id).',
    setup: 'Collection: employees with documents containing name, department, and salary fields',
    setupCode: `db.employees.insertMany([
  {name: "Alice", department: "Engineering", salary: 75000},
  {name: "Bob", department: "Sales", salary: 55000}
]);`,
    expected: 'Documents with only name and department fields',
    sample: 'db.employees.find({}, {name: 1, department: 1, _id: 0})',
    hints: [
      'Second parameter to find() is the projection',
      'Use 1 to include fields, 0 to exclude',
      '_id is included by default unless explicitly excluded',
    ],
    validPatterns: [/db\.employees\.find\s*\(\s*\{\s*\}\s*,\s*\{.*name\s*:\s*1/i],
    tags: ['find', 'beginner', 'projection'],
  },
  {
    id: 'mongo-beginner-find-003',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Find Single Document',
    text: 'Find a single document for the employee named "Alice".',
    setup: 'Collection: employees with multiple documents',
    setupCode: `db.employees.insertMany([
  {name: "Alice", department: "Engineering"},
  {name: "Bob", department: "Sales"}
]);`,
    expected: 'Single document for Alice',
    sample: 'db.employees.findOne({name: "Alice"})',
    hints: [
      'Use findOne() instead of find() for single document',
      'Returns the first matching document, not a cursor',
    ],
    validPatterns: [/db\.employees\.findOne\s*\(\s*\{\s*name\s*:\s*"Alice"\s*\}\s*\)/i],
    tags: ['findOne', 'beginner'],
  },
  {
    id: 'mongo-beginner-find-004',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Find with Sort',
    text: 'Find all employees sorted by salary in descending order.',
    setup: 'Collection: employees with salary field',
    setupCode: `db.employees.insertMany([
  {name: "Alice", salary: 75000},
  {name: "Bob", salary: 55000},
  {name: "Carol", salary: 85000}
]);`,
    expected: 'Employees sorted from highest to lowest salary',
    sample: 'db.employees.find().sort({salary: -1})',
    hints: ['Use sort() to order results', '1 for ascending order, -1 for descending order'],
    validPatterns: [
      /db\.employees\.find\s*\(\s*\)\s*\.sort\s*\(\s*\{\s*salary\s*:\s*-1\s*\}\s*\)/i,
    ],
    tags: ['find', 'beginner', 'sort'],
  },
  {
    id: 'mongo-beginner-query-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Query with Equality',
    text: 'Find all employees in the Engineering department.',
    setup: 'Collection: employees with department field',
    setupCode: `db.employees.insertMany([
  {name: "Alice", department: "Engineering"},
  {name: "Bob", department: "Sales"}
]);`,
    expected: 'Alice',
    sample: 'db.employees.find({department: "Engineering"})',
    hints: ['Pass query object to find()', 'Simple key-value pairs match exact values'],
    validPatterns: [/db\.employees\.find\s*\(\s*\{\s*department\s*:\s*"Engineering"\s*\}\s*\)/i],
    tags: ['find', 'beginner', 'equality'],
  },
  {
    id: 'mongo-beginner-query-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Query with Comparison',
    text: 'Find all employees with salary greater than 60000.',
    setup: 'Collection: employees with salary field',
    setupCode: `db.employees.insertMany([
  {name: "Alice", salary: 75000},
  {name: "Bob", salary: 55000}
]);`,
    expected: 'Alice',
    sample: 'db.employees.find({salary: {$gt: 60000}})',
    hints: [
      'Use $gt operator for greater than',
      'Comparison operators: $gt, $gte, $lt, $lte, $ne, $eq',
    ],
    validPatterns: [
      /db\.employees\.find\s*\(\s*\{\s*salary\s*:\s*\{\s*\$gt\s*:\s*60000\s*\}\s*\}\s*\)/i,
    ],
    tags: ['find', 'beginner', 'comparison', '$gt'],
  },
  {
    id: 'mongo-beginner-query-003',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Query with Multiple Conditions',
    text: 'Find employees in Engineering with salary greater than 70000.',
    setup: 'Collection: employees with department and salary fields',
    setupCode: `db.employees.insertMany([
  {name: "Alice", department: "Engineering", salary: 75000},
  {name: "Bob", department: "Engineering", salary: 65000},
  {name: "Carol", department: "Sales", salary: 80000}
]);`,
    expected: 'Alice',
    sample: 'db.employees.find({department: "Engineering", salary: {$gt: 70000}})',
    hints: [
      'Multiple conditions in query object act as AND',
      'All conditions must be true for a document to match',
    ],
    validPatterns: [
      /db\.employees\.find\s*\(\s*\{\s*department\s*:\s*"Engineering"\s*,\s*salary\s*:\s*\{\s*\$gt\s*:\s*70000\s*\}/i,
    ],
    tags: ['find', 'beginner', 'multiple-conditions'],
  },
  {
    id: 'mongo-beginner-insert-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Insert Single Document',
    text: 'Insert a new employee document with name "David", department "Marketing", and salary 60000.',
    setup: 'Collection: employees (empty or existing)',
    setupCode: 'db.employees.deleteMany({});',
    expected: 'Document inserted with generated _id',
    sample: 'db.employees.insertOne({name: "David", department: "Marketing", salary: 60000})',
    hints: [
      'Use insertOne() to insert a single document',
      'MongoDB automatically generates an _id if not provided',
    ],
    validPatterns: [
      /db\.employees\.insertOne\s*\(\s*\{\s*name\s*:\s*"David"\s*,\s*department\s*:\s*"Marketing"\s*,\s*salary\s*:\s*60000\s*\}\s*\)/i,
    ],
    tags: ['insert', 'beginner', 'insertOne'],
  },
  {
    id: 'mongo-beginner-insert-002',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Insert Multiple Documents',
    text: 'Insert two employee documents in a single operation.',
    setup: 'Collection: employees (empty or existing)',
    setupCode: 'db.employees.deleteMany({});',
    expected: '2 documents inserted',
    sample:
      'db.employees.insertMany([{name: "Eve", department: "Engineering"}, {name: "Frank", department: "Sales"}])',
    hints: [
      'Use insertMany() with an array of documents',
      'More efficient than multiple insertOne() calls',
    ],
    validPatterns: [/db\.employees\.insertMany\s*\(\s*\[/i],
    tags: ['insert', 'beginner', 'insertMany'],
  },
  {
    id: 'mongo-beginner-update-001',
    category: 'Beginner Fundamentals',
    difficulty: 'easy',
    title: 'Update Single Document',
    text: 'Update the salary to 80000 for the employee named "Alice".',
    setup: 'Collection: employees with existing documents',
    setupCode: `db.employees.insertOne({name: "Alice", salary: 75000});`,
    expected: '1 document updated',
    sample: 'db.employees.updateOne({name: "Alice"}, {$set: {salary: 80000}})',
    hints: [
      'Use updateOne() with filter and update documents',
      '$set operator sets specific field values',
      'Always use $set or other update operators, not raw document replacement',
    ],
    validPatterns: [
      /db\.employees\.updateOne\s*\(\s*\{\s*name\s*:\s*"Alice"\s*\}\s*,\s*\{\s*\$set\s*:\s*\{\s*salary\s*:\s*80000\s*\}\s*\}\s*\)/i,
    ],
    tags: ['update', 'beginner', 'updateOne', '$set'],
  },
];
