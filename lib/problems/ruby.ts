/**
 * Ruby coding drill problems
 * Covers Array, String, Hash, and Enumerable methods
 */

import type { Problem } from '../types';

export const rubyProblems: Problem[] = [
  // ============================================================
  // Array Methods
  // ============================================================

  // map / collect
  {
    id: 'ruby-array-map-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Double Array Elements with map',
    text: 'Use the `map` method to double each number in the array.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [2, 4, 6, 8, 10],
    sample: 'numbers.map { |n| n * 2 }',
    hints: ['map transforms each element', 'Use a block with |n|'],
    validPatterns: [
      /numbers\.map\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*2\s*\}/,
      /numbers\.map\s*\(\s*&:.*\)/,
      /numbers\.collect\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*2\s*\}/,
    ],
    tags: ['map', 'collect', 'transform'],
  },
  {
    id: 'ruby-array-collect-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Convert to Strings with collect',
    text: 'Use the `collect` method to convert each number to a string.',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: ['1', '2', '3'],
    sample: 'numbers.collect(&:to_s)',
    hints: ['collect is an alias for map', 'Use &:to_s for method shorthand'],
    validPatterns: [
      /numbers\.collect\s*\(\s*&:to_s\s*\)/,
      /numbers\.collect\s*\{\s*\|(\w+)\|\s*\1\.to_s\s*\}/,
      /numbers\.map\s*\(\s*&:to_s\s*\)/,
      /numbers\.map\s*\{\s*\|(\w+)\|\s*\1\.to_s\s*\}/,
    ],
    tags: ['collect', 'map', 'to_s'],
  },

  // select / reject / filter
  {
    id: 'ruby-array-select-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Select Even Numbers',
    text: 'Use the `select` method to filter only even numbers from the array.',
    setup: 'numbers = [1, 2, 3, 4, 5, 6]',
    setupCode: 'numbers = [1, 2, 3, 4, 5, 6]',
    expected: [2, 4, 6],
    sample: 'numbers.select { |n| n.even? }',
    hints: ['select returns elements where block is true', 'Use .even? method'],
    validPatterns: [
      /numbers\.select\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}/,
      /numbers\.select\s*\{\s*\|(\w+)\|\s*\1\s*%\s*2\s*==\s*0\s*\}/,
      /numbers\.select\s*\(\s*&:even\?\s*\)/,
      /numbers\.filter\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}/,
    ],
    tags: ['select', 'filter', 'even'],
  },
  {
    id: 'ruby-array-reject-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Reject Negative Numbers',
    text: 'Use the `reject` method to remove all negative numbers from the array.',
    setup: 'numbers = [-3, -1, 0, 2, 5]',
    setupCode: 'numbers = [-3, -1, 0, 2, 5]',
    expected: [0, 2, 5],
    sample: 'numbers.reject { |n| n < 0 }',
    hints: ['reject removes elements where block is true', 'Check if n < 0'],
    validPatterns: [
      /numbers\.reject\s*\{\s*\|(\w+)\|\s*\1\s*<\s*0\s*\}/,
      /numbers\.reject\s*\{\s*\|(\w+)\|\s*\1\.negative\?\s*\}/,
      /numbers\.reject\s*\(\s*&:negative\?\s*\)/,
    ],
    tags: ['reject', 'filter', 'negative'],
  },
  {
    id: 'ruby-array-filter-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Filter Long Words',
    text: 'Use the `filter` method to keep only words longer than 4 characters.',
    setup: 'words = ["hi", "hello", "world", "ok", "ruby"]',
    setupCode: 'words = ["hi", "hello", "world", "ok", "ruby"]',
    expected: ['hello', 'world'],
    sample: 'words.filter { |w| w.length > 4 }',
    hints: ['filter is an alias for select', 'Check w.length > 4'],
    validPatterns: [
      /words\.filter\s*\{\s*\|(\w+)\|\s*\1\.length\s*>\s*4\s*\}/,
      /words\.filter\s*\{\s*\|(\w+)\|\s*\1\.size\s*>\s*4\s*\}/,
      /words\.select\s*\{\s*\|(\w+)\|\s*\1\.length\s*>\s*4\s*\}/,
    ],
    tags: ['filter', 'select', 'length'],
  },

  // reduce / inject
  {
    id: 'ruby-array-reduce-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Sum Array with reduce',
    text: 'Use the `reduce` method to calculate the sum of all numbers.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: 15,
    sample: 'numbers.reduce(0) { |sum, n| sum + n }',
    hints: [
      'reduce accumulates a value',
      'Start with 0 as initial value',
      'Can also use numbers.reduce(:+) shorthand',
    ],
    validPatterns: [
      /numbers\.reduce\s*\(\s*0\s*\)\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\+\s*\2\s*\}/,
      /numbers\.reduce\s*\(\s*:\+\s*\)/,
      /numbers\.reduce\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\+\s*\2\s*\}/,
      /numbers\.inject\s*\(\s*0\s*\)\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\+\s*\2\s*\}/,
      /numbers\.inject\s*\(\s*:\+\s*\)/,
      /numbers\.sum\b/,
    ],
    tags: ['reduce', 'inject', 'sum'],
  },
  {
    id: 'ruby-array-inject-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Product with inject',
    text: 'Use the `inject` method to calculate the product of all numbers.',
    setup: 'numbers = [1, 2, 3, 4]',
    setupCode: 'numbers = [1, 2, 3, 4]',
    expected: 24,
    sample: 'numbers.inject(1) { |product, n| product * n }',
    hints: [
      'inject is an alias for reduce',
      'Start with 1 for multiplication',
      'Can also use numbers.inject(:*) shorthand',
    ],
    validPatterns: [
      /numbers\.inject\s*\(\s*1\s*\)\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\*\s*\2\s*\}/,
      /numbers\.inject\s*\(\s*:\*\s*\)/,
      /numbers\.inject\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\*\s*\2\s*\}/,
      /numbers\.reduce\s*\(\s*1\s*\)\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\*\s*\2\s*\}/,
      /numbers\.reduce\s*\(\s*:\*\s*\)/,
    ],
    tags: ['inject', 'reduce', 'product'],
  },

  // find / detect
  {
    id: 'ruby-array-find-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Find First Even Number',
    text: 'Use the `find` method to get the first even number in the array.',
    setup: 'numbers = [1, 3, 4, 6, 7]',
    setupCode: 'numbers = [1, 3, 4, 6, 7]',
    expected: 4,
    sample: 'numbers.find { |n| n.even? }',
    hints: ['find returns the first matching element', 'Use .even? method'],
    validPatterns: [
      /numbers\.find\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}/,
      /numbers\.find\s*\{\s*\|(\w+)\|\s*\1\s*%\s*2\s*==\s*0\s*\}/,
      /numbers\.find\s*\(\s*&:even\?\s*\)/,
      /numbers\.detect\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}/,
    ],
    tags: ['find', 'detect', 'first'],
  },
  {
    id: 'ruby-array-detect-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Detect String Starting with A',
    text: 'Use the `detect` method to find the first word starting with "a".',
    setup: 'words = ["hello", "apple", "world", "ant"]',
    setupCode: 'words = ["hello", "apple", "world", "ant"]',
    expected: 'apple',
    sample: 'words.detect { |w| w.start_with?("a") }',
    hints: ['detect is an alias for find', 'Use start_with? method'],
    validPatterns: [
      /words\.detect\s*\{\s*\|(\w+)\|\s*\1\.start_with\?\s*\(\s*["']a["']\s*\)\s*\}/,
      /words\.detect\s*\{\s*\|(\w+)\|\s*\1\[0\]\s*==\s*["']a["']\s*\}/,
      /words\.find\s*\{\s*\|(\w+)\|\s*\1\.start_with\?\s*\(\s*["']a["']\s*\)\s*\}/,
    ],
    tags: ['detect', 'find', 'start_with'],
  },

  // sort / sort_by
  {
    id: 'ruby-array-sort-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Sort Numbers Ascending',
    text: 'Use the `sort` method to sort the numbers in ascending order.',
    setup: 'numbers = [5, 2, 8, 1, 9]',
    setupCode: 'numbers = [5, 2, 8, 1, 9]',
    expected: [1, 2, 5, 8, 9],
    sample: 'numbers.sort',
    hints: ['sort returns a sorted array', 'Default is ascending order'],
    validPatterns: [/numbers\.sort\b/],
    tags: ['sort', 'ascending'],
  },
  {
    id: 'ruby-array-sort-2',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Sort Numbers Descending',
    text: 'Use the `sort` method with a block to sort numbers in descending order.',
    setup: 'numbers = [5, 2, 8, 1, 9]',
    setupCode: 'numbers = [5, 2, 8, 1, 9]',
    expected: [9, 8, 5, 2, 1],
    sample: 'numbers.sort { |a, b| b <=> a }',
    hints: ['Use spaceship operator <=>', 'Reverse the comparison for descending'],
    validPatterns: [
      /numbers\.sort\s*\{\s*\|(\w+),\s*(\w+)\|\s*\2\s*<=>\s*\1\s*\}/,
      /numbers\.sort\.reverse/,
      /numbers\.sort\s*\{\s*\|(\w+),\s*(\w+)\|\s*-?\s*\(\s*\1\s*<=>\s*\2\s*\)\s*\}/,
    ],
    tags: ['sort', 'descending', 'spaceship'],
  },
  {
    id: 'ruby-array-sort-by-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Sort by String Length',
    text: 'Use the `sort_by` method to sort words by their length.',
    setup: 'words = ["ruby", "is", "awesome"]',
    setupCode: 'words = ["ruby", "is", "awesome"]',
    expected: ['is', 'ruby', 'awesome'],
    sample: 'words.sort_by { |w| w.length }',
    hints: ['sort_by uses block value for comparison', 'Use length or size'],
    validPatterns: [
      /words\.sort_by\s*\{\s*\|(\w+)\|\s*\1\.length\s*\}/,
      /words\.sort_by\s*\{\s*\|(\w+)\|\s*\1\.size\s*\}/,
      /words\.sort_by\s*\(\s*&:length\s*\)/,
      /words\.sort_by\s*\(\s*&:size\s*\)/,
    ],
    tags: ['sort_by', 'length'],
  },

  // each / each_with_index
  {
    id: 'ruby-array-each-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Iterate with each',
    text: 'Use `each` to iterate and return the original array (side effects only).',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: [1, 2, 3],
    sample: 'numbers.each { |n| puts n }',
    hints: ['each returns the original array', 'Block is for side effects'],
    validPatterns: [/numbers\.each\s*\{\s*\|(\w+)\|/, /numbers\.each\s+do\s*\|(\w+)\|/],
    tags: ['each', 'iteration'],
  },
  {
    id: 'ruby-array-each-with-index-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Iterate with Index',
    text: 'Use `each_with_index` to create an array of [element, index] pairs.',
    setup: 'letters = ["a", "b", "c"]',
    setupCode: 'letters = ["a", "b", "c"]',
    expected: [
      ['a', 0],
      ['b', 1],
      ['c', 2],
    ],
    sample: 'letters.each_with_index.map { |letter, index| [letter, index] }',
    hints: ['each_with_index gives element and index', 'Combine with map'],
    validPatterns: [
      /letters\.each_with_index\.map\s*\{\s*\|(\w+),\s*(\w+)\|\s*\[\s*\1,\s*\2\s*\]\s*\}/,
      /letters\.map\.with_index\s*\{\s*\|(\w+),\s*(\w+)\|\s*\[\s*\1,\s*\2\s*\]\s*\}/,
    ],
    tags: ['each_with_index', 'map', 'index'],
  },

  // first / last / take / drop
  {
    id: 'ruby-array-first-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Get First Element',
    text: 'Use the `first` method to get the first element of the array.',
    setup: 'numbers = [10, 20, 30, 40]',
    setupCode: 'numbers = [10, 20, 30, 40]',
    expected: 10,
    sample: 'numbers.first',
    hints: ['first returns the first element'],
    validPatterns: [/numbers\.first\b/, /numbers\[0\]/],
    tags: ['first', 'access'],
  },
  {
    id: 'ruby-array-last-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Get Last Element',
    text: 'Use the `last` method to get the last element of the array.',
    setup: 'numbers = [10, 20, 30, 40]',
    setupCode: 'numbers = [10, 20, 30, 40]',
    expected: 40,
    sample: 'numbers.last',
    hints: ['last returns the last element'],
    validPatterns: [/numbers\.last\b/, /numbers\[-1\]/],
    tags: ['last', 'access'],
  },
  {
    id: 'ruby-array-take-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Take First N Elements',
    text: 'Use the `take` method to get the first 3 elements.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [1, 2, 3],
    sample: 'numbers.take(3)',
    hints: ['take(n) returns first n elements'],
    validPatterns: [
      /numbers\.take\s*\(\s*3\s*\)/,
      /numbers\.first\s*\(\s*3\s*\)/,
      /numbers\[0,\s*3\]/,
      /numbers\[0\.\.2\]/,
    ],
    tags: ['take', 'slice'],
  },
  {
    id: 'ruby-array-drop-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Drop First N Elements',
    text: 'Use the `drop` method to skip the first 2 elements.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [3, 4, 5],
    sample: 'numbers.drop(2)',
    hints: ['drop(n) skips first n elements'],
    validPatterns: [/numbers\.drop\s*\(\s*2\s*\)/, /numbers\[2\.\.-1\]/, /numbers\[2\.\.4\]/],
    tags: ['drop', 'slice'],
  },

  // flatten / compact
  {
    id: 'ruby-array-flatten-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Flatten Nested Array',
    text: 'Use the `flatten` method to convert a nested array to a flat array.',
    setup: 'nested = [[1, 2], [3, [4, 5]]]',
    setupCode: 'nested = [[1, 2], [3, [4, 5]]]',
    expected: [1, 2, 3, 4, 5],
    sample: 'nested.flatten',
    hints: ['flatten removes all nesting levels'],
    validPatterns: [/nested\.flatten\b/],
    tags: ['flatten', 'nested'],
  },
  {
    id: 'ruby-array-compact-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Remove Nil Values',
    text: 'Use the `compact` method to remove all nil values from the array.',
    setup: 'values = [1, nil, 2, nil, 3]',
    setupCode: 'values = [1, nil, 2, nil, 3]',
    expected: [1, 2, 3],
    sample: 'values.compact',
    hints: ['compact removes nil values'],
    validPatterns: [/values\.compact\b/],
    tags: ['compact', 'nil'],
  },

  // uniq
  {
    id: 'ruby-array-uniq-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Remove Duplicates',
    text: 'Use the `uniq` method to remove duplicate values.',
    setup: 'numbers = [1, 2, 2, 3, 3, 3, 4]',
    setupCode: 'numbers = [1, 2, 2, 3, 3, 3, 4]',
    expected: [1, 2, 3, 4],
    sample: 'numbers.uniq',
    hints: ['uniq removes duplicates preserving order'],
    validPatterns: [/numbers\.uniq\b/],
    tags: ['uniq', 'duplicates'],
  },

  // join
  {
    id: 'ruby-array-join-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Join Array Elements',
    text: 'Use the `join` method to combine array elements with a comma separator.',
    setup: 'words = ["hello", "world", "ruby"]',
    setupCode: 'words = ["hello", "world", "ruby"]',
    expected: 'hello, world, ruby',
    sample: 'words.join(", ")',
    hints: ['join combines elements with separator'],
    validPatterns: [/words\.join\s*\(\s*["'],\s*["']\s*\)/],
    tags: ['join', 'string'],
  },

  // push / pop / shift / unshift
  {
    id: 'ruby-array-push-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Add to End with push',
    text: 'Use the `push` method to add 4 to the end of the array.',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: [1, 2, 3, 4],
    sample: 'numbers.push(4)',
    hints: ['push adds element to the end', 'Can also use <<'],
    validPatterns: [/numbers\.push\s*\(\s*4\s*\)/, /numbers\s*<<\s*4/],
    tags: ['push', 'append'],
  },
  {
    id: 'ruby-array-pop-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Remove from End with pop',
    text: 'Use the `pop` method to remove and return the last element.',
    setup: 'numbers = [1, 2, 3, 4]',
    setupCode: 'numbers = [1, 2, 3, 4]',
    expected: 4,
    sample: 'numbers.pop',
    hints: ['pop removes and returns the last element'],
    validPatterns: [/numbers\.pop\b/],
    tags: ['pop', 'remove'],
  },
  {
    id: 'ruby-array-shift-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Remove from Start with shift',
    text: 'Use the `shift` method to remove and return the first element.',
    setup: 'numbers = [1, 2, 3, 4]',
    setupCode: 'numbers = [1, 2, 3, 4]',
    expected: 1,
    sample: 'numbers.shift',
    hints: ['shift removes and returns the first element'],
    validPatterns: [/numbers\.shift\b/],
    tags: ['shift', 'remove'],
  },
  {
    id: 'ruby-array-unshift-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Add to Start with unshift',
    text: 'Use the `unshift` method to add 0 to the beginning of the array.',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: [0, 1, 2, 3],
    sample: 'numbers.unshift(0)',
    hints: ['unshift adds element to the beginning', 'Can also use prepend'],
    validPatterns: [/numbers\.unshift\s*\(\s*0\s*\)/, /numbers\.prepend\s*\(\s*0\s*\)/],
    tags: ['unshift', 'prepend'],
  },

  // include?
  {
    id: 'ruby-array-include-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Check Element Inclusion',
    text: 'Use the `include?` method to check if 3 is in the array.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: true,
    sample: 'numbers.include?(3)',
    hints: ['include? returns true or false'],
    validPatterns: [/numbers\.include\?\s*\(\s*3\s*\)/],
    tags: ['include?', 'membership'],
  },

  // ============================================================
  // String Methods
  // ============================================================

  // split / join
  {
    id: 'ruby-string-split-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Split String by Space',
    text: 'Use the `split` method to break the string into words.',
    setup: 'sentence = "hello world ruby"',
    setupCode: 'sentence = "hello world ruby"',
    expected: ['hello', 'world', 'ruby'],
    sample: 'sentence.split(" ")',
    hints: ['split breaks string at delimiter', 'split with no argument splits on whitespace'],
    validPatterns: [
      /sentence\.split\s*\(\s*["'] ["']\s*\)/,
      /sentence\.split\s*\(\s*\/\s+\/\s*\)/,
      /sentence\.split\b/,
    ],
    tags: ['split', 'words'],
  },
  {
    id: 'ruby-string-join-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Join Words with Dash',
    text: 'Join the array of words with a dash separator.',
    setup: 'words = ["hello", "world"]',
    setupCode: 'words = ["hello", "world"]',
    expected: 'hello-world',
    sample: 'words.join("-")',
    hints: ['join combines with separator'],
    validPatterns: [/words\.join\s*\(\s*["']-["']\s*\)/],
    tags: ['join', 'concatenate'],
  },

  // upcase / downcase / capitalize
  {
    id: 'ruby-string-upcase-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Convert to Uppercase',
    text: 'Use the `upcase` method to convert the string to uppercase.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 'HELLO',
    sample: 'text.upcase',
    hints: ['upcase converts all characters to uppercase'],
    validPatterns: [/text\.upcase\b/],
    tags: ['upcase', 'uppercase'],
  },
  {
    id: 'ruby-string-downcase-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Convert to Lowercase',
    text: 'Use the `downcase` method to convert the string to lowercase.',
    setup: 'text = "HELLO"',
    setupCode: 'text = "HELLO"',
    expected: 'hello',
    sample: 'text.downcase',
    hints: ['downcase converts all characters to lowercase'],
    validPatterns: [/text\.downcase\b/],
    tags: ['downcase', 'lowercase'],
  },
  {
    id: 'ruby-string-capitalize-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Capitalize String',
    text: 'Use the `capitalize` method to capitalize the first letter.',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: 'Hello world',
    sample: 'text.capitalize',
    hints: ['capitalize makes first letter uppercase, rest lowercase'],
    validPatterns: [/text\.capitalize\b/],
    tags: ['capitalize', 'title'],
  },

  // strip / chomp
  {
    id: 'ruby-string-strip-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Remove Whitespace',
    text: 'Use the `strip` method to remove leading and trailing whitespace.',
    setup: 'text = "  hello world  "',
    setupCode: 'text = "  hello world  "',
    expected: 'hello world',
    sample: 'text.strip',
    hints: ['strip removes whitespace from both ends'],
    validPatterns: [/text\.strip\b/],
    tags: ['strip', 'trim'],
  },
  {
    id: 'ruby-string-chomp-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Remove Trailing Newline',
    text: 'Use the `chomp` method to remove the trailing newline.',
    setup: 'text = "hello\\n"',
    setupCode: 'text = "hello\\n"',
    expected: 'hello',
    sample: 'text.chomp',
    hints: ['chomp removes trailing newline characters'],
    validPatterns: [/text\.chomp\b/],
    tags: ['chomp', 'newline'],
  },

  // gsub / sub
  {
    id: 'ruby-string-gsub-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Replace All Occurrences',
    text: 'Use `gsub` to replace all spaces with underscores.',
    setup: 'text = "hello world ruby"',
    setupCode: 'text = "hello world ruby"',
    expected: 'hello_world_ruby',
    sample: 'text.gsub(" ", "_")',
    hints: ['gsub replaces all occurrences', 'Takes pattern and replacement'],
    validPatterns: [
      /text\.gsub\s*\(\s*["'] ["'],\s*["']_["']\s*\)/,
      /text\.gsub\s*\(\s*\/\s+\/,\s*["']_["']\s*\)/,
      /text\.tr\s*\(\s*["'] ["'],\s*["']_["']\s*\)/,
    ],
    tags: ['gsub', 'replace'],
  },
  {
    id: 'ruby-string-sub-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Replace First Occurrence',
    text: 'Use `sub` to replace only the first space with a dash.',
    setup: 'text = "hello world ruby"',
    setupCode: 'text = "hello world ruby"',
    expected: 'hello-world ruby',
    sample: 'text.sub(" ", "-")',
    hints: ['sub replaces only the first occurrence'],
    validPatterns: [
      /text\.sub\s*\(\s*["'] ["'],\s*["']-["']\s*\)/,
      /text\.sub\s*\(\s*\/\s+\/,\s*["']-["']\s*\)/,
    ],
    tags: ['sub', 'replace'],
  },

  // include? / start_with? / end_with?
  {
    id: 'ruby-string-include-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Check Substring Inclusion',
    text: 'Use `include?` to check if the string contains "world".',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: true,
    sample: 'text.include?("world")',
    hints: ['include? checks for substring presence'],
    validPatterns: [/text\.include\?\s*\(\s*["']world["']\s*\)/],
    tags: ['include?', 'contains'],
  },
  {
    id: 'ruby-string-start-with-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Check String Prefix',
    text: 'Use `start_with?` to check if the string starts with "hello".',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: true,
    sample: 'text.start_with?("hello")',
    hints: ['start_with? checks the beginning'],
    validPatterns: [/text\.start_with\?\s*\(\s*["']hello["']\s*\)/],
    tags: ['start_with?', 'prefix'],
  },
  {
    id: 'ruby-string-end-with-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Check String Suffix',
    text: 'Use `end_with?` to check if the string ends with "world".',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: true,
    sample: 'text.end_with?("world")',
    hints: ['end_with? checks the ending'],
    validPatterns: [/text\.end_with\?\s*\(\s*["']world["']\s*\)/],
    tags: ['end_with?', 'suffix'],
  },

  // reverse
  {
    id: 'ruby-string-reverse-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Reverse String',
    text: 'Use the `reverse` method to reverse the string.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 'olleh',
    sample: 'text.reverse',
    hints: ['reverse returns the string backwards'],
    validPatterns: [/text\.reverse\b/],
    tags: ['reverse', 'backwards'],
  },

  // chars / bytes
  {
    id: 'ruby-string-chars-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Convert to Character Array',
    text: 'Use the `chars` method to convert the string to an array of characters.',
    setup: 'text = "ruby"',
    setupCode: 'text = "ruby"',
    expected: ['r', 'u', 'b', 'y'],
    sample: 'text.chars',
    hints: ['chars returns array of individual characters', 'split("") also works'],
    validPatterns: [/text\.chars\b/, /text\.split\s*\(\s*["']["']\s*\)/, /text\.each_char\.to_a\b/],
    tags: ['chars', 'characters'],
  },
  {
    id: 'ruby-string-bytes-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Get Byte Values',
    text: 'Use the `bytes` method to get the byte values of the string.',
    setup: 'text = "abc"',
    setupCode: 'text = "abc"',
    expected: [97, 98, 99],
    sample: 'text.bytes',
    hints: ['bytes returns ASCII values'],
    validPatterns: [/text\.bytes\b/],
    tags: ['bytes', 'ascii'],
  },

  // ============================================================
  // Hash Methods
  // ============================================================

  // keys / values
  {
    id: 'ruby-hash-keys-1',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Get Hash Keys',
    text: 'Use the `keys` method to get all keys from the hash.',
    setup: 'person = { name: "Alice", age: 30, city: "NYC" }',
    setupCode: 'person = { name: "Alice", age: 30, city: "NYC" }',
    expected: [':name', ':age', ':city'],
    sample: 'person.keys',
    hints: ['keys returns an array of all keys (as symbols)'],
    validPatterns: [/person\.keys\b/],
    tags: ['keys', 'hash', 'symbols'],
  },
  {
    id: 'ruby-hash-values-1',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Get Hash Values',
    text: 'Use the `values` method to get all values from the hash.',
    setup: 'person = { name: "Alice", age: 30 }',
    setupCode: 'person = { name: "Alice", age: 30 }',
    expected: ['Alice', 30],
    sample: 'person.values',
    hints: ['values returns an array of all values'],
    validPatterns: [/person\.values\b/],
    tags: ['values', 'hash'],
  },

  // each / each_pair
  {
    id: 'ruby-hash-each-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Iterate Hash with each',
    text: 'Use `each` to iterate and return the original hash.',
    setup: 'scores = { alice: 90, bob: 85 }',
    setupCode: 'scores = { alice: 90, bob: 85 }',
    expected: { alice: 90, bob: 85 },
    sample: 'scores.each { |k, v| puts "#{k}: #{v}" }',
    hints: ['each yields key-value pairs', 'Returns the original hash'],
    validPatterns: [
      /scores\.each\s*\{\s*\|(\w+),\s*(\w+)\|/,
      /scores\.each_pair\s*\{\s*\|(\w+),\s*(\w+)\|/,
    ],
    tags: ['each', 'iteration'],
  },

  // select / reject
  {
    id: 'ruby-hash-select-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Select Hash Entries',
    text: 'Use `select` to get hash entries where value is greater than 80.',
    setup: 'scores = { alice: 90, bob: 75, carol: 85 }',
    setupCode: 'scores = { alice: 90, bob: 75, carol: 85 }',
    expected: { alice: 90, carol: 85 },
    sample: 'scores.select { |k, v| v > 80 }',
    hints: ['select filters hash entries', 'Block receives key and value'],
    validPatterns: [
      /scores\.select\s*\{\s*\|(\w+),\s*(\w+)\|\s*\2\s*>\s*80\s*\}/,
      /scores\.select\s*\{\s*\|_,\s*(\w+)\|\s*\1\s*>\s*80\s*\}/,
    ],
    tags: ['select', 'filter'],
  },
  {
    id: 'ruby-hash-reject-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Reject Hash Entries',
    text: 'Use `reject` to remove hash entries where value is less than 80.',
    setup: 'scores = { alice: 90, bob: 75, carol: 85 }',
    setupCode: 'scores = { alice: 90, bob: 75, carol: 85 }',
    expected: { alice: 90, carol: 85 },
    sample: 'scores.reject { |k, v| v < 80 }',
    hints: ['reject removes entries where block is true'],
    validPatterns: [
      /scores\.reject\s*\{\s*\|(\w+),\s*(\w+)\|\s*\2\s*<\s*80\s*\}/,
      /scores\.reject\s*\{\s*\|_,\s*(\w+)\|\s*\1\s*<\s*80\s*\}/,
    ],
    tags: ['reject', 'filter'],
  },

  // merge
  {
    id: 'ruby-hash-merge-1',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Merge Hashes',
    text: 'Use `merge` to combine two hashes.',
    setup: 'defaults = { a: 1, b: 2 }\noverrides = { b: 3, c: 4 }',
    setupCode: 'defaults = { a: 1, b: 2 }\noverrides = { b: 3, c: 4 }',
    expected: { a: 1, b: 3, c: 4 },
    sample: 'defaults.merge(overrides)',
    hints: ['merge combines hashes', 'Second hash values override first'],
    validPatterns: [/defaults\.merge\s*\(\s*overrides\s*\)/],
    tags: ['merge', 'combine'],
  },

  // fetch / dig
  {
    id: 'ruby-hash-fetch-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Fetch with Default',
    text: 'Use `fetch` to get a value with a default if key is missing.',
    setup: 'person = { name: "Alice" }',
    setupCode: 'person = { name: "Alice" }',
    expected: 'Unknown',
    sample: 'person.fetch(:age, "Unknown")',
    hints: ['fetch takes key and default value', 'Default used if key missing'],
    validPatterns: [/person\.fetch\s*\(\s*:age,\s*["']Unknown["']\s*\)/],
    tags: ['fetch', 'default'],
  },
  {
    id: 'ruby-hash-dig-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Dig into Nested Hash',
    text: 'Use `dig` to safely access a nested value.',
    setup: 'data = { user: { profile: { name: "Alice" } } }',
    setupCode: 'data = { user: { profile: { name: "Alice" } } }',
    expected: 'Alice',
    sample: 'data.dig(:user, :profile, :name)',
    hints: ['dig navigates nested structures safely', 'Returns nil if path missing'],
    validPatterns: [/data\.dig\s*\(\s*:user,\s*:profile,\s*:name\s*\)/],
    tags: ['dig', 'nested'],
  },

  // ============================================================
  // Enumerable Methods
  // ============================================================

  // any? / all? / none?
  {
    id: 'ruby-enum-any-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Check if Any Match',
    text: 'Use `any?` to check if any number is greater than 10.',
    setup: 'numbers = [5, 8, 12, 3]',
    setupCode: 'numbers = [5, 8, 12, 3]',
    expected: true,
    sample: 'numbers.any? { |n| n > 10 }',
    hints: ['any? returns true if any element matches'],
    validPatterns: [/numbers\.any\?\s*\{\s*\|(\w+)\|\s*\1\s*>\s*10\s*\}/],
    tags: ['any?', 'predicate'],
  },
  {
    id: 'ruby-enum-all-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Check if All Match',
    text: 'Use `all?` to check if all numbers are positive.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: true,
    sample: 'numbers.all? { |n| n > 0 }',
    hints: ['all? returns true if all elements match'],
    validPatterns: [
      /numbers\.all\?\s*\{\s*\|(\w+)\|\s*\1\s*>\s*0\s*\}/,
      /numbers\.all\?\s*\(\s*&:positive\?\s*\)/,
    ],
    tags: ['all?', 'predicate'],
  },
  {
    id: 'ruby-enum-none-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Check if None Match',
    text: 'Use `none?` to check if no numbers are negative.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: true,
    sample: 'numbers.none? { |n| n < 0 }',
    hints: ['none? returns true if no elements match'],
    validPatterns: [
      /numbers\.none\?\s*\{\s*\|(\w+)\|\s*\1\s*<\s*0\s*\}/,
      /numbers\.none\?\s*\(\s*&:negative\?\s*\)/,
    ],
    tags: ['none?', 'predicate'],
  },

  // count
  {
    id: 'ruby-enum-count-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Count Elements',
    text: 'Use `count` to count how many numbers are even.',
    setup: 'numbers = [1, 2, 3, 4, 5, 6]',
    setupCode: 'numbers = [1, 2, 3, 4, 5, 6]',
    expected: 3,
    sample: 'numbers.count { |n| n.even? }',
    hints: ['count with block counts matching elements'],
    validPatterns: [
      /numbers\.count\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}/,
      /numbers\.count\s*\(\s*&:even\?\s*\)/,
    ],
    tags: ['count', 'quantity'],
  },

  // max / min / minmax
  {
    id: 'ruby-enum-max-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Find Maximum',
    text: 'Use the `max` method to find the largest number.',
    setup: 'numbers = [3, 7, 1, 9, 4]',
    setupCode: 'numbers = [3, 7, 1, 9, 4]',
    expected: 9,
    sample: 'numbers.max',
    hints: ['max returns the largest element'],
    validPatterns: [/numbers\.max\b/],
    tags: ['max', 'largest'],
  },
  {
    id: 'ruby-enum-min-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Find Minimum',
    text: 'Use the `min` method to find the smallest number.',
    setup: 'numbers = [3, 7, 1, 9, 4]',
    setupCode: 'numbers = [3, 7, 1, 9, 4]',
    expected: 1,
    sample: 'numbers.min',
    hints: ['min returns the smallest element'],
    validPatterns: [/numbers\.min\b/],
    tags: ['min', 'smallest'],
  },
  {
    id: 'ruby-enum-minmax-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Find Min and Max',
    text: 'Use `minmax` to get both minimum and maximum in one call.',
    setup: 'numbers = [3, 7, 1, 9, 4]',
    setupCode: 'numbers = [3, 7, 1, 9, 4]',
    expected: [1, 9],
    sample: 'numbers.minmax',
    hints: ['minmax returns [min, max] array'],
    validPatterns: [/numbers\.minmax\b/],
    tags: ['minmax', 'range'],
  },

  // sum
  {
    id: 'ruby-enum-sum-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Sum Array Elements',
    text: 'Use the `sum` method to calculate the total of all numbers.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: 15,
    sample: 'numbers.sum',
    hints: ['sum adds all elements together'],
    validPatterns: [
      /numbers\.sum\b/,
      /numbers\.reduce\s*\(\s*:?\+\s*\)/,
      /numbers\.inject\s*\(\s*:?\+\s*\)/,
    ],
    tags: ['sum', 'total'],
  },

  // ============================================================
  // NEW PROBLEMS - Enumerable Methods (Advanced)
  // ============================================================

  // partition
  {
    id: 'ruby-enum-partition-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Partition Even and Odd',
    text: 'Use `partition` to split numbers into even and odd arrays.',
    setup: 'numbers = [1, 2, 3, 4, 5, 6]',
    setupCode: 'numbers = [1, 2, 3, 4, 5, 6]',
    expected: [
      [2, 4, 6],
      [1, 3, 5],
    ],
    sample: 'numbers.partition { |n| n.even? }',
    hints: [
      'partition returns two arrays: [truthy, falsy]',
      'First array contains elements where block is true',
    ],
    validPatterns: [
      /numbers\.partition\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}/,
      /numbers\.partition\s*\(\s*&:even\?\s*\)/,
    ],
    tags: ['partition', 'split', 'even', 'odd'],
  },
  {
    id: 'ruby-enum-partition-2',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Partition Passing and Failing Scores',
    text: 'Use `partition` to separate passing (>= 60) and failing scores.',
    setup: 'scores = [85, 42, 91, 55, 78, 33]',
    setupCode: 'scores = [85, 42, 91, 55, 78, 33]',
    expected: [
      [85, 91, 78],
      [42, 55, 33],
    ],
    sample: 'scores.partition { |s| s >= 60 }',
    hints: ['partition splits based on condition', 'Returns [passing, failing] arrays'],
    validPatterns: [/scores\.partition\s*\{\s*\|(\w+)\|\s*\1\s*>=\s*60\s*\}/],
    tags: ['partition', 'filter', 'scores'],
  },

  // group_by
  {
    id: 'ruby-enum-group-by-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Group by Length',
    text: 'Use `group_by` to group words by their length.',
    setup: 'words = ["cat", "dog", "elephant", "ant", "bear"]',
    setupCode: 'words = ["cat", "dog", "elephant", "ant", "bear"]',
    expected: { 3: ['cat', 'dog', 'ant'], 8: ['elephant'], 4: ['bear'] },
    sample: 'words.group_by { |w| w.length }',
    hints: [
      'group_by returns a hash with block values as keys',
      'Each key maps to array of matching elements',
    ],
    validPatterns: [
      /words\.group_by\s*\{\s*\|(\w+)\|\s*\1\.length\s*\}/,
      /words\.group_by\s*\{\s*\|(\w+)\|\s*\1\.size\s*\}/,
      /words\.group_by\s*\(\s*&:length\s*\)/,
      /words\.group_by\s*\(\s*&:size\s*\)/,
    ],
    tags: ['group_by', 'hash', 'categorize'],
  },
  {
    id: 'ruby-enum-group-by-2',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Group by First Letter',
    text: 'Use `group_by` to group words by their first letter (lowercase).',
    setup: 'words = ["Apple", "Banana", "apricot", "Blueberry", "cherry"]',
    setupCode: 'words = ["Apple", "Banana", "apricot", "Blueberry", "cherry"]',
    expected: { a: ['Apple', 'apricot'], b: ['Banana', 'Blueberry'], c: ['cherry'] },
    sample: 'words.group_by { |w| w[0].downcase }',
    hints: ['Access first character with [0]', 'Use downcase for case-insensitive grouping'],
    validPatterns: [
      /words\.group_by\s*\{\s*\|(\w+)\|\s*\1\[0\]\.downcase\s*\}/,
      /words\.group_by\s*\{\s*\|(\w+)\|\s*\1\.chr\.downcase\s*\}/,
    ],
    tags: ['group_by', 'downcase', 'first_char'],
  },

  // inject with initial value
  {
    id: 'ruby-enum-inject-hash-1',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Build Hash with inject',
    text: 'Use `inject` to convert an array of pairs into a hash.',
    setup: 'pairs = [[:a, 1], [:b, 2], [:c, 3]]',
    setupCode: 'pairs = [[:a, 1], [:b, 2], [:c, 3]]',
    expected: { a: 1, b: 2, c: 3 },
    sample: 'pairs.inject({}) { |hash, (k, v)| hash[k] = v; hash }',
    hints: [
      'Start with empty hash {}',
      'Destructure pair into key and value',
      'Return the hash from block',
    ],
    validPatterns: [
      /pairs\.inject\s*\(\s*\{\}\s*\)\s*\{/,
      /pairs\.reduce\s*\(\s*\{\}\s*\)\s*\{/,
      /pairs\.each_with_object\s*\(\s*\{\}\s*\)\s*\{/,
      /pairs\.to_h\b/,
    ],
    tags: ['inject', 'reduce', 'hash', 'transform'],
  },

  // collect/map with index
  {
    id: 'ruby-enum-collect-index-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Collect with Index',
    text: 'Use `collect` with `with_index` to multiply each element by its index.',
    setup: 'numbers = [10, 20, 30, 40]',
    setupCode: 'numbers = [10, 20, 30, 40]',
    expected: [0, 20, 60, 120],
    sample: 'numbers.collect.with_index { |n, i| n * i }',
    hints: ['Chain with_index after collect', 'Block receives element and index'],
    validPatterns: [
      /numbers\.collect\.with_index\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\*\s*\2\s*\}/,
      /numbers\.map\.with_index\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\*\s*\2\s*\}/,
      /numbers\.each_with_index\.map\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\*\s*\2\s*\}/,
    ],
    tags: ['collect', 'map', 'with_index', 'transform'],
  },

  // ============================================================
  // NEW PROBLEMS - String Methods (Advanced)
  // ============================================================

  // scan
  {
    id: 'ruby-string-scan-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Scan for All Numbers',
    text: 'Use `scan` to extract all numbers from the string.',
    setup: 'text = "I have 3 cats and 2 dogs"',
    setupCode: 'text = "I have 3 cats and 2 dogs"',
    expected: ['3', '2'],
    sample: 'text.scan(/\\d+/)',
    hints: ['scan returns all regex matches as array', 'Use \\d+ to match digits'],
    validPatterns: [/text\.scan\s*\(\s*\/\\d\+\/\s*\)/, /text\.scan\s*\(\s*\/\[0-9\]\+\/\s*\)/],
    tags: ['scan', 'regex', 'extract'],
  },
  {
    id: 'ruby-string-scan-2',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Scan for Words Starting with Capital',
    text: 'Use `scan` to extract all words starting with a capital letter.',
    setup: 'text = "Hello World from Ruby Land"',
    setupCode: 'text = "Hello World from Ruby Land"',
    expected: ['Hello', 'World', 'Ruby', 'Land'],
    sample: 'text.scan(/[A-Z][a-z]*/)',
    hints: [
      'Match capital letter followed by lowercase',
      'Use [A-Z] for uppercase, [a-z]* for following lowercase',
    ],
    validPatterns: [
      /text\.scan\s*\(\s*\/\[A-Z\]\[a-z\]\*\/\s*\)/,
      /text\.scan\s*\(\s*\/\[A-Z\]\\w\*\/\s*\)/,
    ],
    tags: ['scan', 'regex', 'capitalize'],
  },

  // match
  {
    id: 'ruby-string-match-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Match Email Domain',
    text: 'Use `match` to extract the domain from an email address.',
    setup: 'email = "user@example.com"',
    setupCode: 'email = "user@example.com"',
    expected: 'example.com',
    sample: 'email.match(/@(.+)/)[1]',
    hints: ['match returns MatchData object', 'Use capturing group and index [1]'],
    validPatterns: [
      /email\.match\s*\(\s*\/@\(\.\+\)\/\s*\)\s*\[1\]/,
      /email\.match\s*\(\s*\/@\(\[^@\]\+\)\/\s*\)\s*\[1\]/,
      /email\.split\s*\(\s*["']@["']\s*\)\s*\[1\]/,
      /email\[\/\/@\(\.\+\)\/,\s*1\]/,
    ],
    tags: ['match', 'regex', 'capture'],
  },

  // squeeze
  {
    id: 'ruby-string-squeeze-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Squeeze Repeated Characters',
    text: 'Use `squeeze` to reduce consecutive duplicate characters to single.',
    setup: 'text = "heeellooo   woorrld"',
    setupCode: 'text = "heeellooo   woorrld"',
    expected: 'helo world',
    sample: 'text.squeeze',
    hints: ['squeeze reduces runs of same character to one', 'Works on all characters by default'],
    validPatterns: [/text\.squeeze\b/],
    tags: ['squeeze', 'duplicates', 'compress'],
  },
  {
    id: 'ruby-string-squeeze-2',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Squeeze Only Spaces',
    text: 'Use `squeeze` to reduce only multiple spaces to single space.',
    setup: 'text = "hello    world   ruby"',
    setupCode: 'text = "hello    world   ruby"',
    expected: 'hello world ruby',
    sample: 'text.squeeze(" ")',
    hints: ['Pass character to squeeze as argument', 'Only that character will be squeezed'],
    validPatterns: [/text\.squeeze\s*\(\s*["'] ["']\s*\)/],
    tags: ['squeeze', 'spaces', 'normalize'],
  },

  // gsub with block
  {
    id: 'ruby-string-gsub-block-1',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Replace with Block Transformation',
    text: 'Use `gsub` with a block to uppercase all words starting with "r".',
    setup: 'text = "ruby is really rad"',
    setupCode: 'text = "ruby is really rad"',
    expected: 'RUBY is REALLY RAD',
    sample: 'text.gsub(/\\br\\w*/i) { |word| word.upcase }',
    hints: [
      'gsub can take a block for dynamic replacement',
      'Use \\b for word boundary',
      'Block receives matched text',
    ],
    validPatterns: [/text\.gsub\s*\(\s*\/.*r.*\/[i]?\s*\)\s*\{\s*\|(\w+)\|\s*\1\.upcase\s*\}/],
    tags: ['gsub', 'block', 'transform', 'regex'],
  },

  // chomp with argument
  {
    id: 'ruby-string-chomp-arg-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Chomp Specific Suffix',
    text: 'Use `chomp` to remove the ".txt" suffix from the filename.',
    setup: 'filename = "document.txt"',
    setupCode: 'filename = "document.txt"',
    expected: 'document',
    sample: 'filename.chomp(".txt")',
    hints: ['chomp can take a suffix argument', 'Only removes if string ends with that suffix'],
    validPatterns: [
      /filename\.chomp\s*\(\s*["']\.txt["']\s*\)/,
      /filename\.delete_suffix\s*\(\s*["']\.txt["']\s*\)/,
    ],
    tags: ['chomp', 'suffix', 'filename'],
  },

  // ============================================================
  // NEW PROBLEMS - Array Methods (Advanced)
  // ============================================================

  // zip
  {
    id: 'ruby-array-zip-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Zip Arrays Together',
    text: 'Use `zip` to combine two arrays into pairs.',
    setup: 'names = ["Alice", "Bob", "Carol"]\nages = [25, 30, 35]',
    setupCode: 'names = ["Alice", "Bob", "Carol"]\nages = [25, 30, 35]',
    expected: [
      ['Alice', 25],
      ['Bob', 30],
      ['Carol', 35],
    ],
    sample: 'names.zip(ages)',
    hints: ['zip combines arrays element-wise', 'Returns array of pairs'],
    validPatterns: [/names\.zip\s*\(\s*ages\s*\)/],
    tags: ['zip', 'combine', 'pairs'],
  },
  {
    id: 'ruby-array-zip-2',
    category: 'Array Methods',
    difficulty: 'hard',
    title: 'Zip and Transform to Hash',
    text: 'Use `zip` to create a hash from two arrays.',
    setup: 'keys = [:name, :age, :city]\nvalues = ["Alice", 30, "NYC"]',
    setupCode: 'keys = [:name, :age, :city]\nvalues = ["Alice", 30, "NYC"]',
    expected: { name: 'Alice', age: 30, city: 'NYC' },
    sample: 'keys.zip(values).to_h',
    hints: ['zip creates array of pairs', 'to_h converts pairs to hash'],
    validPatterns: [
      /keys\.zip\s*\(\s*values\s*\)\.to_h\b/,
      /Hash\s*\[\s*keys\.zip\s*\(\s*values\s*\)\s*\]/,
    ],
    tags: ['zip', 'to_h', 'hash', 'transform'],
  },

  // transpose
  {
    id: 'ruby-array-transpose-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Transpose Matrix',
    text: 'Use `transpose` to swap rows and columns of a 2D array.',
    setup: 'matrix = [[1, 2, 3], [4, 5, 6]]',
    setupCode: 'matrix = [[1, 2, 3], [4, 5, 6]]',
    expected: [
      [1, 4],
      [2, 5],
      [3, 6],
    ],
    sample: 'matrix.transpose',
    hints: ['transpose flips rows and columns', 'Works on arrays of equal-length arrays'],
    validPatterns: [/matrix\.transpose\b/],
    tags: ['transpose', 'matrix', '2d'],
  },

  // rotate
  {
    id: 'ruby-array-rotate-1',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Rotate Array Left',
    text: 'Use `rotate` to move the first element to the end.',
    setup: 'letters = ["a", "b", "c", "d"]',
    setupCode: 'letters = ["a", "b", "c", "d"]',
    expected: ['b', 'c', 'd', 'a'],
    sample: 'letters.rotate',
    hints: ['rotate(1) moves first element to end', 'Default rotation is 1'],
    validPatterns: [/letters\.rotate\b/, /letters\.rotate\s*\(\s*1\s*\)/],
    tags: ['rotate', 'shift', 'circular'],
  },
  {
    id: 'ruby-array-rotate-2',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Rotate Array Right',
    text: 'Use `rotate` with a negative argument to rotate right by 2 positions.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [4, 5, 1, 2, 3],
    sample: 'numbers.rotate(-2)',
    hints: ['Negative argument rotates right', 'rotate(-2) brings last 2 elements to front'],
    validPatterns: [/numbers\.rotate\s*\(\s*-2\s*\)/],
    tags: ['rotate', 'right', 'negative'],
  },

  // flatten with depth
  {
    id: 'ruby-array-flatten-depth-1',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Flatten One Level',
    text: 'Use `flatten` with depth argument to flatten only one level.',
    setup: 'nested = [[1, [2, 3]], [4, [5, 6]]]',
    setupCode: 'nested = [[1, [2, 3]], [4, [5, 6]]]',
    expected: [1, [2, 3], 4, [5, 6]],
    sample: 'nested.flatten(1)',
    hints: ['flatten(n) flattens n levels deep', 'flatten(1) only removes one nesting level'],
    validPatterns: [/nested\.flatten\s*\(\s*1\s*\)/],
    tags: ['flatten', 'depth', 'nested'],
  },

  // ============================================================
  // NEW PROBLEMS - Hash Methods (Advanced)
  // ============================================================

  // invert
  {
    id: 'ruby-hash-invert-1',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Invert Hash Keys and Values',
    text: 'Use `invert` to swap keys and values in the hash.',
    setup: 'codes = { a: 1, b: 2, c: 3 }',
    setupCode: 'codes = { a: 1, b: 2, c: 3 }',
    expected: { 1: ':a', 2: ':b', 3: ':c' },
    sample: 'codes.invert',
    hints: ['invert swaps keys and values', 'Original values become new keys'],
    validPatterns: [/codes\.invert\b/],
    tags: ['invert', 'swap', 'reverse'],
  },

  // transform_keys
  {
    id: 'ruby-hash-transform-keys-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Transform Keys to Strings',
    text: 'Use `transform_keys` to convert all symbol keys to strings.',
    setup: 'person = { name: "Alice", age: 30 }',
    setupCode: 'person = { name: "Alice", age: 30 }',
    expected: { name: 'Alice', age: 30 },
    sample: 'person.transform_keys(&:to_s)',
    hints: ['transform_keys applies block to each key', 'Use &:to_s for symbol to string'],
    validPatterns: [
      /person\.transform_keys\s*\(\s*&:to_s\s*\)/,
      /person\.transform_keys\s*\{\s*\|(\w+)\|\s*\1\.to_s\s*\}/,
    ],
    tags: ['transform_keys', 'keys', 'to_s'],
  },

  // transform_values
  {
    id: 'ruby-hash-transform-values-1',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Transform Values by Doubling',
    text: 'Use `transform_values` to double all values in the hash.',
    setup: 'scores = { alice: 10, bob: 15, carol: 20 }',
    setupCode: 'scores = { alice: 10, bob: 15, carol: 20 }',
    expected: { alice: 20, bob: 30, carol: 40 },
    sample: 'scores.transform_values { |v| v * 2 }',
    hints: ['transform_values applies block to each value', 'Keys remain unchanged'],
    validPatterns: [/scores\.transform_values\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*2\s*\}/],
    tags: ['transform_values', 'values', 'multiply'],
  },

  // slice
  {
    id: 'ruby-hash-slice-1',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Slice Specific Keys',
    text: 'Use `slice` to extract only the :name and :age keys.',
    setup: 'person = { name: "Alice", age: 30, city: "NYC", job: "Engineer" }',
    setupCode: 'person = { name: "Alice", age: 30, city: "NYC", job: "Engineer" }',
    expected: { name: 'Alice', age: 30 },
    sample: 'person.slice(:name, :age)',
    hints: ['slice returns new hash with only specified keys', 'Pass multiple keys as arguments'],
    validPatterns: [/person\.slice\s*\(\s*:name,\s*:age\s*\)/],
    tags: ['slice', 'subset', 'extract'],
  },

  // ============================================================
  // NEW PROBLEMS - Block/Proc/Lambda
  // ============================================================

  // Basic block
  {
    id: 'ruby-block-basic-1',
    category: 'Block/Proc/Lambda',
    difficulty: 'easy',
    title: 'Pass Block to Method',
    text: 'Use `yield` concept: call the block three times with 1, 2, 3.',
    setup: '# Define result using map with a block',
    setupCode: '# Use map with a block that squares numbers',
    expected: [1, 4, 9],
    sample: '[1, 2, 3].map { |n| n ** 2 }',
    hints: ['Blocks are code between { } or do/end', 'map yields each element to the block'],
    validPatterns: [
      /\[1,\s*2,\s*3\]\.map\s*\{\s*\|(\w+)\|\s*\1\s*\*\*\s*2\s*\}/,
      /\[1,\s*2,\s*3\]\.map\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*\1\s*\}/,
    ],
    tags: ['block', 'map', 'yield'],
  },

  // Proc creation
  {
    id: 'ruby-proc-create-1',
    category: 'Block/Proc/Lambda',
    difficulty: 'medium',
    title: 'Create and Call a Proc',
    text: 'Create a Proc that doubles a number and call it with 5.',
    setup: '# Create doubler proc and call it',
    setupCode: '# Create a Proc that doubles, then call with 5',
    expected: 10,
    sample: 'doubler = Proc.new { |n| n * 2 }; doubler.call(5)',
    hints: ['Proc.new creates a proc object', 'Call proc with .call(arg)'],
    validPatterns: [
      /Proc\.new\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*2\s*\}.*\.call\s*\(\s*5\s*\)/,
      /proc\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*2\s*\}.*\.call\s*\(\s*5\s*\)/,
    ],
    tags: ['proc', 'call', 'create'],
  },

  // Lambda creation
  {
    id: 'ruby-lambda-create-1',
    category: 'Block/Proc/Lambda',
    difficulty: 'medium',
    title: 'Create and Call a Lambda',
    text: 'Create a lambda that adds 10 to a number and call it with 5.',
    setup: '# Create add_ten lambda and call it',
    setupCode: '# Create a lambda that adds 10, then call with 5',
    expected: 15,
    sample: 'add_ten = ->(n) { n + 10 }; add_ten.call(5)',
    hints: [
      'Lambda syntax: ->(args) { body } or lambda { |args| body }',
      'Call with .call(arg) or .(arg) or [arg]',
    ],
    validPatterns: [
      /->\s*\(\s*(\w+)\s*\)\s*\{\s*\1\s*\+\s*10\s*\}.*\.call\s*\(\s*5\s*\)/,
      /lambda\s*\{\s*\|(\w+)\|\s*\1\s*\+\s*10\s*\}.*\.call\s*\(\s*5\s*\)/,
    ],
    tags: ['lambda', 'call', 'stabby'],
  },

  // Symbol to proc
  {
    id: 'ruby-symbol-to-proc-1',
    category: 'Block/Proc/Lambda',
    difficulty: 'easy',
    title: 'Symbol to Proc Shorthand',
    text: 'Use the & symbol-to-proc shorthand to convert numbers to strings.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: ['1', '2', '3', '4', '5'],
    sample: 'numbers.map(&:to_s)',
    hints: ['&:method_name converts symbol to proc', 'Equivalent to { |x| x.method_name }'],
    validPatterns: [/numbers\.map\s*\(\s*&:to_s\s*\)/],
    tags: ['symbol_to_proc', 'map', 'shorthand'],
  },

  // tap
  {
    id: 'ruby-block-tap-1',
    category: 'Block/Proc/Lambda',
    difficulty: 'hard',
    title: 'Use tap for Debugging Chain',
    text: 'Use `tap` to inspect intermediate value in a method chain that doubles then adds 1.',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: [3, 5, 7],
    sample: 'numbers.map { |n| n * 2 }.tap { |arr| p arr }.map { |n| n + 1 }',
    hints: ['tap yields self to block and returns self', 'Useful for debugging method chains'],
    validPatterns: [/\.tap\s*\{.*\}.*\.map\s*\{/, /numbers\.map\s*\{.*\}\.map\s*\{.*\+\s*1/],
    tags: ['tap', 'debug', 'chain'],
  },

  // ============================================================
  // String Operations (Advanced)
  // Covers: center, ljust, rjust, squeeze, delete, scan, match,
  // gsub with blocks, encoding, heredocs, interpolation,
  // each_char, each_line, % formatting, StringIO
  // ============================================================

  // center
  {
    id: 'ruby-str-center-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Center String with Padding',
    text: 'Use `center` to pad the string to 11 characters with spaces.',
    setup: 'text = "ruby"',
    setupCode: 'text = "ruby"',
    expected: '   ruby    ',
    sample: 'text.center(11)',
    hints: ['center pads both sides equally', 'Default padding character is space'],
    validPatterns: [/text\.center\s*\(\s*11\s*\)/],
    tags: ['center', 'padding', 'alignment'],
  },
  {
    id: 'ruby-str-center-2',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Center with Custom Padding',
    text: 'Use `center` to pad the string to 10 characters with asterisks.',
    setup: 'text = "hi"',
    setupCode: 'text = "hi"',
    expected: '****hi****',
    sample: 'text.center(10, "*")',
    hints: ['Pass second argument for custom padding', 'Padding character can be any string'],
    validPatterns: [/text\.center\s*\(\s*10,\s*["']\*["']\s*\)/],
    tags: ['center', 'padding', 'custom'],
  },

  // ljust
  {
    id: 'ruby-str-ljust-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Left Justify String',
    text: 'Use `ljust` to left-justify the string in a 10-character field.',
    setup: 'text = "ruby"',
    setupCode: 'text = "ruby"',
    expected: 'ruby      ',
    sample: 'text.ljust(10)',
    hints: ['ljust pads on the right side', 'String stays on the left'],
    validPatterns: [/text\.ljust\s*\(\s*10\s*\)/],
    tags: ['ljust', 'padding', 'alignment'],
  },
  {
    id: 'ruby-str-ljust-2',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Left Justify with Dots',
    text: 'Use `ljust` to left-justify with dots to fill 15 characters.',
    setup: 'item = "Price"',
    setupCode: 'item = "Price"',
    expected: 'Price..........',
    sample: 'item.ljust(15, ".")',
    hints: ['Second argument specifies padding character', 'Useful for creating formatted output'],
    validPatterns: [/item\.ljust\s*\(\s*15,\s*["']\.["']\s*\)/],
    tags: ['ljust', 'padding', 'format'],
  },

  // rjust
  {
    id: 'ruby-str-rjust-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Right Justify Number',
    text: 'Use `rjust` to right-justify the number string with leading zeros.',
    setup: 'num = "42"',
    setupCode: 'num = "42"',
    expected: '00042',
    sample: 'num.rjust(5, "0")',
    hints: ['rjust pads on the left side', 'Common for zero-padding numbers'],
    validPatterns: [/num\.rjust\s*\(\s*5,\s*["']0["']\s*\)/],
    tags: ['rjust', 'padding', 'zero-pad'],
  },

  // delete
  {
    id: 'ruby-str-delete-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Delete Vowels from String',
    text: 'Use `delete` to remove all vowels from the string.',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: 'hll wrld',
    sample: 'text.delete("aeiou")',
    hints: ['delete removes all characters in the argument', 'Pass all vowels as a single string'],
    validPatterns: [
      /text\.delete\s*\(\s*["']aeiou["']\s*\)/,
      /text\.delete\s*\(\s*["']aeiouAEIOU["']\s*\)/,
    ],
    tags: ['delete', 'remove', 'vowels'],
  },
  {
    id: 'ruby-str-delete-2',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Delete All Digits',
    text: 'Use `delete` with a range to remove all digits from the string.',
    setup: 'text = "Order #12345 confirmed"',
    setupCode: 'text = "Order #12345 confirmed"',
    expected: 'Order # confirmed',
    sample: 'text.delete("0-9")',
    hints: [
      'delete supports character ranges like "0-9"',
      'Works similar to character classes in regex',
    ],
    validPatterns: [
      /text\.delete\s*\(\s*["']0-9["']\s*\)/,
      /text\.delete\s*\(\s*["']\d["']\s*\)/,
      /text\.gsub\s*\(\s*\/\\d\/,\s*["']["']\s*\)/,
    ],
    tags: ['delete', 'digits', 'range'],
  },

  // scan with regex groups
  {
    id: 'ruby-str-scan-groups-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Scan with Capture Groups',
    text: 'Use `scan` with capture groups to extract key-value pairs.',
    setup: 'text = "name=Alice, age=30, city=NYC"',
    setupCode: 'text = "name=Alice, age=30, city=NYC"',
    expected: [
      ['name', 'Alice'],
      ['age', '30'],
      ['city', 'NYC'],
    ],
    sample: 'text.scan(/(\\w+)=(\\w+)/)',
    hints: [
      'Capture groups () in regex return nested arrays',
      'Each match returns array of captured groups',
    ],
    validPatterns: [
      /text\.scan\s*\(\s*\/\(\\w\+\)=\(\\w\+\)\/\s*\)/,
      /text\.scan\s*\(\s*\/\(\[^=\]\+\)=\(\[^,\s\]\+\)\/\s*\)/,
    ],
    tags: ['scan', 'regex', 'capture', 'groups'],
  },

  // match with named groups
  {
    id: 'ruby-str-match-named-1',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Match with Named Capture Groups',
    text: 'Use `match` with named capture groups to extract date parts.',
    setup: 'date = "2024-03-15"',
    setupCode: 'date = "2024-03-15"',
    expected: '2024',
    sample: 'date.match(/(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/)[:year]',
    hints: [
      'Named groups use (?<name>pattern) syntax',
      'Access captured values with [:name] or .captures',
    ],
    validPatterns: [
      /date\.match\s*\(.*\?<year>.*\)\s*\[\s*:year\s*\]/,
      /date\.match\s*\(.*\)\s*\[\s*1\s*\]/,
      /date\.split\s*\(\s*["']-["']\s*\)\s*\[\s*0\s*\]/,
    ],
    tags: ['match', 'regex', 'named', 'capture'],
  },

  // =~ operator
  {
    id: 'ruby-str-match-operator-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Match Operator Index',
    text: 'Use the `=~` operator to find the index of the first digit.',
    setup: 'text = "hello123world"',
    setupCode: 'text = "hello123world"',
    expected: 5,
    sample: 'text =~ /\\d/',
    hints: ['=~ returns the index of first match', 'Returns nil if no match found'],
    validPatterns: [/text\s*=~\s*\/\\d\//, /text\s*=~\s*\/\[0-9\]\//],
    tags: ['=~', 'match', 'index', 'regex'],
  },

  // gsub with block
  {
    id: 'ruby-str-gsub-block-2',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Replace Numbers with Doubled Values',
    text: 'Use `gsub` with a block to double all numbers in the string.',
    setup: 'text = "I have 3 cats and 5 dogs"',
    setupCode: 'text = "I have 3 cats and 5 dogs"',
    expected: 'I have 6 cats and 10 dogs',
    sample: 'text.gsub(/\\d+/) { |n| (n.to_i * 2).to_s }',
    hints: ['Block receives matched string', 'Convert to integer, double, convert back to string'],
    validPatterns: [/text\.gsub\s*\(\s*\/\\d\+\/\s*\)\s*\{\s*\|(\w+)\|.*\.to_i\s*\*\s*2/],
    tags: ['gsub', 'block', 'transform', 'numbers'],
  },
  {
    id: 'ruby-str-gsub-block-3',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Titlecase Words with gsub',
    text: 'Use `gsub` with a block to capitalize each word.',
    setup: 'text = "hello world from ruby"',
    setupCode: 'text = "hello world from ruby"',
    expected: 'Hello World From Ruby',
    sample: 'text.gsub(/\\b\\w/) { |char| char.upcase }',
    hints: [
      'Use \\b for word boundary',
      'Match first character of each word',
      'Upcase the matched character in block',
    ],
    validPatterns: [
      /text\.gsub\s*\(\s*\/\\b\\w\/\s*\)\s*\{\s*\|(\w+)\|\s*\1\.upcase\s*\}/,
      /text\.gsub\s*\(\s*\/\\b\(\\w\)\/\s*\)\s*\{/,
      /text\.split\s*\(.*\)\.map\s*\{.*capitalize.*\}\.join/,
    ],
    tags: ['gsub', 'block', 'titlecase', 'capitalize'],
  },

  // each_char
  {
    id: 'ruby-str-each-char-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Iterate Characters with each_char',
    text: 'Use `each_char` to count vowels in the string.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 2,
    sample: 'count = 0; text.each_char { |c| count += 1 if "aeiou".include?(c) }; count',
    hints: ['each_char yields each character', 'Check if character is in vowels string'],
    validPatterns: [
      /text\.each_char\s*\{/,
      /text\.chars\.count\s*\{.*aeiou/,
      /text\.count\s*\(\s*["']aeiou["']\s*\)/,
    ],
    tags: ['each_char', 'iterate', 'count', 'vowels'],
  },

  // each_line
  {
    id: 'ruby-str-each-line-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Process Lines with each_line',
    text: 'Use `each_line` to collect non-empty lines into an array.',
    setup: 'text = "hello\\n\\nworld\\n\\nruby"',
    setupCode: 'text = "hello\\n\\nworld\\n\\nruby"',
    expected: ['hello', 'world', 'ruby'],
    sample:
      'result = []; text.each_line { |line| result << line.strip unless line.strip.empty? }; result',
    hints: [
      'each_line yields each line including newline',
      'Use strip to remove whitespace',
      'Check empty? to skip blank lines',
    ],
    validPatterns: [
      /text\.each_line\s*\{/,
      /text\.lines\.reject\s*\{.*empty/,
      /text\.split\s*\(\s*\/\\n\+\/\s*\)/,
    ],
    tags: ['each_line', 'iterate', 'lines', 'filter'],
  },

  // String % formatting
  {
    id: 'ruby-str-format-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Printf-style Formatting',
    text: 'Use the `%` operator to format a string with name and age.',
    setup: 'name = "Alice"\nage = 30',
    setupCode: 'name = "Alice"\nage = 30',
    expected: 'Name: Alice, Age: 30',
    sample: '"Name: %s, Age: %d" % [name, age]',
    hints: ['% operator uses printf-style format specifiers', '%s for strings, %d for integers'],
    validPatterns: [
      /["'].*%s.*%d.*["']\s*%\s*\[\s*name,\s*age\s*\]/,
      /["'].*%\{.*\}.*["']\s*%\s*\{/,
    ],
    tags: ['%', 'format', 'printf', 'sprintf'],
  },
  {
    id: 'ruby-str-format-2',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Format Float with Precision',
    text: 'Use `%` formatting to display a float with 2 decimal places.',
    setup: 'price = 19.99567',
    setupCode: 'price = 19.99567',
    expected: 'Price: $19.99',
    sample: '"Price: $%.2f" % price',
    hints: ['%.2f formats float with 2 decimal places', 'Rounds the value automatically'],
    validPatterns: [
      /["'].*%\.2f.*["']\s*%\s*price/,
      /sprintf\s*\(\s*["'].*%\.2f.*["'],\s*price\s*\)/,
    ],
    tags: ['%', 'format', 'float', 'precision'],
  },
  {
    id: 'ruby-str-format-3',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Named Format Placeholders',
    text: 'Use named placeholders with `%` formatting.',
    setup: 'data = { name: "Ruby", version: 3.2 }',
    setupCode: 'data = { name: "Ruby", version: 3.2 }',
    expected: 'Language: Ruby v3.2',
    sample: '"Language: %{name} v%{version}" % data',
    hints: ['%{key} uses named placeholders', 'Hash keys must match placeholder names'],
    validPatterns: [/["'].*%\{name\}.*%\{version\}.*["']\s*%\s*data/],
    tags: ['%', 'format', 'named', 'hash'],
  },

  // String encoding
  {
    id: 'ruby-str-encoding-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Check String Encoding',
    text: 'Use `encoding` to get the encoding of the string.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 'UTF-8',
    sample: 'text.encoding.to_s',
    hints: ['encoding returns an Encoding object', 'Use to_s or name to get string representation'],
    validPatterns: [/text\.encoding\.to_s/, /text\.encoding\.name/],
    tags: ['encoding', 'utf-8', 'charset'],
  },
  {
    id: 'ruby-str-encoding-2',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Force Encoding Change',
    text: 'Use `force_encoding` to treat the string as ASCII-8BIT.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 'ASCII-8BIT',
    sample: 'text.dup.force_encoding("ASCII-8BIT").encoding.to_s',
    hints: [
      'force_encoding changes encoding without transcoding',
      'Use dup to avoid modifying original string',
    ],
    validPatterns: [
      /\.force_encoding\s*\(\s*["']ASCII-8BIT["']\s*\)/,
      /\.force_encoding\s*\(\s*Encoding::ASCII_8BIT\s*\)/,
    ],
    tags: ['force_encoding', 'encoding', 'binary'],
  },

  // Heredoc
  {
    id: 'ruby-str-heredoc-1',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Multi-line String with Heredoc',
    text: 'Use a heredoc to create a multi-line string and get its line count.',
    setup: '# Create a 3-line heredoc',
    setupCode: '# Create heredoc with 3 lines',
    expected: 3,
    sample: '<<~TEXT.lines.count\n  Line 1\n  Line 2\n  Line 3\nTEXT',
    hints: [
      '<<~DELIMITER starts a squiggly heredoc',
      'Squiggly heredoc strips leading whitespace',
      'lines.count gives number of lines',
    ],
    validPatterns: [/<<[~-]?[A-Z]+/, /<<-?[A-Z]+/],
    tags: ['heredoc', 'multiline', 'string'],
  },

  // String interpolation patterns
  {
    id: 'ruby-str-interpolation-1',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Expression Interpolation',
    text: 'Use string interpolation to embed an arithmetic expression.',
    setup: 'a = 5\nb = 3',
    setupCode: 'a = 5\nb = 3',
    expected: '5 + 3 = 8',
    sample: '"#{a} + #{b} = #{a + b}"',
    hints: [
      '#{} can contain any Ruby expression',
      'Expression is evaluated and converted to string',
    ],
    validPatterns: [/"#\{a\}\s*\+\s*#\{b\}\s*=\s*#\{a\s*\+\s*b\}"/],
    tags: ['interpolation', 'expression', 'embed'],
  },
  {
    id: 'ruby-str-interpolation-2',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Method Call Interpolation',
    text: 'Use interpolation to embed a method call result.',
    setup: 'items = ["apple", "banana", "cherry"]',
    setupCode: 'items = ["apple", "banana", "cherry"]',
    expected: 'Total: 3 items',
    sample: '"Total: #{items.length} items"',
    hints: ['Any method can be called inside #{}', 'Result is automatically converted to string'],
    validPatterns: [/".*#\{items\.(length|size|count)\}.*"/],
    tags: ['interpolation', 'method', 'call'],
  },

  // StringIO
  {
    id: 'ruby-str-stringio-1',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Write to StringIO',
    text: 'Use StringIO to capture output written with puts.',
    setup: 'require "stringio"',
    setupCode: 'require "stringio"',
    expected: 'Hello, World!',
    sample: 'io = StringIO.new; io.puts "Hello, World!"; io.string.chomp',
    hints: [
      'StringIO acts like a file but uses a string',
      'Use .string to get the written content',
      'chomp removes trailing newline from puts',
    ],
    validPatterns: [/StringIO\.new.*\.puts.*\.string/, /StringIO\.new.*<<.*\.string/],
    tags: ['StringIO', 'io', 'buffer', 'capture'],
  },
  {
    id: 'ruby-str-stringio-2',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Read from StringIO',
    text: 'Use StringIO to read a string line by line.',
    setup: 'require "stringio"\ntext = "line1\\nline2\\nline3"',
    setupCode: 'require "stringio"\ntext = "line1\\nline2\\nline3"',
    expected: ['line1', 'line2', 'line3'],
    sample: 'io = StringIO.new(text); io.readlines.map(&:chomp)',
    hints: [
      'Initialize StringIO with a string to read from',
      'readlines returns array of lines',
      'map(&:chomp) removes newlines',
    ],
    validPatterns: [
      /StringIO\.new\s*\(\s*text\s*\).*\.readlines/,
      /StringIO\.new\s*\(\s*text\s*\).*\.each_line/,
    ],
    tags: ['StringIO', 'read', 'lines', 'parse'],
  },

  // Additional squeeze variations
  {
    id: 'ruby-str-squeeze-3',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Squeeze Letter Range',
    text: 'Use `squeeze` with a range to squeeze only letters, not spaces.',
    setup: 'text = "heeelllo   wooorld"',
    setupCode: 'text = "heeelllo   wooorld"',
    expected: 'helo   world',
    sample: 'text.squeeze("a-z")',
    hints: ['squeeze accepts character ranges', 'Only specified characters are squeezed'],
    validPatterns: [
      /text\.squeeze\s*\(\s*["']a-z["']\s*\)/,
      /text\.squeeze\s*\(\s*["']a-zA-Z["']\s*\)/,
    ],
    tags: ['squeeze', 'range', 'letters'],
  },

  // ============================================================
  // Advanced Enumerable Module - Lazy Enumerators, chunk, slice,
  // tally, each_with_object, minmax_by, cycle patterns
  // ============================================================

  // each_with_object patterns (3 problems: 2 easy, 1 medium)
  {
    id: 'ruby-enum-each-with-object-hash-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Build Word Length Hash with each_with_object',
    text: 'Use `each_with_object` to create a hash mapping each word to its length.',
    setup: 'words = ["cat", "elephant", "dog"]',
    setupCode: 'words = ["cat", "elephant", "dog"]',
    expected: { cat: 3, elephant: 8, dog: 3 },
    sample: 'words.each_with_object({}) { |word, hash| hash[word] = word.length }',
    hints: [
      'each_with_object passes an accumulator to each iteration',
      'The accumulator is the second block parameter',
      'Returns the accumulator after all iterations',
    ],
    validPatterns: [/words\.each_with_object\s*\(\s*\{\s*\}\s*\)\s*\{\s*\|(\w+),\s*(\w+)\|/],
    tags: ['each_with_object', 'hash', 'accumulator'],
  },
  {
    id: 'ruby-enum-each-with-object-array-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Collect Squares with each_with_object',
    text: 'Use `each_with_object` to build an array of squared numbers.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [1, 4, 9, 16, 25],
    sample: 'numbers.each_with_object([]) { |n, arr| arr << n ** 2 }',
    hints: [
      'Pass an empty array as the accumulator object',
      'Use << to append transformed elements',
      'Returns the modified array after iteration',
    ],
    validPatterns: [/numbers\.each_with_object\s*\(\s*\[\s*\]\s*\)\s*\{\s*\|(\w+),\s*(\w+)\|/],
    tags: ['each_with_object', 'array', 'transform'],
  },
  {
    id: 'ruby-enum-each-with-object-group-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Group Numbers by Parity',
    text: 'Use `each_with_object` to group numbers into even and odd arrays.',
    setup: 'numbers = [1, 2, 3, 4, 5, 6, 7, 8]',
    setupCode: 'numbers = [1, 2, 3, 4, 5, 6, 7, 8]',
    expected: { even: [2, 4, 6, 8], odd: [1, 3, 5, 7] },
    sample:
      'numbers.each_with_object({ even: [], odd: [] }) { |n, h| n.even? ? h[:even] << n : h[:odd] << n }',
    hints: [
      'Initialize the hash structure with both keys',
      'Use ternary operator or if/else in block',
      'Append to the appropriate array based on condition',
    ],
    validPatterns: [/numbers\.each_with_object\s*\(\s*\{\s*even:.*odd:.*\}\s*\)\s*\{/],
    tags: ['each_with_object', 'grouping', 'conditional'],
  },

  // tally and group_by combinations (3 problems: 1 easy, 2 medium)
  {
    id: 'ruby-enum-tally-basic-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Count Element Frequency with tally',
    text: 'Use `tally` to count occurrences of each fruit.',
    setup: 'fruits = ["apple", "banana", "apple", "cherry", "banana", "apple"]',
    setupCode: 'fruits = ["apple", "banana", "apple", "cherry", "banana", "apple"]',
    expected: { apple: 3, banana: 2, cherry: 1 },
    sample: 'fruits.tally',
    hints: [
      'tally returns a hash of element counts',
      'Each unique element becomes a key',
      'Value is the count of occurrences',
    ],
    validPatterns: [/fruits\.tally\b/],
    tags: ['tally', 'count', 'frequency'],
  },
  {
    id: 'ruby-enum-tally-transform-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Tally First Letters',
    text: 'Count words by their first letter using `map` and `tally`.',
    setup: 'words = ["apple", "ant", "bear", "banana", "cat"]',
    setupCode: 'words = ["apple", "ant", "bear", "banana", "cat"]',
    expected: { a: 2, b: 2, c: 1 },
    sample: 'words.map { |w| w[0] }.tally',
    hints: [
      'First transform elements with map',
      'Then tally the transformed values',
      'Chain map and tally together',
    ],
    validPatterns: [/words\.map\s*\{.*\[0\].*\}\.tally/, /words\.map\s*\(\s*&:chr\s*\)\.tally/],
    tags: ['tally', 'map', 'transform'],
  },
  {
    id: 'ruby-enum-group-tally-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Group by Length and Count',
    text: 'Use `group_by` and `transform_values` to count words by length.',
    setup: 'words = ["a", "bb", "ccc", "dd", "eee", "f"]',
    setupCode: 'words = ["a", "bb", "ccc", "dd", "eee", "f"]',
    expected: { 1: 2, 2: 2, 3: 2 },
    sample: 'words.group_by(&:length).transform_values(&:count)',
    hints: [
      'First group words by their length',
      'Then transform each group to its count',
      'Alternative: words.map(&:length).tally',
    ],
    validPatterns: [
      /words\.group_by\s*\(\s*&:length\s*\)\.transform_values\s*\(\s*&:count\s*\)/,
      /words\.group_by\s*\{.*\.length.*\}\.transform_values\s*\{.*\.(count|size|length).*\}/,
      /words\.map\s*\(\s*&:length\s*\)\.tally/,
    ],
    tags: ['group_by', 'transform_values', 'tally'],
  },

  // chunk and chunk_while (4 problems: 2 medium, 2 hard)
  {
    id: 'ruby-enum-chunk-even-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Chunk Consecutive Even/Odd Numbers',
    text: 'Use `chunk` to group consecutive numbers by whether they are even.',
    setup: 'numbers = [1, 3, 2, 4, 5, 7, 6, 8]',
    setupCode: 'numbers = [1, 3, 2, 4, 5, 7, 6, 8]',
    expected: [
      [false, [1, 3]],
      [true, [2, 4]],
      [false, [5, 7]],
      [true, [6, 8]],
    ],
    sample: 'numbers.chunk { |n| n.even? }.to_a',
    hints: [
      'chunk groups consecutive elements with same block value',
      'Returns an Enumerator of [key, array] pairs',
      'Unlike group_by, maintains consecutive runs',
    ],
    validPatterns: [
      /numbers\.chunk\s*\{\s*\|(\w+)\|\s*\1\.even\?\s*\}\.to_a/,
      /numbers\.chunk\s*\(\s*&:even\?\s*\)\.to_a/,
    ],
    tags: ['chunk', 'consecutive', 'grouping'],
  },
  {
    id: 'ruby-enum-chunk-sign-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Chunk by Number Sign',
    text: 'Use `chunk` to group consecutive numbers by positive/negative.',
    setup: 'numbers = [1, 2, -1, -3, 4, 5, -2]',
    setupCode: 'numbers = [1, 2, -1, -3, 4, 5, -2]',
    expected: [
      [true, [1, 2]],
      [false, [-1, -3]],
      [true, [4, 5]],
      [false, [-2]],
    ],
    sample: 'numbers.chunk { |n| n > 0 }.to_a',
    hints: [
      'chunk creates runs of elements with same block result',
      'Positive numbers return true, negative return false',
      'New chunk starts when block result changes',
    ],
    validPatterns: [
      /numbers\.chunk\s*\{\s*\|(\w+)\|\s*\1\s*>\s*0\s*\}\.to_a/,
      /numbers\.chunk\s*\(\s*&:positive\?\s*\)\.to_a/,
    ],
    tags: ['chunk', 'sign', 'positive', 'negative'],
  },
  {
    id: 'ruby-enum-chunk-while-ascending-1',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Chunk While Ascending',
    text: 'Use `chunk_while` to split into ascending runs.',
    setup: 'numbers = [1, 2, 4, 3, 5, 6, 2, 8]',
    setupCode: 'numbers = [1, 2, 4, 3, 5, 6, 2, 8]',
    expected: [
      [1, 2, 4],
      [3, 5, 6],
      [2, 8],
    ],
    sample: 'numbers.chunk_while { |a, b| a < b }.to_a',
    hints: [
      'chunk_while continues a chunk while block returns true',
      'Block receives consecutive pairs of elements',
      'New chunk starts when condition becomes false',
    ],
    validPatterns: [/numbers\.chunk_while\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*<\s*\2\s*\}\.to_a/],
    tags: ['chunk_while', 'ascending', 'consecutive'],
  },
  {
    id: 'ruby-enum-chunk-while-close-1',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Chunk While Numbers Close Together',
    text: 'Use `chunk_while` to group numbers differing by at most 2.',
    setup: 'numbers = [1, 2, 4, 9, 10, 11, 15, 16, 19]',
    setupCode: 'numbers = [1, 2, 4, 9, 10, 11, 15, 16, 19]',
    expected: [[1, 2, 4], [9, 10, 11], [15, 16], [19]],
    sample: 'numbers.chunk_while { |a, b| (b - a).abs <= 2 }.to_a',
    hints: [
      'Compare difference between consecutive elements',
      'Use abs for absolute difference',
      'Chunk continues while difference is small',
    ],
    validPatterns: [
      /numbers\.chunk_while\s*\{\s*\|(\w+),\s*(\w+)\|.*<=\s*2.*\}\.to_a/,
      /numbers\.chunk_while\s*\{\s*\|(\w+),\s*(\w+)\|\s*\2\s*-\s*\1\s*<=\s*2\s*\}\.to_a/,
    ],
    tags: ['chunk_while', 'difference', 'proximity'],
  },

  // slice_before, slice_after, slice_when (4 problems: 2 medium, 2 hard)
  {
    id: 'ruby-enum-slice-before-negative-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Slice Before Negative Numbers',
    text: 'Use `slice_before` to start a new slice before each negative number.',
    setup: 'numbers = [1, 2, -1, 3, 4, -2, 5]',
    setupCode: 'numbers = [1, 2, -1, 3, 4, -2, 5]',
    expected: [
      [1, 2],
      [-1, 3, 4],
      [-2, 5],
    ],
    sample: 'numbers.slice_before { |n| n < 0 }.to_a',
    hints: [
      'slice_before starts new slice when block is true',
      'The matching element begins the new slice',
      'Returns an Enumerator of slices',
    ],
    validPatterns: [
      /numbers\.slice_before\s*\{\s*\|(\w+)\|\s*\1\s*<\s*0\s*\}\.to_a/,
      /numbers\.slice_before\s*\(\s*&:negative\?\s*\)\.to_a/,
    ],
    tags: ['slice_before', 'partition', 'negative'],
  },
  {
    id: 'ruby-enum-slice-after-period-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Slice After Periods',
    text: 'Use `slice_after` to split after each word ending with a period.',
    setup: 'words = ["Hello.", "World", "is", "great.", "Ruby", "rocks."]',
    setupCode: 'words = ["Hello.", "World", "is", "great.", "Ruby", "rocks."]',
    expected: [['Hello.'], ['World', 'is', 'great.'], ['Ruby', 'rocks.']],
    sample: 'words.slice_after { |w| w.end_with?(".") }.to_a',
    hints: [
      'slice_after ends current slice when block is true',
      'The matching element ends the current slice',
      'Next element starts a new slice',
    ],
    validPatterns: [
      /words\.slice_after\s*\{\s*\|(\w+)\|\s*\1\.end_with\?\s*\(\s*["']\.["']\s*\)\s*\}\.to_a/,
      /words\.slice_after\s*\(\s*\/\\.\$\/\s*\)\.to_a/,
    ],
    tags: ['slice_after', 'punctuation', 'sentences'],
  },
  {
    id: 'ruby-enum-slice-when-gap-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Slice When Gap Detected',
    text: 'Use `slice_when` to split when gap > 1 between consecutive numbers.',
    setup: 'numbers = [1, 2, 3, 6, 7, 10, 11, 12]',
    setupCode: 'numbers = [1, 2, 3, 6, 7, 10, 11, 12]',
    expected: [
      [1, 2, 3],
      [6, 7],
      [10, 11, 12],
    ],
    sample: 'numbers.slice_when { |a, b| b - a > 1 }.to_a',
    hints: [
      'slice_when splits when block returns true',
      'Block receives consecutive element pairs',
      'Split occurs between a and b when condition met',
    ],
    validPatterns: [
      /numbers\.slice_when\s*\{\s*\|(\w+),\s*(\w+)\|\s*\2\s*-\s*\1\s*>\s*1\s*\}\.to_a/,
    ],
    tags: ['slice_when', 'gap', 'consecutive'],
  },
  {
    id: 'ruby-enum-slice-when-type-1',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Slice When Type Changes',
    text: 'Use `slice_when` to split when element type changes.',
    setup: 'items = [1, 2, "a", "b", "c", 3, 4, "d"]',
    setupCode: 'items = [1, 2, "a", "b", "c", 3, 4, "d"]',
    expected: [[1, 2], ['a', 'b', 'c'], [3, 4], ['d']],
    sample: 'items.slice_when { |a, b| a.class != b.class }.to_a',
    hints: [
      'Compare classes of consecutive elements',
      'Split when types differ',
      'Useful for heterogeneous collections',
    ],
    validPatterns: [
      /items\.slice_when\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\.class\s*!=\s*\2\.class\s*\}\.to_a/,
    ],
    tags: ['slice_when', 'type', 'class'],
  },

  // minmax and minmax_by (2 problems: 1 easy, 1 medium)
  {
    id: 'ruby-enum-minmax-by-length-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Find Shortest and Longest Word',
    text: 'Use `minmax_by` to find the shortest and longest word.',
    setup: 'words = ["cat", "elephant", "dog", "hippopotamus", "ant"]',
    setupCode: 'words = ["cat", "elephant", "dog", "hippopotamus", "ant"]',
    expected: ['cat', 'hippopotamus'],
    sample: 'words.minmax_by { |w| w.length }',
    hints: [
      'minmax_by returns [min, max] based on block value',
      'More efficient than separate min_by and max_by',
      'Block determines the comparison criteria',
    ],
    validPatterns: [
      /words\.minmax_by\s*\{\s*\|(\w+)\|\s*\1\.length\s*\}/,
      /words\.minmax_by\s*\(\s*&:length\s*\)/,
      /words\.minmax_by\s*\(\s*&:size\s*\)/,
    ],
    tags: ['minmax_by', 'length', 'extremes'],
  },
  {
    id: 'ruby-enum-minmax-by-abs-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Find Min and Max by Absolute Value',
    text: 'Use `minmax_by` to find numbers with smallest and largest absolute values.',
    setup: 'numbers = [-10, 3, -2, 8, -1, 5]',
    setupCode: 'numbers = [-10, 3, -2, 8, -1, 5]',
    expected: [-1, -10],
    sample: 'numbers.minmax_by { |n| n.abs }',
    hints: [
      'Use abs to compare by magnitude only',
      'Returns the actual elements, not transformed values',
      'Smallest absolute value comes first',
    ],
    validPatterns: [
      /numbers\.minmax_by\s*\{\s*\|(\w+)\|\s*\1\.abs\s*\}/,
      /numbers\.minmax_by\s*\(\s*&:abs\s*\)/,
    ],
    tags: ['minmax_by', 'abs', 'magnitude'],
  },

  // cycle and take patterns (2 problems: 1 easy, 1 medium)
  {
    id: 'ruby-enum-cycle-take-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Cycle and Take Elements',
    text: 'Use `cycle` with `take` to repeat elements and get first 8.',
    setup: 'colors = ["red", "green", "blue"]',
    setupCode: 'colors = ["red", "green", "blue"]',
    expected: ['red', 'green', 'blue', 'red', 'green', 'blue', 'red', 'green'],
    sample: 'colors.cycle.take(8)',
    hints: [
      'cycle creates an infinite enumerator',
      'Use take to limit the result',
      'Elements repeat in order indefinitely',
    ],
    validPatterns: [
      /colors\.cycle\.take\s*\(\s*8\s*\)/,
      /colors\.cycle\s*\(\s*\)\.take\s*\(\s*8\s*\)/,
    ],
    tags: ['cycle', 'take', 'infinite'],
  },
  {
    id: 'ruby-enum-cycle-finite-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Cycle Fixed Number of Times',
    text: 'Use `cycle(n)` to repeat the array exactly 3 times.',
    setup: 'items = [1, 2]',
    setupCode: 'items = [1, 2]',
    expected: [1, 2, 1, 2, 1, 2],
    sample: 'items.cycle(3).to_a',
    hints: [
      'cycle(n) repeats exactly n times then stops',
      'Returns an Enumerator',
      'Use to_a to convert to array',
    ],
    validPatterns: [/items\.cycle\s*\(\s*3\s*\)\.to_a/],
    tags: ['cycle', 'repeat', 'finite'],
  },

  // Enumerator::Lazy (5 problems: 2 medium, 3 hard)
  {
    id: 'ruby-enum-lazy-select-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Lazy Select from Infinite Range',
    text: 'Use `lazy` to find first 5 numbers divisible by 7.',
    setup: 'range = 1..Float::INFINITY',
    setupCode: 'range = 1..Float::INFINITY',
    expected: [7, 14, 21, 28, 35],
    sample: 'range.lazy.select { |n| n % 7 == 0 }.take(5).to_a',
    hints: [
      'lazy creates a lazy enumerator',
      'Operations are deferred until needed',
      'Prevents evaluating the entire infinite range',
    ],
    validPatterns: [
      /range\.lazy\.select\s*\{\s*\|(\w+)\|\s*\1\s*%\s*7\s*==\s*0\s*\}\.take\s*\(\s*5\s*\)\.to_a/,
    ],
    tags: ['lazy', 'infinite', 'select'],
  },
  {
    id: 'ruby-enum-lazy-map-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Lazy Map and Take',
    text: 'Use `lazy` to get first 6 squares from infinite range.',
    setup: 'range = 1..Float::INFINITY',
    setupCode: 'range = 1..Float::INFINITY',
    expected: [1, 4, 9, 16, 25, 36],
    sample: 'range.lazy.map { |n| n ** 2 }.take(6).to_a',
    hints: [
      'lazy.map transforms elements lazily',
      'Only computes as many as needed',
      'Use take to limit results',
    ],
    validPatterns: [
      /range\.lazy\.map\s*\{\s*\|(\w+)\|\s*\1\s*\*\*\s*2\s*\}\.take\s*\(\s*6\s*\)\.to_a/,
      /range\.lazy\.map\s*\{\s*\|(\w+)\|\s*\1\s*\*\s*\1\s*\}\.take\s*\(\s*6\s*\)\.to_a/,
    ],
    tags: ['lazy', 'map', 'squares'],
  },
  {
    id: 'ruby-enum-lazy-chain-1',
    category: 'Enumerable Methods',
    difficulty: 'medium',
    title: 'Lazy Chain: Filter and Transform',
    text: 'Use `lazy` to find first 4 squares of even numbers.',
    setup: 'range = 1..Float::INFINITY',
    setupCode: 'range = 1..Float::INFINITY',
    expected: [4, 16, 36, 64],
    sample: 'range.lazy.select(&:even?).map { |n| n ** 2 }.take(4).to_a',
    hints: [
      'Chain lazy operations: select, map, take',
      'Each operation stays lazy until to_a',
      'Processes only as many elements as needed',
    ],
    validPatterns: [
      /range\.lazy\.select.*\.map\s*\{.*\*\*\s*2.*\}\.take\s*\(\s*4\s*\)\.to_a/,
      /range\.lazy\.select\s*\(\s*&:even\?\s*\)\.map\s*\{.*\}\.take/,
    ],
    tags: ['lazy', 'chain', 'transform'],
  },
  {
    id: 'ruby-enum-lazy-flatmap-1',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Lazy flat_map from Infinite Range',
    text: 'Use `lazy.flat_map` to generate first 6 pairs [n, n*2].',
    setup: 'range = 1..Float::INFINITY',
    setupCode: 'range = 1..Float::INFINITY',
    expected: [1, 2, 2, 4, 3, 6],
    sample: 'range.lazy.flat_map { |n| [n, n * 2] }.take(6).to_a',
    hints: [
      'flat_map flattens one level of nesting',
      'Each number produces a pair that gets flattened',
      'Lazy prevents infinite loop',
    ],
    validPatterns: [
      /range\.lazy\.flat_map\s*\{\s*\|(\w+)\|\s*\[\s*\1,\s*\1\s*\*\s*2\s*\]\s*\}\.take\s*\(\s*6\s*\)\.to_a/,
    ],
    tags: ['lazy', 'flat_map', 'infinite'],
  },
  {
    id: 'ruby-enum-lazy-force-1',
    category: 'Enumerable Methods',
    difficulty: 'hard',
    title: 'Lazy with Force Evaluation',
    text: 'Use `lazy` with `force` to get first 5 Fibonacci-like sums.',
    setup: 'fibs = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55]',
    setupCode: 'fibs = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55]',
    expected: [2, 3, 5, 8, 13],
    sample: 'fibs.lazy.each_cons(2).map { |a, b| a + b }.take(5).force',
    hints: [
      'force is an alias for to_a on lazy enumerators',
      'each_cons(2) yields consecutive pairs',
      'Triggers evaluation of the lazy chain',
    ],
    validPatterns: [
      /fibs\.lazy\.each_cons\s*\(\s*2\s*\)\.map\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\+\s*\2\s*\}\.take\s*\(\s*5\s*\)\.force/,
      /fibs\.lazy\.each_cons\s*\(\s*2\s*\)\.map\s*\{\s*\|(\w+),\s*(\w+)\|\s*\1\s*\+\s*\2\s*\}\.take\s*\(\s*5\s*\)\.to_a/,
    ],
    tags: ['lazy', 'force', 'each_cons'],
  },

  // Additional Enumerable patterns (2 more to reach 25 total)
  {
    id: 'ruby-enum-each-cons-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Consecutive Pairs with each_cons',
    text: 'Use `each_cons` to get all consecutive pairs of elements.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [
      [1, 2],
      [2, 3],
      [3, 4],
      [4, 5],
    ],
    sample: 'numbers.each_cons(2).to_a',
    hints: [
      'each_cons(n) yields overlapping slices of n elements',
      'Each slice shares n-1 elements with the next',
      'Returns an Enumerator, use to_a to collect',
    ],
    validPatterns: [/numbers\.each_cons\s*\(\s*2\s*\)\.to_a/],
    tags: ['each_cons', 'consecutive', 'sliding_window'],
  },
  {
    id: 'ruby-enum-each-slice-batch-1',
    category: 'Enumerable Methods',
    difficulty: 'easy',
    title: 'Batch Processing with each_slice',
    text: 'Use `each_slice` to split numbers into groups of 3.',
    setup: 'numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]',
    setupCode: 'numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]',
    expected: [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]],
    sample: 'numbers.each_slice(3).to_a',
    hints: [
      'each_slice(n) yields non-overlapping slices of n elements',
      'Last slice may have fewer than n elements',
      'Useful for batch processing',
    ],
    validPatterns: [/numbers\.each_slice\s*\(\s*3\s*\)\.to_a/],
    tags: ['each_slice', 'batch', 'chunking'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 1: Array Methods (50 problems)
  // ============================================================

  {
    id: 'ruby-arr-200',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Map with Index Starting at 1',
    text: 'Use `map.with_index(1)` to number each element starting from 1.',
    setup: 'items = ["a", "b", "c"]',
    setupCode: 'items = ["a", "b", "c"]',
    expected: ['1: a', '2: b', '3: c'],
    sample: 'items.map.with_index(1) { |item, i| "#{i}: #{item}" }',
    hints: ['with_index accepts a starting offset', 'Default offset is 0'],
    tags: ['map', 'with_index', 'numbering'],
  },
  {
    id: 'ruby-arr-201',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Flatten One Level Only',
    text: 'Use `flatten(1)` to flatten only the first level of nesting.',
    setup: 'nested = [[1, [2]], [3, [4]]]',
    setupCode: 'nested = [[1, [2]], [3, [4]]]',
    expected: [1, [2], 3, [4]],
    sample: 'nested.flatten(1)',
    hints: ['flatten accepts a depth argument', 'flatten(1) only removes one level'],
    tags: ['flatten', 'depth', 'nested'],
  },
  {
    id: 'ruby-arr-202',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Compact Map in One Step',
    text: 'Use `filter_map` to transform and remove nils in one step.',
    setup: 'numbers = [1, 2, nil, 3, nil, 4]',
    setupCode: 'numbers = [1, 2, nil, 3, nil, 4]',
    expected: [2, 4, 6, 8],
    sample: 'numbers.filter_map { |n| n * 2 if n }',
    hints: ['filter_map combines select and map', 'Returns non-nil block results'],
    tags: ['filter_map', 'compact', 'transform'],
  },
  {
    id: 'ruby-arr-203',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Find Index of Element',
    text: 'Use `index` to find the position of "ruby" in the array.',
    setup: 'langs = ["python", "ruby", "javascript"]',
    setupCode: 'langs = ["python", "ruby", "javascript"]',
    expected: 1,
    sample: 'langs.index("ruby")',
    hints: ['index returns position of first match', 'Returns nil if not found'],
    tags: ['index', 'find', 'position'],
  },
  {
    id: 'ruby-arr-204',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Find Index with Block',
    text: 'Use `index` with a block to find first number greater than 5.',
    setup: 'numbers = [2, 4, 6, 8, 10]',
    setupCode: 'numbers = [2, 4, 6, 8, 10]',
    expected: 2,
    sample: 'numbers.index { |n| n > 5 }',
    hints: ['index accepts a block for custom matching', 'Returns index of first match'],
    tags: ['index', 'block', 'find'],
  },
  {
    id: 'ruby-arr-205',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Reverse Array',
    text: 'Use `reverse` to reverse the order of elements.',
    setup: 'letters = ["a", "b", "c", "d"]',
    setupCode: 'letters = ["a", "b", "c", "d"]',
    expected: ['d', 'c', 'b', 'a'],
    sample: 'letters.reverse',
    hints: ['reverse returns a new reversed array', 'Original array unchanged'],
    tags: ['reverse', 'order'],
  },
  {
    id: 'ruby-arr-206',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Sample Random Element',
    text: 'Use `sample` to get a random element (use seed for consistent result).',
    setup: 'colors = ["red", "green", "blue"]',
    setupCode: 'colors = ["red", "green", "blue"]',
    expected: 'green',
    sample: 'colors.sample(random: Random.new(1))',
    hints: ['sample returns random element', 'Use Random seed for reproducibility'],
    tags: ['sample', 'random'],
  },
  {
    id: 'ruby-arr-207',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Sample Multiple Elements',
    text: 'Use `sample(2)` to get 2 random elements.',
    setup: 'nums = [1, 2, 3, 4, 5]',
    setupCode: 'nums = [1, 2, 3, 4, 5]',
    expected: [2, 1],
    sample: 'nums.sample(2, random: Random.new(1))',
    hints: ['sample(n) returns n random elements', 'No duplicates in result'],
    tags: ['sample', 'multiple', 'random'],
  },
  {
    id: 'ruby-arr-208',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Shuffle Array',
    text: 'Use `shuffle` to randomize array order.',
    setup: 'cards = [1, 2, 3, 4]',
    setupCode: 'cards = [1, 2, 3, 4]',
    expected: [2, 1, 4, 3],
    sample: 'cards.shuffle(random: Random.new(1))',
    hints: ['shuffle randomizes element order', 'Use Random seed for testing'],
    tags: ['shuffle', 'random', 'order'],
  },
  {
    id: 'ruby-arr-209',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Intersection of Arrays',
    text: 'Use `&` to find common elements between two arrays.',
    setup: 'a = [1, 2, 3, 4]\nb = [3, 4, 5, 6]',
    setupCode: 'a = [1, 2, 3, 4]\nb = [3, 4, 5, 6]',
    expected: [3, 4],
    sample: 'a & b',
    hints: ['& returns elements common to both', 'Also called intersection'],
    tags: ['intersection', 'set', 'common'],
  },
  {
    id: 'ruby-arr-210',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Union of Arrays',
    text: 'Use `|` to combine arrays without duplicates.',
    setup: 'a = [1, 2, 3]\nb = [2, 3, 4]',
    setupCode: 'a = [1, 2, 3]\nb = [2, 3, 4]',
    expected: [1, 2, 3, 4],
    sample: 'a | b',
    hints: ['| returns all unique elements', 'Also called union'],
    tags: ['union', 'set', 'unique'],
  },
  {
    id: 'ruby-arr-211',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Difference of Arrays',
    text: 'Use `-` to find elements in first array but not in second.',
    setup: 'a = [1, 2, 3, 4, 5]\nb = [2, 4]',
    setupCode: 'a = [1, 2, 3, 4, 5]\nb = [2, 4]',
    expected: [1, 3, 5],
    sample: 'a - b',
    hints: ['- removes elements found in second array', 'Also called difference'],
    tags: ['difference', 'set', 'subtract'],
  },
  {
    id: 'ruby-arr-212',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Product of Arrays',
    text: 'Use `product` to get all combinations of elements.',
    setup: 'sizes = ["S", "M"]\ncolors = ["red", "blue"]',
    setupCode: 'sizes = ["S", "M"]\ncolors = ["red", "blue"]',
    expected: [
      ['S', 'red'],
      ['S', 'blue'],
      ['M', 'red'],
      ['M', 'blue'],
    ],
    sample: 'sizes.product(colors)',
    hints: ['product creates Cartesian product', 'All possible pairs'],
    tags: ['product', 'combinations', 'cartesian'],
  },
  {
    id: 'ruby-arr-213',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Permutations of Array',
    text: 'Use `permutation(2)` to get all 2-element permutations.',
    setup: 'letters = ["a", "b", "c"]',
    setupCode: 'letters = ["a", "b", "c"]',
    expected: [
      ['a', 'b'],
      ['a', 'c'],
      ['b', 'a'],
      ['b', 'c'],
      ['c', 'a'],
      ['c', 'b'],
    ],
    sample: 'letters.permutation(2).to_a',
    hints: ['permutation generates ordered arrangements', 'Order matters in permutations'],
    tags: ['permutation', 'combinations'],
  },
  {
    id: 'ruby-arr-214',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Combinations of Array',
    text: 'Use `combination(2)` to get all 2-element combinations.',
    setup: 'letters = ["a", "b", "c"]',
    setupCode: 'letters = ["a", "b", "c"]',
    expected: [
      ['a', 'b'],
      ['a', 'c'],
      ['b', 'c'],
    ],
    sample: 'letters.combination(2).to_a',
    hints: ['combination generates unordered selections', 'Order does not matter'],
    tags: ['combination', 'subsets'],
  },
  {
    id: 'ruby-arr-215',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Repeated Combination',
    text: 'Use `repeated_combination(2)` to include same-element pairs.',
    setup: 'nums = [1, 2]',
    setupCode: 'nums = [1, 2]',
    expected: [
      [1, 1],
      [1, 2],
      [2, 2],
    ],
    sample: 'nums.repeated_combination(2).to_a',
    hints: ['repeated_combination allows duplicates', 'Elements can repeat'],
    tags: ['repeated_combination', 'combinations'],
  },
  {
    id: 'ruby-arr-216',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Fill Array with Value',
    text: 'Use `fill` to replace all elements with a single value.',
    setup: 'arr = [1, 2, 3, 4]',
    setupCode: 'arr = [1, 2, 3, 4]',
    expected: [0, 0, 0, 0],
    sample: 'arr.fill(0)',
    hints: ['fill replaces all elements', 'Modifies array in place'],
    tags: ['fill', 'replace'],
  },
  {
    id: 'ruby-arr-217',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Fill Range with Value',
    text: 'Use `fill` with range to replace elements at positions 1-2.',
    setup: 'arr = [1, 2, 3, 4]',
    setupCode: 'arr = [1, 2, 3, 4]',
    expected: [1, 0, 0, 4],
    sample: 'arr.fill(0, 1..2)',
    hints: ['fill accepts a range', 'Only fills specified positions'],
    tags: ['fill', 'range', 'replace'],
  },
  {
    id: 'ruby-arr-218',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Check Array Empty',
    text: 'Use `empty?` to check if array has no elements.',
    setup: 'arr = []',
    setupCode: 'arr = []',
    expected: true,
    sample: 'arr.empty?',
    hints: ['empty? returns true for empty arrays', 'Opposite of any?'],
    tags: ['empty?', 'predicate'],
  },
  {
    id: 'ruby-arr-219',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Get Array Length',
    text: 'Use `length` to get the number of elements.',
    setup: 'items = ["a", "b", "c", "d", "e"]',
    setupCode: 'items = ["a", "b", "c", "d", "e"]',
    expected: 5,
    sample: 'items.length',
    hints: ['length and size are aliases', 'count also works'],
    tags: ['length', 'size', 'count'],
  },
  {
    id: 'ruby-arr-220',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Flatten and Compact',
    text: 'Use `flatten` then `compact` to flatten and remove nils.',
    setup: 'data = [[1, nil], [2, [nil, 3]]]',
    setupCode: 'data = [[1, nil], [2, [nil, 3]]]',
    expected: [1, 2, 3],
    sample: 'data.flatten.compact',
    hints: ['Chain flatten and compact', 'Order matters'],
    tags: ['flatten', 'compact', 'chain'],
  },
  {
    id: 'ruby-arr-221',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Select with Index',
    text: 'Use `select.with_index` to get elements at even indices.',
    setup: 'letters = ["a", "b", "c", "d", "e"]',
    setupCode: 'letters = ["a", "b", "c", "d", "e"]',
    expected: ['a', 'c', 'e'],
    sample: 'letters.select.with_index { |_, i| i.even? }',
    hints: ['Chain with_index after select', 'Use _ for unused variable'],
    tags: ['select', 'with_index', 'filter'],
  },
  {
    id: 'ruby-arr-222',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Reject Duplicates Keep First',
    text: 'Use `uniq` with block to keep first occurrence by length.',
    setup: 'words = ["cat", "dog", "bird", "rat"]',
    setupCode: 'words = ["cat", "dog", "bird", "rat"]',
    expected: ['cat', 'bird'],
    sample: 'words.uniq { |w| w.length }',
    hints: ['uniq with block uses block result for comparison', 'Keeps first of each group'],
    tags: ['uniq', 'block', 'dedupe'],
  },
  {
    id: 'ruby-arr-223',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Count Specific Element',
    text: 'Use `count` to count occurrences of 2.',
    setup: 'numbers = [1, 2, 2, 3, 2, 4]',
    setupCode: 'numbers = [1, 2, 2, 3, 2, 4]',
    expected: 3,
    sample: 'numbers.count(2)',
    hints: ['count with argument counts specific value', 'Returns number of matches'],
    tags: ['count', 'occurrences'],
  },
  {
    id: 'ruby-arr-224',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Dig into Nested Array',
    text: 'Use `dig` to safely access nested array element.',
    setup: 'matrix = [[1, 2], [3, [4, 5]]]',
    setupCode: 'matrix = [[1, 2], [3, [4, 5]]]',
    expected: 5,
    sample: 'matrix.dig(1, 1, 1)',
    hints: ['dig navigates nested structures', 'Returns nil if path invalid'],
    tags: ['dig', 'nested', 'safe'],
  },
  {
    id: 'ruby-arr-225',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Fetch with Default',
    text: 'Use `fetch` to get element with default for missing index.',
    setup: 'arr = [10, 20, 30]',
    setupCode: 'arr = [10, 20, 30]',
    expected: 'not found',
    sample: 'arr.fetch(5, "not found")',
    hints: ['fetch with default returns default for invalid index', 'Safer than [] access'],
    tags: ['fetch', 'default', 'safe'],
  },
  {
    id: 'ruby-arr-226',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Values at Multiple Indices',
    text: 'Use `values_at` to get elements at indices 0, 2, and 4.',
    setup: 'letters = ["a", "b", "c", "d", "e"]',
    setupCode: 'letters = ["a", "b", "c", "d", "e"]',
    expected: ['a', 'c', 'e'],
    sample: 'letters.values_at(0, 2, 4)',
    hints: ['values_at accepts multiple indices', 'Returns array of values'],
    tags: ['values_at', 'multiple', 'access'],
  },
  {
    id: 'ruby-arr-227',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Assoc for Nested Array Lookup',
    text: 'Use `assoc` to find sub-array starting with key.',
    setup: 'data = [["name", "Alice"], ["age", 30], ["city", "NYC"]]',
    setupCode: 'data = [["name", "Alice"], ["age", 30], ["city", "NYC"]]',
    expected: ['age', 30],
    sample: 'data.assoc("age")',
    hints: ['assoc finds array where first element matches', 'Returns nil if not found'],
    tags: ['assoc', 'lookup', 'nested'],
  },
  {
    id: 'ruby-arr-228',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Rassoc for Value Lookup',
    text: 'Use `rassoc` to find sub-array containing value.',
    setup: 'pairs = [["a", 1], ["b", 2], ["c", 3]]',
    setupCode: 'pairs = [["a", 1], ["b", 2], ["c", 3]]',
    expected: ['b', 2],
    sample: 'pairs.rassoc(2)',
    hints: ['rassoc searches by second element', 'Opposite of assoc'],
    tags: ['rassoc', 'lookup', 'reverse'],
  },
  {
    id: 'ruby-arr-229',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Convert to Hash with to_h',
    text: 'Use `to_h` to convert array of pairs to hash.',
    setup: 'pairs = [[:a, 1], [:b, 2], [:c, 3]]',
    setupCode: 'pairs = [[:a, 1], [:b, 2], [:c, 3]]',
    expected: { a: 1, b: 2, c: 3 },
    sample: 'pairs.to_h',
    hints: ['to_h converts [key, value] pairs', 'Works on arrays of 2-element arrays'],
    tags: ['to_h', 'hash', 'convert'],
  },
  {
    id: 'ruby-arr-230',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'To Hash with Block',
    text: 'Use `to_h` with block to create hash from single values.',
    setup: 'words = ["cat", "dog", "bird"]',
    setupCode: 'words = ["cat", "dog", "bird"]',
    expected: { cat: 3, dog: 3, bird: 4 },
    sample: 'words.to_h { |w| [w.to_sym, w.length] }',
    hints: ['to_h block should return [key, value] pair', 'Transform elements to pairs'],
    tags: ['to_h', 'block', 'transform'],
  },
  {
    id: 'ruby-arr-231',
    category: 'Array Methods',
    difficulty: 'hard',
    title: 'Bsearch for Binary Search',
    text: 'Use `bsearch` to find first number >= 5 in sorted array.',
    setup: 'sorted = [1, 2, 4, 7, 9, 12]',
    setupCode: 'sorted = [1, 2, 4, 7, 9, 12]',
    expected: 7,
    sample: 'sorted.bsearch { |n| n >= 5 }',
    hints: ['bsearch uses binary search on sorted arrays', 'Much faster for large arrays'],
    tags: ['bsearch', 'binary', 'search'],
  },
  {
    id: 'ruby-arr-232',
    category: 'Array Methods',
    difficulty: 'hard',
    title: 'Bsearch Index',
    text: 'Use `bsearch_index` to find index of first number > 10.',
    setup: 'sorted = [2, 5, 8, 12, 15, 20]',
    setupCode: 'sorted = [2, 5, 8, 12, 15, 20]',
    expected: 3,
    sample: 'sorted.bsearch_index { |n| n > 10 }',
    hints: ['bsearch_index returns position', 'Requires sorted array'],
    tags: ['bsearch_index', 'binary', 'index'],
  },
  {
    id: 'ruby-arr-233',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Pack Array to Binary',
    text: 'Use `pack` to convert integers to bytes.',
    setup: 'bytes = [65, 66, 67]',
    setupCode: 'bytes = [65, 66, 67]',
    expected: 'ABC',
    sample: 'bytes.pack("C*")',
    hints: ['pack converts to binary format', 'C* packs as unsigned chars'],
    tags: ['pack', 'binary', 'convert'],
  },
  {
    id: 'ruby-arr-234',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Sum with Initial Value',
    text: 'Use `sum` with initial value to concatenate strings.',
    setup: 'words = ["Hello", " ", "World"]',
    setupCode: 'words = ["Hello", " ", "World"]',
    expected: 'Say: Hello World',
    sample: 'words.sum("Say: ")',
    hints: ['sum with string initial concatenates', 'Initial value determines type'],
    tags: ['sum', 'concatenate', 'initial'],
  },
  {
    id: 'ruby-arr-235',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Min with Block',
    text: 'Use `min` with block to find shortest word.',
    setup: 'words = ["elephant", "cat", "dog"]',
    setupCode: 'words = ["elephant", "cat", "dog"]',
    expected: 'cat',
    sample: 'words.min { |a, b| a.length <=> b.length }',
    hints: ['min with block for custom comparison', 'Use spaceship operator'],
    tags: ['min', 'block', 'comparison'],
  },
  {
    id: 'ruby-arr-236',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Min By Length',
    text: 'Use `min_by` to find word with shortest length.',
    setup: 'words = ["ruby", "go", "python"]',
    setupCode: 'words = ["ruby", "go", "python"]',
    expected: 'go',
    sample: 'words.min_by { |w| w.length }',
    hints: ['min_by uses block value for comparison', 'Simpler than min with block'],
    tags: ['min_by', 'length', 'shortest'],
  },
  {
    id: 'ruby-arr-237',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Max By Length',
    text: 'Use `max_by` to find longest word.',
    setup: 'words = ["cat", "elephant", "dog"]',
    setupCode: 'words = ["cat", "elephant", "dog"]',
    expected: 'elephant',
    sample: 'words.max_by { |w| w.length }',
    hints: ['max_by uses block value for comparison', 'Returns element not block value'],
    tags: ['max_by', 'length', 'longest'],
  },
  {
    id: 'ruby-arr-238',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Take While Condition',
    text: 'Use `take_while` to take elements while less than 5.',
    setup: 'numbers = [1, 3, 5, 2, 4]',
    setupCode: 'numbers = [1, 3, 5, 2, 4]',
    expected: [1, 3],
    sample: 'numbers.take_while { |n| n < 5 }',
    hints: ['take_while stops at first false', 'Different from select'],
    tags: ['take_while', 'conditional', 'prefix'],
  },
  {
    id: 'ruby-arr-239',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Drop While Condition',
    text: 'Use `drop_while` to skip elements while less than 5.',
    setup: 'numbers = [1, 3, 5, 2, 4]',
    setupCode: 'numbers = [1, 3, 5, 2, 4]',
    expected: [5, 2, 4],
    sample: 'numbers.drop_while { |n| n < 5 }',
    hints: ['drop_while skips until first false', 'Keeps rest of array'],
    tags: ['drop_while', 'conditional', 'skip'],
  },
  {
    id: 'ruby-arr-240',
    category: 'Array Methods',
    difficulty: 'hard',
    title: 'Reduce to Hash',
    text: 'Use `reduce` to count character occurrences.',
    setup: 'chars = ["a", "b", "a", "c", "b", "a"]',
    setupCode: 'chars = ["a", "b", "a", "c", "b", "a"]',
    expected: { a: 3, b: 2, c: 1 },
    sample: 'chars.reduce(Hash.new(0)) { |h, c| h[c.to_sym] += 1; h }',
    hints: ['Use Hash.new(0) for default values', 'Return hash from block'],
    tags: ['reduce', 'hash', 'count'],
  },
  {
    id: 'ruby-arr-241',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Flatten Map (flat_map)',
    text: 'Use `flat_map` to expand and flatten in one step.',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: [1, -1, 2, -2, 3, -3],
    sample: 'numbers.flat_map { |n| [n, -n] }',
    hints: ['flat_map combines map and flatten(1)', 'Block returns arrays'],
    tags: ['flat_map', 'expand', 'flatten'],
  },
  {
    id: 'ruby-arr-242',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Prepend Elements',
    text: 'Use `prepend` to add elements to the beginning.',
    setup: 'arr = [3, 4, 5]',
    setupCode: 'arr = [3, 4, 5]',
    expected: [1, 2, 3, 4, 5],
    sample: 'arr.prepend(1, 2)',
    hints: ['prepend adds to front', 'Alias for unshift'],
    tags: ['prepend', 'unshift', 'add'],
  },
  {
    id: 'ruby-arr-243',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Append Multiple Elements',
    text: 'Use `push` to add multiple elements at once.',
    setup: 'arr = [1, 2]',
    setupCode: 'arr = [1, 2]',
    expected: [1, 2, 3, 4, 5],
    sample: 'arr.push(3, 4, 5)',
    hints: ['push accepts multiple arguments', 'Adds all to end'],
    tags: ['push', 'append', 'multiple'],
  },
  {
    id: 'ruby-arr-244',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Insert at Position',
    text: 'Use `insert` to add element at specific index.',
    setup: 'arr = [1, 2, 4, 5]',
    setupCode: 'arr = [1, 2, 4, 5]',
    expected: [1, 2, 3, 4, 5],
    sample: 'arr.insert(2, 3)',
    hints: ['insert(index, value) adds at position', 'Shifts existing elements'],
    tags: ['insert', 'position', 'add'],
  },
  {
    id: 'ruby-arr-245',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Delete at Index',
    text: 'Use `delete_at` to remove element at index 2.',
    setup: 'arr = [1, 2, 3, 4, 5]',
    setupCode: 'arr = [1, 2, 3, 4, 5]',
    expected: 3,
    sample: 'arr.delete_at(2)',
    hints: ['delete_at removes and returns element', 'Modifies original array'],
    tags: ['delete_at', 'remove', 'index'],
  },
  {
    id: 'ruby-arr-246',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Delete by Value',
    text: 'Use `delete` to remove all occurrences of value.',
    setup: 'arr = [1, 2, 3, 2, 4, 2]',
    setupCode: 'arr = [1, 2, 3, 2, 4, 2]',
    expected: 2,
    sample: 'arr.delete(2)',
    hints: ['delete removes all matching elements', 'Returns deleted value'],
    tags: ['delete', 'remove', 'value'],
  },
  {
    id: 'ruby-arr-247',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Delete If Condition',
    text: 'Use `delete_if` to remove all even numbers.',
    setup: 'arr = [1, 2, 3, 4, 5, 6]',
    setupCode: 'arr = [1, 2, 3, 4, 5, 6]',
    expected: [1, 3, 5],
    sample: 'arr.delete_if { |n| n.even? }',
    hints: ['delete_if removes where block true', 'Modifies array in place'],
    tags: ['delete_if', 'filter', 'remove'],
  },
  {
    id: 'ruby-arr-248',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Keep If Condition',
    text: 'Use `keep_if` to keep only positive numbers.',
    setup: 'arr = [-2, -1, 0, 1, 2]',
    setupCode: 'arr = [-2, -1, 0, 1, 2]',
    expected: [1, 2],
    sample: 'arr.keep_if { |n| n > 0 }',
    hints: ['keep_if keeps where block true', 'Opposite of delete_if'],
    tags: ['keep_if', 'filter', 'retain'],
  },
  {
    id: 'ruby-arr-249',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Clear Array',
    text: 'Use `clear` to remove all elements from array.',
    setup: 'arr = [1, 2, 3, 4, 5]',
    setupCode: 'arr = [1, 2, 3, 4, 5]',
    expected: [],
    sample: 'arr.clear',
    hints: ['clear empties the array', 'Returns empty array'],
    tags: ['clear', 'empty', 'remove'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 2: Hash Methods (50 problems)
  // ============================================================

  {
    id: 'ruby-hash-250',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Create Hash with Default Value',
    text: 'Create a hash with default value 0 and access missing key.',
    setup: 'h = Hash.new(0)',
    setupCode: 'h = Hash.new(0)',
    expected: 0,
    sample: 'h[:missing]',
    hints: ['Hash.new(default) sets default for missing keys', 'Useful for counting'],
    tags: ['Hash.new', 'default', 'missing'],
  },
  {
    id: 'ruby-hash-251',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Hash with Default Block',
    text: 'Create hash with default block that auto-creates arrays.',
    setup: 'h = Hash.new { |hash, key| hash[key] = [] }',
    setupCode: 'h = Hash.new { |hash, key| hash[key] = [] }',
    expected: ['item'],
    sample: 'h[:list] << "item"; h[:list]',
    hints: ['Default block can auto-initialize values', 'Block receives hash and key'],
    tags: ['Hash.new', 'block', 'auto-vivification'],
  },
  {
    id: 'ruby-hash-252',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Check Key Existence',
    text: 'Use `key?` to check if hash contains a key.',
    setup: 'person = { name: "Alice", age: 30 }',
    setupCode: 'person = { name: "Alice", age: 30 }',
    expected: true,
    sample: 'person.key?(:name)',
    hints: ['key? returns boolean', 'Also has_key? is an alias'],
    tags: ['key?', 'has_key?', 'exists'],
  },
  {
    id: 'ruby-hash-253',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Check Value Existence',
    text: 'Use `value?` to check if hash contains a value.',
    setup: 'scores = { alice: 90, bob: 85 }',
    setupCode: 'scores = { alice: 90, bob: 85 }',
    expected: true,
    sample: 'scores.value?(90)',
    hints: ['value? searches values', 'Also has_value? is an alias'],
    tags: ['value?', 'has_value?', 'contains'],
  },
  {
    id: 'ruby-hash-254',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Get Key for Value',
    text: 'Use `key` to find the key for a given value.',
    setup: 'codes = { a: 1, b: 2, c: 3 }',
    setupCode: 'codes = { a: 1, b: 2, c: 3 }',
    expected: ':b',
    sample: 'codes.key(2)',
    hints: ['key returns first key with given value', 'Returns nil if not found'],
    tags: ['key', 'reverse', 'lookup'],
  },
  {
    id: 'ruby-hash-255',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Merge with Block',
    text: 'Use `merge` with block to handle duplicate keys by summing.',
    setup: 'a = { x: 1, y: 2 }\nb = { y: 3, z: 4 }',
    setupCode: 'a = { x: 1, y: 2 }\nb = { y: 3, z: 4 }',
    expected: { x: 1, y: 5, z: 4 },
    sample: 'a.merge(b) { |key, v1, v2| v1 + v2 }',
    hints: ['Block handles key conflicts', 'Block receives key, old value, new value'],
    tags: ['merge', 'block', 'conflict'],
  },
  {
    id: 'ruby-hash-256',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Update Hash In Place',
    text: 'Use `merge!` to update hash with another hash.',
    setup: 'config = { debug: false }',
    setupCode: 'config = { debug: false }',
    expected: { debug: true, verbose: true },
    sample: 'config.merge!(debug: true, verbose: true)',
    hints: ['merge! modifies original hash', 'Also called update'],
    tags: ['merge!', 'update', 'mutate'],
  },
  {
    id: 'ruby-hash-257',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Transform Keys to Symbols',
    text: 'Use `transform_keys` to convert string keys to symbols.',
    setup: 'data = { "name" => "Alice", "age" => 30 }',
    setupCode: 'data = { "name" => "Alice", "age" => 30 }',
    expected: { name: 'Alice', age: 30 },
    sample: 'data.transform_keys(&:to_sym)',
    hints: ['transform_keys applies block to keys', 'Values unchanged'],
    tags: ['transform_keys', 'symbols', 'convert'],
  },
  {
    id: 'ruby-hash-258',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Transform Keys with Prefix',
    text: 'Use `transform_keys` to add prefix to all keys.',
    setup: 'data = { name: "Alice", age: 30 }',
    setupCode: 'data = { name: "Alice", age: 30 }',
    expected: { user_name: 'Alice', user_age: 30 },
    sample: 'data.transform_keys { |k| "user_#{k}".to_sym }',
    hints: ['Block can transform keys any way', 'Build new key in block'],
    tags: ['transform_keys', 'prefix', 'rename'],
  },
  {
    id: 'ruby-hash-259',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Transform Values to Strings',
    text: 'Use `transform_values` to convert all values to strings.',
    setup: 'data = { a: 1, b: 2, c: 3 }',
    setupCode: 'data = { a: 1, b: 2, c: 3 }',
    expected: { a: '1', b: '2', c: '3' },
    sample: 'data.transform_values(&:to_s)',
    hints: ['transform_values applies block to values', 'Keys unchanged'],
    tags: ['transform_values', 'to_s', 'convert'],
  },
  {
    id: 'ruby-hash-260',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Select Hash Entries',
    text: 'Use `select` to keep entries where value > 50.',
    setup: 'scores = { alice: 85, bob: 42, carol: 91 }',
    setupCode: 'scores = { alice: 85, bob: 42, carol: 91 }',
    expected: { alice: 85, carol: 91 },
    sample: 'scores.select { |k, v| v > 50 }',
    hints: ['select returns new hash', 'Block receives key and value'],
    tags: ['select', 'filter', 'hash'],
  },
  {
    id: 'ruby-hash-261',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Reject Hash Entries',
    text: 'Use `reject` to remove entries where key starts with underscore.',
    setup: 'data = { name: "Alice", _id: 123, age: 30, _temp: true }',
    setupCode: 'data = { name: "Alice", _id: 123, age: 30, _temp: true }',
    expected: { name: 'Alice', age: 30 },
    sample: 'data.reject { |k, v| k.to_s.start_with?("_") }',
    hints: ['reject removes where block true', 'Convert symbol to string for check'],
    tags: ['reject', 'filter', 'exclude'],
  },
  {
    id: 'ruby-hash-262',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Slice Multiple Keys',
    text: 'Use `slice` to extract multiple keys at once.',
    setup: 'user = { id: 1, name: "Alice", email: "a@b.com", password: "secret" }',
    setupCode: 'user = { id: 1, name: "Alice", email: "a@b.com", password: "secret" }',
    expected: { name: 'Alice', email: 'a@b.com' },
    sample: 'user.slice(:name, :email)',
    hints: ['slice returns hash with only specified keys', 'Useful for whitelisting'],
    tags: ['slice', 'extract', 'whitelist'],
  },
  {
    id: 'ruby-hash-263',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Except Keys',
    text: 'Use `except` to exclude specific keys (Rails/ActiveSupport).',
    setup: 'user = { id: 1, name: "Alice", password: "secret" }',
    setupCode: 'user = { id: 1, name: "Alice", password: "secret" }',
    expected: { id: 1, name: 'Alice' },
    sample: 'user.reject { |k, _| k == :password }',
    hints: ['Pure Ruby: use reject', 'Rails has except method'],
    tags: ['except', 'exclude', 'blacklist'],
  },
  {
    id: 'ruby-hash-264',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Convert Hash to Array',
    text: 'Use `to_a` to convert hash to array of pairs.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: [
      ['a', 1],
      ['b', 2],
      ['c', 3],
    ],
    sample: 'h.to_a',
    hints: ['to_a returns array of [key, value] pairs', 'Preserves insertion order'],
    tags: ['to_a', 'convert', 'array'],
  },
  {
    id: 'ruby-hash-265',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Flatten Hash to Array',
    text: 'Use `flatten` to convert nested pairs to flat array.',
    setup: 'h = { a: 1, b: 2 }',
    setupCode: 'h = { a: 1, b: 2 }',
    expected: ['a', 1, 'b', 2],
    sample: 'h.flatten',
    hints: ['flatten converts to flat array', 'Alternates keys and values'],
    tags: ['flatten', 'array', 'convert'],
  },
  {
    id: 'ruby-hash-266',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Compact Hash',
    text: 'Use `compact` to remove nil values from hash.',
    setup: 'data = { a: 1, b: nil, c: 3, d: nil }',
    setupCode: 'data = { a: 1, b: nil, c: 3, d: nil }',
    expected: { a: 1, c: 3 },
    sample: 'data.compact',
    hints: ['compact removes nil values', 'Keys with nil are removed'],
    tags: ['compact', 'nil', 'clean'],
  },
  {
    id: 'ruby-hash-267',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Delete Key from Hash',
    text: 'Use `delete` to remove a key and get its value.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: 2,
    sample: 'h.delete(:b)',
    hints: ['delete removes key and returns value', 'Returns nil if key missing'],
    tags: ['delete', 'remove', 'key'],
  },
  {
    id: 'ruby-hash-268',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Delete with Default Block',
    text: 'Use `delete` with block for missing key default.',
    setup: 'h = { a: 1, b: 2 }',
    setupCode: 'h = { a: 1, b: 2 }',
    expected: 'not found',
    sample: 'h.delete(:z) { |k| "not found" }',
    hints: ['Block called if key missing', 'Block receives the key'],
    tags: ['delete', 'block', 'default'],
  },
  {
    id: 'ruby-hash-269',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Delete If Condition',
    text: 'Use `delete_if` to remove entries where value is negative.',
    setup: 'h = { a: 1, b: -2, c: 3, d: -4 }',
    setupCode: 'h = { a: 1, b: -2, c: 3, d: -4 }',
    expected: { a: 1, c: 3 },
    sample: 'h.delete_if { |k, v| v < 0 }',
    hints: ['delete_if removes where block true', 'Modifies hash in place'],
    tags: ['delete_if', 'filter', 'remove'],
  },
  {
    id: 'ruby-hash-270',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Keep If Condition',
    text: 'Use `keep_if` to keep only entries with symbol keys.',
    setup: 'h = { :a => 1, "b" => 2, :c => 3 }',
    setupCode: 'h = { :a => 1, "b" => 2, :c => 3 }',
    expected: { a: 1, c: 3 },
    sample: 'h.keep_if { |k, v| k.is_a?(Symbol) }',
    hints: ['keep_if keeps where block true', 'Opposite of delete_if'],
    tags: ['keep_if', 'filter', 'retain'],
  },
  {
    id: 'ruby-hash-271',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Clear Hash',
    text: 'Use `clear` to remove all entries from hash.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: {},
    sample: 'h.clear',
    hints: ['clear empties the hash', 'Returns empty hash'],
    tags: ['clear', 'empty', 'reset'],
  },
  {
    id: 'ruby-hash-272',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Get Hash Size',
    text: 'Use `size` to count number of key-value pairs.',
    setup: 'h = { a: 1, b: 2, c: 3, d: 4 }',
    setupCode: 'h = { a: 1, b: 2, c: 3, d: 4 }',
    expected: 4,
    sample: 'h.size',
    hints: ['size and length are aliases', 'count also works'],
    tags: ['size', 'length', 'count'],
  },
  {
    id: 'ruby-hash-273',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Check Empty Hash',
    text: 'Use `empty?` to check if hash has no entries.',
    setup: 'h = {}',
    setupCode: 'h = {}',
    expected: true,
    sample: 'h.empty?',
    hints: ['empty? returns true for empty hash', 'size == 0'],
    tags: ['empty?', 'predicate', 'check'],
  },
  {
    id: 'ruby-hash-274',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Each Key Iteration',
    text: 'Use `each_key` to collect all keys into array.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: ['a', 'b', 'c'],
    sample: 'result = []; h.each_key { |k| result << k }; result',
    hints: ['each_key iterates only keys', 'Cleaner than each for key-only work'],
    tags: ['each_key', 'iterate', 'keys'],
  },
  {
    id: 'ruby-hash-275',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Each Value Iteration',
    text: 'Use `each_value` to sum all values.',
    setup: 'h = { a: 10, b: 20, c: 30 }',
    setupCode: 'h = { a: 10, b: 20, c: 30 }',
    expected: 60,
    sample: 'sum = 0; h.each_value { |v| sum += v }; sum',
    hints: ['each_value iterates only values', 'Or use h.values.sum'],
    tags: ['each_value', 'iterate', 'values'],
  },
  {
    id: 'ruby-hash-276',
    category: 'Hash Methods',
    difficulty: 'hard',
    title: 'Deep Merge Nested Hashes',
    text: 'Manually deep merge two nested hashes.',
    setup: 'a = { x: { y: 1 } }\nb = { x: { z: 2 } }',
    setupCode: 'a = { x: { y: 1 } }\nb = { x: { z: 2 } }',
    expected: { x: { y: 1, z: 2 } },
    sample: 'a.merge(b) { |k, v1, v2| v1.is_a?(Hash) && v2.is_a?(Hash) ? v1.merge(v2) : v2 }',
    hints: ['Use merge with block for nested', 'Recursively merge hash values'],
    tags: ['merge', 'deep', 'nested'],
  },
  {
    id: 'ruby-hash-277',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Fetch Multiple Values',
    text: 'Use `fetch_values` to get multiple values at once.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: [1, 3],
    sample: 'h.fetch_values(:a, :c)',
    hints: ['fetch_values returns array of values', 'Raises error if key missing'],
    tags: ['fetch_values', 'multiple', 'access'],
  },
  {
    id: 'ruby-hash-278',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Values at Keys',
    text: 'Use `values_at` to get values for specific keys.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: [1, null, 3],
    sample: 'h.values_at(:a, :z, :c)',
    hints: ['values_at returns nil for missing keys', 'Does not raise error'],
    tags: ['values_at', 'multiple', 'nil'],
  },
  {
    id: 'ruby-hash-279',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Compare Hashes',
    text: 'Use `==` to check if two hashes are equal.',
    setup: 'a = { x: 1, y: 2 }\nb = { y: 2, x: 1 }',
    setupCode: 'a = { x: 1, y: 2 }\nb = { y: 2, x: 1 }',
    expected: true,
    sample: 'a == b',
    hints: ['== compares contents not order', 'Keys and values must match'],
    tags: ['==', 'compare', 'equal'],
  },
  {
    id: 'ruby-hash-280',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Assoc Lookup in Hash',
    text: 'Use `assoc` to find key-value pair by key.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: ['b', 2],
    sample: 'h.assoc(:b)',
    hints: ['assoc returns [key, value] pair', 'Returns nil if not found'],
    tags: ['assoc', 'lookup', 'pair'],
  },
  {
    id: 'ruby-hash-281',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Rassoc Lookup by Value',
    text: 'Use `rassoc` to find pair by value.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: ['b', 2],
    sample: 'h.rassoc(2)',
    hints: ['rassoc searches by value', 'Returns first match'],
    tags: ['rassoc', 'lookup', 'value'],
  },
  {
    id: 'ruby-hash-282',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Dig into Nested Hash',
    text: 'Use `dig` to safely access deeply nested value.',
    setup: 'data = { user: { profile: { settings: { theme: "dark" } } } }',
    setupCode: 'data = { user: { profile: { settings: { theme: "dark" } } } }',
    expected: 'dark',
    sample: 'data.dig(:user, :profile, :settings, :theme)',
    hints: ['dig navigates nested structures', 'Returns nil if path broken'],
    tags: ['dig', 'nested', 'safe'],
  },
  {
    id: 'ruby-hash-283',
    category: 'Hash Methods',
    difficulty: 'hard',
    title: 'Dig with Missing Path',
    text: 'Use `dig` to access missing nested path safely.',
    setup: 'data = { a: { b: 1 } }',
    setupCode: 'data = { a: { b: 1 } }',
    expected: null,
    sample: 'data.dig(:a, :c, :d)',
    hints: ['dig returns nil for missing paths', 'No error raised'],
    tags: ['dig', 'nil', 'missing'],
  },
  {
    id: 'ruby-hash-284',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Store Key Value',
    text: 'Use `store` to add a new key-value pair.',
    setup: 'h = { a: 1 }',
    setupCode: 'h = { a: 1 }',
    expected: 2,
    sample: 'h.store(:b, 2)',
    hints: ['store is same as h[key] = value', 'Returns the stored value'],
    tags: ['store', 'add', 'assign'],
  },
  {
    id: 'ruby-hash-285',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Replace Hash Contents',
    text: 'Use `replace` to swap hash contents entirely.',
    setup: 'h = { a: 1, b: 2 }',
    setupCode: 'h = { a: 1, b: 2 }',
    expected: { x: 10, y: 20 },
    sample: 'h.replace({ x: 10, y: 20 })',
    hints: ['replace changes contents in place', 'Same object, new contents'],
    tags: ['replace', 'swap', 'mutate'],
  },
  {
    id: 'ruby-hash-286',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Default Value',
    text: 'Use `default` to get the default value of hash.',
    setup: 'h = Hash.new("N/A")',
    setupCode: 'h = Hash.new("N/A")',
    expected: 'N/A',
    sample: 'h.default',
    hints: ['default returns the default value', 'Set via Hash.new(value)'],
    tags: ['default', 'missing', 'value'],
  },
  {
    id: 'ruby-hash-287',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Set Default Value',
    text: 'Use `default=` to change default value.',
    setup: 'h = {}',
    setupCode: 'h = {}',
    expected: 0,
    sample: 'h.default = 0; h[:missing]',
    hints: ['default= sets new default', 'Affects all missing keys'],
    tags: ['default=', 'set', 'missing'],
  },
  {
    id: 'ruby-hash-288',
    category: 'Hash Methods',
    difficulty: 'hard',
    title: 'Set Default Proc',
    text: 'Use `default_proc=` to set dynamic default.',
    setup: 'h = {}',
    setupCode: 'h = {}',
    expected: 'KEY_X',
    sample: 'h.default_proc = ->(hash, key) { "KEY_#{key.upcase}" }; h[:x]',
    hints: ['default_proc for computed defaults', 'Proc receives hash and key'],
    tags: ['default_proc', 'dynamic', 'computed'],
  },
  {
    id: 'ruby-hash-289',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Shift First Pair',
    text: 'Use `shift` to remove and return first pair.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: ['a', 1],
    sample: 'h.shift',
    hints: ['shift removes first inserted pair', 'Returns [key, value]'],
    tags: ['shift', 'remove', 'first'],
  },
  {
    id: 'ruby-hash-290',
    category: 'Hash Methods',
    difficulty: 'hard',
    title: 'Map Hash to New Hash',
    text: 'Use `map` and `to_h` to transform a hash.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: { A: 2, B: 4, C: 6 },
    sample: 'h.map { |k, v| [k.upcase, v * 2] }.to_h',
    hints: ['map returns array of pairs', 'to_h converts back to hash'],
    tags: ['map', 'to_h', 'transform'],
  },
  {
    id: 'ruby-hash-291',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Reduce Hash to Value',
    text: 'Use `reduce` to sum all values with keys as multipliers.',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: 6,
    sample: 'h.reduce(0) { |sum, (k, v)| sum + v }',
    hints: ['reduce works on hashes', 'Destructure pair in block'],
    tags: ['reduce', 'sum', 'accumulate'],
  },
  {
    id: 'ruby-hash-292',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'Any Matching Entry',
    text: 'Use `any?` to check if any value exceeds 50.',
    setup: 'scores = { alice: 45, bob: 60, carol: 30 }',
    setupCode: 'scores = { alice: 45, bob: 60, carol: 30 }',
    expected: true,
    sample: 'scores.any? { |k, v| v > 50 }',
    hints: ['any? works on hashes', 'Block receives key-value pair'],
    tags: ['any?', 'predicate', 'check'],
  },
  {
    id: 'ruby-hash-293',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'All Matching Entries',
    text: 'Use `all?` to check if all values are positive.',
    setup: 'nums = { a: 1, b: 2, c: 3 }',
    setupCode: 'nums = { a: 1, b: 2, c: 3 }',
    expected: true,
    sample: 'nums.all? { |k, v| v > 0 }',
    hints: ['all? checks every entry', 'Returns false if any fails'],
    tags: ['all?', 'predicate', 'every'],
  },
  {
    id: 'ruby-hash-294',
    category: 'Hash Methods',
    difficulty: 'easy',
    title: 'None Matching Entry',
    text: 'Use `none?` to check if no values are negative.',
    setup: 'nums = { a: 1, b: 2, c: 3 }',
    setupCode: 'nums = { a: 1, b: 2, c: 3 }',
    expected: true,
    sample: 'nums.none? { |k, v| v < 0 }',
    hints: ['none? checks all fail condition', 'Opposite of any?'],
    tags: ['none?', 'predicate', 'check'],
  },
  {
    id: 'ruby-hash-295',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'One Matching Entry',
    text: 'Use `one?` to check exactly one value equals 10.',
    setup: 'nums = { a: 5, b: 10, c: 15 }',
    setupCode: 'nums = { a: 5, b: 10, c: 15 }',
    expected: true,
    sample: 'nums.one? { |k, v| v == 10 }',
    hints: ['one? checks exactly one matches', 'False if zero or multiple'],
    tags: ['one?', 'predicate', 'exact'],
  },
  {
    id: 'ruby-hash-296',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Find Entry by Condition',
    text: 'Use `find` to get first entry where value > 50.',
    setup: 'scores = { alice: 45, bob: 60, carol: 80 }',
    setupCode: 'scores = { alice: 45, bob: 60, carol: 80 }',
    expected: ['bob', 60],
    sample: 'scores.find { |k, v| v > 50 }',
    hints: ['find returns first matching pair', 'Returns [key, value] array'],
    tags: ['find', 'detect', 'first'],
  },
  {
    id: 'ruby-hash-297',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Count Entries by Condition',
    text: 'Use `count` to count entries where value is even.',
    setup: 'nums = { a: 1, b: 2, c: 3, d: 4 }',
    setupCode: 'nums = { a: 1, b: 2, c: 3, d: 4 }',
    expected: 2,
    sample: 'nums.count { |k, v| v.even? }',
    hints: ['count with block counts matches', 'Works on hashes'],
    tags: ['count', 'filter', 'tally'],
  },
  {
    id: 'ruby-hash-298',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Group Hash by Value Property',
    text: 'Use `group_by` to group by value parity.',
    setup: 'nums = { a: 1, b: 2, c: 3, d: 4 }',
    setupCode: 'nums = { a: 1, b: 2, c: 3, d: 4 }',
    expected: {
      false: [
        ['a', 1],
        ['c', 3],
      ],
      true: [
        ['b', 2],
        ['d', 4],
      ],
    },
    sample: 'nums.group_by { |k, v| v.even? }',
    hints: ['group_by on hash returns hash of arrays', 'Each array contains pairs'],
    tags: ['group_by', 'categorize', 'partition'],
  },
  {
    id: 'ruby-hash-299',
    category: 'Hash Methods',
    difficulty: 'hard',
    title: 'Partition Hash',
    text: 'Use `partition` to split hash by value threshold.',
    setup: 'scores = { a: 80, b: 45, c: 90, d: 30 }',
    setupCode: 'scores = { a: 80, b: 45, c: 90, d: 30 }',
    expected: [
      [
        ['a', 80],
        ['c', 90],
      ],
      [
        ['b', 45],
        ['d', 30],
      ],
    ],
    sample: 'scores.partition { |k, v| v >= 60 }',
    hints: ['partition returns [true_arr, false_arr]', 'Each contains [key, value] pairs'],
    tags: ['partition', 'split', 'divide'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 3: String Methods (50 problems)
  // ============================================================

  {
    id: 'ruby-str-300',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Multiply String',
    text: 'Use `*` operator to repeat string 3 times.',
    setup: 'text = "ab"',
    setupCode: 'text = "ab"',
    expected: 'ababab',
    sample: 'text * 3',
    hints: ['* repeats string n times', 'Returns new string'],
    tags: ['*', 'repeat', 'multiply'],
  },
  {
    id: 'ruby-str-301',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Concatenate Strings',
    text: 'Use `+` to concatenate two strings.',
    setup: 'a = "Hello"\nb = "World"',
    setupCode: 'a = "Hello"\nb = "World"',
    expected: 'HelloWorld',
    sample: 'a + b',
    hints: ['+ joins strings', 'Creates new string'],
    tags: ['+', 'concatenate', 'join'],
  },
  {
    id: 'ruby-str-302',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Append to String',
    text: 'Use `<<` to append to string in place.',
    setup: 'text = "Hello"',
    setupCode: 'text = "Hello"',
    expected: 'Hello World',
    sample: 'text << " World"',
    hints: ['<< modifies original string', 'Also called shovel operator'],
    tags: ['<<', 'append', 'mutate'],
  },
  {
    id: 'ruby-str-303',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'String Slice by Range',
    text: 'Use range indexing to extract substring.',
    setup: 'text = "Hello World"',
    setupCode: 'text = "Hello World"',
    expected: 'World',
    sample: 'text[6..10]',
    hints: ['[start..end] extracts range', 'Inclusive of both ends'],
    tags: ['[]', 'slice', 'range'],
  },
  {
    id: 'ruby-str-304',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'String Slice by Length',
    text: 'Use `[start, length]` to extract substring.',
    setup: 'text = "Hello World"',
    setupCode: 'text = "Hello World"',
    expected: 'Hello',
    sample: 'text[0, 5]',
    hints: ['[start, length] extracts n chars', 'From start position'],
    tags: ['[]', 'slice', 'length'],
  },
  {
    id: 'ruby-str-305',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'String Slice by Regex',
    text: 'Use regex indexing to extract matching part.',
    setup: 'text = "Price: $123.45"',
    setupCode: 'text = "Price: $123.45"',
    expected: '123.45',
    sample: 'text[/\\d+\\.\\d+/]',
    hints: ['[/regex/] returns first match', 'Returns nil if no match'],
    tags: ['[]', 'regex', 'extract'],
  },
  {
    id: 'ruby-str-306',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Negative String Index',
    text: 'Use negative index to get last character.',
    setup: 'text = "Ruby"',
    setupCode: 'text = "Ruby"',
    expected: 'y',
    sample: 'text[-1]',
    hints: ['-1 is last character', 'Negative counts from end'],
    tags: ['[]', 'negative', 'last'],
  },
  {
    id: 'ruby-str-307',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Swapcase String',
    text: 'Use `swapcase` to swap upper and lowercase.',
    setup: 'text = "Hello World"',
    setupCode: 'text = "Hello World"',
    expected: 'hELLO wORLD',
    sample: 'text.swapcase',
    hints: ['swapcase inverts case', 'Upper becomes lower and vice versa'],
    tags: ['swapcase', 'case', 'invert'],
  },
  {
    id: 'ruby-str-308',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Titlecase Each Word',
    text: 'Use `split`, `map`, and `join` to titlecase each word.',
    setup: 'text = "hello world ruby"',
    setupCode: 'text = "hello world ruby"',
    expected: 'Hello World Ruby',
    sample: 'text.split.map(&:capitalize).join(" ")',
    hints: ['Split into words, capitalize each, rejoin', 'Or use gsub with regex'],
    tags: ['capitalize', 'titlecase', 'words'],
  },
  {
    id: 'ruby-str-309',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Left Strip Whitespace',
    text: 'Use `lstrip` to remove leading whitespace only.',
    setup: 'text = "   hello   "',
    setupCode: 'text = "   hello   "',
    expected: 'hello   ',
    sample: 'text.lstrip',
    hints: ['lstrip removes left whitespace', 'Trailing whitespace remains'],
    tags: ['lstrip', 'whitespace', 'trim'],
  },
  {
    id: 'ruby-str-310',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Right Strip Whitespace',
    text: 'Use `rstrip` to remove trailing whitespace only.',
    setup: 'text = "   hello   "',
    setupCode: 'text = "   hello   "',
    expected: '   hello',
    sample: 'text.rstrip',
    hints: ['rstrip removes right whitespace', 'Leading whitespace remains'],
    tags: ['rstrip', 'whitespace', 'trim'],
  },
  {
    id: 'ruby-str-311',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Chop Last Character',
    text: 'Use `chop` to remove last character.',
    setup: 'text = "Hello!"',
    setupCode: 'text = "Hello!"',
    expected: 'Hello',
    sample: 'text.chop',
    hints: ['chop removes last char unconditionally', 'Different from chomp'],
    tags: ['chop', 'remove', 'last'],
  },
  {
    id: 'ruby-str-312',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Prepend to String',
    text: 'Use `prepend` to add text to beginning.',
    setup: 'text = "World"',
    setupCode: 'text = "World"',
    expected: 'Hello World',
    sample: 'text.prepend("Hello ")',
    hints: ['prepend adds to front', 'Modifies string in place'],
    tags: ['prepend', 'add', 'front'],
  },
  {
    id: 'ruby-str-313',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Insert at Position',
    text: 'Use `insert` to add text at specific index.',
    setup: 'text = "Hello World"',
    setupCode: 'text = "Hello World"',
    expected: 'Hello Ruby World',
    sample: 'text.insert(6, "Ruby ")',
    hints: ['insert(index, str) adds at position', 'Shifts existing chars right'],
    tags: ['insert', 'position', 'add'],
  },
  {
    id: 'ruby-str-314',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Replace Substring',
    text: 'Use `[]=` to replace part of string.',
    setup: 'text = "Hello World"',
    setupCode: 'text = "Hello World"',
    expected: 'Hello Ruby',
    sample: 'text[6..10] = "Ruby"; text',
    hints: ['[]= replaces specified portion', 'Can use range or regex'],
    tags: ['[]=', 'replace', 'modify'],
  },
  {
    id: 'ruby-str-315',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Tr Translate Characters',
    text: 'Use `tr` to translate vowels to numbers.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 'h2ll4',
    sample: 'text.tr("aeiou", "12345")',
    hints: ['tr maps chars one-to-one', 'First string to second string'],
    tags: ['tr', 'translate', 'map'],
  },
  {
    id: 'ruby-str-316',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Tr Delete Characters',
    text: 'Use `tr` to remove all vowels.',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: 'hll wrld',
    sample: 'text.delete("aeiou")',
    hints: ['delete removes specified chars', 'Or use tr with empty string'],
    tags: ['delete', 'remove', 'chars'],
  },
  {
    id: 'ruby-str-317',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Tr Squeeze Characters',
    text: 'Use `tr_s` to translate and squeeze.',
    setup: 'text = "heeello"',
    setupCode: 'text = "heeello"',
    expected: 'halo',
    sample: 'text.tr_s("elo", "alo")',
    hints: ['tr_s translates and squeezes result', 'Combines tr and squeeze'],
    tags: ['tr_s', 'translate', 'squeeze'],
  },
  {
    id: 'ruby-str-318',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Count Characters',
    text: 'Use `count` to count occurrences of specific chars.',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: 3,
    sample: 'text.count("lo")',
    hints: ['count counts chars in set', 'Counts l and o combined'],
    tags: ['count', 'characters', 'frequency'],
  },
  {
    id: 'ruby-str-319',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Count with Range',
    text: 'Use `count` with range to count lowercase letters.',
    setup: 'text = "Hello World 123"',
    setupCode: 'text = "Hello World 123"',
    expected: 8,
    sample: 'text.count("a-z")',
    hints: ['count accepts char ranges', 'a-z matches lowercase'],
    tags: ['count', 'range', 'letters'],
  },
  {
    id: 'ruby-str-320',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Sum of Bytes',
    text: 'Use `sum` to get checksum of string bytes.',
    setup: 'text = "abc"',
    setupCode: 'text = "abc"',
    expected: 294,
    sample: 'text.sum',
    hints: ['sum adds ASCII values', '97 + 98 + 99 = 294'],
    tags: ['sum', 'checksum', 'bytes'],
  },
  {
    id: 'ruby-str-321',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Ord of First Character',
    text: 'Use `ord` to get ASCII value of first character.',
    setup: 'text = "ABC"',
    setupCode: 'text = "ABC"',
    expected: 65,
    sample: 'text.ord',
    hints: ['ord returns code point', 'A = 65 in ASCII'],
    tags: ['ord', 'ascii', 'code'],
  },
  {
    id: 'ruby-str-322',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Chr from Integer',
    text: 'Use `chr` to convert integer to character.',
    setup: 'code = 65',
    setupCode: 'code = 65',
    expected: 'A',
    sample: 'code.chr',
    hints: ['chr converts code to char', 'Opposite of ord'],
    tags: ['chr', 'character', 'convert'],
  },
  {
    id: 'ruby-str-323',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Crypt Password',
    text: 'Use `crypt` to hash string with salt.',
    setup: 'password = "secret"',
    setupCode: 'password = "secret"',
    expected: true,
    sample: 'password.crypt("ab").start_with?("ab")',
    hints: ['crypt uses DES by default', 'Salt determines output'],
    tags: ['crypt', 'hash', 'password'],
  },
  {
    id: 'ruby-str-324',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Hex String to Integer',
    text: 'Use `hex` to convert hex string to integer.',
    setup: 'text = "ff"',
    setupCode: 'text = "ff"',
    expected: 255,
    sample: 'text.hex',
    hints: ['hex interprets as hexadecimal', 'ff = 255'],
    tags: ['hex', 'convert', 'number'],
  },
  {
    id: 'ruby-str-325',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Oct String to Integer',
    text: 'Use `oct` to convert octal string to integer.',
    setup: 'text = "77"',
    setupCode: 'text = "77"',
    expected: 63,
    sample: 'text.oct',
    hints: ['oct interprets as octal', '77 octal = 63 decimal'],
    tags: ['oct', 'convert', 'octal'],
  },
  {
    id: 'ruby-str-326',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'To Integer',
    text: 'Use `to_i` to convert string to integer.',
    setup: 'text = "42abc"',
    setupCode: 'text = "42abc"',
    expected: 42,
    sample: 'text.to_i',
    hints: ['to_i stops at non-digit', 'Returns 0 if starts with non-digit'],
    tags: ['to_i', 'convert', 'integer'],
  },
  {
    id: 'ruby-str-327',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'To Integer with Base',
    text: 'Use `to_i` with base to parse binary string.',
    setup: 'text = "1010"',
    setupCode: 'text = "1010"',
    expected: 10,
    sample: 'text.to_i(2)',
    hints: ['to_i(base) parses in given base', 'Base 2 is binary'],
    tags: ['to_i', 'base', 'binary'],
  },
  {
    id: 'ruby-str-328',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'To Float',
    text: 'Use `to_f` to convert string to float.',
    setup: 'text = "3.14"',
    setupCode: 'text = "3.14"',
    expected: 3.14,
    sample: 'text.to_f',
    hints: ['to_f parses as float', 'Returns 0.0 if invalid'],
    tags: ['to_f', 'convert', 'float'],
  },
  {
    id: 'ruby-str-329',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'To Symbol',
    text: 'Use `to_sym` to convert string to symbol.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: ':hello',
    sample: 'text.to_sym',
    hints: ['to_sym creates symbol', 'Also intern is alias'],
    tags: ['to_sym', 'symbol', 'convert'],
  },
  {
    id: 'ruby-str-330',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Unpack Binary Data',
    text: 'Use `unpack` to extract integers from binary.',
    setup: 'binary = "\\x01\\x02\\x03"',
    setupCode: 'binary = "\\x01\\x02\\x03"',
    expected: [1, 2, 3],
    sample: 'binary.unpack("C*")',
    hints: ['unpack parses binary format', 'C* extracts unsigned bytes'],
    tags: ['unpack', 'binary', 'parse'],
  },
  {
    id: 'ruby-str-331',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Scan All Matches',
    text: 'Use `scan` to extract all words.',
    setup: 'text = "hello world ruby"',
    setupCode: 'text = "hello world ruby"',
    expected: ['hello', 'world', 'ruby'],
    sample: 'text.scan(/\\w+/)',
    hints: ['scan returns all matches', 'Returns array of strings'],
    tags: ['scan', 'regex', 'all'],
  },
  {
    id: 'ruby-str-332',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Scan with Groups',
    text: 'Use `scan` with capture groups to extract pairs.',
    setup: 'text = "a=1 b=2 c=3"',
    setupCode: 'text = "a=1 b=2 c=3"',
    expected: [
      ['a', '1'],
      ['b', '2'],
      ['c', '3'],
    ],
    sample: 'text.scan(/(\\w+)=(\\d+)/)',
    hints: ['Capture groups return arrays', 'Each match is array of groups'],
    tags: ['scan', 'capture', 'groups'],
  },
  {
    id: 'ruby-str-333',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Match First Only',
    text: 'Use `match` to extract first number.',
    setup: 'text = "Order 123 has 456 items"',
    setupCode: 'text = "Order 123 has 456 items"',
    expected: '123',
    sample: 'text.match(/\\d+/)[0]',
    hints: ['match returns MatchData', 'Access with [0] for full match'],
    tags: ['match', 'regex', 'first'],
  },
  {
    id: 'ruby-str-334',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Match Named Groups',
    text: 'Use named capture groups in match.',
    setup: 'text = "John Doe"',
    setupCode: 'text = "John Doe"',
    expected: 'Doe',
    sample: 'text.match(/(?<first>\\w+) (?<last>\\w+)/)[:last]',
    hints: ['Named groups use (?<name>)', 'Access by name symbol'],
    tags: ['match', 'named', 'capture'],
  },
  {
    id: 'ruby-str-335',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Match Question Mark',
    text: 'Use `match?` for boolean regex check.',
    setup: 'email = "test@example.com"',
    setupCode: 'email = "test@example.com"',
    expected: true,
    sample: 'email.match?(/\\A[\\w+.]+@[\\w]+\\.[\\w]+\\z/)',
    hints: ['match? returns boolean only', 'More efficient than match'],
    tags: ['match?', 'regex', 'boolean'],
  },
  {
    id: 'ruby-str-336',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Gsub with Hash',
    text: 'Use `gsub` with hash for multiple replacements.',
    setup: 'text = "I have a cat and a dog"',
    setupCode: 'text = "I have a cat and a dog"',
    expected: 'I have a kitten and a puppy',
    sample: 'text.gsub(/cat|dog/, "cat" => "kitten", "dog" => "puppy")',
    hints: ['gsub accepts hash for mapping', 'Keys are match strings'],
    tags: ['gsub', 'hash', 'multiple'],
  },
  {
    id: 'ruby-str-337',
    category: 'String Methods',
    difficulty: 'hard',
    title: 'Gsub with Block and Groups',
    text: 'Use `gsub` with block accessing capture groups.',
    setup: 'text = "hello world"',
    setupCode: 'text = "hello world"',
    expected: 'HELLO WORLD',
    sample: 'text.gsub(/(\\w+)/) { $1.upcase }',
    hints: ['$1 accesses first capture in block', 'Use captures for transformation'],
    tags: ['gsub', 'block', 'capture'],
  },
  {
    id: 'ruby-str-338',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Next String',
    text: 'Use `next` to get successor string.',
    setup: 'text = "abc"',
    setupCode: 'text = "abc"',
    expected: 'abd',
    sample: 'text.next',
    hints: ['next increments last char', 'Also called succ'],
    tags: ['next', 'succ', 'increment'],
  },
  {
    id: 'ruby-str-339',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Upto Range',
    text: 'Use `upto` to iterate through string range.',
    setup: 'start = "a"',
    setupCode: 'start = "a"',
    expected: ['a', 'b', 'c', 'd', 'e'],
    sample: 'start.upto("e").to_a',
    hints: ['upto iterates string sequence', 'Works like number range'],
    tags: ['upto', 'range', 'sequence'],
  },
  {
    id: 'ruby-str-340',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Compare Strings',
    text: 'Use `<=>` spaceship operator to compare strings.',
    setup: 'a = "apple"\nb = "banana"',
    setupCode: 'a = "apple"\nb = "banana"',
    expected: -1,
    sample: 'a <=> b',
    hints: ['<=> returns -1, 0, or 1', 'Lexicographic comparison'],
    tags: ['<=>', 'compare', 'spaceship'],
  },
  {
    id: 'ruby-str-341',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Case Insensitive Compare',
    text: 'Use `casecmp` for case-insensitive comparison.',
    setup: 'a = "Hello"\nb = "hello"',
    setupCode: 'a = "Hello"\nb = "hello"',
    expected: 0,
    sample: 'a.casecmp(b)',
    hints: ['casecmp ignores case', '0 means equal'],
    tags: ['casecmp', 'compare', 'case'],
  },
  {
    id: 'ruby-str-342',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Case Compare Question',
    text: 'Use `casecmp?` for boolean case-insensitive check.',
    setup: 'a = "RUBY"\nb = "ruby"',
    setupCode: 'a = "RUBY"\nb = "ruby"',
    expected: true,
    sample: 'a.casecmp?(b)',
    hints: ['casecmp? returns boolean', 'True if equal ignoring case'],
    tags: ['casecmp?', 'equal', 'case'],
  },
  {
    id: 'ruby-str-343',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Partition String',
    text: 'Use `partition` to split at first match.',
    setup: 'text = "hello=world=ruby"',
    setupCode: 'text = "hello=world=ruby"',
    expected: ['hello', '=', 'world=ruby'],
    sample: 'text.partition("=")',
    hints: ['partition returns [before, match, after]', 'Splits at first occurrence'],
    tags: ['partition', 'split', 'three'],
  },
  {
    id: 'ruby-str-344',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Rpartition String',
    text: 'Use `rpartition` to split at last match.',
    setup: 'text = "hello=world=ruby"',
    setupCode: 'text = "hello=world=ruby"',
    expected: ['hello=world', '=', 'ruby'],
    sample: 'text.rpartition("=")',
    hints: ['rpartition splits at last occurrence', 'Searches from right'],
    tags: ['rpartition', 'split', 'last'],
  },
  {
    id: 'ruby-str-345',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Lines with Chomp',
    text: 'Use `lines` with chomp to get clean lines.',
    setup: 'text = "line1\\nline2\\nline3"',
    setupCode: 'text = "line1\\nline2\\nline3"',
    expected: ['line1', 'line2', 'line3'],
    sample: 'text.lines(chomp: true)',
    hints: ['lines(chomp: true) removes newlines', 'Ruby 2.4+ feature'],
    tags: ['lines', 'chomp', 'clean'],
  },
  {
    id: 'ruby-str-346',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Split with Limit',
    text: 'Use `split` with limit to control parts.',
    setup: 'text = "a,b,c,d,e"',
    setupCode: 'text = "a,b,c,d,e"',
    expected: ['a', 'b', 'c,d,e'],
    sample: 'text.split(",", 3)',
    hints: ['Limit controls max parts', 'Last part contains remainder'],
    tags: ['split', 'limit', 'parts'],
  },
  {
    id: 'ruby-str-347',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'Split with Regex Groups',
    text: 'Use `split` with capturing regex to keep separators.',
    setup: 'text = "a1b2c3d"',
    setupCode: 'text = "a1b2c3d"',
    expected: ['a', '1', 'b', '2', 'c', '3', 'd'],
    sample: 'text.split(/(\\d)/)',
    hints: ['Capture groups in split are kept', 'Useful for tokenizing'],
    tags: ['split', 'regex', 'capture'],
  },
  {
    id: 'ruby-str-348',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Remove Prefix',
    text: 'Use `delete_prefix` to remove string prefix.',
    setup: 'filename = "test_user.rb"',
    setupCode: 'filename = "test_user.rb"',
    expected: 'user.rb',
    sample: 'filename.delete_prefix("test_")',
    hints: ['delete_prefix removes if present', 'Returns original if not found'],
    tags: ['delete_prefix', 'remove', 'prefix'],
  },
  {
    id: 'ruby-str-349',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Remove Suffix',
    text: 'Use `delete_suffix` to remove file extension.',
    setup: 'filename = "document.txt"',
    setupCode: 'filename = "document.txt"',
    expected: 'document',
    sample: 'filename.delete_suffix(".txt")',
    hints: ['delete_suffix removes if present', 'Cleaner than chomp for this'],
    tags: ['delete_suffix', 'remove', 'extension'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 4: Block Patterns, Regex, Enumerable (50 problems)
  // ============================================================

  {
    id: 'ruby-block-350',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Yield to Block',
    text: 'Call times with block to build array.',
    setup: '# Use 3.times with block',
    setupCode: '# Use 3.times with block',
    expected: [0, 1, 2],
    sample: '3.times.map { |i| i }',
    hints: ['times yields 0 to n-1', 'Combine with map to collect'],
    tags: ['yield', 'times', 'block'],
  },
  {
    id: 'ruby-block-351',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Block Given Check',
    text: 'Define method that uses block_given? pattern.',
    setup: 'def greet(name); block_given? ? yield(name) : "Hello #{name}"; end',
    setupCode: 'def greet(name); block_given? ? yield(name) : "Hello #{name}"; end',
    expected: 'HELLO ALICE',
    sample: 'greet("Alice") { |n| "HELLO #{n.upcase}" }',
    hints: ['block_given? checks for block', 'yield passes control to block'],
    tags: ['block_given?', 'yield', 'conditional'],
  },
  {
    id: 'ruby-block-352',
    category: 'Block Patterns',
    difficulty: 'hard',
    title: 'Capture Block as Proc',
    text: 'Use & to capture block as proc parameter.',
    setup: 'def transform(arr, &block); arr.map(&block); end',
    setupCode: 'def transform(arr, &block); arr.map(&block); end',
    expected: [2, 4, 6],
    sample: 'transform([1, 2, 3]) { |n| n * 2 }',
    hints: ['&block captures block as Proc', 'Can pass proc to other methods'],
    tags: ['&block', 'proc', 'capture'],
  },
  {
    id: 'ruby-block-353',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Proc vs Lambda Return',
    text: 'Show lambda return behavior vs proc.',
    setup: 'lam = ->(n) { return n * 2 }',
    setupCode: 'lam = ->(n) { return n * 2 }',
    expected: 10,
    sample: 'lam.call(5)',
    hints: ['Lambda return exits lambda only', 'Proc return exits enclosing method'],
    tags: ['lambda', 'return', 'behavior'],
  },
  {
    id: 'ruby-block-354',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Lambda Arity Check',
    text: 'Check lambda enforces argument count.',
    setup: 'lam = ->(a, b) { a + b }',
    setupCode: 'lam = ->(a, b) { a + b }',
    expected: 2,
    sample: 'lam.arity',
    hints: ['arity returns required arg count', 'Lambda is strict about arity'],
    tags: ['lambda', 'arity', 'arguments'],
  },
  {
    id: 'ruby-block-355',
    category: 'Block Patterns',
    difficulty: 'easy',
    title: 'Proc Call Shorthand',
    text: 'Use bracket notation to call proc.',
    setup: 'double = Proc.new { |n| n * 2 }',
    setupCode: 'double = Proc.new { |n| n * 2 }',
    expected: 10,
    sample: 'double[5]',
    hints: ['proc[arg] is shorthand for call', 'Also proc.(arg) works'],
    tags: ['proc', 'call', 'shorthand'],
  },
  {
    id: 'ruby-block-356',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Curry Function',
    text: 'Use curry to partially apply arguments.',
    setup: 'add = ->(a, b, c) { a + b + c }.curry',
    setupCode: 'add = ->(a, b, c) { a + b + c }.curry',
    expected: 6,
    sample: 'add[1][2][3]',
    hints: ['curry allows partial application', 'Returns new lambda until all args'],
    tags: ['curry', 'partial', 'application'],
  },
  {
    id: 'ruby-block-357',
    category: 'Block Patterns',
    difficulty: 'hard',
    title: 'Method to Proc',
    text: 'Convert method to proc using method and &.',
    setup: 'def triple(n); n * 3; end',
    setupCode: 'def triple(n); n * 3; end',
    expected: [3, 6, 9],
    sample: '[1, 2, 3].map(&method(:triple))',
    hints: ['method(:name) gets Method object', '& converts to proc'],
    tags: ['method', 'proc', 'convert'],
  },
  {
    id: 'ruby-block-358',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Compose Procs',
    text: 'Use >> to compose two procs.',
    setup: 'double = ->(n) { n * 2 }\nadd_one = ->(n) { n + 1 }',
    setupCode: 'double = ->(n) { n * 2 }\nadd_one = ->(n) { n + 1 }',
    expected: 11,
    sample: '(double >> add_one).call(5)',
    hints: ['>> composes left to right', 'double then add_one'],
    tags: ['>>', 'compose', 'chain'],
  },
  {
    id: 'ruby-block-359',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Compose Reverse',
    text: 'Use << to compose in reverse order.',
    setup: 'double = ->(n) { n * 2 }\nadd_one = ->(n) { n + 1 }',
    setupCode: 'double = ->(n) { n * 2 }\nadd_one = ->(n) { n + 1 }',
    expected: 12,
    sample: '(double << add_one).call(5)',
    hints: ['<< composes right to left', 'add_one then double'],
    tags: ['<<', 'compose', 'reverse'],
  },
  {
    id: 'ruby-regex-360',
    category: 'Regex',
    difficulty: 'easy',
    title: 'Basic Regex Match',
    text: 'Use =~ to check if string contains digits.',
    setup: 'text = "hello123"',
    setupCode: 'text = "hello123"',
    expected: 5,
    sample: 'text =~ /\\d/',
    hints: ['=~ returns index of match', 'Returns nil if no match'],
    tags: ['=~', 'match', 'index'],
  },
  {
    id: 'ruby-regex-361',
    category: 'Regex',
    difficulty: 'easy',
    title: 'Case Insensitive Match',
    text: 'Use i flag for case-insensitive match.',
    setup: 'text = "Hello World"',
    setupCode: 'text = "Hello World"',
    expected: 0,
    sample: 'text =~ /hello/i',
    hints: ['i flag ignores case', '/pattern/i syntax'],
    tags: ['regex', 'case', 'insensitive'],
  },
  {
    id: 'ruby-regex-362',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Multiline Regex',
    text: 'Use m flag to match across newlines.',
    setup: 'text = "hello\\nworld"',
    setupCode: 'text = "hello\\nworld"',
    expected: true,
    sample: '!!(text =~ /hello.world/m)',
    hints: ['m flag makes . match newlines', 'Without m, . excludes newlines'],
    tags: ['regex', 'multiline', 'dot'],
  },
  {
    id: 'ruby-regex-363',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Extended Regex',
    text: 'Use x flag for readable regex with comments.',
    setup: 'text = "user@example.com"',
    setupCode: 'text = "user@example.com"',
    expected: true,
    sample:
      '!!(text =~ /\\w+  # username\n          @     # at sign\n          \\w+   # domain\n          \\.[a-z]+  # TLD\n          /x)',
    hints: ['x flag allows whitespace and comments', 'Makes complex regex readable'],
    tags: ['regex', 'extended', 'comments'],
  },
  {
    id: 'ruby-regex-364',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Word Boundary',
    text: 'Use word boundary to match whole words.',
    setup: 'text = "cat category"',
    setupCode: 'text = "cat category"',
    expected: ['cat'],
    sample: 'text.scan(/\\bcat\\b/)',
    hints: ['\\b matches word boundary', 'Prevents partial matches'],
    tags: ['regex', 'boundary', 'word'],
  },
  {
    id: 'ruby-regex-365',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Lookahead Assertion',
    text: 'Use positive lookahead to match before pattern.',
    setup: 'text = "foo bar foobar"',
    setupCode: 'text = "foo bar foobar"',
    expected: ['foo'],
    sample: 'text.scan(/foo(?=bar)/)',
    hints: ['(?=pattern) is positive lookahead', 'Matches foo followed by bar'],
    tags: ['regex', 'lookahead', 'assertion'],
  },
  {
    id: 'ruby-regex-366',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Negative Lookahead',
    text: 'Use negative lookahead to match not followed by.',
    setup: 'text = "foo bar foobar"',
    setupCode: 'text = "foo bar foobar"',
    expected: ['foo'],
    sample: 'text.scan(/foo(?!bar)/)',
    hints: ['(?!pattern) is negative lookahead', 'foo NOT followed by bar'],
    tags: ['regex', 'negative', 'lookahead'],
  },
  {
    id: 'ruby-regex-367',
    category: 'Regex',
    difficulty: 'hard',
    title: 'Lookbehind Assertion',
    text: 'Use positive lookbehind to match after pattern.',
    setup: 'text = "$100 $200 300"',
    setupCode: 'text = "$100 $200 300"',
    expected: ['100', '200'],
    sample: 'text.scan(/(?<=\\$)\\d+/)',
    hints: ['(?<=pattern) is positive lookbehind', 'Matches digits after $'],
    tags: ['regex', 'lookbehind', 'assertion'],
  },
  {
    id: 'ruby-regex-368',
    category: 'Regex',
    difficulty: 'hard',
    title: 'Named Capture Group',
    text: 'Use named capture group and access by name.',
    setup: 'text = "2024-03-15"',
    setupCode: 'text = "2024-03-15"',
    expected: { year: '2024', month: '03', day: '15' },
    sample:
      'm = text.match(/(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/); { year: m[:year], month: m[:month], day: m[:day] }',
    hints: ['(?<name>pattern) creates named group', 'Access with match[:name]'],
    tags: ['regex', 'named', 'capture'],
  },
  {
    id: 'ruby-regex-369',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Non-Capturing Group',
    text: 'Use non-capturing group for grouping only.',
    setup: 'text = "catdog catcat"',
    setupCode: 'text = "catdog catcat"',
    expected: ['catdog', 'catcat'],
    sample: 'text.scan(/(?:cat|dog)+/)',
    hints: ['(?:pattern) groups without capturing', 'Useful for alternation'],
    tags: ['regex', 'non-capturing', 'group'],
  },
  {
    id: 'ruby-regex-370',
    category: 'Regex',
    difficulty: 'easy',
    title: 'Character Class',
    text: 'Use character class to match vowels.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: ['e', 'o'],
    sample: 'text.scan(/[aeiou]/)',
    hints: ['[chars] matches any single char', 'Called character class'],
    tags: ['regex', 'class', 'characters'],
  },
  {
    id: 'ruby-regex-371',
    category: 'Regex',
    difficulty: 'easy',
    title: 'Negated Character Class',
    text: 'Use negated class to match non-vowels.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: ['h', 'l', 'l'],
    sample: 'text.scan(/[^aeiou]/)',
    hints: ['[^chars] matches NOT in set', 'Caret negates class'],
    tags: ['regex', 'negated', 'class'],
  },
  {
    id: 'ruby-regex-372',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Greedy vs Lazy',
    text: 'Use lazy quantifier for minimal match.',
    setup: 'text = "<a><b>"',
    setupCode: 'text = "<a><b>"',
    expected: ['<a>', '<b>'],
    sample: 'text.scan(/<.+?>/)',
    hints: ['+? is lazy version of +', 'Matches as few as possible'],
    tags: ['regex', 'lazy', 'quantifier'],
  },
  {
    id: 'ruby-regex-373',
    category: 'Regex',
    difficulty: 'medium',
    title: 'Backreference',
    text: 'Use backreference to match repeated word.',
    setup: 'text = "the the cat cat"',
    setupCode: 'text = "the the cat cat"',
    expected: ['the the', 'cat cat'],
    sample: 'text.scan(/(\\w+) \\1/)',
    hints: ['\\1 references first capture', 'Matches same text again'],
    tags: ['regex', 'backreference', 'repeat'],
  },
  {
    id: 'ruby-regex-374',
    category: 'Regex',
    difficulty: 'hard',
    title: 'Gsub with Named Groups',
    text: 'Use gsub with named groups in replacement.',
    setup: 'text = "John Doe"',
    setupCode: 'text = "John Doe"',
    expected: 'Doe, John',
    sample: 'text.gsub(/(?<first>\\w+) (?<last>\\w+)/, "\\k<last>, \\k<first>")',
    hints: ['\\k<name> references named group', 'In replacement string'],
    tags: ['gsub', 'named', 'replacement'],
  },
  {
    id: 'ruby-enum-375',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Zip Multiple Arrays',
    text: 'Use zip to combine three arrays.',
    setup: 'a = [1, 2]\nb = ["a", "b"]\nc = [:x, :y]',
    setupCode: 'a = [1, 2]\nb = ["a", "b"]\nc = [:x, :y]',
    expected: [
      [1, 'a', ':x'],
      [2, 'b', ':y'],
    ],
    sample: 'a.zip(b, c)',
    hints: ['zip accepts multiple arrays', 'Combines element-wise'],
    tags: ['zip', 'multiple', 'combine'],
  },
  {
    id: 'ruby-enum-376',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Each With Object String',
    text: 'Use each_with_object to build string.',
    setup: 'words = ["hello", "world"]',
    setupCode: 'words = ["hello", "world"]',
    expected: 'HELLO-WORLD',
    sample: 'words.each_with_object("") { |w, str| str << (str.empty? ? "" : "-") + w.upcase }',
    hints: ['Works with any mutable object', 'String is mutable in Ruby'],
    tags: ['each_with_object', 'string', 'build'],
  },
  {
    id: 'ruby-enum-377',
    category: 'Enumerable',
    difficulty: 'easy',
    title: 'Find All Matches',
    text: 'Use find_all as alias for select.',
    setup: 'numbers = [1, 2, 3, 4, 5, 6]',
    setupCode: 'numbers = [1, 2, 3, 4, 5, 6]',
    expected: [2, 4, 6],
    sample: 'numbers.find_all { |n| n.even? }',
    hints: ['find_all is alias for select', 'Same functionality'],
    tags: ['find_all', 'select', 'filter'],
  },
  {
    id: 'ruby-enum-378',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Detect with Default',
    text: 'Use detect with ifnone proc.',
    setup: 'numbers = [1, 3, 5]',
    setupCode: 'numbers = [1, 3, 5]',
    expected: 'none found',
    sample: 'numbers.detect(-> { "none found" }) { |n| n.even? }',
    hints: ['First arg is ifnone callable', 'Called when no match'],
    tags: ['detect', 'default', 'ifnone'],
  },
  {
    id: 'ruby-enum-379',
    category: 'Enumerable',
    difficulty: 'easy',
    title: 'First with Count',
    text: 'Use first(n) to get multiple elements.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [1, 2, 3],
    sample: 'numbers.first(3)',
    hints: ['first(n) returns array', 'Same as take(n)'],
    tags: ['first', 'multiple', 'take'],
  },
  {
    id: 'ruby-enum-380',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Grep Pattern',
    text: 'Use grep to filter by pattern.',
    setup: 'items = ["apple", "banana", "apricot", "cherry"]',
    setupCode: 'items = ["apple", "banana", "apricot", "cherry"]',
    expected: ['apple', 'apricot'],
    sample: 'items.grep(/^a/)',
    hints: ['grep uses === for matching', 'Works with regex, class, range'],
    tags: ['grep', 'pattern', 'filter'],
  },
  {
    id: 'ruby-enum-381',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Grep with Block',
    text: 'Use grep with block to filter and transform.',
    setup: 'items = [1, "two", 3, "four", 5]',
    setupCode: 'items = [1, "two", 3, "four", 5]',
    expected: [2, 6, 10],
    sample: 'items.grep(Integer) { |n| n * 2 }',
    hints: ['grep block transforms matches', 'Filter then map in one'],
    tags: ['grep', 'block', 'transform'],
  },
  {
    id: 'ruby-enum-382',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Grep_v Inverse',
    text: 'Use grep_v to filter out pattern.',
    setup: 'items = [1, "two", 3, "four"]',
    setupCode: 'items = [1, "two", 3, "four"]',
    expected: ['two', 'four'],
    sample: 'items.grep_v(Integer)',
    hints: ['grep_v is inverse of grep', 'Returns non-matching'],
    tags: ['grep_v', 'inverse', 'filter'],
  },
  {
    id: 'ruby-enum-383',
    category: 'Enumerable',
    difficulty: 'easy',
    title: 'Member Check',
    text: 'Use member? to check inclusion.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: true,
    sample: 'numbers.member?(3)',
    hints: ['member? is alias for include?', 'Same functionality'],
    tags: ['member?', 'include?', 'check'],
  },
  {
    id: 'ruby-enum-384',
    category: 'Enumerable',
    difficulty: 'hard',
    title: 'Inject Symbol',
    text: 'Use inject with symbol for string concatenation.',
    setup: 'words = ["Hello", " ", "World"]',
    setupCode: 'words = ["Hello", " ", "World"]',
    expected: 'Hello World',
    sample: 'words.inject(:+)',
    hints: ['inject(:method) calls method between elements', 'Works for any binary method'],
    tags: ['inject', 'symbol', 'reduce'],
  },
  {
    id: 'ruby-enum-385',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Max Multiple',
    text: 'Use max(n) to get top n elements.',
    setup: 'numbers = [3, 1, 4, 1, 5, 9, 2, 6]',
    setupCode: 'numbers = [3, 1, 4, 1, 5, 9, 2, 6]',
    expected: [9, 6, 5],
    sample: 'numbers.max(3)',
    hints: ['max(n) returns array of n largest', 'Sorted descending'],
    tags: ['max', 'multiple', 'top'],
  },
  {
    id: 'ruby-enum-386',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Min Multiple',
    text: 'Use min(n) to get bottom n elements.',
    setup: 'numbers = [3, 1, 4, 1, 5, 9, 2, 6]',
    setupCode: 'numbers = [3, 1, 4, 1, 5, 9, 2, 6]',
    expected: [1, 1, 2],
    sample: 'numbers.min(3)',
    hints: ['min(n) returns array of n smallest', 'Sorted ascending'],
    tags: ['min', 'multiple', 'bottom'],
  },
  {
    id: 'ruby-enum-387',
    category: 'Enumerable',
    difficulty: 'hard',
    title: 'Sort with Multiple Keys',
    text: 'Use sort_by with multiple criteria.',
    setup: 'people = [{name: "Bob", age: 30}, {name: "Alice", age: 25}, {name: "Alice", age: 30}]',
    setupCode:
      'people = [{name: "Bob", age: 30}, {name: "Alice", age: 25}, {name: "Alice", age: 30}]',
    expected: [
      { name: 'Alice', age: 25 },
      { name: 'Alice', age: 30 },
      { name: 'Bob', age: 30 },
    ],
    sample: 'people.sort_by { |p| [p[:name], p[:age]] }',
    hints: ['Return array for multi-key sort', 'Sorts by first, then second'],
    tags: ['sort_by', 'multiple', 'keys'],
  },
  {
    id: 'ruby-enum-388',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Reverse Each',
    text: 'Use reverse_each to iterate backwards.',
    setup: 'numbers = [1, 2, 3]',
    setupCode: 'numbers = [1, 2, 3]',
    expected: [3, 2, 1],
    sample: 'result = []; numbers.reverse_each { |n| result << n }; result',
    hints: ['reverse_each iterates in reverse', 'More efficient than reverse.each'],
    tags: ['reverse_each', 'backwards', 'iterate'],
  },
  {
    id: 'ruby-enum-389',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Entries Method',
    text: 'Use entries as alias for to_a.',
    setup: 'range = 1..5',
    setupCode: 'range = 1..5',
    expected: [1, 2, 3, 4, 5],
    sample: 'range.entries',
    hints: ['entries is alias for to_a', 'Converts enumerable to array'],
    tags: ['entries', 'to_a', 'convert'],
  },
  {
    id: 'ruby-enum-390',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Flat Map Transform',
    text: 'Use flat_map to expand each element.',
    setup: 'words = ["hello", "world"]',
    setupCode: 'words = ["hello", "world"]',
    expected: ['h', 'e', 'l', 'l', 'o', 'w', 'o', 'r', 'l', 'd'],
    sample: 'words.flat_map(&:chars)',
    hints: ['flat_map flattens one level', 'Same as map + flatten(1)'],
    tags: ['flat_map', 'expand', 'flatten'],
  },
  {
    id: 'ruby-enum-391',
    category: 'Enumerable',
    difficulty: 'hard',
    title: 'Chain Enumerators',
    text: 'Use chain to combine enumerators.',
    setup: 'a = [1, 2]\nb = [3, 4]',
    setupCode: 'a = [1, 2]\nb = [3, 4]',
    expected: [1, 2, 3, 4],
    sample: 'a.chain(b).to_a',
    hints: ['chain concatenates enumerators', 'Lazy concatenation'],
    tags: ['chain', 'concatenate', 'enumerator'],
  },
  {
    id: 'ruby-enum-392',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Filter Map',
    text: 'Use filter_map to filter and transform.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [4, 8],
    sample: 'numbers.filter_map { |n| n * 2 if n.even? }',
    hints: ['filter_map combines select and map', 'Returns non-nil results'],
    tags: ['filter_map', 'transform', 'filter'],
  },
  {
    id: 'ruby-enum-393',
    category: 'Enumerable',
    difficulty: 'easy',
    title: 'Tally Count',
    text: 'Use tally to count occurrences.',
    setup: 'letters = ["a", "b", "a", "c", "b", "a"]',
    setupCode: 'letters = ["a", "b", "a", "c", "b", "a"]',
    expected: { a: 3, b: 2, c: 1 },
    sample: 'letters.tally',
    hints: ['tally counts each unique element', 'Returns hash of counts'],
    tags: ['tally', 'count', 'frequency'],
  },
  {
    id: 'ruby-enum-394',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Uniq By Block',
    text: 'Use uniq with block for custom uniqueness.',
    setup: 'words = ["cat", "car", "dog", "dot"]',
    setupCode: 'words = ["cat", "car", "dog", "dot"]',
    expected: ['cat', 'dog'],
    sample: 'words.uniq { |w| w[0] }',
    hints: ['uniq block determines uniqueness key', 'Keeps first of each group'],
    tags: ['uniq', 'block', 'unique'],
  },
  {
    id: 'ruby-enum-395',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Compact Blank',
    text: 'Chain compact and reject for blank removal.',
    setup: 'items = [1, nil, "", 2, "  ", 3]',
    setupCode: 'items = [1, nil, "", 2, "  ", 3]',
    expected: [1, 2, 3],
    sample: 'items.compact.reject { |x| x.respond_to?(:strip) && x.strip.empty? }',
    hints: ['compact removes nil', 'Need extra logic for empty strings'],
    tags: ['compact', 'blank', 'clean'],
  },
  {
    id: 'ruby-enum-396',
    category: 'Enumerable',
    difficulty: 'hard',
    title: 'Reduce Nested',
    text: 'Use reduce to flatten nested structure.',
    setup: 'nested = [[1, 2], [3, [4, 5]]]',
    setupCode: 'nested = [[1, 2], [3, [4, 5]]]',
    expected: [1, 2, 3, [4, 5]],
    sample: 'nested.reduce([]) { |acc, arr| acc + arr }',
    hints: ['reduce can concatenate arrays', 'Flattens one level'],
    tags: ['reduce', 'flatten', 'concatenate'],
  },
  {
    id: 'ruby-enum-397',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Each Entry',
    text: 'Use each_entry to iterate with explicit block.',
    setup: 'hash = { a: 1, b: 2 }',
    setupCode: 'hash = { a: 1, b: 2 }',
    expected: [
      ['a', 1],
      ['b', 2],
    ],
    sample: 'result = []; hash.each_entry { |e| result << e }; result',
    hints: ['each_entry yields each as single value', 'Useful for hashes'],
    tags: ['each_entry', 'iterate', 'entry'],
  },
  {
    id: 'ruby-enum-398',
    category: 'Enumerable',
    difficulty: 'easy',
    title: 'Drop Last',
    text: 'Combine take and size to drop last n.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [1, 2, 3],
    sample: 'numbers.take(numbers.size - 2)',
    hints: ['No built-in drop_last', 'Use take with calculated size'],
    tags: ['take', 'drop', 'last'],
  },
  {
    id: 'ruby-enum-399',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Sliding Window Sum',
    text: 'Use each_cons to calculate sliding sums.',
    setup: 'numbers = [1, 2, 3, 4, 5]',
    setupCode: 'numbers = [1, 2, 3, 4, 5]',
    expected: [6, 9, 12],
    sample: 'numbers.each_cons(3).map(&:sum)',
    hints: ['each_cons creates overlapping groups', 'Map sum over each window'],
    tags: ['each_cons', 'sliding', 'window'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 5: Symbols, Range, Time/Date, File Operations (50 problems)
  // ============================================================

  {
    id: 'ruby-sym-400',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Create Symbol',
    text: 'Create a symbol from a string.',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: ':hello',
    sample: 'text.to_sym',
    hints: ['to_sym converts string to symbol', 'Also intern works'],
    tags: ['to_sym', 'create', 'convert'],
  },
  {
    id: 'ruby-sym-401',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Symbol to String',
    text: 'Convert symbol back to string.',
    setup: 'sym = :hello',
    setupCode: 'sym = :hello',
    expected: 'hello',
    sample: 'sym.to_s',
    hints: ['to_s converts symbol to string', 'Also id2name works'],
    tags: ['to_s', 'convert', 'string'],
  },
  {
    id: 'ruby-sym-402',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Symbol with Spaces',
    text: 'Create symbol with special characters.',
    setup: '# Symbol with space',
    setupCode: '# Symbol with space',
    expected: ':"hello world"',
    sample: ':"hello world"',
    hints: ['Use quotes for special chars', 'Or %s{} syntax'],
    tags: ['symbol', 'quotes', 'special'],
  },
  {
    id: 'ruby-sym-403',
    category: 'Symbols',
    difficulty: 'medium',
    title: 'All Symbols',
    text: 'Get count of all symbols in Ruby.',
    setup: '# Count symbols',
    setupCode: '# Count symbols',
    expected: true,
    sample: 'Symbol.all_symbols.count > 1000',
    hints: ['all_symbols returns all defined symbols', 'Ruby has many built-in'],
    tags: ['all_symbols', 'count', 'system'],
  },
  {
    id: 'ruby-sym-404',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Symbol Comparison',
    text: 'Compare symbols for equality.',
    setup: 'a = :hello\nb = :hello',
    setupCode: 'a = :hello\nb = :hello',
    expected: true,
    sample: 'a == b && a.equal?(b)',
    hints: ['Same symbols are same object', 'equal? checks object identity'],
    tags: ['symbol', 'compare', 'identity'],
  },
  {
    id: 'ruby-sym-405',
    category: 'Symbols',
    difficulty: 'medium',
    title: 'Symbol Methods',
    text: 'Use upcase on symbol.',
    setup: 'sym = :hello',
    setupCode: 'sym = :hello',
    expected: ':HELLO',
    sample: 'sym.upcase',
    hints: ['Symbols have string-like methods', 'Returns new symbol'],
    tags: ['symbol', 'upcase', 'transform'],
  },
  {
    id: 'ruby-sym-406',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Symbol Match',
    text: 'Check if symbol matches pattern.',
    setup: 'sym = :hello_world',
    setupCode: 'sym = :hello_world',
    expected: true,
    sample: 'sym.match?(/world/)',
    hints: ['Symbols support match?', 'Works like string matching'],
    tags: ['symbol', 'match', 'regex'],
  },
  {
    id: 'ruby-sym-407',
    category: 'Symbols',
    difficulty: 'medium',
    title: 'Symbol Slice',
    text: 'Extract portion of symbol.',
    setup: 'sym = :hello_world',
    setupCode: 'sym = :hello_world',
    expected: 'hello',
    sample: 'sym[0..4]',
    hints: ['Symbols support [] indexing', 'Returns string not symbol'],
    tags: ['symbol', 'slice', 'index'],
  },
  {
    id: 'ruby-sym-408',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Symbol Length',
    text: 'Get length of symbol.',
    setup: 'sym = :hello',
    setupCode: 'sym = :hello',
    expected: 5,
    sample: 'sym.length',
    hints: ['length works on symbols', 'Also size works'],
    tags: ['symbol', 'length', 'size'],
  },
  {
    id: 'ruby-sym-409',
    category: 'Symbols',
    difficulty: 'easy',
    title: 'Symbol Empty Check',
    text: 'Check if symbol is empty.',
    setup: 'sym = :""',
    setupCode: 'sym = :""',
    expected: true,
    sample: 'sym.empty?',
    hints: ['empty? works on symbols', 'Empty symbol is :""'],
    tags: ['symbol', 'empty?', 'check'],
  },
  {
    id: 'ruby-range-410',
    category: 'Range',
    difficulty: 'easy',
    title: 'Inclusive Range',
    text: 'Create inclusive range and convert to array.',
    setup: '# Range 1 to 5',
    setupCode: '# Range 1 to 5',
    expected: [1, 2, 3, 4, 5],
    sample: '(1..5).to_a',
    hints: ['.. creates inclusive range', 'Includes end value'],
    tags: ['range', 'inclusive', 'to_a'],
  },
  {
    id: 'ruby-range-411',
    category: 'Range',
    difficulty: 'easy',
    title: 'Exclusive Range',
    text: 'Create exclusive range (excludes end).',
    setup: '# Range 1 to less than 5',
    setupCode: '# Range 1 to less than 5',
    expected: [1, 2, 3, 4],
    sample: '(1...5).to_a',
    hints: ['... creates exclusive range', 'Excludes end value'],
    tags: ['range', 'exclusive', '...'],
  },
  {
    id: 'ruby-range-412',
    category: 'Range',
    difficulty: 'easy',
    title: 'Range Cover Check',
    text: 'Use cover? to check if value in range.',
    setup: 'range = 1..10',
    setupCode: 'range = 1..10',
    expected: true,
    sample: 'range.cover?(5)',
    hints: ['cover? uses comparison operators', 'Very fast check'],
    tags: ['range', 'cover?', 'check'],
  },
  {
    id: 'ruby-range-413',
    category: 'Range',
    difficulty: 'medium',
    title: 'Range Include Check',
    text: 'Use include? vs cover? for discrete check.',
    setup: 'range = 1..5',
    setupCode: 'range = 1..5',
    expected: false,
    sample: 'range.include?(2.5)',
    hints: ['include? checks discrete membership', 'Returns false for non-integers'],
    tags: ['range', 'include?', 'discrete'],
  },
  {
    id: 'ruby-range-414',
    category: 'Range',
    difficulty: 'easy',
    title: 'Range Begin End',
    text: 'Get begin and end of range.',
    setup: 'range = 5..10',
    setupCode: 'range = 5..10',
    expected: [5, 10],
    sample: '[range.begin, range.end]',
    hints: ['begin returns first value', 'end returns last value'],
    tags: ['range', 'begin', 'end'],
  },
  {
    id: 'ruby-range-415',
    category: 'Range',
    difficulty: 'easy',
    title: 'Range Size',
    text: 'Get size of numeric range.',
    setup: 'range = 1..100',
    setupCode: 'range = 1..100',
    expected: 100,
    sample: 'range.size',
    hints: ['size returns count for numeric', 'Works without iteration'],
    tags: ['range', 'size', 'count'],
  },
  {
    id: 'ruby-range-416',
    category: 'Range',
    difficulty: 'medium',
    title: 'Range Step',
    text: 'Use step to iterate by increment.',
    setup: 'range = 0..10',
    setupCode: 'range = 0..10',
    expected: [0, 2, 4, 6, 8, 10],
    sample: 'range.step(2).to_a',
    hints: ['step(n) increments by n', 'Returns enumerator'],
    tags: ['range', 'step', 'increment'],
  },
  {
    id: 'ruby-range-417',
    category: 'Range',
    difficulty: 'medium',
    title: 'Letter Range',
    text: 'Create range of letters.',
    setup: '# Letters a to f',
    setupCode: '# Letters a to f',
    expected: ['a', 'b', 'c', 'd', 'e', 'f'],
    sample: '("a".."f").to_a',
    hints: ['Ranges work with strings', 'Uses succ for iteration'],
    tags: ['range', 'letters', 'string'],
  },
  {
    id: 'ruby-range-418',
    category: 'Range',
    difficulty: 'easy',
    title: 'Range First',
    text: 'Get first n elements from range.',
    setup: 'range = 1..100',
    setupCode: 'range = 1..100',
    expected: [1, 2, 3, 4, 5],
    sample: 'range.first(5)',
    hints: ['first(n) returns array', 'Does not iterate all'],
    tags: ['range', 'first', 'lazy'],
  },
  {
    id: 'ruby-range-419',
    category: 'Range',
    difficulty: 'easy',
    title: 'Range Last',
    text: 'Get last n elements from range.',
    setup: 'range = 1..10',
    setupCode: 'range = 1..10',
    expected: [8, 9, 10],
    sample: 'range.last(3)',
    hints: ['last(n) returns array', 'From end of range'],
    tags: ['range', 'last', 'tail'],
  },
  {
    id: 'ruby-range-420',
    category: 'Range',
    difficulty: 'medium',
    title: 'Endless Range',
    text: 'Create endless range and take elements.',
    setup: '# Endless range starting at 1',
    setupCode: '# Endless range starting at 1',
    expected: [1, 2, 3, 4, 5],
    sample: '(1..).take(5)',
    hints: ['(n..) creates endless range', 'Must use take or lazy'],
    tags: ['range', 'endless', 'infinite'],
  },
  {
    id: 'ruby-range-421',
    category: 'Range',
    difficulty: 'medium',
    title: 'Beginless Range',
    text: 'Create beginless range for slicing.',
    setup: 'arr = [1, 2, 3, 4, 5]',
    setupCode: 'arr = [1, 2, 3, 4, 5]',
    expected: [1, 2, 3],
    sample: 'arr[..2]',
    hints: ['(..n) is beginless range', 'Useful for array slicing'],
    tags: ['range', 'beginless', 'slice'],
  },
  {
    id: 'ruby-range-422',
    category: 'Range',
    difficulty: 'medium',
    title: 'Range Min Max',
    text: 'Get min and max from range.',
    setup: 'range = 5..15',
    setupCode: 'range = 5..15',
    expected: [5, 15],
    sample: '[range.min, range.max]',
    hints: ['min returns begin', 'max returns end'],
    tags: ['range', 'min', 'max'],
  },
  {
    id: 'ruby-range-423',
    category: 'Range',
    difficulty: 'easy',
    title: 'Range Exclude End',
    text: 'Check if range excludes end.',
    setup: 'range = 1...5',
    setupCode: 'range = 1...5',
    expected: true,
    sample: 'range.exclude_end?',
    hints: ['exclude_end? returns boolean', 'True for ... ranges'],
    tags: ['range', 'exclude_end?', 'check'],
  },
  {
    id: 'ruby-time-424',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'Current Time',
    text: 'Get current time.',
    setup: '# Get now',
    setupCode: '# Get now',
    expected: true,
    sample: 'Time.now.is_a?(Time)',
    hints: ['Time.now returns current time', 'Also Time.new works'],
    tags: ['Time', 'now', 'current'],
  },
  {
    id: 'ruby-time-425',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'Create Specific Time',
    text: 'Create time for specific date.',
    setup: '# January 15, 2024',
    setupCode: '# January 15, 2024',
    expected: 2024,
    sample: 'Time.new(2024, 1, 15).year',
    hints: ['Time.new(y, m, d) creates time', 'Month is 1-12'],
    tags: ['Time', 'new', 'create'],
  },
  {
    id: 'ruby-time-426',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'Time Components',
    text: 'Extract year, month, day from time.',
    setup: 't = Time.new(2024, 3, 15)',
    setupCode: 't = Time.new(2024, 3, 15)',
    expected: [2024, 3, 15],
    sample: '[t.year, t.month, t.day]',
    hints: ['year, month, day accessors', 'Also mday for day'],
    tags: ['Time', 'components', 'access'],
  },
  {
    id: 'ruby-time-427',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Format Time',
    text: 'Format time with strftime.',
    setup: 't = Time.new(2024, 3, 15, 14, 30)',
    setupCode: 't = Time.new(2024, 3, 15, 14, 30)',
    expected: '2024-03-15 14:30',
    sample: 't.strftime("%Y-%m-%d %H:%M")',
    hints: ['strftime formats time', '%Y=year, %m=month, %d=day'],
    tags: ['Time', 'strftime', 'format'],
  },
  {
    id: 'ruby-time-428',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Parse Time String',
    text: 'Parse time from string.',
    setup: 'require "time"',
    setupCode: 'require "time"',
    expected: 2024,
    sample: 'Time.parse("2024-03-15").year',
    hints: ['Time.parse requires require time', 'Parses many formats'],
    tags: ['Time', 'parse', 'string'],
  },
  {
    id: 'ruby-time-429',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'Day of Week',
    text: 'Get day of week from time.',
    setup: 't = Time.new(2024, 3, 15)',
    setupCode: 't = Time.new(2024, 3, 15)',
    expected: 5,
    sample: 't.wday',
    hints: ['wday returns 0-6', '0 is Sunday, 6 is Saturday'],
    tags: ['Time', 'wday', 'weekday'],
  },
  {
    id: 'ruby-time-430',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Time Arithmetic',
    text: 'Add seconds to time.',
    setup: 't = Time.new(2024, 1, 1, 0, 0, 0)',
    setupCode: 't = Time.new(2024, 1, 1, 0, 0, 0)',
    expected: 1,
    sample: '(t + 3600).hour',
    hints: ['+ adds seconds', '3600 = 1 hour'],
    tags: ['Time', 'arithmetic', 'add'],
  },
  {
    id: 'ruby-time-431',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Time Difference',
    text: 'Calculate difference between times.',
    setup: 'a = Time.new(2024, 1, 1)\nb = Time.new(2024, 1, 2)',
    setupCode: 'a = Time.new(2024, 1, 1)\nb = Time.new(2024, 1, 2)',
    expected: 86400,
    sample: '(b - a).to_i',
    hints: ['- returns seconds', '86400 = 1 day'],
    tags: ['Time', 'difference', 'subtract'],
  },
  {
    id: 'ruby-time-432',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'Unix Timestamp',
    text: 'Get Unix timestamp.',
    setup: 't = Time.new(2024, 1, 1, 0, 0, 0, "+00:00")',
    setupCode: 't = Time.new(2024, 1, 1, 0, 0, 0, "+00:00")',
    expected: 1704067200,
    sample: 't.to_i',
    hints: ['to_i returns Unix timestamp', 'Seconds since 1970'],
    tags: ['Time', 'to_i', 'unix'],
  },
  {
    id: 'ruby-time-433',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Time from Timestamp',
    text: 'Create time from Unix timestamp.',
    setup: 'ts = 1704067200',
    setupCode: 'ts = 1704067200',
    expected: 2024,
    sample: 'Time.at(ts).utc.year',
    hints: ['Time.at creates from timestamp', 'Use utc for UTC'],
    tags: ['Time', 'at', 'timestamp'],
  },
  {
    id: 'ruby-time-434',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'UTC Time',
    text: 'Convert time to UTC.',
    setup: 't = Time.now',
    setupCode: 't = Time.now',
    expected: true,
    sample: 't.utc.utc?',
    hints: ['utc converts to UTC', 'utc? checks if UTC'],
    tags: ['Time', 'utc', 'timezone'],
  },
  {
    id: 'ruby-time-435',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Date Today',
    text: 'Get current date.',
    setup: 'require "date"',
    setupCode: 'require "date"',
    expected: true,
    sample: 'Date.today.is_a?(Date)',
    hints: ['Date.today returns current date', 'Requires date library'],
    tags: ['Date', 'today', 'current'],
  },
  {
    id: 'ruby-time-436',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Date Arithmetic',
    text: 'Add days to date.',
    setup: 'require "date"\nd = Date.new(2024, 1, 1)',
    setupCode: 'require "date"\nd = Date.new(2024, 1, 1)',
    expected: 8,
    sample: '(d + 7).day',
    hints: ['+ adds days to Date', 'Returns new Date'],
    tags: ['Date', 'arithmetic', 'days'],
  },
  {
    id: 'ruby-time-437',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Date Range',
    text: 'Create date range and count.',
    setup: 'require "date"\nstart_date = Date.new(2024, 1, 1)\nend_date = Date.new(2024, 1, 7)',
    setupCode: 'require "date"\nstart_date = Date.new(2024, 1, 1)\nend_date = Date.new(2024, 1, 7)',
    expected: 7,
    sample: '(start_date..end_date).count',
    hints: ['Date ranges work like others', 'Can iterate over dates'],
    tags: ['Date', 'range', 'iterate'],
  },
  {
    id: 'ruby-time-438',
    category: 'Time/Date',
    difficulty: 'easy',
    title: 'Date Leap Year',
    text: 'Check if year is leap year.',
    setup: 'require "date"',
    setupCode: 'require "date"',
    expected: true,
    sample: 'Date.leap?(2024)',
    hints: ['Date.leap? checks leap year', 'Class method'],
    tags: ['Date', 'leap?', 'year'],
  },
  {
    id: 'ruby-time-439',
    category: 'Time/Date',
    difficulty: 'medium',
    title: 'Date Day Name',
    text: 'Get name of day of week.',
    setup: 'require "date"\nd = Date.new(2024, 3, 15)',
    setupCode: 'require "date"\nd = Date.new(2024, 3, 15)',
    expected: 'Friday',
    sample: 'd.strftime("%A")',
    hints: ['%A gives full day name', 'strftime for formatting'],
    tags: ['Date', 'strftime', 'day'],
  },
  {
    id: 'ruby-file-440',
    category: 'File Operations',
    difficulty: 'easy',
    title: 'Check File Exists',
    text: 'Check if file exists.',
    setup: '# Check /etc/hosts',
    setupCode: '# Check /etc/hosts',
    expected: true,
    sample: 'File.exist?("/etc/hosts")',
    hints: ['File.exist? checks existence', 'Returns boolean'],
    tags: ['File', 'exist?', 'check'],
  },
  {
    id: 'ruby-file-441',
    category: 'File Operations',
    difficulty: 'easy',
    title: 'Check Directory',
    text: 'Check if path is directory.',
    setup: '# Check /tmp',
    setupCode: '# Check /tmp',
    expected: true,
    sample: 'File.directory?("/tmp")',
    hints: ['directory? checks for dir', 'False for files'],
    tags: ['File', 'directory?', 'check'],
  },
  {
    id: 'ruby-file-442',
    category: 'File Operations',
    difficulty: 'easy',
    title: 'Check Regular File',
    text: 'Check if path is regular file.',
    setup: '# Check /etc/hosts',
    setupCode: '# Check /etc/hosts',
    expected: true,
    sample: 'File.file?("/etc/hosts")',
    hints: ['file? checks for regular file', 'False for directories'],
    tags: ['File', 'file?', 'check'],
  },
  {
    id: 'ruby-file-443',
    category: 'File Operations',
    difficulty: 'easy',
    title: 'Get Basename',
    text: 'Extract filename from path.',
    setup: 'path = "/home/user/document.txt"',
    setupCode: 'path = "/home/user/document.txt"',
    expected: 'document.txt',
    sample: 'File.basename(path)',
    hints: ['basename extracts filename', 'Removes directory'],
    tags: ['File', 'basename', 'extract'],
  },
  {
    id: 'ruby-file-444',
    category: 'File Operations',
    difficulty: 'easy',
    title: 'Get Directory',
    text: 'Extract directory from path.',
    setup: 'path = "/home/user/document.txt"',
    setupCode: 'path = "/home/user/document.txt"',
    expected: '/home/user',
    sample: 'File.dirname(path)',
    hints: ['dirname extracts directory', 'Removes filename'],
    tags: ['File', 'dirname', 'extract'],
  },
  {
    id: 'ruby-file-445',
    category: 'File Operations',
    difficulty: 'easy',
    title: 'Get Extension',
    text: 'Extract file extension.',
    setup: 'path = "/home/user/document.txt"',
    setupCode: 'path = "/home/user/document.txt"',
    expected: '.txt',
    sample: 'File.extname(path)',
    hints: ['extname returns extension', 'Includes the dot'],
    tags: ['File', 'extname', 'extension'],
  },
  {
    id: 'ruby-file-446',
    category: 'File Operations',
    difficulty: 'medium',
    title: 'Join Path Parts',
    text: 'Join path components.',
    setup: 'parts = ["home", "user", "docs"]',
    setupCode: 'parts = ["home", "user", "docs"]',
    expected: 'home/user/docs',
    sample: 'File.join(*parts)',
    hints: ['File.join handles separators', 'Platform independent'],
    tags: ['File', 'join', 'path'],
  },
  {
    id: 'ruby-file-447',
    category: 'File Operations',
    difficulty: 'medium',
    title: 'Expand Path',
    text: 'Expand relative path to absolute.',
    setup: '# Expand ~ path',
    setupCode: '# Expand ~ path',
    expected: true,
    sample: 'File.expand_path("~").start_with?("/")',
    hints: ['expand_path resolves path', 'Handles ~ for home'],
    tags: ['File', 'expand_path', 'absolute'],
  },
  {
    id: 'ruby-file-448',
    category: 'File Operations',
    difficulty: 'medium',
    title: 'Split Path',
    text: 'Split path into dir and file.',
    setup: 'path = "/home/user/doc.txt"',
    setupCode: 'path = "/home/user/doc.txt"',
    expected: ['/home/user', 'doc.txt'],
    sample: 'File.split(path)',
    hints: ['split returns [dir, file]', 'Opposite of join'],
    tags: ['File', 'split', 'path'],
  },
  {
    id: 'ruby-file-449',
    category: 'File Operations',
    difficulty: 'medium',
    title: 'List Directory',
    text: 'List files in directory.',
    setup: '# List /tmp entries',
    setupCode: '# List /tmp entries',
    expected: true,
    sample: 'Dir.entries("/tmp").include?(".")',
    hints: ['Dir.entries lists all files', 'Includes . and ..'],
    tags: ['Dir', 'entries', 'list'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 6: Struct, OpenStruct, OOP, Metaprogramming (50 problems)
  // ============================================================

  {
    id: 'ruby-struct-450',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'Create Struct Class',
    text: 'Create a Person struct with name and age.',
    setup: 'Person = Struct.new(:name, :age)',
    setupCode: 'Person = Struct.new(:name, :age)',
    expected: 'Alice',
    sample: 'Person.new("Alice", 30).name',
    hints: ['Struct.new creates a class', 'Arguments become attributes'],
    tags: ['Struct', 'new', 'create'],
  },
  {
    id: 'ruby-struct-451',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'Struct with Keyword Args',
    text: 'Create struct with keyword_init.',
    setup: 'Person = Struct.new(:name, :age, keyword_init: true)',
    setupCode: 'Person = Struct.new(:name, :age, keyword_init: true)',
    expected: 30,
    sample: 'Person.new(name: "Alice", age: 30).age',
    hints: ['keyword_init: true enables kwargs', 'More explicit initialization'],
    tags: ['Struct', 'keyword_init', 'kwargs'],
  },
  {
    id: 'ruby-struct-452',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'Struct to Hash',
    text: 'Convert struct instance to hash.',
    setup: 'Person = Struct.new(:name, :age)\np = Person.new("Alice", 30)',
    setupCode: 'Person = Struct.new(:name, :age)\np = Person.new("Alice", 30)',
    expected: { name: 'Alice', age: 30 },
    sample: 'p.to_h',
    hints: ['to_h converts to hash', 'Keys are attribute names'],
    tags: ['Struct', 'to_h', 'convert'],
  },
  {
    id: 'ruby-struct-453',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'Struct to Array',
    text: 'Convert struct instance to array.',
    setup: 'Person = Struct.new(:name, :age)\np = Person.new("Alice", 30)',
    setupCode: 'Person = Struct.new(:name, :age)\np = Person.new("Alice", 30)',
    expected: ['Alice', 30],
    sample: 'p.to_a',
    hints: ['to_a returns values array', 'Order matches definition'],
    tags: ['Struct', 'to_a', 'values'],
  },
  {
    id: 'ruby-struct-454',
    category: 'Struct/OpenStruct',
    difficulty: 'medium',
    title: 'Struct with Methods',
    text: 'Define struct with custom method.',
    setup: 'Person = Struct.new(:name, :age) { def adult?; age >= 18; end }',
    setupCode: 'Person = Struct.new(:name, :age) { def adult?; age >= 18; end }',
    expected: true,
    sample: 'Person.new("Alice", 30).adult?',
    hints: ['Block adds methods to struct', 'Access attributes directly'],
    tags: ['Struct', 'methods', 'block'],
  },
  {
    id: 'ruby-struct-455',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'Struct Members',
    text: 'Get list of struct attributes.',
    setup: 'Person = Struct.new(:name, :age)',
    setupCode: 'Person = Struct.new(:name, :age)',
    expected: ['name', 'age'],
    sample: 'Person.members',
    hints: ['members returns attribute symbols', 'Class method'],
    tags: ['Struct', 'members', 'attributes'],
  },
  {
    id: 'ruby-struct-456',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'Struct Bracket Access',
    text: 'Access struct attribute by symbol.',
    setup: 'Person = Struct.new(:name, :age)\np = Person.new("Alice", 30)',
    setupCode: 'Person = Struct.new(:name, :age)\np = Person.new("Alice", 30)',
    expected: 'Alice',
    sample: 'p[:name]',
    hints: ['[] allows symbol access', 'Also works with strings'],
    tags: ['Struct', '[]', 'access'],
  },
  {
    id: 'ruby-struct-457',
    category: 'Struct/OpenStruct',
    difficulty: 'medium',
    title: 'Struct Equality',
    text: 'Compare struct instances.',
    setup:
      'Person = Struct.new(:name, :age)\na = Person.new("Alice", 30)\nb = Person.new("Alice", 30)',
    setupCode:
      'Person = Struct.new(:name, :age)\na = Person.new("Alice", 30)\nb = Person.new("Alice", 30)',
    expected: true,
    sample: 'a == b',
    hints: ['Structs compare by values', 'Same values = equal'],
    tags: ['Struct', '==', 'equality'],
  },
  {
    id: 'ruby-struct-458',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'OpenStruct Create',
    text: 'Create OpenStruct with dynamic attributes.',
    setup: 'require "ostruct"',
    setupCode: 'require "ostruct"',
    expected: 'Alice',
    sample: 'OpenStruct.new(name: "Alice", age: 30).name',
    hints: ['OpenStruct allows any attributes', 'More flexible than Struct'],
    tags: ['OpenStruct', 'new', 'dynamic'],
  },
  {
    id: 'ruby-struct-459',
    category: 'Struct/OpenStruct',
    difficulty: 'easy',
    title: 'OpenStruct Add Attribute',
    text: 'Add attribute to OpenStruct dynamically.',
    setup: 'require "ostruct"\no = OpenStruct.new',
    setupCode: 'require "ostruct"\no = OpenStruct.new',
    expected: 'Alice',
    sample: 'o.name = "Alice"; o.name',
    hints: ['Assign any attribute name', 'Creates getter and setter'],
    tags: ['OpenStruct', 'dynamic', 'attribute'],
  },
  {
    id: 'ruby-struct-460',
    category: 'Struct/OpenStruct',
    difficulty: 'medium',
    title: 'OpenStruct to Hash',
    text: 'Convert OpenStruct to hash.',
    setup: 'require "ostruct"\no = OpenStruct.new(a: 1, b: 2)',
    setupCode: 'require "ostruct"\no = OpenStruct.new(a: 1, b: 2)',
    expected: { a: 1, b: 2 },
    sample: 'o.to_h',
    hints: ['to_h converts to hash', 'All attributes included'],
    tags: ['OpenStruct', 'to_h', 'convert'],
  },
  {
    id: 'ruby-struct-461',
    category: 'Struct/OpenStruct',
    difficulty: 'medium',
    title: 'OpenStruct Delete Attribute',
    text: 'Remove attribute from OpenStruct.',
    setup: 'require "ostruct"\no = OpenStruct.new(a: 1, b: 2)',
    setupCode: 'require "ostruct"\no = OpenStruct.new(a: 1, b: 2)',
    expected: 1,
    sample: 'o.delete_field(:a)',
    hints: ['delete_field removes attribute', 'Returns deleted value'],
    tags: ['OpenStruct', 'delete_field', 'remove'],
  },
  {
    id: 'ruby-oop-462',
    category: 'Object-Oriented',
    difficulty: 'easy',
    title: 'Check Class',
    text: 'Check object class.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: 'String',
    sample: 'obj.class.name',
    hints: ['class returns object class', 'name gives string name'],
    tags: ['class', 'type', 'check'],
  },
  {
    id: 'ruby-oop-463',
    category: 'Object-Oriented',
    difficulty: 'easy',
    title: 'Check Instance Of',
    text: 'Check if object is instance of class.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.is_a?(String)',
    hints: ['is_a? checks inheritance', 'Also kind_of? works'],
    tags: ['is_a?', 'instance', 'check'],
  },
  {
    id: 'ruby-oop-464',
    category: 'Object-Oriented',
    difficulty: 'easy',
    title: 'Check Exact Class',
    text: 'Check if object is exactly a class.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.instance_of?(String)',
    hints: ['instance_of? checks exact class', 'Not subclasses'],
    tags: ['instance_of?', 'exact', 'class'],
  },
  {
    id: 'ruby-oop-465',
    category: 'Object-Oriented',
    difficulty: 'easy',
    title: 'Check Respond To',
    text: 'Check if object responds to method.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.respond_to?(:upcase)',
    hints: ['respond_to? checks method exists', 'Duck typing check'],
    tags: ['respond_to?', 'method', 'duck'],
  },
  {
    id: 'ruby-oop-466',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Object Methods List',
    text: 'Get list of object methods.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.methods.include?(:upcase)',
    hints: ['methods returns all methods', 'Very long list'],
    tags: ['methods', 'list', 'introspection'],
  },
  {
    id: 'ruby-oop-467',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Public Methods Only',
    text: 'Get only public methods.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.public_methods.include?(:length)',
    hints: ['public_methods excludes private', 'Pass false for own only'],
    tags: ['public_methods', 'visibility', 'list'],
  },
  {
    id: 'ruby-oop-468',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Instance Variables',
    text: 'Get list of instance variables.',
    setup: 'class Dog; def initialize; @name = "Rex"; end; end\nd = Dog.new',
    setupCode: 'class Dog; def initialize; @name = "Rex"; end; end\nd = Dog.new',
    expected: ['@name'],
    sample: 'd.instance_variables',
    hints: ['instance_variables lists ivars', 'Returns array of symbols'],
    tags: ['instance_variables', 'ivars', 'list'],
  },
  {
    id: 'ruby-oop-469',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Get Instance Variable',
    text: 'Read instance variable by name.',
    setup: 'class Dog; def initialize; @name = "Rex"; end; end\nd = Dog.new',
    setupCode: 'class Dog; def initialize; @name = "Rex"; end; end\nd = Dog.new',
    expected: 'Rex',
    sample: 'd.instance_variable_get(:@name)',
    hints: ['instance_variable_get reads ivar', 'Include @ in symbol'],
    tags: ['instance_variable_get', 'read', 'ivar'],
  },
  {
    id: 'ruby-oop-470',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Set Instance Variable',
    text: 'Set instance variable by name.',
    setup: 'class Dog; def name; @name; end; end\nd = Dog.new',
    setupCode: 'class Dog; def name; @name; end; end\nd = Dog.new',
    expected: 'Max',
    sample: 'd.instance_variable_set(:@name, "Max"); d.name',
    hints: ['instance_variable_set writes ivar', 'Can create new ivars'],
    tags: ['instance_variable_set', 'write', 'ivar'],
  },
  {
    id: 'ruby-oop-471',
    category: 'Object-Oriented',
    difficulty: 'hard',
    title: 'Method Missing',
    text: 'Define method_missing for dynamic methods.',
    setup: 'class Echo; def method_missing(m, *args); "Called: #{m}"; end; end',
    setupCode: 'class Echo; def method_missing(m, *args); "Called: #{m}"; end; end',
    expected: 'Called: hello',
    sample: 'Echo.new.hello',
    hints: ['method_missing catches undefined calls', 'First arg is method name'],
    tags: ['method_missing', 'dynamic', 'catch'],
  },
  {
    id: 'ruby-oop-472',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Ancestors Chain',
    text: 'Get class ancestors.',
    setup: 'class Animal; end\nclass Dog < Animal; end',
    setupCode: 'class Animal; end\nclass Dog < Animal; end',
    expected: true,
    sample: 'Dog.ancestors.include?(Animal)',
    hints: ['ancestors returns inheritance chain', 'Includes modules too'],
    tags: ['ancestors', 'inheritance', 'chain'],
  },
  {
    id: 'ruby-oop-473',
    category: 'Object-Oriented',
    difficulty: 'easy',
    title: 'Superclass',
    text: 'Get parent class.',
    setup: 'class Animal; end\nclass Dog < Animal; end',
    setupCode: 'class Animal; end\nclass Dog < Animal; end',
    expected: 'Animal',
    sample: 'Dog.superclass.name',
    hints: ['superclass returns parent', 'Only immediate parent'],
    tags: ['superclass', 'parent', 'inheritance'],
  },
  {
    id: 'ruby-oop-474',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Include Module',
    text: 'Include module for instance methods.',
    setup: 'module Greet; def hi; "Hello!"; end; end\nclass Person; include Greet; end',
    setupCode: 'module Greet; def hi; "Hello!"; end; end\nclass Person; include Greet; end',
    expected: 'Hello!',
    sample: 'Person.new.hi',
    hints: ['include adds instance methods', 'Module becomes ancestor'],
    tags: ['include', 'module', 'mixin'],
  },
  {
    id: 'ruby-oop-475',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Extend Module',
    text: 'Extend module for class methods.',
    setup: 'module ClassMethods; def count; 42; end; end\nclass Item; extend ClassMethods; end',
    setupCode: 'module ClassMethods; def count; 42; end; end\nclass Item; extend ClassMethods; end',
    expected: 42,
    sample: 'Item.count',
    hints: ['extend adds class methods', 'Called on class not instance'],
    tags: ['extend', 'module', 'class_methods'],
  },
  {
    id: 'ruby-oop-476',
    category: 'Object-Oriented',
    difficulty: 'hard',
    title: 'Prepend Module',
    text: 'Prepend module to override methods.',
    setup:
      'module Loud; def speak; super.upcase; end; end\nclass Dog; prepend Loud; def speak; "woof"; end; end',
    setupCode:
      'module Loud; def speak; super.upcase; end; end\nclass Dog; prepend Loud; def speak; "woof"; end; end',
    expected: 'WOOF',
    sample: 'Dog.new.speak',
    hints: ['prepend inserts before class', 'Can call super'],
    tags: ['prepend', 'override', 'module'],
  },
  {
    id: 'ruby-meta-477',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Define Method',
    text: 'Define method dynamically.',
    setup: 'class Calculator; end',
    setupCode: 'class Calculator; end',
    expected: 10,
    sample: 'Calculator.define_method(:double) { |n| n * 2 }; Calculator.new.double(5)',
    hints: ['define_method creates method', 'Block becomes method body'],
    tags: ['define_method', 'dynamic', 'create'],
  },
  {
    id: 'ruby-meta-478',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Send Method',
    text: 'Call method by name with send.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: 'HELLO',
    sample: 'obj.send(:upcase)',
    hints: ['send calls method by symbol', 'Can call private methods'],
    tags: ['send', 'dynamic', 'call'],
  },
  {
    id: 'ruby-meta-479',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Public Send',
    text: 'Call public method only with public_send.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: 'HELLO',
    sample: 'obj.public_send(:upcase)',
    hints: ['public_send respects visibility', 'Safer than send'],
    tags: ['public_send', 'safe', 'call'],
  },
  {
    id: 'ruby-meta-480',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Instance Eval',
    text: 'Evaluate code in object context.',
    setup: 'class Box; def initialize; @value = 42; end; end\nb = Box.new',
    setupCode: 'class Box; def initialize; @value = 42; end; end\nb = Box.new',
    expected: 42,
    sample: 'b.instance_eval { @value }',
    hints: ['instance_eval runs in object context', 'Access private state'],
    tags: ['instance_eval', 'context', 'private'],
  },
  {
    id: 'ruby-meta-481',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Class Eval',
    text: 'Add method to class dynamically.',
    setup: 'class Dog; end',
    setupCode: 'class Dog; end',
    expected: 'Woof!',
    sample: 'Dog.class_eval { def bark; "Woof!"; end }; Dog.new.bark',
    hints: ['class_eval modifies class', 'Like reopening class'],
    tags: ['class_eval', 'modify', 'class'],
  },
  {
    id: 'ruby-meta-482',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Method Object',
    text: 'Get method as object.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: 'HELLO',
    sample: 'm = obj.method(:upcase); m.call',
    hints: ['method(:name) returns Method object', 'Call with call'],
    tags: ['method', 'object', 'callable'],
  },
  {
    id: 'ruby-meta-483',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Unbound Method',
    text: 'Get unbound method from class.',
    setup: 'class Greeter; def hi; "Hello"; end; end',
    setupCode: 'class Greeter; def hi; "Hello"; end; end',
    expected: 'Hello',
    sample: 'm = Greeter.instance_method(:hi); m.bind(Greeter.new).call',
    hints: ['instance_method gets unbound method', 'Must bind to instance'],
    tags: ['instance_method', 'unbound', 'bind'],
  },
  {
    id: 'ruby-meta-484',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Alias Method',
    text: 'Create method alias.',
    setup: 'class Dog; def speak; "woof"; end; alias_method :bark, :speak; end',
    setupCode: 'class Dog; def speak; "woof"; end; alias_method :bark, :speak; end',
    expected: 'woof',
    sample: 'Dog.new.bark',
    hints: ['alias_method creates alias', 'New name first, old name second'],
    tags: ['alias_method', 'alias', 'rename'],
  },
  {
    id: 'ruby-meta-485',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Undef Method',
    text: 'Remove method from class.',
    setup: 'class Calc; def add(a, b); a + b; end; end\nCalc.undef_method(:add)',
    setupCode: 'class Calc; def add(a, b); a + b; end; end\nCalc.undef_method(:add)',
    expected: false,
    sample: 'Calc.new.respond_to?(:add)',
    hints: ['undef_method removes method', 'NoMethodError if called'],
    tags: ['undef_method', 'remove', 'delete'],
  },
  {
    id: 'ruby-meta-486',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Const Get',
    text: 'Get constant by name.',
    setup: 'MY_VALUE = 42',
    setupCode: 'MY_VALUE = 42',
    expected: 42,
    sample: 'Object.const_get(:MY_VALUE)',
    hints: ['const_get retrieves constant', 'Works with class names too'],
    tags: ['const_get', 'constant', 'dynamic'],
  },
  {
    id: 'ruby-meta-487',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Const Set',
    text: 'Set constant dynamically.',
    setup: '# Set constant',
    setupCode: '# Set constant',
    expected: 100,
    sample: 'Object.const_set(:DYNAMIC_CONST, 100); DYNAMIC_CONST',
    hints: ['const_set creates constant', 'Warning if already exists'],
    tags: ['const_set', 'constant', 'create'],
  },
  {
    id: 'ruby-meta-488',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Define Singleton Method',
    text: 'Add method to single object only.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: 'HELLO!',
    sample: 'obj.define_singleton_method(:shout) { upcase + "!" }; obj.shout',
    hints: ['define_singleton_method for one object', 'Other strings unaffected'],
    tags: ['define_singleton_method', 'singleton', 'individual'],
  },
  {
    id: 'ruby-meta-489',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Singleton Class',
    text: 'Access singleton class.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.singleton_class.is_a?(Class)',
    hints: ['singleton_class returns eigenclass', 'For object-specific methods'],
    tags: ['singleton_class', 'eigenclass', 'meta'],
  },
  {
    id: 'ruby-meta-490',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Method Defined Check',
    text: 'Check if method is defined.',
    setup: 'class Dog; def bark; end; end',
    setupCode: 'class Dog; def bark; end; end',
    expected: true,
    sample: 'Dog.method_defined?(:bark)',
    hints: ['method_defined? checks class methods', 'Not private by default'],
    tags: ['method_defined?', 'check', 'exists'],
  },
  {
    id: 'ruby-meta-491',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Attr Accessor Dynamic',
    text: 'Create accessors dynamically.',
    setup: 'class Box; end',
    setupCode: 'class Box; end',
    expected: 42,
    sample: 'Box.attr_accessor(:value); b = Box.new; b.value = 42; b.value',
    hints: ['attr_accessor is a method', 'Can call on class'],
    tags: ['attr_accessor', 'dynamic', 'accessor'],
  },
  {
    id: 'ruby-meta-492',
    category: 'Metaprogramming',
    difficulty: 'easy',
    title: 'Object ID',
    text: 'Get unique object identifier.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.object_id.is_a?(Integer)',
    hints: ['object_id is unique per object', 'Same object = same id'],
    tags: ['object_id', 'identity', 'unique'],
  },
  {
    id: 'ruby-meta-493',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Freeze Object',
    text: 'Make object immutable.',
    setup: 'obj = "hello"',
    setupCode: 'obj = "hello"',
    expected: true,
    sample: 'obj.freeze; obj.frozen?',
    hints: ['freeze prevents modification', 'frozen? checks state'],
    tags: ['freeze', 'frozen?', 'immutable'],
  },
  {
    id: 'ruby-meta-494',
    category: 'Metaprogramming',
    difficulty: 'easy',
    title: 'Dup Object',
    text: 'Create shallow copy.',
    setup: 'arr = [1, 2, 3]',
    setupCode: 'arr = [1, 2, 3]',
    expected: false,
    sample: 'copy = arr.dup; copy.equal?(arr)',
    hints: ['dup creates shallow copy', 'Different object'],
    tags: ['dup', 'copy', 'shallow'],
  },
  {
    id: 'ruby-meta-495',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Clone Object',
    text: 'Clone with singleton methods.',
    setup: 'obj = "hello"; obj.define_singleton_method(:foo) { "bar" }',
    setupCode: 'obj = "hello"; obj.define_singleton_method(:foo) { "bar" }',
    expected: 'bar',
    sample: 'copy = obj.clone; copy.foo',
    hints: ['clone copies singleton methods', 'dup does not'],
    tags: ['clone', 'copy', 'singleton'],
  },
  {
    id: 'ruby-meta-496',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Binding Object',
    text: 'Capture execution context.',
    setup: 'x = 10; b = binding',
    setupCode: 'x = 10; b = binding',
    expected: 10,
    sample: 'b.local_variable_get(:x)',
    hints: ['binding captures context', 'Access local variables'],
    tags: ['binding', 'context', 'locals'],
  },
  {
    id: 'ruby-meta-497',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Eval with Binding',
    text: 'Evaluate code in binding context.',
    setup: 'x = 5; b = binding',
    setupCode: 'x = 5; b = binding',
    expected: 25,
    sample: 'eval("x * x", b)',
    hints: ['eval executes string as code', 'Binding provides context'],
    tags: ['eval', 'binding', 'execute'],
  },
  {
    id: 'ruby-meta-498',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Caller Stack',
    text: 'Get call stack.',
    setup: 'def foo; caller; end',
    setupCode: 'def foo; caller; end',
    expected: true,
    sample: 'foo.is_a?(Array)',
    hints: ['caller returns stack trace', 'Array of strings'],
    tags: ['caller', 'stack', 'trace'],
  },
  {
    id: 'ruby-meta-499',
    category: 'Metaprogramming',
    difficulty: 'medium',
    title: 'Caller Locations',
    text: 'Get structured call stack.',
    setup: 'def bar; caller_locations; end',
    setupCode: 'def bar; caller_locations; end',
    expected: true,
    sample: 'bar.first.respond_to?(:lineno)',
    hints: ['caller_locations returns objects', 'Has lineno, path methods'],
    tags: ['caller_locations', 'stack', 'structured'],
  },

  // ============================================================
  // NEW PROBLEMS BATCH 7: Pattern Matching, Data Class, Ractor (50 problems)
  // ============================================================

  {
    id: 'ruby-pattern-500',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Basic Pattern Match',
    text: 'Use case/in for pattern matching.',
    setup: 'data = [1, 2, 3]',
    setupCode: 'data = [1, 2, 3]',
    expected: 'three elements',
    sample: 'case data; in [_, _, _]; "three elements"; else; "other"; end',
    hints: ['case/in for pattern matching', '_ matches any value'],
    tags: ['pattern', 'case', 'in'],
  },
  {
    id: 'ruby-pattern-501',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Array Pattern with Capture',
    text: 'Capture values in array pattern.',
    setup: 'data = [1, 2, 3]',
    setupCode: 'data = [1, 2, 3]',
    expected: 2,
    sample: 'case data; in [_, middle, _]; middle; end',
    hints: ['Named variables capture values', 'Position matters'],
    tags: ['pattern', 'capture', 'array'],
  },
  {
    id: 'ruby-pattern-502',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Hash Pattern Match',
    text: 'Match hash with pattern.',
    setup: 'data = { name: "Alice", age: 30 }',
    setupCode: 'data = { name: "Alice", age: 30 }',
    expected: 'Alice',
    sample: 'case data; in { name: n }; n; end',
    hints: ['Hash pattern extracts values', 'Partial match allowed'],
    tags: ['pattern', 'hash', 'extract'],
  },
  {
    id: 'ruby-pattern-503',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Rest Pattern',
    text: 'Use rest pattern to capture remaining.',
    setup: 'data = [1, 2, 3, 4, 5]',
    setupCode: 'data = [1, 2, 3, 4, 5]',
    expected: [2, 3, 4],
    sample: 'case data; in [first, *middle, last]; middle; end',
    hints: ['*rest captures remaining elements', 'Works at any position'],
    tags: ['pattern', 'rest', 'splat'],
  },
  {
    id: 'ruby-pattern-504',
    category: 'Pattern Matching',
    difficulty: 'hard',
    title: 'Guard in Pattern',
    text: 'Use guard clause in pattern.',
    setup: 'data = { age: 25 }',
    setupCode: 'data = { age: 25 }',
    expected: 'adult',
    sample: 'case data; in { age: a } if a >= 18; "adult"; else; "minor"; end',
    hints: ['if adds guard condition', 'Pattern must match AND guard'],
    tags: ['pattern', 'guard', 'condition'],
  },
  {
    id: 'ruby-pattern-505',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Alternative Pattern',
    text: 'Match multiple patterns with |.',
    setup: 'status = :ok',
    setupCode: 'status = :ok',
    expected: 'success',
    sample: 'case status; in :ok | :success; "success"; else; "fail"; end',
    hints: ['| allows alternatives', 'Any pattern can match'],
    tags: ['pattern', 'alternative', 'or'],
  },
  {
    id: 'ruby-pattern-506',
    category: 'Pattern Matching',
    difficulty: 'hard',
    title: 'Nested Pattern',
    text: 'Match deeply nested structure.',
    setup: 'data = { user: { profile: { name: "Alice" } } }',
    setupCode: 'data = { user: { profile: { name: "Alice" } } }',
    expected: 'Alice',
    sample: 'case data; in { user: { profile: { name: n } } }; n; end',
    hints: ['Patterns can nest deeply', 'Each level must match'],
    tags: ['pattern', 'nested', 'deep'],
  },
  {
    id: 'ruby-pattern-507',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Type Pattern',
    text: 'Match by type with deconstruction.',
    setup: 'data = { name: "Alice", age: 30 }',
    setupCode: 'data = { name: "Alice", age: 30 }',
    expected: true,
    sample: 'case data; in Hash; true; else; false; end',
    hints: ['Class name matches type', 'Like is_a? check'],
    tags: ['pattern', 'type', 'class'],
  },
  {
    id: 'ruby-pattern-508',
    category: 'Pattern Matching',
    difficulty: 'hard',
    title: 'Pin Operator',
    text: 'Use ^ to pin variable value.',
    setup: 'expected = 42\ndata = [42, 43]',
    setupCode: 'expected = 42\ndata = [42, 43]',
    expected: true,
    sample: 'case data; in [^expected, _]; true; else; false; end',
    hints: ['^var pins existing value', 'Matches exact value'],
    tags: ['pattern', 'pin', 'exact'],
  },
  {
    id: 'ruby-pattern-509',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'As Pattern',
    text: 'Capture matched value with =>.',
    setup: 'data = [1, [2, 3], 4]',
    setupCode: 'data = [1, [2, 3], 4]',
    expected: [2, 3],
    sample: 'case data; in [_, inner => captured, _]; captured; end',
    hints: ['=> captures while matching', 'Binds matched portion'],
    tags: ['pattern', 'as', 'capture'],
  },
  {
    id: 'ruby-pattern-510',
    category: 'Pattern Matching',
    difficulty: 'easy',
    title: 'Rightward Assignment',
    text: 'Use => for rightward assignment.',
    setup: '# Rightward assign',
    setupCode: '# Rightward assign',
    expected: 42,
    sample: '42 => x; x',
    hints: ['value => var assigns right', 'Ruby 3.0+ feature'],
    tags: ['pattern', '=>', 'assign'],
  },
  {
    id: 'ruby-pattern-511',
    category: 'Pattern Matching',
    difficulty: 'medium',
    title: 'Find Pattern',
    text: 'Use find pattern for subsequence.',
    setup: 'data = [1, 2, 3, 4, 5]',
    setupCode: 'data = [1, 2, 3, 4, 5]',
    expected: 3,
    sample: 'case data; in [*, x, *] if x > 2; x; end',
    hints: ['* at both ends for find pattern', 'Finds matching element'],
    tags: ['pattern', 'find', 'subsequence'],
  },
  {
    id: 'ruby-data-512',
    category: 'Data Class',
    difficulty: 'medium',
    title: 'Create Data Class',
    text: 'Create immutable data class.',
    setup: 'Point = Data.define(:x, :y)',
    setupCode: 'Point = Data.define(:x, :y)',
    expected: 3,
    sample: 'Point.new(3, 4).x',
    hints: ['Data.define creates immutable class', 'Ruby 3.2+ feature'],
    tags: ['Data', 'define', 'immutable'],
  },
  {
    id: 'ruby-data-513',
    category: 'Data Class',
    difficulty: 'medium',
    title: 'Data with Keywords',
    text: 'Create Data with keyword arguments.',
    setup: 'Point = Data.define(:x, :y)',
    setupCode: 'Point = Data.define(:x, :y)',
    expected: 4,
    sample: 'Point.new(x: 3, y: 4).y',
    hints: ['Data supports keyword init', 'Always keyword or positional'],
    tags: ['Data', 'keyword', 'init'],
  },
  {
    id: 'ruby-data-514',
    category: 'Data Class',
    difficulty: 'medium',
    title: 'Data to Hash',
    text: 'Convert Data to hash.',
    setup: 'Point = Data.define(:x, :y)\np = Point.new(3, 4)',
    setupCode: 'Point = Data.define(:x, :y)\np = Point.new(3, 4)',
    expected: { x: 3, y: 4 },
    sample: 'p.to_h',
    hints: ['Data has to_h method', 'Returns attribute hash'],
    tags: ['Data', 'to_h', 'convert'],
  },
  {
    id: 'ruby-data-515',
    category: 'Data Class',
    difficulty: 'medium',
    title: 'Data with Method',
    text: 'Add method to Data class.',
    setup: 'Point = Data.define(:x, :y) { def magnitude; Math.sqrt(x**2 + y**2); end }',
    setupCode: 'Point = Data.define(:x, :y) { def magnitude; Math.sqrt(x**2 + y**2); end }',
    expected: 5.0,
    sample: 'Point.new(3, 4).magnitude',
    hints: ['Block adds methods to Data', 'Access members directly'],
    tags: ['Data', 'method', 'block'],
  },
  {
    id: 'ruby-data-516',
    category: 'Data Class',
    difficulty: 'hard',
    title: 'Data with Transformation',
    text: 'Create modified copy with with.',
    setup: 'Point = Data.define(:x, :y)\np = Point.new(1, 2)',
    setupCode: 'Point = Data.define(:x, :y)\np = Point.new(1, 2)',
    expected: 10,
    sample: 'p.with(x: 10).x',
    hints: ['with creates modified copy', 'Original unchanged'],
    tags: ['Data', 'with', 'copy'],
  },
  {
    id: 'ruby-data-517',
    category: 'Data Class',
    difficulty: 'easy',
    title: 'Data Equality',
    text: 'Compare Data instances.',
    setup: 'Point = Data.define(:x, :y)\na = Point.new(1, 2)\nb = Point.new(1, 2)',
    setupCode: 'Point = Data.define(:x, :y)\na = Point.new(1, 2)\nb = Point.new(1, 2)',
    expected: true,
    sample: 'a == b',
    hints: ['Data compares by value', 'Same values = equal'],
    tags: ['Data', '==', 'equality'],
  },
  {
    id: 'ruby-data-518',
    category: 'Data Class',
    difficulty: 'medium',
    title: 'Data Deconstruct',
    text: 'Use Data with pattern matching.',
    setup: 'Point = Data.define(:x, :y)\np = Point.new(3, 4)',
    setupCode: 'Point = Data.define(:x, :y)\np = Point.new(3, 4)',
    expected: 3,
    sample: 'case p; in Point(x:, y:); x; end',
    hints: ['Data supports deconstruction', 'Works with pattern matching'],
    tags: ['Data', 'deconstruct', 'pattern'],
  },
  {
    id: 'ruby-data-519',
    category: 'Data Class',
    difficulty: 'easy',
    title: 'Data Members',
    text: 'Get list of Data members.',
    setup: 'Point = Data.define(:x, :y)',
    setupCode: 'Point = Data.define(:x, :y)',
    expected: ['x', 'y'],
    sample: 'Point.members',
    hints: ['members returns attribute list', 'Like Struct'],
    tags: ['Data', 'members', 'attributes'],
  },
  {
    id: 'ruby-ractor-520',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Create Ractor',
    text: 'Create basic Ractor.',
    setup: '# Create Ractor',
    setupCode: '# Create Ractor',
    expected: 42,
    sample: 'r = Ractor.new { 42 }; r.take',
    hints: ['Ractor.new creates parallel actor', 'take gets result'],
    tags: ['Ractor', 'new', 'take'],
  },
  {
    id: 'ruby-ractor-521',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Ractor Send',
    text: 'Send message to Ractor.',
    setup: '# Ractor with receive',
    setupCode: '# Ractor with receive',
    expected: 10,
    sample: 'r = Ractor.new { Ractor.receive * 2 }; r.send(5); r.take',
    hints: ['send puts message in inbox', 'receive gets message'],
    tags: ['Ractor', 'send', 'receive'],
  },
  {
    id: 'ruby-ractor-522',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Ractor Yield',
    text: 'Yield value from Ractor.',
    setup: '# Ractor yield',
    setupCode: '# Ractor yield',
    expected: 'hello',
    sample: 'r = Ractor.new { Ractor.yield "hello"; "done" }; r.take',
    hints: ['yield sends intermediate value', 'take receives it'],
    tags: ['Ractor', 'yield', 'intermediate'],
  },
  {
    id: 'ruby-ractor-523',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Ractor with Arguments',
    text: 'Pass arguments to Ractor.',
    setup: '# Ractor with args',
    setupCode: '# Ractor with args',
    expected: 15,
    sample: 'r = Ractor.new(5, 10) { |a, b| a + b }; r.take',
    hints: ['Args passed to block', 'Values copied (not shared)'],
    tags: ['Ractor', 'arguments', 'copy'],
  },
  {
    id: 'ruby-ractor-524',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Ractor Select',
    text: 'Select from multiple Ractors.',
    setup: '# Multiple Ractors',
    setupCode: '# Multiple Ractors',
    expected: true,
    sample:
      'r1 = Ractor.new { 1 }; r2 = Ractor.new { 2 }; Ractor.select(r1, r2).first.is_a?(Ractor)',
    hints: ['select waits for any Ractor', 'Returns [ractor, value]'],
    tags: ['Ractor', 'select', 'multiple'],
  },
  {
    id: 'ruby-ractor-525',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Ractor Main',
    text: 'Get main Ractor reference.',
    setup: '# Main Ractor',
    setupCode: '# Main Ractor',
    expected: true,
    sample: 'Ractor.main == Ractor.current',
    hints: ['Ractor.main is initial Ractor', 'current is running Ractor'],
    tags: ['Ractor', 'main', 'current'],
  },
  {
    id: 'ruby-ractor-526',
    category: 'Ractor',
    difficulty: 'hard',
    title: 'Ractor Shareable',
    text: 'Make object shareable.',
    setup: 'arr = [1, 2, 3]',
    setupCode: 'arr = [1, 2, 3]',
    expected: true,
    sample: 'Ractor.make_shareable(arr); Ractor.shareable?(arr)',
    hints: ['make_shareable deep freezes', 'shareable? checks status'],
    tags: ['Ractor', 'shareable', 'freeze'],
  },
  {
    id: 'ruby-misc-527',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Array Intersection All',
    text: 'Use intersection for multiple arrays.',
    setup: 'a = [1, 2, 3]\nb = [2, 3, 4]\nc = [3, 4, 5]',
    setupCode: 'a = [1, 2, 3]\nb = [2, 3, 4]\nc = [3, 4, 5]',
    expected: [3],
    sample: 'a.intersection(b, c)',
    hints: ['intersection takes multiple args', 'Ruby 3.1+ feature'],
    tags: ['intersection', 'multiple', 'common'],
  },
  {
    id: 'ruby-misc-528',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Array Union All',
    text: 'Use union for multiple arrays.',
    setup: 'a = [1, 2]\nb = [2, 3]\nc = [3, 4]',
    setupCode: 'a = [1, 2]\nb = [2, 3]\nc = [3, 4]',
    expected: [1, 2, 3, 4],
    sample: 'a.union(b, c)',
    hints: ['union combines unique elements', 'From all arrays'],
    tags: ['union', 'multiple', 'combine'],
  },
  {
    id: 'ruby-misc-529',
    category: 'Array Methods',
    difficulty: 'easy',
    title: 'Array Difference All',
    text: 'Use difference for multiple arrays.',
    setup: 'a = [1, 2, 3, 4, 5]\nb = [2, 4]\nc = [1, 5]',
    setupCode: 'a = [1, 2, 3, 4, 5]\nb = [2, 4]\nc = [1, 5]',
    expected: [3],
    sample: 'a.difference(b, c)',
    hints: ['difference removes from all', 'Sequential removal'],
    tags: ['difference', 'multiple', 'remove'],
  },
  {
    id: 'ruby-misc-530',
    category: 'String Methods',
    difficulty: 'medium',
    title: 'String Undump',
    text: 'Use undump to unescape string.',
    setup: 'escaped = \'"Hello\\\\nWorld"\'',
    setupCode: 'escaped = \'"Hello\\\\nWorld"\'',
    expected: 'Hello\nWorld',
    sample: 'escaped.undump',
    hints: ['undump reverses dump/inspect', 'Interprets escape sequences'],
    tags: ['undump', 'unescape', 'parse'],
  },
  {
    id: 'ruby-misc-531',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'String Dump',
    text: 'Use dump for escaped representation.',
    setup: 'text = "Hello\\nWorld"',
    setupCode: 'text = "Hello\\nWorld"',
    expected: true,
    sample: 'text.dump.include?("\\\\n")',
    hints: ['dump escapes special chars', 'Returns quoted string'],
    tags: ['dump', 'escape', 'debug'],
  },
  {
    id: 'ruby-misc-532',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Hash Except Keys',
    text: 'Use except to exclude keys (Ruby 3.0+).',
    setup: 'h = { a: 1, b: 2, c: 3 }',
    setupCode: 'h = { a: 1, b: 2, c: 3 }',
    expected: { a: 1 },
    sample: 'h.except(:b, :c)',
    hints: ['except excludes specified keys', 'Ruby 3.0+ feature'],
    tags: ['except', 'exclude', 'filter'],
  },
  {
    id: 'ruby-misc-533',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Compact Blank',
    text: 'Filter out blank values.',
    setup: 'items = ["", nil, "hello", " ", "world"]',
    setupCode: 'items = ["", nil, "hello", " ", "world"]',
    expected: ['hello', 'world'],
    sample: 'items.reject { |x| x.nil? || (x.respond_to?(:strip) && x.strip.empty?) }',
    hints: ['Check nil and empty strings', 'strip then empty?'],
    tags: ['compact', 'blank', 'filter'],
  },
  {
    id: 'ruby-misc-534',
    category: 'Enumerable',
    difficulty: 'easy',
    title: 'Sum with Block',
    text: 'Use sum with transformation block.',
    setup: 'items = [{price: 10}, {price: 20}, {price: 30}]',
    setupCode: 'items = [{price: 10}, {price: 20}, {price: 30}]',
    expected: 60,
    sample: 'items.sum { |i| i[:price] }',
    hints: ['sum accepts block for transform', 'Then sums results'],
    tags: ['sum', 'block', 'transform'],
  },
  {
    id: 'ruby-misc-535',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Max By Multiple',
    text: 'Get multiple max values.',
    setup: 'words = ["hi", "hello", "hey", "howdy"]',
    setupCode: 'words = ["hi", "hello", "hey", "howdy"]',
    expected: ['hello', 'howdy'],
    sample: 'words.max_by(2) { |w| w.length }',
    hints: ['max_by(n) returns n largest', 'By block value'],
    tags: ['max_by', 'multiple', 'top'],
  },
  {
    id: 'ruby-misc-536',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Min By Multiple',
    text: 'Get multiple min values.',
    setup: 'numbers = [5, 2, 8, 1, 9, 3]',
    setupCode: 'numbers = [5, 2, 8, 1, 9, 3]',
    expected: [1, 2, 3],
    sample: 'numbers.min(3)',
    hints: ['min(n) returns n smallest', 'Sorted ascending'],
    tags: ['min', 'multiple', 'bottom'],
  },
  {
    id: 'ruby-misc-537',
    category: 'Block Patterns',
    difficulty: 'medium',
    title: 'Then Method Chain',
    text: 'Use then for method chaining.',
    setup: 'value = 5',
    setupCode: 'value = 5',
    expected: 100,
    sample: 'value.then { |v| v * 2 }.then { |v| v * 10 }',
    hints: ['then yields self to block', 'Returns block result'],
    tags: ['then', 'chain', 'transform'],
  },
  {
    id: 'ruby-misc-538',
    category: 'Block Patterns',
    difficulty: 'easy',
    title: 'Yield Self',
    text: 'Use yield_self (alias of then).',
    setup: 'text = "hello"',
    setupCode: 'text = "hello"',
    expected: 'HELLO!',
    sample: 'text.yield_self { |t| t.upcase + "!" }',
    hints: ['yield_self is alias for then', 'Same functionality'],
    tags: ['yield_self', 'then', 'alias'],
  },
  {
    id: 'ruby-misc-539',
    category: 'String Methods',
    difficulty: 'easy',
    title: 'Grapheme Clusters',
    text: 'Iterate over grapheme clusters.',
    setup: 'text = "e\\u0301"  # e with accent',
    setupCode: 'text = "e\\u0301"  # e with accent',
    expected: 1,
    sample: 'text.grapheme_clusters.count',
    hints: ['grapheme_clusters handles unicode', 'Better than chars for emoji'],
    tags: ['grapheme_clusters', 'unicode', 'emoji'],
  },
  {
    id: 'ruby-misc-540',
    category: 'Enumerable',
    difficulty: 'hard',
    title: 'Reduce with Index',
    text: 'Use each_with_index in reduce.',
    setup: 'letters = ["a", "b", "c"]',
    setupCode: 'letters = ["a", "b", "c"]',
    expected: { a: 0, b: 1, c: 2 },
    sample: 'letters.each_with_index.reduce({}) { |h, (letter, i)| h[letter.to_sym] = i; h }',
    hints: ['Chain with_index before reduce', 'Destructure in block'],
    tags: ['reduce', 'with_index', 'transform'],
  },
  {
    id: 'ruby-misc-541',
    category: 'Array Methods',
    difficulty: 'medium',
    title: 'Deconstruct Array',
    text: 'Use deconstruction assignment.',
    setup: 'arr = [1, 2, 3, 4, 5]',
    setupCode: 'arr = [1, 2, 3, 4, 5]',
    expected: [2, 3, 4],
    sample: 'first, *middle, last = arr; middle',
    hints: ['* captures middle elements', 'Multiple assignment'],
    tags: ['deconstruct', 'splat', 'assign'],
  },
  {
    id: 'ruby-misc-542',
    category: 'Hash Methods',
    difficulty: 'medium',
    title: 'Deconstruct Hash',
    text: 'Use hash deconstruction.',
    setup: 'person = { name: "Alice", age: 30, city: "NYC" }',
    setupCode: 'person = { name: "Alice", age: 30, city: "NYC" }',
    expected: 'Alice',
    sample: 'person => { name: }; name',
    hints: ['=> destructures hash', 'Ruby 3.0+ feature'],
    tags: ['deconstruct', 'hash', '=>'],
  },
  {
    id: 'ruby-misc-543',
    category: 'Enumerable',
    difficulty: 'medium',
    title: 'Tally Transform',
    text: 'Transform values after tally.',
    setup: 'items = ["a", "b", "a", "c", "a", "b"]',
    setupCode: 'items = ["a", "b", "a", "c", "a", "b"]',
    expected: { a: 6, b: 4, c: 2 },
    sample: 'items.tally.transform_values { |v| v * 2 }',
    hints: ['Chain transform_values after tally', 'Modify counts'],
    tags: ['tally', 'transform_values', 'chain'],
  },
  {
    id: 'ruby-misc-544',
    category: 'Range',
    difficulty: 'medium',
    title: 'Range Overlap',
    text: 'Check if ranges overlap.',
    setup: 'a = 1..5\nb = 4..8',
    setupCode: 'a = 1..5\nb = 4..8',
    expected: true,
    sample: 'a.cover?(b.begin) || b.cover?(a.begin)',
    hints: ['Check if either contains other start', 'Or use begin/end comparison'],
    tags: ['range', 'overlap', 'intersect'],
  },
  {
    id: 'ruby-misc-545',
    category: 'Struct/OpenStruct',
    difficulty: 'medium',
    title: 'Struct Dig',
    text: 'Use dig with nested Structs.',
    setup:
      'Address = Struct.new(:city)\nPerson = Struct.new(:name, :address)\np = Person.new("Alice", Address.new("NYC"))',
    setupCode:
      'Address = Struct.new(:city)\nPerson = Struct.new(:name, :address)\np = Person.new("Alice", Address.new("NYC"))',
    expected: 'NYC',
    sample: 'p.dig(:address, :city)',
    hints: ['dig works on Structs', 'Navigate nested structures'],
    tags: ['Struct', 'dig', 'nested'],
  },
  {
    id: 'ruby-misc-546',
    category: 'Metaprogramming',
    difficulty: 'hard',
    title: 'Refinement',
    text: 'Use refinement to add method locally.',
    setup: 'module StringExt; refine String do; def shout; upcase + "!"; end; end; end',
    setupCode: 'module StringExt; refine String do; def shout; upcase + "!"; end; end; end',
    expected: 'HELLO!',
    sample: 'using StringExt; "hello".shout',
    hints: ['refine adds scoped methods', 'using activates refinement'],
    tags: ['refinement', 'refine', 'using'],
  },
  {
    id: 'ruby-misc-547',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Comparable Mixin',
    text: 'Include Comparable for comparison methods.',
    setup:
      'class Box; include Comparable; attr_reader :size; def initialize(s); @size = s; end; def <=>(other); size <=> other.size; end; end',
    setupCode:
      'class Box; include Comparable; attr_reader :size; def initialize(s); @size = s; end; def <=>(other); size <=> other.size; end; end',
    expected: true,
    sample: 'Box.new(5) > Box.new(3)',
    hints: ['Comparable adds <, >, etc.', 'Define <=> method'],
    tags: ['Comparable', 'mixin', 'comparison'],
  },
  {
    id: 'ruby-misc-548',
    category: 'Object-Oriented',
    difficulty: 'medium',
    title: 'Enumerable Custom',
    text: 'Include Enumerable in custom class.',
    setup:
      'class MyCollection; include Enumerable; def initialize(arr); @arr = arr; end; def each(&block); @arr.each(&block); end; end',
    setupCode:
      'class MyCollection; include Enumerable; def initialize(arr); @arr = arr; end; def each(&block); @arr.each(&block); end; end',
    expected: [2, 4, 6],
    sample: 'MyCollection.new([1, 2, 3]).map { |n| n * 2 }',
    hints: ['Enumerable needs each method', 'Gets all enumerable methods'],
    tags: ['Enumerable', 'include', 'custom'],
  },
  {
    id: 'ruby-misc-549',
    category: 'Block Patterns',
    difficulty: 'hard',
    title: 'Proc Source Location',
    text: 'Get source location of proc.',
    setup: 'my_proc = proc { |x| x * 2 }',
    setupCode: 'my_proc = proc { |x| x * 2 }',
    expected: true,
    sample: 'my_proc.source_location.is_a?(Array)',
    hints: ['source_location returns [file, line]', 'Useful for debugging'],
    tags: ['proc', 'source_location', 'debug'],
  },
];

export default rubyProblems;
